
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>DIPY &#8212; dipy 1.0.0 documentation</title>
    <link rel="stylesheet" href="../_static/dipy.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
  <meta name="keywords" content="DIPY, dMRI, DTI, DSI, diffusion MRI, Tensor,
  neuroimaging, python, neuroscience, Eleftherios, Garyfallidis, tractography,
  streamlines, fiber tracking">

  </head><body>
<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
 <a href="../index.html">
  <img src="../_static/dipy-banner.png" alt="DIPY logo"  border="0" />
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
  <li><a href="../index.html">Home</a> |&nbsp;</li>
  <li><a href="../stateoftheart.html">Overview</a> |&nbsp;</li>
  <li><a href="../examples_index.html">Gallery</a> |&nbsp;</li>
  <li><a href="../installation.html">Download</a> |&nbsp;</li>
  <li><a href="../subscribe.html">Subscribe</a> |&nbsp;</li>
  <li><a href="../developers.html">Developers</a> |&nbsp;</li>
  <li><a href="../cite.html">Cite</a> &nbsp;</li>
 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">


<h4> Site Navigation </h4>
  <ul>
    <li><a href="../documentation.html">Documentation</a></li>
    <li><a href="../devel/index.html">Development</a></li>
  </ul>

<h4> NIPY Community </h4>
  <ul class="simple">
    <li><a class="reference external"
	href="http://nipy.org/">Community Home</a></li>
    <li><a class="reference external"
	href="http://nipy.org/">NIPY Projects</a></li>
    <li><a class="reference external"
	href="https://mail.python.org/mailman/listinfo/neuroimaging">Mailing List</a></li>
    <li><a class="reference external"
	href="http://nipy.org/nipy/license.html">License</a></li>
  </ul>


  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Tractography Clustering - Available Features</a><ul>
<li><a class="reference internal" href="#clustering-examples-identityfeature">Identity Feature</a></li>
<li><a class="reference internal" href="#resample-feature">Resample Feature</a></li>
<li><a class="reference internal" href="#center-of-mass-feature">Center of Mass Feature</a></li>
<li><a class="reference internal" href="#midpoint-feature">Midpoint Feature</a></li>
<li><a class="reference internal" href="#arclength-feature">ArcLength Feature</a></li>
<li><a class="reference internal" href="#vector-between-endpoints-feature">Vector Between Endpoints Feature</a></li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/examples_built/segment_clustering_features.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="tractography-clustering-available-features">
<span id="example-segment-clustering-features"></span><h1>Tractography Clustering - Available Features<a class="headerlink" href="#tractography-clustering-available-features" title="Permalink to this headline">¶</a></h1>
<p>This page lists available features that can be used by the tractography
clustering framework. For every feature a brief description is provided
explaining: what it does, when it’s useful and how to use it. If you are not
familiar with the tractography clustering framework, read the
<a class="reference internal" href="segment_extending_clustering_framework.html#clustering-framework"><span class="std std-ref">Clustering framework</span></a> first.</p>
<div class="contents local topic" id="available-features">
<p class="topic-title first">Available Features</p>
<ul class="simple">
<li><p><a class="reference internal" href="#clustering-examples-identityfeature" id="id8">Identity Feature</a></p></li>
<li><p><a class="reference internal" href="#resample-feature" id="id9">Resample Feature</a></p></li>
<li><p><a class="reference internal" href="#center-of-mass-feature" id="id10">Center of Mass Feature</a></p></li>
<li><p><a class="reference internal" href="#midpoint-feature" id="id11">Midpoint Feature</a></p></li>
<li><p><a class="reference internal" href="#arclength-feature" id="id12">ArcLength Feature</a></p></li>
<li><p><a class="reference internal" href="#vector-between-endpoints-feature" id="id13">Vector Between Endpoints Feature</a></p></li>
</ul>
</div>
<p><strong>Note</strong>:
All examples assume a function <cite>get_streamlines</cite> exists. We defined here a
simple function to do so. It imports the necessary modules and load a small
streamline bundle.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_streamlines</span><span class="p">():</span>
    <span class="kn">from</span> <span class="nn">dipy.data</span> <span class="k">import</span> <span class="n">get_fnames</span>
    <span class="kn">from</span> <span class="nn">dipy.io.streamline</span> <span class="k">import</span> <span class="n">load_tractogram</span>
    <span class="kn">from</span> <span class="nn">dipy.tracking.streamline</span> <span class="k">import</span> <span class="n">Streamlines</span>

    <span class="n">fname</span> <span class="o">=</span> <span class="n">get_fnames</span><span class="p">(</span><span class="s1">&#39;fornix&#39;</span><span class="p">)</span>
    <span class="n">fornix</span> <span class="o">=</span> <span class="n">load_tractogram</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;same&#39;</span><span class="p">,</span>
                             <span class="n">bbox_valid_check</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">streamlines</span>

    <span class="n">streamlines</span> <span class="o">=</span> <span class="n">Streamlines</span><span class="p">(</span><span class="n">fornix</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">streamlines</span>
</pre></div>
</div>
<div class="section" id="clustering-examples-identityfeature">
<span id="identity-feature"></span><h2><a class="toc-backref" href="#id8">Identity Feature</a><a class="headerlink" href="#clustering-examples-identityfeature" title="Permalink to this headline">¶</a></h2>
<p><strong>What:</strong> Instances of <cite>IdentityFeature</cite> simply return the streamlines
unaltered.  In other words the features are the original data.</p>
<p><strong>When:</strong> The QuickBundles algorithm requires streamlines to have the same
number of points. If this is the case for your streamlines, you can tell
QuickBundles to not perform resampling (see following example). The clustering
should be faster than using the default behaviour of QuickBundles since it will
require less computation (i.e. no resampling). However, it highly depends
on the number of points streamlines have. By default, QuickBundles resamples
streamlines so that they have 12 points each <a class="reference internal" href="tracking_introduction_eudx.html#garyfallidis12" id="id1"><span>[Garyfallidis12]</span></a>.</p>
<p><em>Unless stated otherwise, it is the default feature used by `Metric` objects
in the clustering framework.</em></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dipy.segment.clustering</span> <span class="k">import</span> <span class="n">QuickBundles</span>
<span class="kn">from</span> <span class="nn">dipy.segment.metric</span> <span class="k">import</span> <span class="n">IdentityFeature</span>
<span class="kn">from</span> <span class="nn">dipy.segment.metric</span> <span class="k">import</span> <span class="n">AveragePointwiseEuclideanMetric</span>

<span class="c1"># Get some streamlines.</span>
<span class="n">streamlines</span> <span class="o">=</span> <span class="n">get_streamlines</span><span class="p">()</span>  <span class="c1"># Previously defined.</span>

<span class="c1"># Make sure our streamlines have the same number of points.</span>
<span class="kn">from</span> <span class="nn">dipy.tracking.streamline</span> <span class="k">import</span> <span class="n">set_number_of_points</span>
<span class="n">streamlines</span> <span class="o">=</span> <span class="n">set_number_of_points</span><span class="p">(</span><span class="n">streamlines</span><span class="p">,</span> <span class="n">nb_points</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

<span class="c1"># Create an instance of `IdentityFeature` and tell metric to use it.</span>
<span class="n">feature</span> <span class="o">=</span> <span class="n">IdentityFeature</span><span class="p">()</span>
<span class="n">metric</span> <span class="o">=</span> <span class="n">AveragePointwiseEuclideanMetric</span><span class="p">(</span><span class="n">feature</span><span class="o">=</span><span class="n">feature</span><span class="p">)</span>
<span class="n">qb</span> <span class="o">=</span> <span class="n">QuickBundles</span><span class="p">(</span><span class="n">threshold</span><span class="o">=</span><span class="mf">10.</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="n">metric</span><span class="p">)</span>
<span class="n">clusters</span> <span class="o">=</span> <span class="n">qb</span><span class="o">.</span><span class="n">cluster</span><span class="p">(</span><span class="n">streamlines</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Nb. clusters:&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">clusters</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cluster sizes:&quot;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="n">clusters</span><span class="p">)))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Nb</span><span class="o">.</span> <span class="n">clusters</span><span class="p">:</span> <span class="mi">4</span>

<span class="n">Cluster</span> <span class="n">sizes</span><span class="p">:</span> <span class="p">[</span><span class="mi">64</span><span class="p">,</span> <span class="mi">191</span><span class="p">,</span> <span class="mi">47</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="resample-feature">
<span id="clustering-examples-resamplefeature"></span><h2><a class="toc-backref" href="#id9">Resample Feature</a><a class="headerlink" href="#resample-feature" title="Permalink to this headline">¶</a></h2>
<p><strong>What:</strong> Instances of <cite>ResampleFeature</cite> resample streamlines to a
predetermined number of points. The resampling is done on the fly such that
there are no permanent modifications made to your streamlines.</p>
<p><strong>When:</strong> The QuickBundles algorithm requires streamlines to have the same
number of points. By default, QuickBundles uses <cite>ResampleFeature</cite> to resample
streamlines so that they have 12 points each <a class="reference internal" href="tracking_introduction_eudx.html#garyfallidis12" id="id2"><span>[Garyfallidis12]</span></a>. If you want to
use a different number of points for the resampling, you should provide your
own instance of <cite>ResampleFeature</cite> (see following example).</p>
<p><strong>Note:</strong> Resampling streamlines has an impact on clustering results both in
term of speed and quality. Setting the number of points too low will result in
a loss of information about the shape of the streamlines. On the contrary,
setting the number of points too high will slow down the clustering process.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dipy.segment.clustering</span> <span class="k">import</span> <span class="n">QuickBundles</span>
<span class="kn">from</span> <span class="nn">dipy.segment.metric</span> <span class="k">import</span> <span class="n">ResampleFeature</span>
<span class="kn">from</span> <span class="nn">dipy.segment.metric</span> <span class="k">import</span> <span class="n">AveragePointwiseEuclideanMetric</span>

<span class="c1"># Get some streamlines.</span>
<span class="n">streamlines</span> <span class="o">=</span> <span class="n">get_streamlines</span><span class="p">()</span>  <span class="c1"># Previously defined.</span>

<span class="c1"># Streamlines will be resampled to 24 points on the fly.</span>
<span class="n">feature</span> <span class="o">=</span> <span class="n">ResampleFeature</span><span class="p">(</span><span class="n">nb_points</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
<span class="n">metric</span> <span class="o">=</span> <span class="n">AveragePointwiseEuclideanMetric</span><span class="p">(</span><span class="n">feature</span><span class="o">=</span><span class="n">feature</span><span class="p">)</span>  <span class="c1"># a.k.a. MDF</span>
<span class="n">qb</span> <span class="o">=</span> <span class="n">QuickBundles</span><span class="p">(</span><span class="n">threshold</span><span class="o">=</span><span class="mf">10.</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="n">metric</span><span class="p">)</span>
<span class="n">clusters</span> <span class="o">=</span> <span class="n">qb</span><span class="o">.</span><span class="n">cluster</span><span class="p">(</span><span class="n">streamlines</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Nb. clusters:&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">clusters</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cluster sizes:&quot;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="n">clusters</span><span class="p">)))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Nb</span><span class="o">.</span> <span class="n">clusters</span><span class="p">:</span> <span class="mi">4</span>

<span class="n">Cluster</span> <span class="n">sizes</span><span class="p">:</span> <span class="p">[</span><span class="mi">64</span><span class="p">,</span> <span class="mi">191</span><span class="p">,</span> <span class="mi">44</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="center-of-mass-feature">
<span id="clustering-examples-centerofmassfeature"></span><h2><a class="toc-backref" href="#id10">Center of Mass Feature</a><a class="headerlink" href="#center-of-mass-feature" title="Permalink to this headline">¶</a></h2>
<p><strong>What:</strong> Instances of <cite>CenterOfMassFeature</cite> compute the center of mass (also
known as center of gravity) of a set of points. This is achieved by taking the
mean of every coordinate independently (for more information see the
<a class="reference external" href="https://en.wikipedia.org/wiki/Center_of_mass">wiki page</a>).</p>
<p><strong>When:</strong> This feature can be useful when you <em>only</em> need information about the
spatial position of a streamline.</p>
<p><strong>Note:</strong> The computed center is not guaranteed to be an existing point in the
streamline.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">dipy.viz</span> <span class="k">import</span> <span class="n">window</span><span class="p">,</span> <span class="n">actor</span>
<span class="kn">from</span> <span class="nn">dipy.segment.clustering</span> <span class="k">import</span> <span class="n">QuickBundles</span>
<span class="kn">from</span> <span class="nn">dipy.segment.metric</span> <span class="k">import</span> <span class="n">CenterOfMassFeature</span>
<span class="kn">from</span> <span class="nn">dipy.segment.metric</span> <span class="k">import</span> <span class="n">EuclideanMetric</span>

<span class="c1"># Enables/disables interactive visualization</span>
<span class="n">interactive</span> <span class="o">=</span> <span class="kc">False</span>

<span class="c1"># Get some streamlines.</span>
<span class="n">streamlines</span> <span class="o">=</span> <span class="n">get_streamlines</span><span class="p">()</span>  <span class="c1"># Previously defined.</span>


<span class="n">feature</span> <span class="o">=</span> <span class="n">CenterOfMassFeature</span><span class="p">()</span>
<span class="n">metric</span> <span class="o">=</span> <span class="n">EuclideanMetric</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>

<span class="n">qb</span> <span class="o">=</span> <span class="n">QuickBundles</span><span class="p">(</span><span class="n">threshold</span><span class="o">=</span><span class="mf">5.</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="n">metric</span><span class="p">)</span>
<span class="n">clusters</span> <span class="o">=</span> <span class="n">qb</span><span class="o">.</span><span class="n">cluster</span><span class="p">(</span><span class="n">streamlines</span><span class="p">)</span>

<span class="c1"># Extract feature of every streamline.</span>
<span class="n">centers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">feature</span><span class="o">.</span><span class="n">extract</span><span class="p">,</span> <span class="n">streamlines</span><span class="p">)))</span>

<span class="c1"># Color each center of mass according to the cluster they belong to.</span>
<span class="n">colormap</span> <span class="o">=</span> <span class="n">actor</span><span class="o">.</span><span class="n">create_colormap</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">clusters</span><span class="p">)))</span>
<span class="n">colormap_full</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">streamlines</span><span class="p">),</span> <span class="mi">3</span><span class="p">))</span>
<span class="k">for</span> <span class="n">cluster</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">clusters</span><span class="p">,</span> <span class="n">colormap</span><span class="p">):</span>
    <span class="n">colormap_full</span><span class="p">[</span><span class="n">cluster</span><span class="o">.</span><span class="n">indices</span><span class="p">]</span> <span class="o">=</span> <span class="n">color</span>

<span class="c1"># Visualization</span>
<span class="n">ren</span> <span class="o">=</span> <span class="n">window</span><span class="o">.</span><span class="n">Renderer</span><span class="p">()</span>
<span class="n">window</span><span class="o">.</span><span class="n">clear</span><span class="p">(</span><span class="n">ren</span><span class="p">)</span>
<span class="n">ren</span><span class="o">.</span><span class="n">SetBackground</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">ren</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">actor</span><span class="o">.</span><span class="n">streamtube</span><span class="p">(</span><span class="n">streamlines</span><span class="p">,</span> <span class="n">window</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">white</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.05</span><span class="p">))</span>
<span class="n">ren</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">actor</span><span class="o">.</span><span class="n">point</span><span class="p">(</span><span class="n">centers</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">colormap_full</span><span class="p">,</span> <span class="n">point_radius</span><span class="o">=</span><span class="mf">0.2</span><span class="p">))</span>
<span class="n">window</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="n">ren</span><span class="p">,</span> <span class="n">n_frames</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">out_path</span><span class="o">=</span><span class="s1">&#39;center_of_mass_feature.png&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">600</span><span class="p">,</span> <span class="mi">600</span><span class="p">))</span>
<span class="k">if</span> <span class="n">interactive</span><span class="p">:</span>
    <span class="n">window</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">ren</span><span class="p">)</span>
</pre></div>
</div>
<div class="figure align-center" id="id4">
<img alt="../_images/center_of_mass_feature.png" src="../_images/center_of_mass_feature.png" />
<p class="caption"><span class="caption-text">Showing the center of mass of each streamline and colored according to
the QuickBundles results.</span><a class="headerlink" href="#id4" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="midpoint-feature">
<span id="clustering-examples-midpointfeature"></span><h2><a class="toc-backref" href="#id11">Midpoint Feature</a><a class="headerlink" href="#midpoint-feature" title="Permalink to this headline">¶</a></h2>
<p><strong>What:</strong> Instances of <cite>MidpointFeature</cite> extract the middle point of a
streamline. If there is an even number of points, the feature will then
correspond to the point halfway between the two middle points.</p>
<p><strong>When:</strong> This feature can be useful when you <em>only</em> need information about the
spatial position of a streamline. This can also be an alternative to the
<cite>CenterOfMassFeature</cite> if the point extracted must be on the streamline.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">dipy.viz</span> <span class="k">import</span> <span class="n">window</span><span class="p">,</span> <span class="n">actor</span>
<span class="kn">from</span> <span class="nn">dipy.segment.clustering</span> <span class="k">import</span> <span class="n">QuickBundles</span>
<span class="kn">from</span> <span class="nn">dipy.segment.metric</span> <span class="k">import</span> <span class="n">MidpointFeature</span>
<span class="kn">from</span> <span class="nn">dipy.segment.metric</span> <span class="k">import</span> <span class="n">EuclideanMetric</span>

<span class="c1"># Get some streamlines.</span>
<span class="n">streamlines</span> <span class="o">=</span> <span class="n">get_streamlines</span><span class="p">()</span>  <span class="c1"># Previously defined.</span>

<span class="n">feature</span> <span class="o">=</span> <span class="n">MidpointFeature</span><span class="p">()</span>
<span class="n">metric</span> <span class="o">=</span> <span class="n">EuclideanMetric</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>

<span class="n">qb</span> <span class="o">=</span> <span class="n">QuickBundles</span><span class="p">(</span><span class="n">threshold</span><span class="o">=</span><span class="mf">5.</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="n">metric</span><span class="p">)</span>
<span class="n">clusters</span> <span class="o">=</span> <span class="n">qb</span><span class="o">.</span><span class="n">cluster</span><span class="p">(</span><span class="n">streamlines</span><span class="p">)</span>

<span class="c1"># Extract feature of every streamline.</span>
<span class="n">midpoints</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">feature</span><span class="o">.</span><span class="n">extract</span><span class="p">,</span> <span class="n">streamlines</span><span class="p">)))</span>

<span class="c1"># Color each midpoint according to the cluster they belong to.</span>
<span class="n">colormap</span> <span class="o">=</span> <span class="n">actor</span><span class="o">.</span><span class="n">create_colormap</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">clusters</span><span class="p">)))</span>
<span class="n">colormap_full</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">streamlines</span><span class="p">),</span> <span class="mi">3</span><span class="p">))</span>
<span class="k">for</span> <span class="n">cluster</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">clusters</span><span class="p">,</span> <span class="n">colormap</span><span class="p">):</span>
    <span class="n">colormap_full</span><span class="p">[</span><span class="n">cluster</span><span class="o">.</span><span class="n">indices</span><span class="p">]</span> <span class="o">=</span> <span class="n">color</span>

<span class="c1"># Visualization</span>
<span class="n">ren</span> <span class="o">=</span> <span class="n">window</span><span class="o">.</span><span class="n">Renderer</span><span class="p">()</span>
<span class="n">window</span><span class="o">.</span><span class="n">clear</span><span class="p">(</span><span class="n">ren</span><span class="p">)</span>
<span class="n">ren</span><span class="o">.</span><span class="n">SetBackground</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">ren</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">actor</span><span class="o">.</span><span class="n">point</span><span class="p">(</span><span class="n">midpoints</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">colormap_full</span><span class="p">,</span> <span class="n">point_radius</span><span class="o">=</span><span class="mf">0.2</span><span class="p">))</span>
<span class="n">ren</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">actor</span><span class="o">.</span><span class="n">streamtube</span><span class="p">(</span><span class="n">streamlines</span><span class="p">,</span> <span class="n">window</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">white</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.05</span><span class="p">))</span>
<span class="n">window</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="n">ren</span><span class="p">,</span> <span class="n">n_frames</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">out_path</span><span class="o">=</span><span class="s1">&#39;midpoint_feature.png&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">600</span><span class="p">,</span> <span class="mi">600</span><span class="p">))</span>
<span class="k">if</span> <span class="n">interactive</span><span class="p">:</span>
    <span class="n">window</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">ren</span><span class="p">)</span>
</pre></div>
</div>
<div class="figure align-center" id="id5">
<img alt="../_images/midpoint_feature.png" src="../_images/midpoint_feature.png" />
<p class="caption"><span class="caption-text">Showing the middle point of each streamline and colored according to the
QuickBundles results.</span><a class="headerlink" href="#id5" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="arclength-feature">
<span id="clustering-examples-arclengthfeature"></span><h2><a class="toc-backref" href="#id12">ArcLength Feature</a><a class="headerlink" href="#arclength-feature" title="Permalink to this headline">¶</a></h2>
<p><strong>What:</strong> Instances of <cite>ArcLengthFeature</cite> compute the length of a streamline.
More specifically, this feature corresponds to the sum of the lengths of every
streamline segments.</p>
<p><strong>When:</strong> This feature can be useful when you <em>only</em> need information about the
length of a streamline.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">dipy.viz</span> <span class="k">import</span> <span class="n">window</span><span class="p">,</span> <span class="n">actor</span>
<span class="kn">from</span> <span class="nn">dipy.segment.clustering</span> <span class="k">import</span> <span class="n">QuickBundles</span>
<span class="kn">from</span> <span class="nn">dipy.segment.metric</span> <span class="k">import</span> <span class="n">ArcLengthFeature</span>
<span class="kn">from</span> <span class="nn">dipy.segment.metric</span> <span class="k">import</span> <span class="n">EuclideanMetric</span>

<span class="c1"># Get some streamlines.</span>
<span class="n">streamlines</span> <span class="o">=</span> <span class="n">get_streamlines</span><span class="p">()</span>  <span class="c1"># Previously defined.</span>

<span class="n">feature</span> <span class="o">=</span> <span class="n">ArcLengthFeature</span><span class="p">()</span>
<span class="n">metric</span> <span class="o">=</span> <span class="n">EuclideanMetric</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
<span class="n">qb</span> <span class="o">=</span> <span class="n">QuickBundles</span><span class="p">(</span><span class="n">threshold</span><span class="o">=</span><span class="mf">2.</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="n">metric</span><span class="p">)</span>
<span class="n">clusters</span> <span class="o">=</span> <span class="n">qb</span><span class="o">.</span><span class="n">cluster</span><span class="p">(</span><span class="n">streamlines</span><span class="p">)</span>

<span class="c1"># Color each streamline according to the cluster they belong to.</span>
<span class="n">colormap</span> <span class="o">=</span> <span class="n">actor</span><span class="o">.</span><span class="n">create_colormap</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">clusters</span><span class="o">.</span><span class="n">centroids</span><span class="p">))</span>
<span class="n">colormap_full</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">streamlines</span><span class="p">),</span> <span class="mi">3</span><span class="p">))</span>
<span class="k">for</span> <span class="n">cluster</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">clusters</span><span class="p">,</span> <span class="n">colormap</span><span class="p">):</span>
    <span class="n">colormap_full</span><span class="p">[</span><span class="n">cluster</span><span class="o">.</span><span class="n">indices</span><span class="p">]</span> <span class="o">=</span> <span class="n">color</span>

<span class="c1"># Visualization</span>
<span class="n">ren</span> <span class="o">=</span> <span class="n">window</span><span class="o">.</span><span class="n">Renderer</span><span class="p">()</span>
<span class="n">window</span><span class="o">.</span><span class="n">clear</span><span class="p">(</span><span class="n">ren</span><span class="p">)</span>
<span class="n">ren</span><span class="o">.</span><span class="n">SetBackground</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">ren</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">actor</span><span class="o">.</span><span class="n">streamtube</span><span class="p">(</span><span class="n">streamlines</span><span class="p">,</span> <span class="n">colormap_full</span><span class="p">))</span>
<span class="n">window</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="n">ren</span><span class="p">,</span> <span class="n">out_path</span><span class="o">=</span><span class="s1">&#39;arclength_feature.png&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">600</span><span class="p">,</span> <span class="mi">600</span><span class="p">))</span>
<span class="k">if</span> <span class="n">interactive</span><span class="p">:</span>
    <span class="n">window</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">ren</span><span class="p">)</span>
</pre></div>
</div>
<div class="figure align-center" id="id6">
<img alt="../_images/arclength_feature.png" src="../_images/arclength_feature.png" />
<p class="caption"><span class="caption-text">Showing the streamlines colored according to their length.</span><a class="headerlink" href="#id6" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="vector-between-endpoints-feature">
<span id="clustering-examples-vectorofendpointsfeature"></span><h2><a class="toc-backref" href="#id13">Vector Between Endpoints Feature</a><a class="headerlink" href="#vector-between-endpoints-feature" title="Permalink to this headline">¶</a></h2>
<p><strong>What:</strong> Instances of <cite>VectorOfEndpointsFeature</cite> extract the vector going
from one extremity of the streamline to the other. In other words, this feature
represents the vector beginning at the first point and ending at the last point
of the streamlines.</p>
<p><strong>When:</strong> This feature can be useful when you <em>only</em> need information about the
orientation of a streamline.</p>
<p><strong>Note:</strong> Since streamlines endpoints are ambiguous (e.g. the first point could
be either the beginning or the end of the streamline), one must be careful when
using this feature.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">dipy.viz</span> <span class="k">import</span> <span class="n">window</span><span class="p">,</span> <span class="n">actor</span>
<span class="kn">from</span> <span class="nn">dipy.segment.clustering</span> <span class="k">import</span> <span class="n">QuickBundles</span>
<span class="kn">from</span> <span class="nn">dipy.segment.metric</span> <span class="k">import</span> <span class="n">VectorOfEndpointsFeature</span>
<span class="kn">from</span> <span class="nn">dipy.segment.metric</span> <span class="k">import</span> <span class="n">CosineMetric</span>

<span class="c1"># Get some streamlines.</span>
<span class="n">streamlines</span> <span class="o">=</span> <span class="n">get_streamlines</span><span class="p">()</span>  <span class="c1"># Previously defined.</span>

<span class="n">feature</span> <span class="o">=</span> <span class="n">VectorOfEndpointsFeature</span><span class="p">()</span>
<span class="n">metric</span> <span class="o">=</span> <span class="n">CosineMetric</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
<span class="n">qb</span> <span class="o">=</span> <span class="n">QuickBundles</span><span class="p">(</span><span class="n">threshold</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="n">metric</span><span class="p">)</span>
<span class="n">clusters</span> <span class="o">=</span> <span class="n">qb</span><span class="o">.</span><span class="n">cluster</span><span class="p">(</span><span class="n">streamlines</span><span class="p">)</span>

<span class="c1"># Color each streamline according to the cluster they belong to.</span>
<span class="n">colormap</span> <span class="o">=</span> <span class="n">actor</span><span class="o">.</span><span class="n">create_colormap</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">clusters</span><span class="p">)))</span>
<span class="n">colormap_full</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">streamlines</span><span class="p">),</span> <span class="mi">3</span><span class="p">))</span>
<span class="k">for</span> <span class="n">cluster</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">clusters</span><span class="p">,</span> <span class="n">colormap</span><span class="p">):</span>
    <span class="n">colormap_full</span><span class="p">[</span><span class="n">cluster</span><span class="o">.</span><span class="n">indices</span><span class="p">]</span> <span class="o">=</span> <span class="n">color</span>

<span class="c1"># Visualization</span>
<span class="n">ren</span> <span class="o">=</span> <span class="n">window</span><span class="o">.</span><span class="n">Renderer</span><span class="p">()</span>
<span class="n">window</span><span class="o">.</span><span class="n">clear</span><span class="p">(</span><span class="n">ren</span><span class="p">)</span>
<span class="n">ren</span><span class="o">.</span><span class="n">SetBackground</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">ren</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">actor</span><span class="o">.</span><span class="n">streamtube</span><span class="p">(</span><span class="n">streamlines</span><span class="p">,</span> <span class="n">colormap_full</span><span class="p">))</span>
<span class="n">window</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="n">ren</span><span class="p">,</span> <span class="n">out_path</span><span class="o">=</span><span class="s1">&#39;vector_of_endpoints_feature.png&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">600</span><span class="p">,</span> <span class="mi">600</span><span class="p">))</span>
<span class="k">if</span> <span class="n">interactive</span><span class="p">:</span>
    <span class="n">window</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">ren</span><span class="p">)</span>
</pre></div>
</div>
<div class="figure align-center" id="id7">
<img alt="../_images/vector_of_endpoints_feature.png" src="../_images/vector_of_endpoints_feature.png" />
<p class="caption"><span class="caption-text">Showing the streamlines colored according to their orientation.</span><a class="headerlink" href="#id7" title="Permalink to this image">¶</a></p>
</div>
<dl class="citation">
<dt class="label" id="garyfallidis12"><span class="brackets">Garyfallidis12</span><span class="fn-backref">(<a href="#id1">1</a>,<a href="#id2">2</a>)</span></dt>
<dd><p>Garyfallidis E. et al., QuickBundles a method for
tractography simplification, Frontiers in Neuroscience, vol 6, no 175, 2012.</p>
</dd>
</dl>
<div class="admonition-example-source-code admonition">
<p class="admonition-title">Example source code</p>
<p>You can download <a class="reference download internal" download="" href="../_downloads/1b490ed1ab9a3a2e207679342bf6e176/segment_clustering_features.py"><code class="xref download docutils literal notranslate"><span class="pre">the</span> <span class="pre">full</span> <span class="pre">source</span> <span class="pre">code</span> <span class="pre">of</span> <span class="pre">this</span> <span class="pre">example</span></code></a>. This same script is also included in the dipy source distribution under the <code class="file docutils literal notranslate"><span class="pre">doc/examples/</span></code> directory.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
  <li><a href="../index.html">Home</a> |&nbsp;</li>
  <li><a href="../stateoftheart.html">Overview</a> |&nbsp;</li>
  <li><a href="../examples_index.html">Gallery</a> |&nbsp;</li>
  <li><a href="../installation.html">Download</a> |&nbsp;</li>
  <li><a href="../subscribe.html">Subscribe</a> |&nbsp;</li>
  <li><a href="../developers.html">Developers</a> |&nbsp;</li>
  <li><a href="../cite.html">Cite</a> &nbsp;</li>
 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2008-2019, dipy developers &lt;neuroimaging@python.org&gt;.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.1.2.
    </div>
  </body>
</html>