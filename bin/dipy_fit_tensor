#!/usr/bin/env python
from optparse import OptionParser
from dipy.workflows.fit_tensor import fit_tensor


usage = """fit_tensor [options] dwi_images"""
parser = OptionParser(usage)
parser.add_option("-b","--bvec",help="text file with gradient directions")
parser.add_option("-r","--root",help="root for files to be saved")
parser.add_option("-m","--mask",default="median_otsu",
                  help="auto-mask by default, --mask=none to not use mask, "
                       "--mask=file.nii.gz for custom mask")
parser.add_option("--threshold",help="threshold passed to BET", default='.2')
parser.add_option("--min_signal",help="minimum valid singal value",
                  type='float', default=1.)
parser.add_option("--save-tensor", action='store_true', help="Save tensor in "
                        "nifti symmat format")
parser.add_option("--scale", type='float', default=1., help="used to scale "
                        "tensor file when --save-tensor is used")
opts, args = parser.parse_args()


if len(args) != 1:
    parser.print_help()
    parser.exit(2)
dwi_file = args[0]


if opts.mask == "none":
    mask = None
else:
    mask = opts.mask


fit_tensor(dwi_file, opts.bvec, opts.root, min_signal=opts.min_signal,
           scale=opts.scale, mask=mask, save_tensor=opts.save_tensor)
