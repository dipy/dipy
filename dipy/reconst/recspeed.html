<!DOCTYPE html>
<!-- Generated by Cython 0.27.3 -->
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Cython: recspeed.pyx</title>
    <style type="text/css">
    
body.cython { font-family: courier; font-size: 12; }

.cython.tag  {  }
.cython.line { margin: 0em }
.cython.code { font-size: 9; color: #444444; display: none; margin: 0px 0px 0px 8px; border-left: 8px none; }

.cython.line .run { background-color: #B0FFB0; }
.cython.line .mis { background-color: #FFB0B0; }
.cython.code.run  { border-left: 8px solid #B0FFB0; }
.cython.code.mis  { border-left: 8px solid #FFB0B0; }

.cython.code .py_c_api  { color: red; }
.cython.code .py_macro_api  { color: #FF7000; }
.cython.code .pyx_c_api  { color: #FF3000; }
.cython.code .pyx_macro_api  { color: #FF7000; }
.cython.code .refnanny  { color: #FFA000; }
.cython.code .trace  { color: #FFA000; }
.cython.code .error_goto  { color: #FFA000; }

.cython.code .coerce  { color: #008000; border: 1px dotted #008000 }
.cython.code .py_attr { color: #FF0000; font-weight: bold; }
.cython.code .c_attr  { color: #0000FF; }
.cython.code .py_call { color: #FF0000; font-weight: bold; }
.cython.code .c_call  { color: #0000FF; }

.cython.score-0 {background-color: #FFFFff;}
.cython.score-1 {background-color: #FFFFe7;}
.cython.score-2 {background-color: #FFFFd4;}
.cython.score-3 {background-color: #FFFFc4;}
.cython.score-4 {background-color: #FFFFb6;}
.cython.score-5 {background-color: #FFFFaa;}
.cython.score-6 {background-color: #FFFF9f;}
.cython.score-7 {background-color: #FFFF96;}
.cython.score-8 {background-color: #FFFF8d;}
.cython.score-9 {background-color: #FFFF86;}
.cython.score-10 {background-color: #FFFF7f;}
.cython.score-11 {background-color: #FFFF79;}
.cython.score-12 {background-color: #FFFF73;}
.cython.score-13 {background-color: #FFFF6e;}
.cython.score-14 {background-color: #FFFF6a;}
.cython.score-15 {background-color: #FFFF66;}
.cython.score-16 {background-color: #FFFF62;}
.cython.score-17 {background-color: #FFFF5e;}
.cython.score-18 {background-color: #FFFF5b;}
.cython.score-19 {background-color: #FFFF57;}
.cython.score-20 {background-color: #FFFF55;}
.cython.score-21 {background-color: #FFFF52;}
.cython.score-22 {background-color: #FFFF4f;}
.cython.score-23 {background-color: #FFFF4d;}
.cython.score-24 {background-color: #FFFF4b;}
.cython.score-25 {background-color: #FFFF48;}
.cython.score-26 {background-color: #FFFF46;}
.cython.score-27 {background-color: #FFFF44;}
.cython.score-28 {background-color: #FFFF43;}
.cython.score-29 {background-color: #FFFF41;}
.cython.score-30 {background-color: #FFFF3f;}
.cython.score-31 {background-color: #FFFF3e;}
.cython.score-32 {background-color: #FFFF3c;}
.cython.score-33 {background-color: #FFFF3b;}
.cython.score-34 {background-color: #FFFF39;}
.cython.score-35 {background-color: #FFFF38;}
.cython.score-36 {background-color: #FFFF37;}
.cython.score-37 {background-color: #FFFF36;}
.cython.score-38 {background-color: #FFFF35;}
.cython.score-39 {background-color: #FFFF34;}
.cython.score-40 {background-color: #FFFF33;}
.cython.score-41 {background-color: #FFFF32;}
.cython.score-42 {background-color: #FFFF31;}
.cython.score-43 {background-color: #FFFF30;}
.cython.score-44 {background-color: #FFFF2f;}
.cython.score-45 {background-color: #FFFF2e;}
.cython.score-46 {background-color: #FFFF2d;}
.cython.score-47 {background-color: #FFFF2c;}
.cython.score-48 {background-color: #FFFF2b;}
.cython.score-49 {background-color: #FFFF2b;}
.cython.score-50 {background-color: #FFFF2a;}
.cython.score-51 {background-color: #FFFF29;}
.cython.score-52 {background-color: #FFFF29;}
.cython.score-53 {background-color: #FFFF28;}
.cython.score-54 {background-color: #FFFF27;}
.cython.score-55 {background-color: #FFFF27;}
.cython.score-56 {background-color: #FFFF26;}
.cython.score-57 {background-color: #FFFF26;}
.cython.score-58 {background-color: #FFFF25;}
.cython.score-59 {background-color: #FFFF24;}
.cython.score-60 {background-color: #FFFF24;}
.cython.score-61 {background-color: #FFFF23;}
.cython.score-62 {background-color: #FFFF23;}
.cython.score-63 {background-color: #FFFF22;}
.cython.score-64 {background-color: #FFFF22;}
.cython.score-65 {background-color: #FFFF22;}
.cython.score-66 {background-color: #FFFF21;}
.cython.score-67 {background-color: #FFFF21;}
.cython.score-68 {background-color: #FFFF20;}
.cython.score-69 {background-color: #FFFF20;}
.cython.score-70 {background-color: #FFFF1f;}
.cython.score-71 {background-color: #FFFF1f;}
.cython.score-72 {background-color: #FFFF1f;}
.cython.score-73 {background-color: #FFFF1e;}
.cython.score-74 {background-color: #FFFF1e;}
.cython.score-75 {background-color: #FFFF1e;}
.cython.score-76 {background-color: #FFFF1d;}
.cython.score-77 {background-color: #FFFF1d;}
.cython.score-78 {background-color: #FFFF1c;}
.cython.score-79 {background-color: #FFFF1c;}
.cython.score-80 {background-color: #FFFF1c;}
.cython.score-81 {background-color: #FFFF1c;}
.cython.score-82 {background-color: #FFFF1b;}
.cython.score-83 {background-color: #FFFF1b;}
.cython.score-84 {background-color: #FFFF1b;}
.cython.score-85 {background-color: #FFFF1a;}
.cython.score-86 {background-color: #FFFF1a;}
.cython.score-87 {background-color: #FFFF1a;}
.cython.score-88 {background-color: #FFFF1a;}
.cython.score-89 {background-color: #FFFF19;}
.cython.score-90 {background-color: #FFFF19;}
.cython.score-91 {background-color: #FFFF19;}
.cython.score-92 {background-color: #FFFF19;}
.cython.score-93 {background-color: #FFFF18;}
.cython.score-94 {background-color: #FFFF18;}
.cython.score-95 {background-color: #FFFF18;}
.cython.score-96 {background-color: #FFFF18;}
.cython.score-97 {background-color: #FFFF17;}
.cython.score-98 {background-color: #FFFF17;}
.cython.score-99 {background-color: #FFFF17;}
.cython.score-100 {background-color: #FFFF17;}
.cython.score-101 {background-color: #FFFF16;}
.cython.score-102 {background-color: #FFFF16;}
.cython.score-103 {background-color: #FFFF16;}
.cython.score-104 {background-color: #FFFF16;}
.cython.score-105 {background-color: #FFFF16;}
.cython.score-106 {background-color: #FFFF15;}
.cython.score-107 {background-color: #FFFF15;}
.cython.score-108 {background-color: #FFFF15;}
.cython.score-109 {background-color: #FFFF15;}
.cython.score-110 {background-color: #FFFF15;}
.cython.score-111 {background-color: #FFFF15;}
.cython.score-112 {background-color: #FFFF14;}
.cython.score-113 {background-color: #FFFF14;}
.cython.score-114 {background-color: #FFFF14;}
.cython.score-115 {background-color: #FFFF14;}
.cython.score-116 {background-color: #FFFF14;}
.cython.score-117 {background-color: #FFFF14;}
.cython.score-118 {background-color: #FFFF13;}
.cython.score-119 {background-color: #FFFF13;}
.cython.score-120 {background-color: #FFFF13;}
.cython.score-121 {background-color: #FFFF13;}
.cython.score-122 {background-color: #FFFF13;}
.cython.score-123 {background-color: #FFFF13;}
.cython.score-124 {background-color: #FFFF13;}
.cython.score-125 {background-color: #FFFF12;}
.cython.score-126 {background-color: #FFFF12;}
.cython.score-127 {background-color: #FFFF12;}
.cython.score-128 {background-color: #FFFF12;}
.cython.score-129 {background-color: #FFFF12;}
.cython.score-130 {background-color: #FFFF12;}
.cython.score-131 {background-color: #FFFF12;}
.cython.score-132 {background-color: #FFFF11;}
.cython.score-133 {background-color: #FFFF11;}
.cython.score-134 {background-color: #FFFF11;}
.cython.score-135 {background-color: #FFFF11;}
.cython.score-136 {background-color: #FFFF11;}
.cython.score-137 {background-color: #FFFF11;}
.cython.score-138 {background-color: #FFFF11;}
.cython.score-139 {background-color: #FFFF11;}
.cython.score-140 {background-color: #FFFF11;}
.cython.score-141 {background-color: #FFFF10;}
.cython.score-142 {background-color: #FFFF10;}
.cython.score-143 {background-color: #FFFF10;}
.cython.score-144 {background-color: #FFFF10;}
.cython.score-145 {background-color: #FFFF10;}
.cython.score-146 {background-color: #FFFF10;}
.cython.score-147 {background-color: #FFFF10;}
.cython.score-148 {background-color: #FFFF10;}
.cython.score-149 {background-color: #FFFF10;}
.cython.score-150 {background-color: #FFFF0f;}
.cython.score-151 {background-color: #FFFF0f;}
.cython.score-152 {background-color: #FFFF0f;}
.cython.score-153 {background-color: #FFFF0f;}
.cython.score-154 {background-color: #FFFF0f;}
.cython.score-155 {background-color: #FFFF0f;}
.cython.score-156 {background-color: #FFFF0f;}
.cython.score-157 {background-color: #FFFF0f;}
.cython.score-158 {background-color: #FFFF0f;}
.cython.score-159 {background-color: #FFFF0f;}
.cython.score-160 {background-color: #FFFF0f;}
.cython.score-161 {background-color: #FFFF0e;}
.cython.score-162 {background-color: #FFFF0e;}
.cython.score-163 {background-color: #FFFF0e;}
.cython.score-164 {background-color: #FFFF0e;}
.cython.score-165 {background-color: #FFFF0e;}
.cython.score-166 {background-color: #FFFF0e;}
.cython.score-167 {background-color: #FFFF0e;}
.cython.score-168 {background-color: #FFFF0e;}
.cython.score-169 {background-color: #FFFF0e;}
.cython.score-170 {background-color: #FFFF0e;}
.cython.score-171 {background-color: #FFFF0e;}
.cython.score-172 {background-color: #FFFF0e;}
.cython.score-173 {background-color: #FFFF0d;}
.cython.score-174 {background-color: #FFFF0d;}
.cython.score-175 {background-color: #FFFF0d;}
.cython.score-176 {background-color: #FFFF0d;}
.cython.score-177 {background-color: #FFFF0d;}
.cython.score-178 {background-color: #FFFF0d;}
.cython.score-179 {background-color: #FFFF0d;}
.cython.score-180 {background-color: #FFFF0d;}
.cython.score-181 {background-color: #FFFF0d;}
.cython.score-182 {background-color: #FFFF0d;}
.cython.score-183 {background-color: #FFFF0d;}
.cython.score-184 {background-color: #FFFF0d;}
.cython.score-185 {background-color: #FFFF0d;}
.cython.score-186 {background-color: #FFFF0d;}
.cython.score-187 {background-color: #FFFF0c;}
.cython.score-188 {background-color: #FFFF0c;}
.cython.score-189 {background-color: #FFFF0c;}
.cython.score-190 {background-color: #FFFF0c;}
.cython.score-191 {background-color: #FFFF0c;}
.cython.score-192 {background-color: #FFFF0c;}
.cython.score-193 {background-color: #FFFF0c;}
.cython.score-194 {background-color: #FFFF0c;}
.cython.score-195 {background-color: #FFFF0c;}
.cython.score-196 {background-color: #FFFF0c;}
.cython.score-197 {background-color: #FFFF0c;}
.cython.score-198 {background-color: #FFFF0c;}
.cython.score-199 {background-color: #FFFF0c;}
.cython.score-200 {background-color: #FFFF0c;}
.cython.score-201 {background-color: #FFFF0c;}
.cython.score-202 {background-color: #FFFF0c;}
.cython.score-203 {background-color: #FFFF0b;}
.cython.score-204 {background-color: #FFFF0b;}
.cython.score-205 {background-color: #FFFF0b;}
.cython.score-206 {background-color: #FFFF0b;}
.cython.score-207 {background-color: #FFFF0b;}
.cython.score-208 {background-color: #FFFF0b;}
.cython.score-209 {background-color: #FFFF0b;}
.cython.score-210 {background-color: #FFFF0b;}
.cython.score-211 {background-color: #FFFF0b;}
.cython.score-212 {background-color: #FFFF0b;}
.cython.score-213 {background-color: #FFFF0b;}
.cython.score-214 {background-color: #FFFF0b;}
.cython.score-215 {background-color: #FFFF0b;}
.cython.score-216 {background-color: #FFFF0b;}
.cython.score-217 {background-color: #FFFF0b;}
.cython.score-218 {background-color: #FFFF0b;}
.cython.score-219 {background-color: #FFFF0b;}
.cython.score-220 {background-color: #FFFF0b;}
.cython.score-221 {background-color: #FFFF0b;}
.cython.score-222 {background-color: #FFFF0a;}
.cython.score-223 {background-color: #FFFF0a;}
.cython.score-224 {background-color: #FFFF0a;}
.cython.score-225 {background-color: #FFFF0a;}
.cython.score-226 {background-color: #FFFF0a;}
.cython.score-227 {background-color: #FFFF0a;}
.cython.score-228 {background-color: #FFFF0a;}
.cython.score-229 {background-color: #FFFF0a;}
.cython.score-230 {background-color: #FFFF0a;}
.cython.score-231 {background-color: #FFFF0a;}
.cython.score-232 {background-color: #FFFF0a;}
.cython.score-233 {background-color: #FFFF0a;}
.cython.score-234 {background-color: #FFFF0a;}
.cython.score-235 {background-color: #FFFF0a;}
.cython.score-236 {background-color: #FFFF0a;}
.cython.score-237 {background-color: #FFFF0a;}
.cython.score-238 {background-color: #FFFF0a;}
.cython.score-239 {background-color: #FFFF0a;}
.cython.score-240 {background-color: #FFFF0a;}
.cython.score-241 {background-color: #FFFF0a;}
.cython.score-242 {background-color: #FFFF0a;}
.cython.score-243 {background-color: #FFFF0a;}
.cython.score-244 {background-color: #FFFF0a;}
.cython.score-245 {background-color: #FFFF0a;}
.cython.score-246 {background-color: #FFFF09;}
.cython.score-247 {background-color: #FFFF09;}
.cython.score-248 {background-color: #FFFF09;}
.cython.score-249 {background-color: #FFFF09;}
.cython.score-250 {background-color: #FFFF09;}
.cython.score-251 {background-color: #FFFF09;}
.cython.score-252 {background-color: #FFFF09;}
.cython.score-253 {background-color: #FFFF09;}
.cython.score-254 {background-color: #FFFF09;}
    </style>
    <script>
    function toggleDiv(id) {
        theDiv = id.nextElementSibling
        if (theDiv.style.display != 'block') theDiv.style.display = 'block';
        else theDiv.style.display = 'none';
    }
    </script>
</head>
<body class="cython">
<p><span style="border-bottom: solid 1px grey;">Generated by Cython 0.27.3</span></p>
<p>
    <span style="background-color: #FFFF00">Yellow lines</span> hint at Python interaction.<br />
    Click on a line that starts with a "<code>+</code>" to see the C code that Cython generated for it.
</p>
<p>Raw output: <a href="recspeed.c">recspeed.c</a></p>
<div class="cython"><pre class="cython line score-13" onclick='toggleDiv(this)'>+<span class="">001</span>: # Emacs should think this is a -*- python -*- file</pre>
<pre class='cython code score-13 '>  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_3, __pyx_kp_u_search_descending_line_207, __pyx_kp_u_i_in_descending_array_a_so_a_i) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 1, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_test, __pyx_t_3) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 1, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">002</span>: """ Optimized routines for creating voxel diffusion models</pre>
<pre class="cython line score-0">&#xA0;<span class="">003</span>: """</pre>
<pre class="cython line score-0">&#xA0;<span class="">004</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">005</span>: # cython: profile=True</pre>
<pre class="cython line score-0">&#xA0;<span class="">006</span>: # cython: embedsignature=True</pre>
<pre class="cython line score-0">&#xA0;<span class="">007</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">008</span>: cimport cython</pre>
<pre class="cython line score-0">&#xA0;<span class="">009</span>: </pre>
<pre class="cython line score-8" onclick='toggleDiv(this)'>+<span class="">010</span>: import numpy as np</pre>
<pre class='cython code score-8 '>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_numpy, 0, -1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 10, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_np, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 10, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">011</span>: cimport numpy as cnp</pre>
<pre class="cython line score-0">&#xA0;<span class="">012</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">013</span>: from libc.stdlib cimport malloc, free</pre>
<pre class="cython line score-0">&#xA0;<span class="">014</span>: from libc.string cimport memcpy</pre>
<pre class="cython line score-0">&#xA0;<span class="">015</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">016</span>: cdef extern from "dpy_math.h" nogil:</pre>
<pre class="cython line score-0">&#xA0;<span class="">017</span>:     double floor(double x)</pre>
<pre class="cython line score-0">&#xA0;<span class="">018</span>:     double fabs(double x)</pre>
<pre class="cython line score-0">&#xA0;<span class="">019</span>:     double cos(double x)</pre>
<pre class="cython line score-0">&#xA0;<span class="">020</span>:     double sin(double x)</pre>
<pre class="cython line score-0">&#xA0;<span class="">021</span>:     float acos(float x )</pre>
<pre class="cython line score-0">&#xA0;<span class="">022</span>:     double sqrt(double x)</pre>
<pre class="cython line score-0">&#xA0;<span class="">023</span>:     double DPY_PI</pre>
<pre class="cython line score-0">&#xA0;<span class="">024</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">025</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">026</span>: # initialize numpy runtime</pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">027</span>: cnp.import_array()</pre>
<pre class='cython code score-0 '>  __pyx_t_2 = __pyx_f_5numpy_import_array();<span class='error_goto'> if (unlikely(__pyx_t_2 == ((int)-1))) __PYX_ERR(0, 27, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">028</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">029</span>: #numpy pointers</pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">030</span>: cdef inline float* asfp(cnp.ndarray pt):</pre>
<pre class='cython code score-0 '>static CYTHON_INLINE float *__pyx_f_4dipy_7reconst_8recspeed_asfp(PyArrayObject *__pyx_v_pt) {
  float *__pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("asfp", 0);
/* … */
  /* function exit code */
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">031</span>:     return &lt;float *&gt;pt.data</pre>
<pre class='cython code score-0 '>  __pyx_r = ((float *)__pyx_v_pt-&gt;data);
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">032</span>: </pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">033</span>: cdef inline double* asdp(cnp.ndarray pt):</pre>
<pre class='cython code score-0 '>static CYTHON_INLINE double *__pyx_f_4dipy_7reconst_8recspeed_asdp(PyArrayObject *__pyx_v_pt) {
  double *__pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("asdp", 0);
/* … */
  /* function exit code */
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">034</span>:     return &lt;double *&gt;pt.data</pre>
<pre class='cython code score-0 '>  __pyx_r = ((double *)__pyx_v_pt-&gt;data);
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">035</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">036</span>: </pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">037</span>: cdef void splitoffset(float *offset, size_t *index, size_t shape) nogil:</pre>
<pre class='cython code score-0 '>static void __pyx_f_4dipy_7reconst_8recspeed_splitoffset(float *__pyx_v_offset, size_t *__pyx_v_index, size_t __pyx_v_shape) {
/* … */
  /* function exit code */
}
</pre><pre class="cython line score-0">&#xA0;<span class="">038</span>:     """Splits a global offset into an integer index and a relative offset"""</pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">039</span>:     offset[0] -= .5</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = 0;
  (__pyx_v_offset[__pyx_t_1]) = ((__pyx_v_offset[__pyx_t_1]) - .5);
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">040</span>:     if offset[0] &lt;= 0:</pre>
<pre class='cython code score-0 '>  __pyx_t_2 = (((__pyx_v_offset[0]) &lt;= 0.0) != 0);
  if (__pyx_t_2) {
/* … */
    goto __pyx_L3;
  }
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">041</span>:         index[0] = 0</pre>
<pre class='cython code score-0 '>    (__pyx_v_index[0]) = 0;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">042</span>:         offset[0] = 0.</pre>
<pre class='cython code score-0 '>    (__pyx_v_offset[0]) = 0.;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">043</span>:     elif offset[0] &gt;= (shape - 1):</pre>
<pre class='cython code score-0 '>  __pyx_t_2 = (((__pyx_v_offset[0]) &gt;= (__pyx_v_shape - 1)) != 0);
  if (__pyx_t_2) {
/* … */
    goto __pyx_L3;
  }
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">044</span>:         index[0] = shape - 2</pre>
<pre class='cython code score-0 '>    (__pyx_v_index[0]) = (__pyx_v_shape - 2);
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">045</span>:         offset[0] = 1.</pre>
<pre class='cython code score-0 '>    (__pyx_v_offset[0]) = 1.;
</pre><pre class="cython line score-0">&#xA0;<span class="">046</span>:     else:</pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">047</span>:         index[0] = &lt;size_t&gt; offset[0]</pre>
<pre class='cython code score-0 '>  /*else*/ {
    (__pyx_v_index[0]) = ((size_t)(__pyx_v_offset[0]));
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">048</span>:         offset[0] = offset[0] - index[0]</pre>
<pre class='cython code score-0 '>    (__pyx_v_offset[0]) = ((__pyx_v_offset[0]) - (__pyx_v_index[0]));
  }
  __pyx_L3:;
</pre><pre class="cython line score-0">&#xA0;<span class="">049</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">050</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">051</span>: @cython.boundscheck(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">052</span>: @cython.wraparound(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">053</span>: @cython.cdivision(True)</pre>
<pre class="cython line score-91" onclick='toggleDiv(this)'>+<span class="">054</span>: def trilinear_interp(cnp.ndarray[cnp.float32_t, ndim=4, mode='strided'] data,</pre>
<pre class='cython code score-91 '>/* Python wrapper */
static PyObject *__pyx_pw_4dipy_7reconst_8recspeed_1trilinear_interp(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4dipy_7reconst_8recspeed_trilinear_interp[] = "Interpolates vector from 4D `data` at 3D point given by `index`\n\n    Interpolates a vector of length T from a 4D volume of shape (I, J, K, T),\n    given point (x, y, z) where (x, y, z) are the coordinates of the point in\n    real units (not yet adjusted for voxel size).\n    ";
static PyMethodDef __pyx_mdef_4dipy_7reconst_8recspeed_1trilinear_interp = {"trilinear_interp", (PyCFunction)__pyx_pw_4dipy_7reconst_8recspeed_1trilinear_interp, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4dipy_7reconst_8recspeed_trilinear_interp};
static PyObject *__pyx_pw_4dipy_7reconst_8recspeed_1trilinear_interp(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyArrayObject *__pyx_v_data = 0;
  PyArrayObject *__pyx_v_index = 0;
  PyArrayObject *__pyx_v_voxel_size = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("trilinear_interp (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_data,&amp;__pyx_n_s_index,&amp;__pyx_n_s_voxel_size,0};
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_data)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_index)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("trilinear_interp", 1, 3, 3, 1); <span class='error_goto'>__PYX_ERR(0, 54, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_voxel_size)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("trilinear_interp", 1, 3, 3, 2); <span class='error_goto'>__PYX_ERR(0, 54, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "trilinear_interp") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 54, __pyx_L3_error)</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 3) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
    }
    __pyx_v_data = ((PyArrayObject *)values[0]);
    __pyx_v_index = ((PyArrayObject *)values[1]);
    __pyx_v_voxel_size = ((PyArrayObject *)values[2]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("trilinear_interp", 1, 3, 3, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 54, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("dipy.reconst.recspeed.trilinear_interp", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_data), __pyx_ptype_5numpy_ndarray, 1, "data", 0))) <span class='error_goto'>__PYX_ERR(0, 54, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_index), __pyx_ptype_5numpy_ndarray, 1, "index", 0))) <span class='error_goto'>__PYX_ERR(0, 55, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_voxel_size), __pyx_ptype_5numpy_ndarray, 1, "voxel_size", 0))) <span class='error_goto'>__PYX_ERR(0, 56, __pyx_L1_error)</span>
  __pyx_r = __pyx_pf_4dipy_7reconst_8recspeed_trilinear_interp(__pyx_self, __pyx_v_data, __pyx_v_index, __pyx_v_voxel_size);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_4dipy_7reconst_8recspeed_trilinear_interp(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_data, PyArrayObject *__pyx_v_index, PyArrayObject *__pyx_v_voxel_size) {
  float __pyx_v_x;
  float __pyx_v_y;
  float __pyx_v_z;
  float __pyx_v_weight;
  size_t __pyx_v_x_ind;
  size_t __pyx_v_y_ind;
  size_t __pyx_v_z_ind;
  size_t __pyx_v_ii;
  size_t __pyx_v_jj;
  size_t __pyx_v_kk;
  size_t __pyx_v_LL;
  size_t __pyx_v_last_d;
  int __pyx_v_bounds_check;
  PyArrayObject *__pyx_v_result = 0;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_data;
  __Pyx_Buffer __pyx_pybuffer_data;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_index;
  __Pyx_Buffer __pyx_pybuffer_index;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_result;
  __Pyx_Buffer __pyx_pybuffer_result;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_voxel_size;
  __Pyx_Buffer __pyx_pybuffer_voxel_size;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("trilinear_interp", 0);
  __pyx_pybuffer_result.pybuffer.buf = NULL;
  __pyx_pybuffer_result.refcount = 0;
  __pyx_pybuffernd_result.data = NULL;
  __pyx_pybuffernd_result.rcbuffer = &amp;__pyx_pybuffer_result;
  __pyx_pybuffer_data.pybuffer.buf = NULL;
  __pyx_pybuffer_data.refcount = 0;
  __pyx_pybuffernd_data.data = NULL;
  __pyx_pybuffernd_data.rcbuffer = &amp;__pyx_pybuffer_data;
  __pyx_pybuffer_index.pybuffer.buf = NULL;
  __pyx_pybuffer_index.refcount = 0;
  __pyx_pybuffernd_index.data = NULL;
  __pyx_pybuffernd_index.rcbuffer = &amp;__pyx_pybuffer_index;
  __pyx_pybuffer_voxel_size.pybuffer.buf = NULL;
  __pyx_pybuffer_voxel_size.refcount = 0;
  __pyx_pybuffernd_voxel_size.data = NULL;
  __pyx_pybuffernd_voxel_size.rcbuffer = &amp;__pyx_pybuffer_voxel_size;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_data.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_data, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_float32_t, PyBUF_FORMAT| PyBUF_STRIDES, 4, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 54, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_data.diminfo[0].strides = __pyx_pybuffernd_data.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_data.diminfo[0].shape = __pyx_pybuffernd_data.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_data.diminfo[1].strides = __pyx_pybuffernd_data.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_data.diminfo[1].shape = __pyx_pybuffernd_data.rcbuffer-&gt;pybuffer.shape[1]; __pyx_pybuffernd_data.diminfo[2].strides = __pyx_pybuffernd_data.rcbuffer-&gt;pybuffer.strides[2]; __pyx_pybuffernd_data.diminfo[2].shape = __pyx_pybuffernd_data.rcbuffer-&gt;pybuffer.shape[2]; __pyx_pybuffernd_data.diminfo[3].strides = __pyx_pybuffernd_data.rcbuffer-&gt;pybuffer.strides[3]; __pyx_pybuffernd_data.diminfo[3].shape = __pyx_pybuffernd_data.rcbuffer-&gt;pybuffer.shape[3];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_index.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_index, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 54, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_index.diminfo[0].strides = __pyx_pybuffernd_index.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_index.diminfo[0].shape = __pyx_pybuffernd_index.rcbuffer-&gt;pybuffer.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_voxel_size.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_voxel_size, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_float_t, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 54, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_voxel_size.diminfo[0].strides = __pyx_pybuffernd_voxel_size.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_voxel_size.diminfo[0].shape = __pyx_pybuffernd_voxel_size.rcbuffer-&gt;pybuffer.shape[0];
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_11);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_12);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_data.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_index.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_result.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_voxel_size.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("dipy.reconst.recspeed.trilinear_interp", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_data.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_index.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_result.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_voxel_size.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_result);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__39 = <span class='py_c_api'>PyTuple_Pack</span>(17, __pyx_n_s_data, __pyx_n_s_index, __pyx_n_s_voxel_size, __pyx_n_s_x, __pyx_n_s_y, __pyx_n_s_z, __pyx_n_s_weight, __pyx_n_s_x_ind, __pyx_n_s_y_ind, __pyx_n_s_z_ind, __pyx_n_s_ii, __pyx_n_s_jj, __pyx_n_s_kk, __pyx_n_s_LL, __pyx_n_s_last_d, __pyx_n_s_bounds_check, __pyx_n_s_result);<span class='error_goto'> if (unlikely(!__pyx_tuple__39)) __PYX_ERR(0, 54, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__39);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__39);
/* … */
  __pyx_t_1 = PyCFunction_NewEx(&amp;__pyx_mdef_4dipy_7reconst_8recspeed_1trilinear_interp, NULL, __pyx_n_s_dipy_reconst_recspeed);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 54, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_trilinear_interp, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 54, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_codeobj__40 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(3, 0, 17, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__39, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_dipy_reconst_recspeed_pyx, __pyx_n_s_trilinear_interp, 54, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__40)) __PYX_ERR(0, 54, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">055</span>:                      cnp.ndarray[cnp.float_t, ndim=1, mode='strided'] index,</pre>
<pre class="cython line score-0">&#xA0;<span class="">056</span>:                      cnp.ndarray[cnp.float_t, ndim=1, mode='c'] voxel_size):</pre>
<pre class="cython line score-0">&#xA0;<span class="">057</span>:     """Interpolates vector from 4D `data` at 3D point given by `index`</pre>
<pre class="cython line score-0">&#xA0;<span class="">058</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">059</span>:     Interpolates a vector of length T from a 4D volume of shape (I, J, K, T),</pre>
<pre class="cython line score-0">&#xA0;<span class="">060</span>:     given point (x, y, z) where (x, y, z) are the coordinates of the point in</pre>
<pre class="cython line score-0">&#xA0;<span class="">061</span>:     real units (not yet adjusted for voxel size).</pre>
<pre class="cython line score-0">&#xA0;<span class="">062</span>:     """</pre>
<pre class="cython line score-0">&#xA0;<span class="">063</span>:     cdef:</pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">064</span>:         float x = index[0] / voxel_size[0]</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = 0;
  __pyx_t_2 = 0;
  __pyx_v_x = ((*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_float_t *, __pyx_pybuffernd_index.rcbuffer-&gt;pybuffer.buf, __pyx_t_1, __pyx_pybuffernd_index.diminfo[0].strides)) / (*__Pyx_BufPtrCContig1d(__pyx_t_5numpy_float_t *, __pyx_pybuffernd_voxel_size.rcbuffer-&gt;pybuffer.buf, __pyx_t_2, __pyx_pybuffernd_voxel_size.diminfo[0].strides)));
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">065</span>:         float y = index[1] / voxel_size[1]</pre>
<pre class='cython code score-0 '>  __pyx_t_3 = 1;
  __pyx_t_4 = 1;
  __pyx_v_y = ((*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_float_t *, __pyx_pybuffernd_index.rcbuffer-&gt;pybuffer.buf, __pyx_t_3, __pyx_pybuffernd_index.diminfo[0].strides)) / (*__Pyx_BufPtrCContig1d(__pyx_t_5numpy_float_t *, __pyx_pybuffernd_voxel_size.rcbuffer-&gt;pybuffer.buf, __pyx_t_4, __pyx_pybuffernd_voxel_size.diminfo[0].strides)));
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">066</span>:         float z = index[2] / voxel_size[2]</pre>
<pre class='cython code score-0 '>  __pyx_t_5 = 2;
  __pyx_t_6 = 2;
  __pyx_v_z = ((*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_float_t *, __pyx_pybuffernd_index.rcbuffer-&gt;pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_index.diminfo[0].strides)) / (*__Pyx_BufPtrCContig1d(__pyx_t_5numpy_float_t *, __pyx_pybuffernd_voxel_size.rcbuffer-&gt;pybuffer.buf, __pyx_t_6, __pyx_pybuffernd_voxel_size.diminfo[0].strides)));
</pre><pre class="cython line score-0">&#xA0;<span class="">067</span>:         float weight</pre>
<pre class="cython line score-0">&#xA0;<span class="">068</span>:         size_t x_ind, y_ind, z_ind, ii, jj, kk, LL</pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">069</span>:         size_t last_d = data.shape[3]</pre>
<pre class='cython code score-0 '>  __pyx_v_last_d = (__pyx_v_data-&gt;dimensions[3]);
</pre><pre class="cython line score-0">&#xA0;<span class="">070</span>:         bint bounds_check</pre>
<pre class="cython line score-0">&#xA0;<span class="">071</span>:         cnp.ndarray[cnp.float32_t, ndim=1, mode='c'] result</pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">072</span>:     bounds_check = (x &lt; 0 or y &lt; 0 or z &lt; 0 or</pre>
<pre class='cython code score-0 '>  __pyx_t_8 = ((__pyx_v_x &lt; 0.0) != 0);
  if (!__pyx_t_8) {
  } else {
    __pyx_t_7 = __pyx_t_8;
    goto __pyx_L3_bool_binop_done;
  }
  __pyx_t_8 = ((__pyx_v_y &lt; 0.0) != 0);
  if (!__pyx_t_8) {
  } else {
    __pyx_t_7 = __pyx_t_8;
    goto __pyx_L3_bool_binop_done;
  }
  __pyx_t_8 = ((__pyx_v_z &lt; 0.0) != 0);
  if (!__pyx_t_8) {
  } else {
    __pyx_t_7 = __pyx_t_8;
    goto __pyx_L3_bool_binop_done;
  }
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">073</span>:                     x &gt; data.shape[0] or</pre>
<pre class='cython code score-0 '>  __pyx_t_8 = ((__pyx_v_x &gt; (__pyx_v_data-&gt;dimensions[0])) != 0);
  if (!__pyx_t_8) {
  } else {
    __pyx_t_7 = __pyx_t_8;
    goto __pyx_L3_bool_binop_done;
  }
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">074</span>:                     y &gt; data.shape[1] or</pre>
<pre class='cython code score-0 '>  __pyx_t_8 = ((__pyx_v_y &gt; (__pyx_v_data-&gt;dimensions[1])) != 0);
  if (!__pyx_t_8) {
  } else {
    __pyx_t_7 = __pyx_t_8;
    goto __pyx_L3_bool_binop_done;
  }
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">075</span>:                     z &gt; data.shape[2])</pre>
<pre class='cython code score-0 '>  __pyx_t_8 = ((__pyx_v_z &gt; (__pyx_v_data-&gt;dimensions[2])) != 0);
  __pyx_t_7 = __pyx_t_8;
  __pyx_L3_bool_binop_done:;
  __pyx_v_bounds_check = __pyx_t_7;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">076</span>:     if bounds_check:</pre>
<pre class='cython code score-0 '>  __pyx_t_7 = (__pyx_v_bounds_check != 0);
  if (__pyx_t_7) {
/* … */
  }
</pre><pre class="cython line score-2" onclick='toggleDiv(this)'>+<span class="">077</span>:         raise IndexError</pre>
<pre class='cython code score-2 '>    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_builtin_IndexError, 0, 0, 0);
    <span class='error_goto'>__PYX_ERR(0, 77, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">078</span>: </pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">079</span>:     splitoffset(&amp;x, &amp;x_ind, data.shape[0])</pre>
<pre class='cython code score-0 '>  __pyx_f_4dipy_7reconst_8recspeed_splitoffset((&amp;__pyx_v_x), (&amp;__pyx_v_x_ind), (__pyx_v_data-&gt;dimensions[0]));
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">080</span>:     splitoffset(&amp;y, &amp;y_ind, data.shape[1])</pre>
<pre class='cython code score-0 '>  __pyx_f_4dipy_7reconst_8recspeed_splitoffset((&amp;__pyx_v_y), (&amp;__pyx_v_y_ind), (__pyx_v_data-&gt;dimensions[1]));
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">081</span>:     splitoffset(&amp;z, &amp;z_ind, data.shape[2])</pre>
<pre class='cython code score-0 '>  __pyx_f_4dipy_7reconst_8recspeed_splitoffset((&amp;__pyx_v_z), (&amp;__pyx_v_z_ind), (__pyx_v_data-&gt;dimensions[2]));
</pre><pre class="cython line score-0">&#xA0;<span class="">082</span>: </pre>
<pre class="cython line score-45" onclick='toggleDiv(this)'>+<span class="">083</span>:     result = np.zeros(last_d, dtype='float32')</pre>
<pre class='cython code score-45 '>  __pyx_t_9 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 83, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
  __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_9, __pyx_n_s_zeros);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 83, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyInt_FromSize_t</span>(__pyx_v_last_d);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 83, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
  __pyx_t_11 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 83, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_9);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_11, 0, __pyx_t_9);
  __pyx_t_9 = 0;
  __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 83, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_9, __pyx_n_s_dtype, __pyx_n_s_float32) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 83, __pyx_L1_error)</span>
  __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_10, __pyx_t_11, __pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 83, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  if (!(likely(((__pyx_t_12) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_12, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 83, __pyx_L1_error)</span>
  __pyx_t_13 = ((PyArrayObject *)__pyx_t_12);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_result.rcbuffer-&gt;pybuffer);
    __pyx_t_14 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_result.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_13, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_float32_t, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS| PyBUF_WRITABLE, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_14 &lt; 0)) {
      <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_15, &amp;__pyx_t_16, &amp;__pyx_t_17);
      if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_result.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_result, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_float32_t, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_15); Py_XDECREF(__pyx_t_16); Py_XDECREF(__pyx_t_17);
        <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
      } else {
        <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_15, __pyx_t_16, __pyx_t_17);
      }
      __pyx_t_15 = __pyx_t_16 = __pyx_t_17 = 0;
    }
    __pyx_pybuffernd_result.diminfo[0].strides = __pyx_pybuffernd_result.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_result.diminfo[0].shape = __pyx_pybuffernd_result.rcbuffer-&gt;pybuffer.shape[0];
    if (unlikely(__pyx_t_14 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 83, __pyx_L1_error)</span>
  }
  __pyx_t_13 = 0;
  __pyx_v_result = ((PyArrayObject *)__pyx_t_12);
  __pyx_t_12 = 0;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">084</span>:     for ii from 0 &lt;= ii &lt;= 1:</pre>
<pre class='cython code score-0 '>  for (__pyx_v_ii = 0; __pyx_v_ii &lt;= 1; __pyx_v_ii++) {
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">085</span>:         for jj from 0 &lt;= jj &lt;= 1:</pre>
<pre class='cython code score-0 '>    for (__pyx_v_jj = 0; __pyx_v_jj &lt;= 1; __pyx_v_jj++) {
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">086</span>:             for kk from 0 &lt;= kk &lt;= 1:</pre>
<pre class='cython code score-0 '>      for (__pyx_v_kk = 0; __pyx_v_kk &lt;= 1; __pyx_v_kk++) {
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">087</span>:                 weight = wght(ii, x)*wght(jj, y)*wght(kk, z)</pre>
<pre class='cython code score-0 '>        __pyx_v_weight = ((__pyx_f_4dipy_7reconst_8recspeed_wght(__pyx_v_ii, __pyx_v_x) * __pyx_f_4dipy_7reconst_8recspeed_wght(__pyx_v_jj, __pyx_v_y)) * __pyx_f_4dipy_7reconst_8recspeed_wght(__pyx_v_kk, __pyx_v_z));
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">088</span>:                 for LL from 0 &lt;= LL &lt; last_d:</pre>
<pre class='cython code score-0 '>        __pyx_t_18 = __pyx_v_last_d;
        for (__pyx_v_LL = 0; __pyx_v_LL &lt; __pyx_t_18; __pyx_v_LL++) {
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">089</span>:                     result[LL] += data[x_ind+ii,y_ind+jj,z_ind+kk,LL]*weight</pre>
<pre class='cython code score-0 '>          __pyx_t_19 = (__pyx_v_x_ind + __pyx_v_ii);
          __pyx_t_20 = (__pyx_v_y_ind + __pyx_v_jj);
          __pyx_t_21 = (__pyx_v_z_ind + __pyx_v_kk);
          __pyx_t_22 = __pyx_v_LL;
          __pyx_t_23 = __pyx_v_LL;
          *__Pyx_BufPtrCContig1d(__pyx_t_5numpy_float32_t *, __pyx_pybuffernd_result.rcbuffer-&gt;pybuffer.buf, __pyx_t_23, __pyx_pybuffernd_result.diminfo[0].strides) += ((*__Pyx_BufPtrStrided4d(__pyx_t_5numpy_float32_t *, __pyx_pybuffernd_data.rcbuffer-&gt;pybuffer.buf, __pyx_t_19, __pyx_pybuffernd_data.diminfo[0].strides, __pyx_t_20, __pyx_pybuffernd_data.diminfo[1].strides, __pyx_t_21, __pyx_pybuffernd_data.diminfo[2].strides, __pyx_t_22, __pyx_pybuffernd_data.diminfo[3].strides)) * __pyx_v_weight);
        }
      }
    }
  }
</pre><pre class="cython line score-2" onclick='toggleDiv(this)'>+<span class="">090</span>:     return result</pre>
<pre class='cython code score-2 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_result));
  __pyx_r = ((PyObject *)__pyx_v_result);
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">091</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">092</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">093</span>: @cython.profile(False)</pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">094</span>: cdef float wght(int i, float r) nogil:</pre>
<pre class='cython code score-0 '>static float __pyx_f_4dipy_7reconst_8recspeed_wght(int __pyx_v_i, float __pyx_v_r) {
  float __pyx_r;
/* … */
  /* function exit code */
  __pyx_L0:;
  return __pyx_r;
}
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">095</span>:     if i:</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = (__pyx_v_i != 0);
  if (__pyx_t_1) {
/* … */
  }
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">096</span>:         return r</pre>
<pre class='cython code score-0 '>    __pyx_r = __pyx_v_r;
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">097</span>:     else:</pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">098</span>:         return 1.-r</pre>
<pre class='cython code score-0 '>  /*else*/ {
    __pyx_r = (1. - __pyx_v_r);
    goto __pyx_L0;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">099</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">100</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">101</span>: @cython.boundscheck(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">102</span>: @cython.wraparound(False)</pre>
<pre class="cython line score-103" onclick='toggleDiv(this)'>+<span class="">103</span>: def remove_similar_vertices(</pre>
<pre class='cython code score-103 '>/* Python wrapper */
static PyObject *__pyx_pw_4dipy_7reconst_8recspeed_3remove_similar_vertices(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4dipy_7reconst_8recspeed_2remove_similar_vertices[] = "Remove vertices that are less than `theta` degrees from any other\n\n    Returns vertices that are at least theta degrees from any other vertex.\n    Vertex v and -v are considered the same so if v and -v are both in\n    `vertices` only one is kept. Also if v and w are both in vertices, w must\n    be separated by theta degrees from both v and -v to be unique.\n\n    Parameters\n    ----------\n    vertices : (N, 3) ndarray\n        N unit vectors.\n    theta : float\n        The minimum separation between vertices in degrees.\n    return_mapping : {False, True}, optional\n        If True, return `mapping` as well as `vertices` and maybe `indices`\n        (see below).\n    return_indices : {False, True}, optional\n        If True, return `indices` as well as `vertices` and maybe `mapping`\n        (see below).\n\n    Returns\n    -------\n    unique_vertices : (M, 3) ndarray\n        Vertices sufficiently separated from one another.\n    mapping : (N,) ndarray\n        For each element ``vertices[i]`` ($i \\in 0..N-1$), the index $j$ to a\n        vertex in `unique_vertices` that is less than `theta` degrees from\n        ``vertices[i]``.  Only returned if `return_mapping` is True.\n    indices : (N,) ndarray\n        `indices` gives the reverse of `mapping`.  For each element\n        ``unique_vertices[j]`` ($j \\in 0..M-1$), the index $i$ to a vertex in\n        `vertices` that is less than `theta` degrees from\n        ``unique_vertices[j]``.  If there is more than one element of\n        `vertices` that is less than theta degrees from `unique_vertices[j]`,\n        return the first (lowest index) matching value.  Only return if\n        `return_indices` is True.\n    ";
static PyMethodDef __pyx_mdef_4dipy_7reconst_8recspeed_3remove_similar_vertices = {"remove_similar_vertices", (PyCFunction)__pyx_pw_4dipy_7reconst_8recspeed_3remove_similar_vertices, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4dipy_7reconst_8recspeed_2remove_similar_vertices};
static PyObject *__pyx_pw_4dipy_7reconst_8recspeed_3remove_similar_vertices(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyArrayObject *__pyx_v_vertices = 0;
  double __pyx_v_theta;
  int __pyx_v_return_mapping;
  int __pyx_v_return_index;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("remove_similar_vertices (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_vertices,&amp;__pyx_n_s_theta,&amp;__pyx_n_s_return_mapping,&amp;__pyx_n_s_return_index,0};
    PyObject* values[4] = {0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_vertices)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_theta)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("remove_similar_vertices", 0, 2, 4, 1); <span class='error_goto'>__PYX_ERR(0, 103, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_return_mapping);
          if (value) { values[2] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_return_index);
          if (value) { values[3] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "remove_similar_vertices") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 103, __pyx_L3_error)</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_vertices = ((PyArrayObject *)values[0]);
    __pyx_v_theta = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[1]); if (unlikely((__pyx_v_theta == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 105, __pyx_L3_error)</span>
    if (values[2]) {
      __pyx_v_return_mapping = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(values[2]); if (unlikely((__pyx_v_return_mapping == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 106, __pyx_L3_error)</span>
    } else {
/* … */
  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_4dipy_7reconst_8recspeed_2remove_similar_vertices(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_vertices, double __pyx_v_theta, int __pyx_v_return_mapping, int __pyx_v_return_index) {
  PyArrayObject *__pyx_v_unique_vertices = 0;
  PyArrayObject *__pyx_v_mapping = 0;
  PyArrayObject *__pyx_v_index = 0;
  char __pyx_v_pass_all;
  npy_int32 __pyx_v_i;
  npy_int32 __pyx_v_j;
  npy_int32 __pyx_v_n_unique;
  npy_intp __pyx_v_n;
  double __pyx_v_a;
  double __pyx_v_b;
  double __pyx_v_c;
  double __pyx_v_sim;
  double __pyx_v_cos_similarity;
  PyObject *__pyx_v_verts = NULL;
  PyObject *__pyx_v_out = NULL;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_index;
  __Pyx_Buffer __pyx_pybuffer_index;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_mapping;
  __Pyx_Buffer __pyx_pybuffer_mapping;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_unique_vertices;
  __Pyx_Buffer __pyx_pybuffer_unique_vertices;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_vertices;
  __Pyx_Buffer __pyx_pybuffer_vertices;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("remove_similar_vertices", 0);
  __pyx_pybuffer_unique_vertices.pybuffer.buf = NULL;
  __pyx_pybuffer_unique_vertices.refcount = 0;
  __pyx_pybuffernd_unique_vertices.data = NULL;
  __pyx_pybuffernd_unique_vertices.rcbuffer = &amp;__pyx_pybuffer_unique_vertices;
  __pyx_pybuffer_mapping.pybuffer.buf = NULL;
  __pyx_pybuffer_mapping.refcount = 0;
  __pyx_pybuffernd_mapping.data = NULL;
  __pyx_pybuffernd_mapping.rcbuffer = &amp;__pyx_pybuffer_mapping;
  __pyx_pybuffer_index.pybuffer.buf = NULL;
  __pyx_pybuffer_index.refcount = 0;
  __pyx_pybuffernd_index.data = NULL;
  __pyx_pybuffernd_index.rcbuffer = &amp;__pyx_pybuffer_index;
  __pyx_pybuffer_vertices.pybuffer.buf = NULL;
  __pyx_pybuffer_vertices.refcount = 0;
  __pyx_pybuffernd_vertices.data = NULL;
  __pyx_pybuffernd_vertices.rcbuffer = &amp;__pyx_pybuffer_vertices;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_vertices.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_vertices, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 103, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_vertices.diminfo[0].strides = __pyx_pybuffernd_vertices.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_vertices.diminfo[0].shape = __pyx_pybuffernd_vertices.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_vertices.diminfo[1].strides = __pyx_pybuffernd_vertices.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_vertices.diminfo[1].shape = __pyx_pybuffernd_vertices.rcbuffer-&gt;pybuffer.shape[1];
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_index.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_mapping.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_unique_vertices.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_vertices.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("dipy.reconst.recspeed.remove_similar_vertices", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_index.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_mapping.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_unique_vertices.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_vertices.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_unique_vertices);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_mapping);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_index);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_verts);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_out);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__41 = <span class='py_c_api'>PyTuple_Pack</span>(19, __pyx_n_s_vertices, __pyx_n_s_theta, __pyx_n_s_return_mapping, __pyx_n_s_return_index, __pyx_n_s_unique_vertices, __pyx_n_s_mapping, __pyx_n_s_index, __pyx_n_s_pass_all, __pyx_n_s_i, __pyx_n_s_j, __pyx_n_s_n_unique, __pyx_n_s_n, __pyx_n_s_a, __pyx_n_s_b, __pyx_n_s_c, __pyx_n_s_sim, __pyx_n_s_cos_similarity, __pyx_n_s_verts, __pyx_n_s_out);<span class='error_goto'> if (unlikely(!__pyx_tuple__41)) __PYX_ERR(0, 103, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__41);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__41);
/* … */
  __pyx_t_1 = PyCFunction_NewEx(&amp;__pyx_mdef_4dipy_7reconst_8recspeed_3remove_similar_vertices, NULL, __pyx_n_s_dipy_reconst_recspeed);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 103, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_remove_similar_vertices, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 103, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_codeobj__42 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(4, 0, 19, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__41, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_dipy_reconst_recspeed_pyx, __pyx_n_s_remove_similar_vertices, 103, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__42)) __PYX_ERR(0, 103, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">104</span>:     cnp.ndarray[cnp.float_t, ndim=2, mode='strided'] vertices,</pre>
<pre class="cython line score-0">&#xA0;<span class="">105</span>:     double theta,</pre>
<pre class="cython line score-7" onclick='toggleDiv(this)'>+<span class="">106</span>:     bint return_mapping=False,</pre>
<pre class='cython code score-7 '>      __pyx_v_return_mapping = ((int)0);
    }
    if (values[3]) {
      __pyx_v_return_index = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(values[3]); if (unlikely((__pyx_v_return_index == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 107, __pyx_L3_error)</span>
    } else {
</pre><pre class="cython line score-7" onclick='toggleDiv(this)'>+<span class="">107</span>:     bint return_index=False):</pre>
<pre class='cython code score-7 '>      __pyx_v_return_index = ((int)0);
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("remove_similar_vertices", 0, 2, 4, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 103, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("dipy.reconst.recspeed.remove_similar_vertices", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_vertices), __pyx_ptype_5numpy_ndarray, 1, "vertices", 0))) <span class='error_goto'>__PYX_ERR(0, 104, __pyx_L1_error)</span>
  __pyx_r = __pyx_pf_4dipy_7reconst_8recspeed_2remove_similar_vertices(__pyx_self, __pyx_v_vertices, __pyx_v_theta, __pyx_v_return_mapping, __pyx_v_return_index);
</pre><pre class="cython line score-0">&#xA0;<span class="">108</span>:     """Remove vertices that are less than `theta` degrees from any other</pre>
<pre class="cython line score-0">&#xA0;<span class="">109</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">110</span>:     Returns vertices that are at least theta degrees from any other vertex.</pre>
<pre class="cython line score-0">&#xA0;<span class="">111</span>:     Vertex v and -v are considered the same so if v and -v are both in</pre>
<pre class="cython line score-0">&#xA0;<span class="">112</span>:     `vertices` only one is kept. Also if v and w are both in vertices, w must</pre>
<pre class="cython line score-0">&#xA0;<span class="">113</span>:     be separated by theta degrees from both v and -v to be unique.</pre>
<pre class="cython line score-0">&#xA0;<span class="">114</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">115</span>:     Parameters</pre>
<pre class="cython line score-0">&#xA0;<span class="">116</span>:     ----------</pre>
<pre class="cython line score-0">&#xA0;<span class="">117</span>:     vertices : (N, 3) ndarray</pre>
<pre class="cython line score-0">&#xA0;<span class="">118</span>:         N unit vectors.</pre>
<pre class="cython line score-0">&#xA0;<span class="">119</span>:     theta : float</pre>
<pre class="cython line score-0">&#xA0;<span class="">120</span>:         The minimum separation between vertices in degrees.</pre>
<pre class="cython line score-0">&#xA0;<span class="">121</span>:     return_mapping : {False, True}, optional</pre>
<pre class="cython line score-0">&#xA0;<span class="">122</span>:         If True, return `mapping` as well as `vertices` and maybe `indices`</pre>
<pre class="cython line score-0">&#xA0;<span class="">123</span>:         (see below).</pre>
<pre class="cython line score-0">&#xA0;<span class="">124</span>:     return_indices : {False, True}, optional</pre>
<pre class="cython line score-0">&#xA0;<span class="">125</span>:         If True, return `indices` as well as `vertices` and maybe `mapping`</pre>
<pre class="cython line score-0">&#xA0;<span class="">126</span>:         (see below).</pre>
<pre class="cython line score-0">&#xA0;<span class="">127</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">128</span>:     Returns</pre>
<pre class="cython line score-0">&#xA0;<span class="">129</span>:     -------</pre>
<pre class="cython line score-0">&#xA0;<span class="">130</span>:     unique_vertices : (M, 3) ndarray</pre>
<pre class="cython line score-0">&#xA0;<span class="">131</span>:         Vertices sufficiently separated from one another.</pre>
<pre class="cython line score-0">&#xA0;<span class="">132</span>:     mapping : (N,) ndarray</pre>
<pre class="cython line score-0">&#xA0;<span class="">133</span>:         For each element ``vertices[i]`` ($i \in 0..N-1$), the index $j$ to a</pre>
<pre class="cython line score-0">&#xA0;<span class="">134</span>:         vertex in `unique_vertices` that is less than `theta` degrees from</pre>
<pre class="cython line score-0">&#xA0;<span class="">135</span>:         ``vertices[i]``.  Only returned if `return_mapping` is True.</pre>
<pre class="cython line score-0">&#xA0;<span class="">136</span>:     indices : (N,) ndarray</pre>
<pre class="cython line score-0">&#xA0;<span class="">137</span>:         `indices` gives the reverse of `mapping`.  For each element</pre>
<pre class="cython line score-0">&#xA0;<span class="">138</span>:         ``unique_vertices[j]`` ($j \in 0..M-1$), the index $i$ to a vertex in</pre>
<pre class="cython line score-0">&#xA0;<span class="">139</span>:         `vertices` that is less than `theta` degrees from</pre>
<pre class="cython line score-0">&#xA0;<span class="">140</span>:         ``unique_vertices[j]``.  If there is more than one element of</pre>
<pre class="cython line score-0">&#xA0;<span class="">141</span>:         `vertices` that is less than theta degrees from `unique_vertices[j]`,</pre>
<pre class="cython line score-0">&#xA0;<span class="">142</span>:         return the first (lowest index) matching value.  Only return if</pre>
<pre class="cython line score-0">&#xA0;<span class="">143</span>:         `return_indices` is True.</pre>
<pre class="cython line score-0">&#xA0;<span class="">144</span>:     """</pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">145</span>:     if vertices.shape[1] != 3:</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = (((__pyx_v_vertices-&gt;dimensions[1]) != 3) != 0);
  if (__pyx_t_1) {
/* … */
  }
</pre><pre class="cython line score-10" onclick='toggleDiv(this)'>+<span class="">146</span>:         raise ValueError('Vertices should be 2D with second dim length 3')</pre>
<pre class='cython code score-10 '>    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_builtin_ValueError, __pyx_tuple_, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 146, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_2, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='error_goto'>__PYX_ERR(0, 146, __pyx_L1_error)</span>
/* … */
  __pyx_tuple_ = <span class='py_c_api'>PyTuple_Pack</span>(1, __pyx_kp_s_Vertices_should_be_2D_with_secon);<span class='error_goto'> if (unlikely(!__pyx_tuple_)) __PYX_ERR(0, 146, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple_);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple_);
</pre><pre class="cython line score-0">&#xA0;<span class="">147</span>:     cdef:</pre>
<pre class="cython line score-0">&#xA0;<span class="">148</span>:         cnp.ndarray[cnp.float_t, ndim=2, mode='c'] unique_vertices</pre>
<pre class="cython line score-0">&#xA0;<span class="">149</span>:         cnp.ndarray[cnp.uint16_t, ndim=1, mode='c'] mapping</pre>
<pre class="cython line score-0">&#xA0;<span class="">150</span>:         cnp.ndarray[cnp.uint16_t, ndim=1, mode='c'] index</pre>
<pre class="cython line score-0">&#xA0;<span class="">151</span>:         char pass_all</pre>
<pre class="cython line score-0">&#xA0;<span class="">152</span>:         # Variable has to be large enough for all valid sizes of vertices</pre>
<pre class="cython line score-0">&#xA0;<span class="">153</span>:         cnp.npy_int32 i, j</pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">154</span>:         cnp.npy_int32 n_unique = 0</pre>
<pre class='cython code score-0 '>  __pyx_v_n_unique = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">155</span>:         # Large enough for all possible sizes of vertices</pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">156</span>:         cnp.npy_intp n = vertices.shape[0]</pre>
<pre class='cython code score-0 '>  __pyx_v_n = (__pyx_v_vertices-&gt;dimensions[0]);
</pre><pre class="cython line score-0">&#xA0;<span class="">157</span>:         double a, b, c, sim</pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">158</span>:         double cos_similarity = cos(DPY_PI/180 * theta)</pre>
<pre class='cython code score-0 '>  __pyx_v_cos_similarity = cos(((DPY_PI / 180.0) * __pyx_v_theta));
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">159</span>:     if n &gt;= 2**16:  # constrained by input data type</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = ((__pyx_v_n &gt;= 0x10000) != 0);
  if (__pyx_t_1) {
/* … */
  }
</pre><pre class="cython line score-10" onclick='toggleDiv(this)'>+<span class="">160</span>:         raise ValueError("too many vertices")</pre>
<pre class='cython code score-10 '>    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_builtin_ValueError, __pyx_tuple__2, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 160, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_2, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='error_goto'>__PYX_ERR(0, 160, __pyx_L1_error)</span>
/* … */
  __pyx_tuple__2 = <span class='py_c_api'>PyTuple_Pack</span>(1, __pyx_kp_s_too_many_vertices);<span class='error_goto'> if (unlikely(!__pyx_tuple__2)) __PYX_ERR(0, 160, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__2);
</pre><pre class="cython line score-59" onclick='toggleDiv(this)'>+<span class="">161</span>:     unique_vertices = np.empty((n, 3), dtype=np.float)</pre>
<pre class='cython code score-59 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 161, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_empty);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 161, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_Py_intptr_t</span>(__pyx_v_n);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 161, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 161, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_3);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 1, __pyx_int_3);
  __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 161, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, __pyx_t_4);
  __pyx_t_4 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 161, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 161, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_5, __pyx_n_s_float);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 161, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_4, __pyx_n_s_dtype, __pyx_t_6) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 161, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_3, __pyx_t_2, __pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 161, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  if (!(likely(((__pyx_t_6) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_6, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 161, __pyx_L1_error)</span>
  __pyx_t_7 = ((PyArrayObject *)__pyx_t_6);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_unique_vertices.rcbuffer-&gt;pybuffer);
    __pyx_t_8 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_unique_vertices.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_7, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_float_t, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS| PyBUF_WRITABLE, 2, 0, __pyx_stack);
    if (unlikely(__pyx_t_8 &lt; 0)) {
      <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_9, &amp;__pyx_t_10, &amp;__pyx_t_11);
      if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_unique_vertices.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_unique_vertices, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_float_t, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS| PyBUF_WRITABLE, 2, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_9); Py_XDECREF(__pyx_t_10); Py_XDECREF(__pyx_t_11);
        <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
      } else {
        <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_9, __pyx_t_10, __pyx_t_11);
      }
      __pyx_t_9 = __pyx_t_10 = __pyx_t_11 = 0;
    }
    __pyx_pybuffernd_unique_vertices.diminfo[0].strides = __pyx_pybuffernd_unique_vertices.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_unique_vertices.diminfo[0].shape = __pyx_pybuffernd_unique_vertices.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_unique_vertices.diminfo[1].strides = __pyx_pybuffernd_unique_vertices.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_unique_vertices.diminfo[1].shape = __pyx_pybuffernd_unique_vertices.rcbuffer-&gt;pybuffer.shape[1];
    if (unlikely(__pyx_t_8 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 161, __pyx_L1_error)</span>
  }
  __pyx_t_7 = 0;
  __pyx_v_unique_vertices = ((PyArrayObject *)__pyx_t_6);
  __pyx_t_6 = 0;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">162</span>:     if return_mapping:</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = (__pyx_v_return_mapping != 0);
  if (__pyx_t_1) {
/* … */
  }
</pre><pre class="cython line score-51" onclick='toggleDiv(this)'>+<span class="">163</span>:         mapping = np.empty(n, dtype=np.uint16)</pre>
<pre class='cython code score-51 '>    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 163, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_6, __pyx_n_s_empty);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 163, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyInt_From_Py_intptr_t</span>(__pyx_v_n);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 163, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 163, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, __pyx_t_6);
    __pyx_t_6 = 0;
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 163, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 163, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_uint16);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 163, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_6, __pyx_n_s_dtype, __pyx_t_5) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 163, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_4, __pyx_t_2, __pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 163, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    if (!(likely(((__pyx_t_5) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 163, __pyx_L1_error)</span>
    __pyx_t_12 = ((PyArrayObject *)__pyx_t_5);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_mapping.rcbuffer-&gt;pybuffer);
      __pyx_t_8 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_mapping.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_12, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_uint16_t, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS| PyBUF_WRITABLE, 1, 0, __pyx_stack);
      if (unlikely(__pyx_t_8 &lt; 0)) {
        <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_11, &amp;__pyx_t_10, &amp;__pyx_t_9);
        if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_mapping.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_mapping, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_uint16_t, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_11); Py_XDECREF(__pyx_t_10); Py_XDECREF(__pyx_t_9);
          <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
        } else {
          <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_11, __pyx_t_10, __pyx_t_9);
        }
        __pyx_t_11 = __pyx_t_10 = __pyx_t_9 = 0;
      }
      __pyx_pybuffernd_mapping.diminfo[0].strides = __pyx_pybuffernd_mapping.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_mapping.diminfo[0].shape = __pyx_pybuffernd_mapping.rcbuffer-&gt;pybuffer.shape[0];
      if (unlikely(__pyx_t_8 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 163, __pyx_L1_error)</span>
    }
    __pyx_t_12 = 0;
    __pyx_v_mapping = ((PyArrayObject *)__pyx_t_5);
    __pyx_t_5 = 0;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">164</span>:     if return_index:</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = (__pyx_v_return_index != 0);
  if (__pyx_t_1) {
/* … */
  }
</pre><pre class="cython line score-51" onclick='toggleDiv(this)'>+<span class="">165</span>:         index = np.empty(n, dtype=np.uint16)</pre>
<pre class='cython code score-51 '>    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 165, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_5, __pyx_n_s_empty);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 165, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyInt_From_Py_intptr_t</span>(__pyx_v_n);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 165, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 165, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, __pyx_t_5);
    __pyx_t_5 = 0;
    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 165, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 165, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_n_s_uint16);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 165, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_3) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 165, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_6, __pyx_t_2, __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 165, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    if (!(likely(((__pyx_t_3) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_3, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 165, __pyx_L1_error)</span>
    __pyx_t_13 = ((PyArrayObject *)__pyx_t_3);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_index.rcbuffer-&gt;pybuffer);
      __pyx_t_8 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_index.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_13, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_uint16_t, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS| PyBUF_WRITABLE, 1, 0, __pyx_stack);
      if (unlikely(__pyx_t_8 &lt; 0)) {
        <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_9, &amp;__pyx_t_10, &amp;__pyx_t_11);
        if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_index.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_index, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_uint16_t, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_9); Py_XDECREF(__pyx_t_10); Py_XDECREF(__pyx_t_11);
          <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
        } else {
          <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_9, __pyx_t_10, __pyx_t_11);
        }
        __pyx_t_9 = __pyx_t_10 = __pyx_t_11 = 0;
      }
      __pyx_pybuffernd_index.diminfo[0].strides = __pyx_pybuffernd_index.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_index.diminfo[0].shape = __pyx_pybuffernd_index.rcbuffer-&gt;pybuffer.shape[0];
      if (unlikely(__pyx_t_8 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 165, __pyx_L1_error)</span>
    }
    __pyx_t_13 = 0;
    __pyx_v_index = ((PyArrayObject *)__pyx_t_3);
    __pyx_t_3 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">166</span>: </pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">167</span>:     for i in range(n):</pre>
<pre class='cython code score-0 '>  __pyx_t_14 = __pyx_v_n;
  for (__pyx_t_15 = 0; __pyx_t_15 &lt; __pyx_t_14; __pyx_t_15+=1) {
    __pyx_v_i = __pyx_t_15;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">168</span>:         pass_all = 1</pre>
<pre class='cython code score-0 '>    __pyx_v_pass_all = 1;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">169</span>:         a = vertices[i, 0]</pre>
<pre class='cython code score-0 '>    __pyx_t_16 = __pyx_v_i;
    __pyx_t_17 = 0;
    __pyx_v_a = (*__Pyx_BufPtrStrided2d(__pyx_t_5numpy_float_t *, __pyx_pybuffernd_vertices.rcbuffer-&gt;pybuffer.buf, __pyx_t_16, __pyx_pybuffernd_vertices.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_vertices.diminfo[1].strides));
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">170</span>:         b = vertices[i, 1]</pre>
<pre class='cython code score-0 '>    __pyx_t_18 = __pyx_v_i;
    __pyx_t_19 = 1;
    __pyx_v_b = (*__Pyx_BufPtrStrided2d(__pyx_t_5numpy_float_t *, __pyx_pybuffernd_vertices.rcbuffer-&gt;pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_vertices.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_vertices.diminfo[1].strides));
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">171</span>:         c = vertices[i, 2]</pre>
<pre class='cython code score-0 '>    __pyx_t_20 = __pyx_v_i;
    __pyx_t_21 = 2;
    __pyx_v_c = (*__Pyx_BufPtrStrided2d(__pyx_t_5numpy_float_t *, __pyx_pybuffernd_vertices.rcbuffer-&gt;pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_vertices.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_vertices.diminfo[1].strides));
</pre><pre class="cython line score-0">&#xA0;<span class="">172</span>:         # Check all other accepted vertices for similarity to this one</pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">173</span>:         for j in range(n_unique):</pre>
<pre class='cython code score-0 '>    __pyx_t_22 = __pyx_v_n_unique;
    for (__pyx_t_23 = 0; __pyx_t_23 &lt; __pyx_t_22; __pyx_t_23+=1) {
      __pyx_v_j = __pyx_t_23;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">174</span>:             sim = fabs(a * unique_vertices[j, 0] +</pre>
<pre class='cython code score-0 '>      __pyx_t_24 = __pyx_v_j;
      __pyx_t_25 = 0;
/* … */
      __pyx_v_sim = fabs((((__pyx_v_a * (*__Pyx_BufPtrCContig2d(__pyx_t_5numpy_float_t *, __pyx_pybuffernd_unique_vertices.rcbuffer-&gt;pybuffer.buf, __pyx_t_24, __pyx_pybuffernd_unique_vertices.diminfo[0].strides, __pyx_t_25, __pyx_pybuffernd_unique_vertices.diminfo[1].strides))) + (__pyx_v_b * (*__Pyx_BufPtrCContig2d(__pyx_t_5numpy_float_t *, __pyx_pybuffernd_unique_vertices.rcbuffer-&gt;pybuffer.buf, __pyx_t_26, __pyx_pybuffernd_unique_vertices.diminfo[0].strides, __pyx_t_27, __pyx_pybuffernd_unique_vertices.diminfo[1].strides)))) + (__pyx_v_c * (*__Pyx_BufPtrCContig2d(__pyx_t_5numpy_float_t *, __pyx_pybuffernd_unique_vertices.rcbuffer-&gt;pybuffer.buf, __pyx_t_28, __pyx_pybuffernd_unique_vertices.diminfo[0].strides, __pyx_t_29, __pyx_pybuffernd_unique_vertices.diminfo[1].strides)))));
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">175</span>:                        b * unique_vertices[j, 1] +</pre>
<pre class='cython code score-0 '>      __pyx_t_26 = __pyx_v_j;
      __pyx_t_27 = 1;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">176</span>:                        c * unique_vertices[j, 2])</pre>
<pre class='cython code score-0 '>      __pyx_t_28 = __pyx_v_j;
      __pyx_t_29 = 2;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">177</span>:             if sim &gt; cos_similarity:  # too similar, drop</pre>
<pre class='cython code score-0 '>      __pyx_t_1 = ((__pyx_v_sim &gt; __pyx_v_cos_similarity) != 0);
      if (__pyx_t_1) {
/* … */
      }
    }
    __pyx_L10_break:;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">178</span>:                 pass_all = 0</pre>
<pre class='cython code score-0 '>        __pyx_v_pass_all = 0;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">179</span>:                 if return_mapping:</pre>
<pre class='cython code score-0 '>        __pyx_t_1 = (__pyx_v_return_mapping != 0);
        if (__pyx_t_1) {
/* … */
        }
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">180</span>:                     mapping[i] = j</pre>
<pre class='cython code score-0 '>          __pyx_t_30 = __pyx_v_i;
          *__Pyx_BufPtrCContig1d(__pyx_t_5numpy_uint16_t *, __pyx_pybuffernd_mapping.rcbuffer-&gt;pybuffer.buf, __pyx_t_30, __pyx_pybuffernd_mapping.diminfo[0].strides) = __pyx_v_j;
</pre><pre class="cython line score-0">&#xA0;<span class="">181</span>:                 # This point unique_vertices[j] already has an entry in index,</pre>
<pre class="cython line score-0">&#xA0;<span class="">182</span>:                 # so we do not need to update.</pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">183</span>:                 break</pre>
<pre class='cython code score-0 '>        goto __pyx_L10_break;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">184</span>:         if pass_all:  # none similar, keep</pre>
<pre class='cython code score-0 '>    __pyx_t_1 = (__pyx_v_pass_all != 0);
    if (__pyx_t_1) {
/* … */
    }
  }
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">185</span>:             unique_vertices[n_unique, 0] = a</pre>
<pre class='cython code score-0 '>      __pyx_t_31 = __pyx_v_n_unique;
      __pyx_t_32 = 0;
      *__Pyx_BufPtrCContig2d(__pyx_t_5numpy_float_t *, __pyx_pybuffernd_unique_vertices.rcbuffer-&gt;pybuffer.buf, __pyx_t_31, __pyx_pybuffernd_unique_vertices.diminfo[0].strides, __pyx_t_32, __pyx_pybuffernd_unique_vertices.diminfo[1].strides) = __pyx_v_a;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">186</span>:             unique_vertices[n_unique, 1] = b</pre>
<pre class='cython code score-0 '>      __pyx_t_33 = __pyx_v_n_unique;
      __pyx_t_34 = 1;
      *__Pyx_BufPtrCContig2d(__pyx_t_5numpy_float_t *, __pyx_pybuffernd_unique_vertices.rcbuffer-&gt;pybuffer.buf, __pyx_t_33, __pyx_pybuffernd_unique_vertices.diminfo[0].strides, __pyx_t_34, __pyx_pybuffernd_unique_vertices.diminfo[1].strides) = __pyx_v_b;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">187</span>:             unique_vertices[n_unique, 2] = c</pre>
<pre class='cython code score-0 '>      __pyx_t_35 = __pyx_v_n_unique;
      __pyx_t_36 = 2;
      *__Pyx_BufPtrCContig2d(__pyx_t_5numpy_float_t *, __pyx_pybuffernd_unique_vertices.rcbuffer-&gt;pybuffer.buf, __pyx_t_35, __pyx_pybuffernd_unique_vertices.diminfo[0].strides, __pyx_t_36, __pyx_pybuffernd_unique_vertices.diminfo[1].strides) = __pyx_v_c;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">188</span>:             if return_mapping:</pre>
<pre class='cython code score-0 '>      __pyx_t_1 = (__pyx_v_return_mapping != 0);
      if (__pyx_t_1) {
/* … */
      }
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">189</span>:                 mapping[i] = n_unique</pre>
<pre class='cython code score-0 '>        __pyx_t_37 = __pyx_v_i;
        *__Pyx_BufPtrCContig1d(__pyx_t_5numpy_uint16_t *, __pyx_pybuffernd_mapping.rcbuffer-&gt;pybuffer.buf, __pyx_t_37, __pyx_pybuffernd_mapping.diminfo[0].strides) = __pyx_v_n_unique;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">190</span>:             if return_index:</pre>
<pre class='cython code score-0 '>      __pyx_t_1 = (__pyx_v_return_index != 0);
      if (__pyx_t_1) {
/* … */
      }
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">191</span>:                 index[n_unique] = i</pre>
<pre class='cython code score-0 '>        __pyx_t_38 = __pyx_v_n_unique;
        *__Pyx_BufPtrCContig1d(__pyx_t_5numpy_uint16_t *, __pyx_pybuffernd_index.rcbuffer-&gt;pybuffer.buf, __pyx_t_38, __pyx_pybuffernd_index.diminfo[0].strides) = __pyx_v_i;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">192</span>:             n_unique += 1</pre>
<pre class='cython code score-0 '>      __pyx_v_n_unique = (__pyx_v_n_unique + 1);
</pre><pre class="cython line score-0">&#xA0;<span class="">193</span>: </pre>
<pre class="cython line score-31" onclick='toggleDiv(this)'>+<span class="">194</span>:     verts = unique_vertices[:n_unique].copy()</pre>
<pre class='cython code score-31 '>  __pyx_t_5 = __Pyx_PyInt_From_npy_int32(__pyx_v_n_unique);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 194, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_2 = <span class='py_c_api'>PySlice_New</span>(Py_None, __pyx_t_5, Py_None);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 194, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = <span class='py_c_api'>PyObject_GetItem</span>(((PyObject *)__pyx_v_unique_vertices), __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 194, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_5, __pyx_n_s_copy);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 194, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_2))) {
    __pyx_t_5 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_2);
    if (likely(__pyx_t_5)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_2, function);
    }
  }
  if (__pyx_t_5) {
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_2, __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 194, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  } else {
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_CallNoArg</span>(__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 194, __pyx_L1_error)</span>
  }
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_verts = __pyx_t_3;
  __pyx_t_3 = 0;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">195</span>:     if not return_mapping and not return_index:</pre>
<pre class='cython code score-0 '>  __pyx_t_39 = ((!(__pyx_v_return_mapping != 0)) != 0);
  if (__pyx_t_39) {
  } else {
    __pyx_t_1 = __pyx_t_39;
    goto __pyx_L17_bool_binop_done;
  }
  __pyx_t_39 = ((!(__pyx_v_return_index != 0)) != 0);
  __pyx_t_1 = __pyx_t_39;
  __pyx_L17_bool_binop_done:;
  if (__pyx_t_1) {
/* … */
  }
</pre><pre class="cython line score-2" onclick='toggleDiv(this)'>+<span class="">196</span>:         return verts</pre>
<pre class='cython code score-2 '>    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_verts);
    __pyx_r = __pyx_v_verts;
    goto __pyx_L0;
</pre><pre class="cython line score-7" onclick='toggleDiv(this)'>+<span class="">197</span>:     out = [verts]</pre>
<pre class='cython code score-7 '>  __pyx_t_3 = <span class='py_c_api'>PyList_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 197, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_verts);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_verts);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_3, 0, __pyx_v_verts);
  __pyx_v_out = ((PyObject*)__pyx_t_3);
  __pyx_t_3 = 0;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">198</span>:     if return_mapping:</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = (__pyx_v_return_mapping != 0);
  if (__pyx_t_1) {
/* … */
  }
</pre><pre class="cython line score-2" onclick='toggleDiv(this)'>+<span class="">199</span>:         out.append(mapping)</pre>
<pre class='cython code score-2 '>    __pyx_t_40 = <span class='pyx_c_api'>__Pyx_PyList_Append</span>(__pyx_v_out, ((PyObject *)__pyx_v_mapping));<span class='error_goto'> if (unlikely(__pyx_t_40 == ((int)-1))) __PYX_ERR(0, 199, __pyx_L1_error)</span>
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">200</span>:     if return_index:</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = (__pyx_v_return_index != 0);
  if (__pyx_t_1) {
/* … */
  }
</pre><pre class="cython line score-34" onclick='toggleDiv(this)'>+<span class="">201</span>:         out.append(index[:n_unique].copy())</pre>
<pre class='cython code score-34 '>    __pyx_t_2 = __Pyx_PyInt_From_npy_int32(__pyx_v_n_unique);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 201, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    __pyx_t_5 = <span class='py_c_api'>PySlice_New</span>(Py_None, __pyx_t_2, Py_None);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 201, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = <span class='py_c_api'>PyObject_GetItem</span>(((PyObject *)__pyx_v_index), __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 201, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_copy);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 201, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = NULL;
    if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_5))) {
      __pyx_t_2 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_5);
      if (likely(__pyx_t_2)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_5);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_5, function);
      }
    }
    if (__pyx_t_2) {
      __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_5, __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 201, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    } else {
      __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_CallNoArg</span>(__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 201, __pyx_L1_error)</span>
    }
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_40 = <span class='pyx_c_api'>__Pyx_PyList_Append</span>(__pyx_v_out, __pyx_t_3);<span class='error_goto'> if (unlikely(__pyx_t_40 == ((int)-1))) __PYX_ERR(0, 201, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class="cython line score-2" onclick='toggleDiv(this)'>+<span class="">202</span>:     return out</pre>
<pre class='cython code score-2 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_out);
  __pyx_r = __pyx_v_out;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">203</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">204</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">205</span>: @cython.boundscheck(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">206</span>: @cython.wraparound(False)</pre>
<pre class="cython line score-68" onclick='toggleDiv(this)'>+<span class="">207</span>: def search_descending(cnp.ndarray[cnp.float_t, ndim=1, mode='c'] a,</pre>
<pre class='cython code score-68 '>/* Python wrapper */
static PyObject *__pyx_pw_4dipy_7reconst_8recspeed_5search_descending(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4dipy_7reconst_8recspeed_4search_descending[] = "`i` in descending array `a` so `a[i] &lt; a[0] * relative_threshold`\n\n    Call ``T = a[0] * relative_threshold``. Return value `i` will be the\n    smallest index in the descending array `a` such that ``a[i] &lt; T``.\n    Equivalently, `i` will be the largest index such that ``all(a[:i] &gt;= T)``.\n    If all values in `a` are &gt;= T, return the length of array `a`.\n\n    Parameters\n    ----------\n    a : ndarray, ndim=1, c-contiguous\n        Array to be searched.  We assume `a` is in descending order.\n    relative_threshold : float\n        Applied threshold will be ``T`` with ``T = a[0] * relative_threshold``.\n\n    Returns\n    -------\n    i : np.intp\n        If ``T = a[0] * relative_threshold`` then `i` will be the largest index\n        such that ``all(a[:i] &gt;= T)``.  If all values in `a` are &gt;= T then\n        `i` will be `len(a)`.\n\n    Examples\n    --------\n    &gt;&gt;&gt; a = np.arange(10, 0, -1, dtype=float)\n    &gt;&gt;&gt; a\n    array([ 10.,   9.,   8.,   7.,   6.,   5.,   4.,   3.,   2.,   1.])\n    &gt;&gt;&gt; search_descending(a, 0.5)\n    6\n    &gt;&gt;&gt; a &lt; 10 * 0.5\n    array([False, False, False, False, False, False,  True,  True,  True,  True], dtype=bool)\n    &gt;&gt;&gt; search_descending(a, 1)\n    1\n    &gt;&gt;&gt; search_descending(a, 2)\n    0\n    &gt;&gt;&gt; search_descending(a, 0)\n    10\n    ";
static PyMethodDef __pyx_mdef_4dipy_7reconst_8recspeed_5search_descending = {"search_descending", (PyCFunction)__pyx_pw_4dipy_7reconst_8recspeed_5search_descending, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4dipy_7reconst_8recspeed_4search_descending};
static PyObject *__pyx_pw_4dipy_7reconst_8recspeed_5search_descending(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyArrayObject *__pyx_v_a = 0;
  double __pyx_v_relative_threshold;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("search_descending (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_a,&amp;__pyx_n_s_relative_threshold,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_a)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_relative_threshold)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("search_descending", 1, 2, 2, 1); <span class='error_goto'>__PYX_ERR(0, 207, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "search_descending") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 207, __pyx_L3_error)</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
    }
    __pyx_v_a = ((PyArrayObject *)values[0]);
    __pyx_v_relative_threshold = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[1]); if (unlikely((__pyx_v_relative_threshold == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 208, __pyx_L3_error)</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("search_descending", 1, 2, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 207, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("dipy.reconst.recspeed.search_descending", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_a), __pyx_ptype_5numpy_ndarray, 1, "a", 0))) <span class='error_goto'>__PYX_ERR(0, 207, __pyx_L1_error)</span>
  __pyx_r = __pyx_pf_4dipy_7reconst_8recspeed_4search_descending(__pyx_self, __pyx_v_a, __pyx_v_relative_threshold);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_4dipy_7reconst_8recspeed_4search_descending(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_a, double __pyx_v_relative_threshold) {
  npy_intp __pyx_v_left;
  npy_intp __pyx_v_right;
  npy_intp __pyx_v_mid;
  double __pyx_v_threshold;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_a;
  __Pyx_Buffer __pyx_pybuffer_a;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("search_descending", 0);
  __pyx_pybuffer_a.pybuffer.buf = NULL;
  __pyx_pybuffer_a.refcount = 0;
  __pyx_pybuffernd_a.data = NULL;
  __pyx_pybuffernd_a.rcbuffer = &amp;__pyx_pybuffer_a;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_a.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_a, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_float_t, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 207, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_a.diminfo[0].strides = __pyx_pybuffernd_a.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_a.diminfo[0].shape = __pyx_pybuffernd_a.rcbuffer-&gt;pybuffer.shape[0];
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_a.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("dipy.reconst.recspeed.search_descending", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_a.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__43 = <span class='py_c_api'>PyTuple_Pack</span>(6, __pyx_n_s_a, __pyx_n_s_relative_threshold, __pyx_n_s_left, __pyx_n_s_right, __pyx_n_s_mid, __pyx_n_s_threshold);<span class='error_goto'> if (unlikely(!__pyx_tuple__43)) __PYX_ERR(0, 207, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__43);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__43);
/* … */
  __pyx_t_1 = PyCFunction_NewEx(&amp;__pyx_mdef_4dipy_7reconst_8recspeed_5search_descending, NULL, __pyx_n_s_dipy_reconst_recspeed);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 207, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_search_descending, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 207, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_codeobj__44 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(2, 0, 6, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__43, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_dipy_reconst_recspeed_pyx, __pyx_n_s_search_descending, 207, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__44)) __PYX_ERR(0, 207, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">208</span>:                       double relative_threshold):</pre>
<pre class="cython line score-0">&#xA0;<span class="">209</span>:     """`i` in descending array `a` so `a[i] &lt; a[0] * relative_threshold`</pre>
<pre class="cython line score-0">&#xA0;<span class="">210</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">211</span>:     Call ``T = a[0] * relative_threshold``. Return value `i` will be the</pre>
<pre class="cython line score-0">&#xA0;<span class="">212</span>:     smallest index in the descending array `a` such that ``a[i] &lt; T``.</pre>
<pre class="cython line score-0">&#xA0;<span class="">213</span>:     Equivalently, `i` will be the largest index such that ``all(a[:i] &gt;= T)``.</pre>
<pre class="cython line score-0">&#xA0;<span class="">214</span>:     If all values in `a` are &gt;= T, return the length of array `a`.</pre>
<pre class="cython line score-0">&#xA0;<span class="">215</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">216</span>:     Parameters</pre>
<pre class="cython line score-0">&#xA0;<span class="">217</span>:     ----------</pre>
<pre class="cython line score-0">&#xA0;<span class="">218</span>:     a : ndarray, ndim=1, c-contiguous</pre>
<pre class="cython line score-0">&#xA0;<span class="">219</span>:         Array to be searched.  We assume `a` is in descending order.</pre>
<pre class="cython line score-0">&#xA0;<span class="">220</span>:     relative_threshold : float</pre>
<pre class="cython line score-0">&#xA0;<span class="">221</span>:         Applied threshold will be ``T`` with ``T = a[0] * relative_threshold``.</pre>
<pre class="cython line score-0">&#xA0;<span class="">222</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">223</span>:     Returns</pre>
<pre class="cython line score-0">&#xA0;<span class="">224</span>:     -------</pre>
<pre class="cython line score-0">&#xA0;<span class="">225</span>:     i : np.intp</pre>
<pre class="cython line score-0">&#xA0;<span class="">226</span>:         If ``T = a[0] * relative_threshold`` then `i` will be the largest index</pre>
<pre class="cython line score-0">&#xA0;<span class="">227</span>:         such that ``all(a[:i] &gt;= T)``.  If all values in `a` are &gt;= T then</pre>
<pre class="cython line score-0">&#xA0;<span class="">228</span>:         `i` will be `len(a)`.</pre>
<pre class="cython line score-0">&#xA0;<span class="">229</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">230</span>:     Examples</pre>
<pre class="cython line score-0">&#xA0;<span class="">231</span>:     --------</pre>
<pre class="cython line score-0">&#xA0;<span class="">232</span>:     &gt;&gt;&gt; a = np.arange(10, 0, -1, dtype=float)</pre>
<pre class="cython line score-0">&#xA0;<span class="">233</span>:     &gt;&gt;&gt; a</pre>
<pre class="cython line score-0">&#xA0;<span class="">234</span>:     array([ 10.,   9.,   8.,   7.,   6.,   5.,   4.,   3.,   2.,   1.])</pre>
<pre class="cython line score-0">&#xA0;<span class="">235</span>:     &gt;&gt;&gt; search_descending(a, 0.5)</pre>
<pre class="cython line score-0">&#xA0;<span class="">236</span>:     6</pre>
<pre class="cython line score-0">&#xA0;<span class="">237</span>:     &gt;&gt;&gt; a &lt; 10 * 0.5</pre>
<pre class="cython line score-0">&#xA0;<span class="">238</span>:     array([False, False, False, False, False, False,  True,  True,  True,  True], dtype=bool)</pre>
<pre class="cython line score-0">&#xA0;<span class="">239</span>:     &gt;&gt;&gt; search_descending(a, 1)</pre>
<pre class="cython line score-0">&#xA0;<span class="">240</span>:     1</pre>
<pre class="cython line score-0">&#xA0;<span class="">241</span>:     &gt;&gt;&gt; search_descending(a, 2)</pre>
<pre class="cython line score-0">&#xA0;<span class="">242</span>:     0</pre>
<pre class="cython line score-0">&#xA0;<span class="">243</span>:     &gt;&gt;&gt; search_descending(a, 0)</pre>
<pre class="cython line score-0">&#xA0;<span class="">244</span>:     10</pre>
<pre class="cython line score-0">&#xA0;<span class="">245</span>:     """</pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">246</span>:     if a.shape[0] == 0:</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = (((__pyx_v_a-&gt;dimensions[0]) == 0) != 0);
  if (__pyx_t_1) {
/* … */
  }
</pre><pre class="cython line score-2" onclick='toggleDiv(this)'>+<span class="">247</span>:         return 0</pre>
<pre class='cython code score-2 '>    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_0);
    __pyx_r = __pyx_int_0;
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">248</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">249</span>:     cdef:</pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">250</span>:         cnp.npy_intp left = 0</pre>
<pre class='cython code score-0 '>  __pyx_v_left = 0;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">251</span>:         cnp.npy_intp right = a.shape[0]</pre>
<pre class='cython code score-0 '>  __pyx_v_right = (__pyx_v_a-&gt;dimensions[0]);
</pre><pre class="cython line score-0">&#xA0;<span class="">252</span>:         cnp.npy_intp mid</pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">253</span>:         double threshold = relative_threshold * a[0]</pre>
<pre class='cython code score-0 '>  __pyx_t_2 = 0;
  __pyx_v_threshold = (__pyx_v_relative_threshold * (*__Pyx_BufPtrCContig1d(__pyx_t_5numpy_float_t *, __pyx_pybuffernd_a.rcbuffer-&gt;pybuffer.buf, __pyx_t_2, __pyx_pybuffernd_a.diminfo[0].strides)));
</pre><pre class="cython line score-0">&#xA0;<span class="">254</span>: </pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">255</span>:     while left != right:</pre>
<pre class='cython code score-0 '>  while (1) {
    __pyx_t_1 = ((__pyx_v_left != __pyx_v_right) != 0);
    if (!__pyx_t_1) break;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">256</span>:         mid = (left + right) // 2</pre>
<pre class='cython code score-0 '>    __pyx_v_mid = __Pyx_div_long((__pyx_v_left + __pyx_v_right), 2);
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">257</span>:         if a[mid] &gt;= threshold:</pre>
<pre class='cython code score-0 '>    __pyx_t_3 = __pyx_v_mid;
    __pyx_t_1 = (((*__Pyx_BufPtrCContig1d(__pyx_t_5numpy_float_t *, __pyx_pybuffernd_a.rcbuffer-&gt;pybuffer.buf, __pyx_t_3, __pyx_pybuffernd_a.diminfo[0].strides)) &gt;= __pyx_v_threshold) != 0);
    if (__pyx_t_1) {
/* … */
      goto __pyx_L6;
    }
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">258</span>:             left = mid + 1</pre>
<pre class='cython code score-0 '>      __pyx_v_left = (__pyx_v_mid + 1);
</pre><pre class="cython line score-0">&#xA0;<span class="">259</span>:         else:</pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">260</span>:             right = mid</pre>
<pre class='cython code score-0 '>    /*else*/ {
      __pyx_v_right = __pyx_v_mid;
    }
    __pyx_L6:;
  }
</pre><pre class="cython line score-3" onclick='toggleDiv(this)'>+<span class="">261</span>:     return left</pre>
<pre class='cython code score-3 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_From_Py_intptr_t</span>(__pyx_v_left);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 261, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_r = __pyx_t_4;
  __pyx_t_4 = 0;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">262</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">263</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">264</span>: @cython.wraparound(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">265</span>: @cython.boundscheck(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">266</span>: @cython.profile(True)</pre>
<pre class="cython line score-63" onclick='toggleDiv(this)'>+<span class="">267</span>: def local_maxima(double[:] odf, cnp.uint16_t[:, :] edges):</pre>
<pre class='cython code score-63 '>/* Python wrapper */
static PyObject *__pyx_pw_4dipy_7reconst_8recspeed_7local_maxima(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4dipy_7reconst_8recspeed_6local_maxima[] = "Local maxima of a function evaluated on a discrete set of points.\n\n    If a function is evaluated on some set of points where each pair of\n    neighboring points is an edge in edges, find the local maxima.\n\n    Parameters\n    ----------\n    odf : array, 1d, dtype=double\n        The function evaluated on a set of discrete points.\n    edges : array (N, 2)\n        The set of neighbor relations between the points. Every edge, ie\n        `edges[i, :]`, is a pair of neighboring points.\n\n    Returns\n    -------\n    peak_values : ndarray\n        Value of odf at a maximum point. Peak values is sorted in descending\n        order.\n    peak_indices : ndarray\n        Indices of maximum points. Sorted in the same order as `peak_values` so\n        `odf[peak_indices[i]] == peak_values[i]`.\n\n    Note\n    ----\n    A point is a local maximum if it is &gt; at least one neighbor and &gt;= all\n    neighbors. If no points meet the above criteria, 1 maximum is returned such\n    that `odf[maximum] == max(odf)`.\n\n    See Also\n    --------\n    dipy.core.sphere\n    ";
static PyMethodDef __pyx_mdef_4dipy_7reconst_8recspeed_7local_maxima = {"local_maxima", (PyCFunction)__pyx_pw_4dipy_7reconst_8recspeed_7local_maxima, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4dipy_7reconst_8recspeed_6local_maxima};
static PyObject *__pyx_pw_4dipy_7reconst_8recspeed_7local_maxima(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  __Pyx_memviewslice __pyx_v_odf = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_edges = { 0, 0, { 0 }, { 0 }, { 0 } };
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("local_maxima (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_odf,&amp;__pyx_n_s_edges,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_odf)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_edges)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("local_maxima", 1, 2, 2, 1); <span class='error_goto'>__PYX_ERR(0, 267, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "local_maxima") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 267, __pyx_L3_error)</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
    }
    __pyx_v_odf = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[0]);<span class='error_goto'> if (unlikely(!__pyx_v_odf.memview)) __PYX_ERR(0, 267, __pyx_L3_error)</span>
    __pyx_v_edges = __Pyx_PyObject_to_MemoryviewSlice_dsds_nn___pyx_t_5numpy_uint16_t(values[1]);<span class='error_goto'> if (unlikely(!__pyx_v_edges.memview)) __PYX_ERR(0, 267, __pyx_L3_error)</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("local_maxima", 1, 2, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 267, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("dipy.reconst.recspeed.local_maxima", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_4dipy_7reconst_8recspeed_6local_maxima(__pyx_self, __pyx_v_odf, __pyx_v_edges);

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_4dipy_7reconst_8recspeed_6local_maxima(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_odf, __Pyx_memviewslice __pyx_v_edges) {
  PyArrayObject *__pyx_v_wpeak = 0;
  long __pyx_v_count;
  PyObject *__pyx_v_indices = NULL;
  PyObject *__pyx_v_values = NULL;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_wpeak;
  __Pyx_Buffer __pyx_pybuffer_wpeak;
  PyObject *__pyx_r = NULL;
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='trace'>__Pyx_TraceFrameInit</span>(__pyx_codeobj__3)
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("local_maxima", 0);
  <span class='trace'>__Pyx_TraceCall</span>("local_maxima", __pyx_f[0], 267, 0, <span class='error_goto'>__PYX_ERR(0, 267, __pyx_L1_error)</span>);
  __pyx_pybuffer_wpeak.pybuffer.buf = NULL;
  __pyx_pybuffer_wpeak.refcount = 0;
  __pyx_pybuffernd_wpeak.data = NULL;
  __pyx_pybuffernd_wpeak.rcbuffer = &amp;__pyx_pybuffer_wpeak;
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_12, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_13, 1);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_wpeak.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("dipy.reconst.recspeed.local_maxima", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_wpeak.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_wpeak);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_indices);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_values);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_odf, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_edges, 1);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='trace'>__Pyx_TraceReturn</span>(__pyx_r, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__45 = <span class='py_c_api'>PyTuple_Pack</span>(6, __pyx_n_s_odf, __pyx_n_s_edges, __pyx_n_s_wpeak, __pyx_n_s_count, __pyx_n_s_indices, __pyx_n_s_values);<span class='error_goto'> if (unlikely(!__pyx_tuple__45)) __PYX_ERR(0, 267, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__45);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__45);
/* … */
  __pyx_t_1 = PyCFunction_NewEx(&amp;__pyx_mdef_4dipy_7reconst_8recspeed_7local_maxima, NULL, __pyx_n_s_dipy_reconst_recspeed);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 267, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_local_maxima, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 267, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_codeobj__3 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(2, 0, 6, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__45, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_dipy_reconst_recspeed_pyx, __pyx_n_s_local_maxima, 267, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__3)) __PYX_ERR(0, 267, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">268</span>:     """Local maxima of a function evaluated on a discrete set of points.</pre>
<pre class="cython line score-0">&#xA0;<span class="">269</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">270</span>:     If a function is evaluated on some set of points where each pair of</pre>
<pre class="cython line score-0">&#xA0;<span class="">271</span>:     neighboring points is an edge in edges, find the local maxima.</pre>
<pre class="cython line score-0">&#xA0;<span class="">272</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">273</span>:     Parameters</pre>
<pre class="cython line score-0">&#xA0;<span class="">274</span>:     ----------</pre>
<pre class="cython line score-0">&#xA0;<span class="">275</span>:     odf : array, 1d, dtype=double</pre>
<pre class="cython line score-0">&#xA0;<span class="">276</span>:         The function evaluated on a set of discrete points.</pre>
<pre class="cython line score-0">&#xA0;<span class="">277</span>:     edges : array (N, 2)</pre>
<pre class="cython line score-0">&#xA0;<span class="">278</span>:         The set of neighbor relations between the points. Every edge, ie</pre>
<pre class="cython line score-0">&#xA0;<span class="">279</span>:         `edges[i, :]`, is a pair of neighboring points.</pre>
<pre class="cython line score-0">&#xA0;<span class="">280</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">281</span>:     Returns</pre>
<pre class="cython line score-0">&#xA0;<span class="">282</span>:     -------</pre>
<pre class="cython line score-0">&#xA0;<span class="">283</span>:     peak_values : ndarray</pre>
<pre class="cython line score-0">&#xA0;<span class="">284</span>:         Value of odf at a maximum point. Peak values is sorted in descending</pre>
<pre class="cython line score-0">&#xA0;<span class="">285</span>:         order.</pre>
<pre class="cython line score-0">&#xA0;<span class="">286</span>:     peak_indices : ndarray</pre>
<pre class="cython line score-0">&#xA0;<span class="">287</span>:         Indices of maximum points. Sorted in the same order as `peak_values` so</pre>
<pre class="cython line score-0">&#xA0;<span class="">288</span>:         `odf[peak_indices[i]] == peak_values[i]`.</pre>
<pre class="cython line score-0">&#xA0;<span class="">289</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">290</span>:     Note</pre>
<pre class="cython line score-0">&#xA0;<span class="">291</span>:     ----</pre>
<pre class="cython line score-0">&#xA0;<span class="">292</span>:     A point is a local maximum if it is &gt; at least one neighbor and &gt;= all</pre>
<pre class="cython line score-0">&#xA0;<span class="">293</span>:     neighbors. If no points meet the above criteria, 1 maximum is returned such</pre>
<pre class="cython line score-0">&#xA0;<span class="">294</span>:     that `odf[maximum] == max(odf)`.</pre>
<pre class="cython line score-0">&#xA0;<span class="">295</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">296</span>:     See Also</pre>
<pre class="cython line score-0">&#xA0;<span class="">297</span>:     --------</pre>
<pre class="cython line score-0">&#xA0;<span class="">298</span>:     dipy.core.sphere</pre>
<pre class="cython line score-0">&#xA0;<span class="">299</span>:     """</pre>
<pre class="cython line score-0">&#xA0;<span class="">300</span>:     cdef:</pre>
<pre class="cython line score-0">&#xA0;<span class="">301</span>:         cnp.ndarray[cnp.npy_intp] wpeak</pre>
<pre class="cython line score-60" onclick='toggleDiv(this)'>+<span class="">302</span>:     wpeak = np.zeros((odf.shape[0],), dtype=np.intp)</pre>
<pre class='cython code score-60 '>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 302, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_zeros);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 302, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyInt_FromSsize_t</span>((__pyx_v_odf.shape[0]));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 302, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 302, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 302, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_t_3);
  __pyx_t_3 = 0;
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 302, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 302, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_n_s_intp);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 302, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_3, __pyx_n_s_dtype, __pyx_t_5) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 302, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_t_1, __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 302, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (!(likely(((__pyx_t_5) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 302, __pyx_L1_error)</span>
  __pyx_t_6 = ((PyArrayObject *)__pyx_t_5);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_wpeak.rcbuffer-&gt;pybuffer);
    __pyx_t_7 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_wpeak.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_6, &amp;__Pyx_TypeInfo_nn_npy_intp, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_7 &lt; 0)) {
      <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_8, &amp;__pyx_t_9, &amp;__pyx_t_10);
      if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_wpeak.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_wpeak, &amp;__Pyx_TypeInfo_nn_npy_intp, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_8); Py_XDECREF(__pyx_t_9); Py_XDECREF(__pyx_t_10);
        <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
      } else {
        <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_8, __pyx_t_9, __pyx_t_10);
      }
      __pyx_t_8 = __pyx_t_9 = __pyx_t_10 = 0;
    }
    __pyx_pybuffernd_wpeak.diminfo[0].strides = __pyx_pybuffernd_wpeak.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_wpeak.diminfo[0].shape = __pyx_pybuffernd_wpeak.rcbuffer-&gt;pybuffer.shape[0];
    if (unlikely(__pyx_t_7 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 302, __pyx_L1_error)</span>
  }
  __pyx_t_6 = 0;
  __pyx_v_wpeak = ((PyArrayObject *)__pyx_t_5);
  __pyx_t_5 = 0;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">303</span>:     count = _compare_neighbors(odf, edges, &amp;wpeak[0])</pre>
<pre class='cython code score-0 '>  __pyx_t_11 = 0;
  __pyx_v_count = __pyx_f_4dipy_7reconst_8recspeed__compare_neighbors(__pyx_v_odf, __pyx_v_edges, (&amp;(*__Pyx_BufPtrStrided1d(npy_intp *, __pyx_pybuffernd_wpeak.rcbuffer-&gt;pybuffer.buf, __pyx_t_11, __pyx_pybuffernd_wpeak.diminfo[0].strides))));
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">304</span>:     if count == -1:</pre>
<pre class='cython code score-0 '>  switch (__pyx_v_count) {
    case -1L:
/* … */
    break;
</pre><pre class="cython line score-10" onclick='toggleDiv(this)'>+<span class="">305</span>:         raise IndexError("Values in edges must be &lt; len(odf)")</pre>
<pre class='cython code score-10 '>    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_builtin_IndexError, __pyx_tuple__4, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 305, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_5, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    <span class='error_goto'>__PYX_ERR(0, 305, __pyx_L1_error)</span>
/* … */
  __pyx_tuple__4 = <span class='py_c_api'>PyTuple_Pack</span>(1, __pyx_kp_s_Values_in_edges_must_be_len_odf);<span class='error_goto'> if (unlikely(!__pyx_tuple__4)) __PYX_ERR(0, 305, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__4);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__4);
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">306</span>:     elif count == -2:</pre>
<pre class='cython code score-0 '>    case -2L:
/* … */
    break;
    default: break;
  }
</pre><pre class="cython line score-10" onclick='toggleDiv(this)'>+<span class="">307</span>:         raise ValueError("odf can not have nans")</pre>
<pre class='cython code score-10 '>    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_builtin_ValueError, __pyx_tuple__5, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 307, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_5, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    <span class='error_goto'>__PYX_ERR(0, 307, __pyx_L1_error)</span>
/* … */
  __pyx_tuple__5 = <span class='py_c_api'>PyTuple_Pack</span>(1, __pyx_kp_s_odf_can_not_have_nans);<span class='error_goto'> if (unlikely(!__pyx_tuple__5)) __PYX_ERR(0, 307, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__5);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__5);
</pre><pre class="cython line score-33" onclick='toggleDiv(this)'>+<span class="">308</span>:     indices = wpeak[:count].copy()</pre>
<pre class='cython code score-33 '>  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>(__pyx_v_count);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 308, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_1 = <span class='py_c_api'>PySlice_New</span>(Py_None, __pyx_t_3, Py_None);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 308, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = <span class='py_c_api'>PyObject_GetItem</span>(((PyObject *)__pyx_v_wpeak), __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 308, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_copy);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 308, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_1))) {
    __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_1);
    if (likely(__pyx_t_3)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_1, function);
    }
  }
  if (__pyx_t_3) {
    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_1, __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 308, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  } else {
    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_CallNoArg</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 308, __pyx_L1_error)</span>
  }
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_indices = __pyx_t_5;
  __pyx_t_5 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">309</span>:     # Get peak values return</pre>
<pre class="cython line score-43" onclick='toggleDiv(this)'>+<span class="">310</span>:     values = np.take(odf, indices)</pre>
<pre class='cython code score-43 '>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 310, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_take);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 310, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __pyx_memoryview_fromslice(__pyx_v_odf, 1, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 310, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = NULL;
  __pyx_t_7 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
    __pyx_t_2 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
    if (likely(__pyx_t_2)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
      __pyx_t_7 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_3)) {
    PyObject *__pyx_temp[3] = {__pyx_t_2, __pyx_t_1, __pyx_v_indices};
    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_3, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 310, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_3)) {
    PyObject *__pyx_temp[3] = {__pyx_t_2, __pyx_t_1, __pyx_v_indices};
    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_3, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 310, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  } else
  #endif
  {
    __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 310, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    if (__pyx_t_2) {
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_t_2); __pyx_t_2 = NULL;
    }
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0+__pyx_t_7, __pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_indices);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_indices);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 1+__pyx_t_7, __pyx_v_indices);
    __pyx_t_1 = 0;
    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_3, __pyx_t_4, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 310, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_values = __pyx_t_5;
  __pyx_t_5 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">311</span>:     # Sort both values and indices</pre>
<pre class="cython line score-4" onclick='toggleDiv(this)'>+<span class="">312</span>:     _cosort(values, indices)</pre>
<pre class='cython code score-4 '>  __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dc_double</span>(__pyx_v_values);
  if (unlikely(!__pyx_t_12.memview)) <span class='error_goto'>__PYX_ERR(0, 312, __pyx_L1_error)</span>
  __pyx_t_13 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dc_nn_npy_intp</span>(__pyx_v_indices);
  if (unlikely(!__pyx_t_13.memview)) <span class='error_goto'>__PYX_ERR(0, 312, __pyx_L1_error)</span>
  __pyx_f_4dipy_7reconst_8recspeed__cosort(__pyx_t_12, __pyx_t_13);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_12, 1);
  __pyx_t_12.memview = NULL;
  __pyx_t_12.data = NULL;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_13, 1);
  __pyx_t_13.memview = NULL;
  __pyx_t_13.data = NULL;
</pre><pre class="cython line score-10" onclick='toggleDiv(this)'>+<span class="">313</span>:     return values, indices</pre>
<pre class='cython code score-10 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 313, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_values);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_values);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_v_values);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_indices);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_indices);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 1, __pyx_v_indices);
  __pyx_r = __pyx_t_5;
  __pyx_t_5 = 0;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">314</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">315</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">316</span>: @cython.wraparound(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">317</span>: @cython.boundscheck(False)</pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">318</span>: cdef void _cosort(double[::1] A, cnp.npy_intp[::1] B) nogil:</pre>
<pre class='cython code score-0 '>static void __pyx_f_4dipy_7reconst_8recspeed__cosort(__Pyx_memviewslice __pyx_v_A, __Pyx_memviewslice __pyx_v_B) {
  size_t __pyx_v_n;
  size_t __pyx_v_hole;
  double __pyx_v_insert_A;
  long __pyx_v_insert_B;
  size_t __pyx_v_i;
/* … */
  /* function exit code */
}
</pre><pre class="cython line score-0">&#xA0;<span class="">319</span>:     """Sorts `A` in-place and applies the same reordering to `B`"""</pre>
<pre class="cython line score-0">&#xA0;<span class="">320</span>:     cdef:</pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">321</span>:         size_t n = A.shape[0]</pre>
<pre class='cython code score-0 '>  __pyx_v_n = (__pyx_v_A.shape[0]);
</pre><pre class="cython line score-0">&#xA0;<span class="">322</span>:         size_t hole</pre>
<pre class="cython line score-0">&#xA0;<span class="">323</span>:         double insert_A</pre>
<pre class="cython line score-0">&#xA0;<span class="">324</span>:         long insert_B</pre>
<pre class="cython line score-0">&#xA0;<span class="">325</span>: </pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">326</span>:     for i in range(1, n):</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = __pyx_v_n;
  for (__pyx_t_2 = 1; __pyx_t_2 &lt; __pyx_t_1; __pyx_t_2+=1) {
    __pyx_v_i = __pyx_t_2;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">327</span>:         insert_A = A[i]</pre>
<pre class='cython code score-0 '>    __pyx_t_3 = __pyx_v_i;
    __pyx_v_insert_A = (*((double *) ( /* dim=0 */ ((char *) (((double *) __pyx_v_A.data) + __pyx_t_3)) )));
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">328</span>:         insert_B = B[i]</pre>
<pre class='cython code score-0 '>    __pyx_t_4 = __pyx_v_i;
    __pyx_v_insert_B = (*((npy_intp *) ( /* dim=0 */ ((char *) (((npy_intp *) __pyx_v_B.data) + __pyx_t_4)) )));
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">329</span>:         hole = i</pre>
<pre class='cython code score-0 '>    __pyx_v_hole = __pyx_v_i;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">330</span>:         while hole &gt; 0 and insert_A &gt; A[hole -1]:</pre>
<pre class='cython code score-0 '>    while (1) {
      __pyx_t_6 = ((__pyx_v_hole &gt; 0) != 0);
      if (__pyx_t_6) {
      } else {
        __pyx_t_5 = __pyx_t_6;
        goto __pyx_L7_bool_binop_done;
      }
      __pyx_t_7 = (__pyx_v_hole - 1);
      __pyx_t_6 = ((__pyx_v_insert_A &gt; (*((double *) ( /* dim=0 */ ((char *) (((double *) __pyx_v_A.data) + __pyx_t_7)) )))) != 0);
      __pyx_t_5 = __pyx_t_6;
      __pyx_L7_bool_binop_done:;
      if (!__pyx_t_5) break;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">331</span>:             A[hole] = A[hole - 1]</pre>
<pre class='cython code score-0 '>      __pyx_t_8 = (__pyx_v_hole - 1);
      __pyx_t_9 = __pyx_v_hole;
      *((double *) ( /* dim=0 */ ((char *) (((double *) __pyx_v_A.data) + __pyx_t_9)) )) = (*((double *) ( /* dim=0 */ ((char *) (((double *) __pyx_v_A.data) + __pyx_t_8)) )));
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">332</span>:             B[hole] = B[hole - 1]</pre>
<pre class='cython code score-0 '>      __pyx_t_10 = (__pyx_v_hole - 1);
      __pyx_t_11 = __pyx_v_hole;
      *((npy_intp *) ( /* dim=0 */ ((char *) (((npy_intp *) __pyx_v_B.data) + __pyx_t_11)) )) = (*((npy_intp *) ( /* dim=0 */ ((char *) (((npy_intp *) __pyx_v_B.data) + __pyx_t_10)) )));
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">333</span>:             hole -= 1</pre>
<pre class='cython code score-0 '>      __pyx_v_hole = (__pyx_v_hole - 1);
    }
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">334</span>:         A[hole] = insert_A</pre>
<pre class='cython code score-0 '>    __pyx_t_12 = __pyx_v_hole;
    *((double *) ( /* dim=0 */ ((char *) (((double *) __pyx_v_A.data) + __pyx_t_12)) )) = __pyx_v_insert_A;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">335</span>:         B[hole] = insert_B</pre>
<pre class='cython code score-0 '>    __pyx_t_13 = __pyx_v_hole;
    *((npy_intp *) ( /* dim=0 */ ((char *) (((npy_intp *) __pyx_v_B.data) + __pyx_t_13)) )) = __pyx_v_insert_B;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">336</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">337</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">338</span>: @cython.wraparound(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">339</span>: @cython.boundscheck(False)</pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">340</span>: cdef long _compare_neighbors(double[:] odf, cnp.uint16_t[:, :] edges,</pre>
<pre class='cython code score-0 '>static long __pyx_f_4dipy_7reconst_8recspeed__compare_neighbors(__Pyx_memviewslice __pyx_v_odf, __Pyx_memviewslice __pyx_v_edges, npy_intp *__pyx_v_wpeak_ptr) {
  size_t __pyx_v_lenedges;
  size_t __pyx_v_lenodf;
  size_t __pyx_v_i;
  __pyx_t_5numpy_uint16_t __pyx_v_find0;
  __pyx_t_5numpy_uint16_t __pyx_v_find1;
  double __pyx_v_odf0;
  double __pyx_v_odf1;
  long __pyx_v_count;
  long __pyx_r;
/* … */
  /* function exit code */
  __pyx_L0:;
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">341</span>:                              cnp.npy_intp *wpeak_ptr) nogil:</pre>
<pre class="cython line score-0">&#xA0;<span class="">342</span>:     """Compares every pair of points in edges</pre>
<pre class="cython line score-0">&#xA0;<span class="">343</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">344</span>:     Parameters</pre>
<pre class="cython line score-0">&#xA0;<span class="">345</span>:     ----------</pre>
<pre class="cython line score-0">&#xA0;<span class="">346</span>:     odf : array of double</pre>
<pre class="cython line score-0">&#xA0;<span class="">347</span>:         values of points on sphere.</pre>
<pre class="cython line score-0">&#xA0;<span class="">348</span>:     edges : array of uint16</pre>
<pre class="cython line score-0">&#xA0;<span class="">349</span>:         neighbor relationships on sphere. Every set of neighbors on the sphere</pre>
<pre class="cython line score-0">&#xA0;<span class="">350</span>:         should be an edge.</pre>
<pre class="cython line score-0">&#xA0;<span class="">351</span>:     wpeak_ptr : pointer</pre>
<pre class="cython line score-0">&#xA0;<span class="">352</span>:         pointer to a block of memory which will be updated with the result of</pre>
<pre class="cython line score-0">&#xA0;<span class="">353</span>:         the comparisons. This block of memory must be large enough to hold</pre>
<pre class="cython line score-0">&#xA0;<span class="">354</span>:         len(odf) longs. The first `count` elements of wpeak will be updated</pre>
<pre class="cython line score-0">&#xA0;<span class="">355</span>:         with the indices of the peaks.</pre>
<pre class="cython line score-0">&#xA0;<span class="">356</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">357</span>:     Returns</pre>
<pre class="cython line score-0">&#xA0;<span class="">358</span>:     -------</pre>
<pre class="cython line score-0">&#xA0;<span class="">359</span>:     count : long</pre>
<pre class="cython line score-0">&#xA0;<span class="">360</span>:         Number of maxima in odf. A value &lt; 0 indicates an error:</pre>
<pre class="cython line score-0">&#xA0;<span class="">361</span>:             -1 : value in edges too large, &gt;= than len(odf)</pre>
<pre class="cython line score-0">&#xA0;<span class="">362</span>:             -2 : odf contains nans</pre>
<pre class="cython line score-0">&#xA0;<span class="">363</span>:     """</pre>
<pre class="cython line score-0">&#xA0;<span class="">364</span>:     cdef:</pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">365</span>:         size_t lenedges = edges.shape[0]</pre>
<pre class='cython code score-0 '>  __pyx_v_lenedges = (__pyx_v_edges.shape[0]);
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">366</span>:         size_t lenodf = odf.shape[0]</pre>
<pre class='cython code score-0 '>  __pyx_v_lenodf = (__pyx_v_odf.shape[0]);
</pre><pre class="cython line score-0">&#xA0;<span class="">367</span>:         size_t i</pre>
<pre class="cython line score-0">&#xA0;<span class="">368</span>:         cnp.uint16_t find0, find1</pre>
<pre class="cython line score-0">&#xA0;<span class="">369</span>:         double odf0, odf1</pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">370</span>:         long count = 0</pre>
<pre class='cython code score-0 '>  __pyx_v_count = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">371</span>: </pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">372</span>:     for i in range(lenedges):</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = __pyx_v_lenedges;
  for (__pyx_t_2 = 0; __pyx_t_2 &lt; __pyx_t_1; __pyx_t_2+=1) {
    __pyx_v_i = __pyx_t_2;
</pre><pre class="cython line score-0">&#xA0;<span class="">373</span>: </pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">374</span>:         find0 = edges[i, 0]</pre>
<pre class='cython code score-0 '>    __pyx_t_3 = __pyx_v_i;
    __pyx_t_4 = 0;
    __pyx_v_find0 = (*((__pyx_t_5numpy_uint16_t *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_edges.data + __pyx_t_3 * __pyx_v_edges.strides[0]) ) + __pyx_t_4 * __pyx_v_edges.strides[1]) )));
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">375</span>:         find1 = edges[i, 1]</pre>
<pre class='cython code score-0 '>    __pyx_t_5 = __pyx_v_i;
    __pyx_t_6 = 1;
    __pyx_v_find1 = (*((__pyx_t_5numpy_uint16_t *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_edges.data + __pyx_t_5 * __pyx_v_edges.strides[0]) ) + __pyx_t_6 * __pyx_v_edges.strides[1]) )));
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">376</span>:         if find0 &gt;= lenodf or find1 &gt;= lenodf:</pre>
<pre class='cython code score-0 '>    __pyx_t_8 = ((__pyx_v_find0 &gt;= __pyx_v_lenodf) != 0);
    if (!__pyx_t_8) {
    } else {
      __pyx_t_7 = __pyx_t_8;
      goto __pyx_L6_bool_binop_done;
    }
    __pyx_t_8 = ((__pyx_v_find1 &gt;= __pyx_v_lenodf) != 0);
    __pyx_t_7 = __pyx_t_8;
    __pyx_L6_bool_binop_done:;
    if (__pyx_t_7) {
/* … */
    }
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">377</span>:             count = -1</pre>
<pre class='cython code score-0 '>      __pyx_v_count = -1L;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">378</span>:             break</pre>
<pre class='cython code score-0 '>      goto __pyx_L4_break;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">379</span>:         odf0 = odf[find0]</pre>
<pre class='cython code score-0 '>    __pyx_t_9 = __pyx_v_find0;
    __pyx_v_odf0 = (*((double *) ( /* dim=0 */ (__pyx_v_odf.data + __pyx_t_9 * __pyx_v_odf.strides[0]) )));
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">380</span>:         odf1 = odf[find1]</pre>
<pre class='cython code score-0 '>    __pyx_t_10 = __pyx_v_find1;
    __pyx_v_odf1 = (*((double *) ( /* dim=0 */ (__pyx_v_odf.data + __pyx_t_10 * __pyx_v_odf.strides[0]) )));
</pre><pre class="cython line score-0">&#xA0;<span class="">381</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">382</span>:         """</pre>
<pre class="cython line score-0">&#xA0;<span class="">383</span>:         Here `wpeak_ptr` is used as an indicator array that can take one of</pre>
<pre class="cython line score-0">&#xA0;<span class="">384</span>:         three values.  If `wpeak_ptr[i]` is:</pre>
<pre class="cython line score-0">&#xA0;<span class="">385</span>:         * -1 : point i of the sphere is smaller than at least one neighbor.</pre>
<pre class="cython line score-0">&#xA0;<span class="">386</span>:         *  0 : point i is equal to all its neighbors.</pre>
<pre class="cython line score-0">&#xA0;<span class="">387</span>:         *  1 : point i is &gt; at least one neighbor and &gt;= all its neighbors.</pre>
<pre class="cython line score-0">&#xA0;<span class="">388</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">389</span>:         Each iteration of the loop is a comparison between neighboring points</pre>
<pre class="cython line score-0">&#xA0;<span class="">390</span>:         (the two point of an edge). At each iteration we update wpeak_ptr in the</pre>
<pre class="cython line score-0">&#xA0;<span class="">391</span>:         following way::</pre>
<pre class="cython line score-0">&#xA0;<span class="">392</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">393</span>:             wpeak_ptr[smaller_point] = -1</pre>
<pre class="cython line score-0">&#xA0;<span class="">394</span>:             if wpeak_ptr[larger_point] == 0:</pre>
<pre class="cython line score-0">&#xA0;<span class="">395</span>:                 wpeak_ptr[larger_point] = 1</pre>
<pre class="cython line score-0">&#xA0;<span class="">396</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">397</span>:         If the two points are equal, wpeak is left unchanged.</pre>
<pre class="cython line score-0">&#xA0;<span class="">398</span>:         """</pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">399</span>:         if odf0 &lt; odf1:</pre>
<pre class='cython code score-0 '>    __pyx_t_7 = ((__pyx_v_odf0 &lt; __pyx_v_odf1) != 0);
    if (__pyx_t_7) {
/* … */
      goto __pyx_L8;
    }
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">400</span>:             wpeak_ptr[find0] = -1</pre>
<pre class='cython code score-0 '>      (__pyx_v_wpeak_ptr[__pyx_v_find0]) = -1;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">401</span>:             wpeak_ptr[find1] |= 1</pre>
<pre class='cython code score-0 '>      __pyx_t_11 = __pyx_v_find1;
      (__pyx_v_wpeak_ptr[__pyx_t_11]) = ((__pyx_v_wpeak_ptr[__pyx_t_11]) | 1);
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">402</span>:         elif odf0 &gt; odf1:</pre>
<pre class='cython code score-0 '>    __pyx_t_7 = ((__pyx_v_odf0 &gt; __pyx_v_odf1) != 0);
    if (__pyx_t_7) {
/* … */
      goto __pyx_L8;
    }
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">403</span>:             wpeak_ptr[find0] |= 1</pre>
<pre class='cython code score-0 '>      __pyx_t_11 = __pyx_v_find0;
      (__pyx_v_wpeak_ptr[__pyx_t_11]) = ((__pyx_v_wpeak_ptr[__pyx_t_11]) | 1);
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">404</span>:             wpeak_ptr[find1] = -1</pre>
<pre class='cython code score-0 '>      (__pyx_v_wpeak_ptr[__pyx_v_find1]) = -1;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">405</span>:         elif (odf0 != odf0) or (odf1 != odf1):</pre>
<pre class='cython code score-0 '>    __pyx_t_8 = ((__pyx_v_odf0 != __pyx_v_odf0) != 0);
    if (!__pyx_t_8) {
    } else {
      __pyx_t_7 = __pyx_t_8;
      goto __pyx_L9_bool_binop_done;
    }
    __pyx_t_8 = ((__pyx_v_odf1 != __pyx_v_odf1) != 0);
    __pyx_t_7 = __pyx_t_8;
    __pyx_L9_bool_binop_done:;
    if (__pyx_t_7) {
/* … */
    }
    __pyx_L8:;
  }
  __pyx_L4_break:;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">406</span>:             count = -2</pre>
<pre class='cython code score-0 '>      __pyx_v_count = -2L;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">407</span>:             break</pre>
<pre class='cython code score-0 '>      goto __pyx_L4_break;
</pre><pre class="cython line score-0">&#xA0;<span class="">408</span>: </pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">409</span>:     if count &lt; 0:</pre>
<pre class='cython code score-0 '>  __pyx_t_7 = ((__pyx_v_count &lt; 0) != 0);
  if (__pyx_t_7) {
/* … */
  }
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">410</span>:         return count</pre>
<pre class='cython code score-0 '>    __pyx_r = __pyx_v_count;
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">411</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">412</span>:     # Count the number of peaks and use first count elements of wpeak_ptr to</pre>
<pre class="cython line score-0">&#xA0;<span class="">413</span>:     # hold indices of those peaks</pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">414</span>:     for i in range(lenodf):</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = __pyx_v_lenodf;
  for (__pyx_t_2 = 0; __pyx_t_2 &lt; __pyx_t_1; __pyx_t_2+=1) {
    __pyx_v_i = __pyx_t_2;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">415</span>:         if wpeak_ptr[i] &gt; 0:</pre>
<pre class='cython code score-0 '>    __pyx_t_7 = (((__pyx_v_wpeak_ptr[__pyx_v_i]) &gt; 0) != 0);
    if (__pyx_t_7) {
/* … */
    }
  }
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">416</span>:             wpeak_ptr[count] = i</pre>
<pre class='cython code score-0 '>      (__pyx_v_wpeak_ptr[__pyx_v_count]) = __pyx_v_i;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">417</span>:             count += 1</pre>
<pre class='cython code score-0 '>      __pyx_v_count = (__pyx_v_count + 1);
</pre><pre class="cython line score-0">&#xA0;<span class="">418</span>: </pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">419</span>:     return count</pre>
<pre class='cython code score-0 '>  __pyx_r = __pyx_v_count;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">420</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">421</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">422</span>: @cython.boundscheck(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">423</span>: @cython.wraparound(False)</pre>
<pre class="cython line score-130" onclick='toggleDiv(this)'>+<span class="">424</span>: def le_to_odf(cnp.ndarray[double, ndim=1] odf, \</pre>
<pre class='cython code score-130 '>/* Python wrapper */
static PyObject *__pyx_pw_4dipy_7reconst_8recspeed_9le_to_odf(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4dipy_7reconst_8recspeed_8le_to_odf[] = "odf for interpolated Laplacian normalized signal\n    ";
static PyMethodDef __pyx_mdef_4dipy_7reconst_8recspeed_9le_to_odf = {"le_to_odf", (PyCFunction)__pyx_pw_4dipy_7reconst_8recspeed_9le_to_odf, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4dipy_7reconst_8recspeed_8le_to_odf};
static PyObject *__pyx_pw_4dipy_7reconst_8recspeed_9le_to_odf(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyArrayObject *__pyx_v_odf = 0;
  PyArrayObject *__pyx_v_LEs = 0;
  PyArrayObject *__pyx_v_radius = 0;
  int __pyx_v_odfn;
  int __pyx_v_radiusn;
  int __pyx_v_anglesn;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("le_to_odf (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_odf,&amp;__pyx_n_s_LEs,&amp;__pyx_n_s_radius,&amp;__pyx_n_s_odfn,&amp;__pyx_n_s_radiusn,&amp;__pyx_n_s_anglesn,0};
    PyObject* values[6] = {0,0,0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_odf)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_LEs)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("le_to_odf", 1, 6, 6, 1); <span class='error_goto'>__PYX_ERR(0, 424, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_radius)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("le_to_odf", 1, 6, 6, 2); <span class='error_goto'>__PYX_ERR(0, 424, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_odfn)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("le_to_odf", 1, 6, 6, 3); <span class='error_goto'>__PYX_ERR(0, 424, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (likely((values[4] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_radiusn)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("le_to_odf", 1, 6, 6, 4); <span class='error_goto'>__PYX_ERR(0, 424, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (likely((values[5] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_anglesn)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("le_to_odf", 1, 6, 6, 5); <span class='error_goto'>__PYX_ERR(0, 424, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "le_to_odf") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 424, __pyx_L3_error)</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 6) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
      values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
      values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
      values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
    }
    __pyx_v_odf = ((PyArrayObject *)values[0]);
    __pyx_v_LEs = ((PyArrayObject *)values[1]);
    __pyx_v_radius = ((PyArrayObject *)values[2]);
    __pyx_v_odfn = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[3]); if (unlikely((__pyx_v_odfn == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 427, __pyx_L3_error)</span>
    __pyx_v_radiusn = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[4]); if (unlikely((__pyx_v_radiusn == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 428, __pyx_L3_error)</span>
    __pyx_v_anglesn = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[5]); if (unlikely((__pyx_v_anglesn == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 429, __pyx_L3_error)</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("le_to_odf", 1, 6, 6, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 424, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("dipy.reconst.recspeed.le_to_odf", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_odf), __pyx_ptype_5numpy_ndarray, 1, "odf", 0))) <span class='error_goto'>__PYX_ERR(0, 424, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_LEs), __pyx_ptype_5numpy_ndarray, 1, "LEs", 0))) <span class='error_goto'>__PYX_ERR(0, 425, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_radius), __pyx_ptype_5numpy_ndarray, 1, "radius", 0))) <span class='error_goto'>__PYX_ERR(0, 426, __pyx_L1_error)</span>
  __pyx_r = __pyx_pf_4dipy_7reconst_8recspeed_8le_to_odf(__pyx_self, __pyx_v_odf, __pyx_v_LEs, __pyx_v_radius, __pyx_v_odfn, __pyx_v_radiusn, __pyx_v_anglesn);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_4dipy_7reconst_8recspeed_8le_to_odf(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_odf, PyArrayObject *__pyx_v_LEs, PyArrayObject *__pyx_v_radius, int __pyx_v_odfn, int __pyx_v_radiusn, int __pyx_v_anglesn) {
  int __pyx_v_m;
  int __pyx_v_i;
  int __pyx_v_j;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_LEs;
  __Pyx_Buffer __pyx_pybuffer_LEs;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_odf;
  __Pyx_Buffer __pyx_pybuffer_odf;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_radius;
  __Pyx_Buffer __pyx_pybuffer_radius;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("le_to_odf", 0);
  __pyx_pybuffer_odf.pybuffer.buf = NULL;
  __pyx_pybuffer_odf.refcount = 0;
  __pyx_pybuffernd_odf.data = NULL;
  __pyx_pybuffernd_odf.rcbuffer = &amp;__pyx_pybuffer_odf;
  __pyx_pybuffer_LEs.pybuffer.buf = NULL;
  __pyx_pybuffer_LEs.refcount = 0;
  __pyx_pybuffernd_LEs.data = NULL;
  __pyx_pybuffernd_LEs.rcbuffer = &amp;__pyx_pybuffer_LEs;
  __pyx_pybuffer_radius.pybuffer.buf = NULL;
  __pyx_pybuffer_radius.refcount = 0;
  __pyx_pybuffernd_radius.data = NULL;
  __pyx_pybuffernd_radius.rcbuffer = &amp;__pyx_pybuffer_radius;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_odf.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_odf, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 424, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_odf.diminfo[0].strides = __pyx_pybuffernd_odf.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_odf.diminfo[0].shape = __pyx_pybuffernd_odf.rcbuffer-&gt;pybuffer.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_LEs.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_LEs, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 424, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_LEs.diminfo[0].strides = __pyx_pybuffernd_LEs.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_LEs.diminfo[0].shape = __pyx_pybuffernd_LEs.rcbuffer-&gt;pybuffer.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_radius.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_radius, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 424, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_radius.diminfo[0].strides = __pyx_pybuffernd_radius.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_radius.diminfo[0].shape = __pyx_pybuffernd_radius.rcbuffer-&gt;pybuffer.shape[0];
/* … */
  /* function exit code */
  __pyx_L1_error:;
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_LEs.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_odf.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_radius.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("dipy.reconst.recspeed.le_to_odf", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_LEs.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_odf.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_radius.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__46 = <span class='py_c_api'>PyTuple_Pack</span>(9, __pyx_n_s_odf, __pyx_n_s_LEs, __pyx_n_s_radius, __pyx_n_s_odfn, __pyx_n_s_radiusn, __pyx_n_s_anglesn, __pyx_n_s_m, __pyx_n_s_i, __pyx_n_s_j);<span class='error_goto'> if (unlikely(!__pyx_tuple__46)) __PYX_ERR(0, 424, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__46);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__46);
/* … */
  __pyx_t_1 = PyCFunction_NewEx(&amp;__pyx_mdef_4dipy_7reconst_8recspeed_9le_to_odf, NULL, __pyx_n_s_dipy_reconst_recspeed);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 424, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_le_to_odf, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 424, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_codeobj__47 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(6, 0, 9, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__46, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_dipy_reconst_recspeed_pyx, __pyx_n_s_le_to_odf, 424, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__47)) __PYX_ERR(0, 424, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">425</span>:                  cnp.ndarray[double, ndim=1] LEs,\</pre>
<pre class="cython line score-0">&#xA0;<span class="">426</span>:                  cnp.ndarray[double, ndim=1] radius,\</pre>
<pre class="cython line score-0">&#xA0;<span class="">427</span>:                  int odfn,\</pre>
<pre class="cython line score-0">&#xA0;<span class="">428</span>:                  int radiusn,\</pre>
<pre class="cython line score-0">&#xA0;<span class="">429</span>:                  int anglesn):</pre>
<pre class="cython line score-0">&#xA0;<span class="">430</span>:     """odf for interpolated Laplacian normalized signal</pre>
<pre class="cython line score-0">&#xA0;<span class="">431</span>:     """</pre>
<pre class="cython line score-0">&#xA0;<span class="">432</span>:     cdef int m, i, j</pre>
<pre class="cython line score-0">&#xA0;<span class="">433</span>: </pre>
<pre class="cython line score-4" onclick='toggleDiv(this)'>+<span class="">434</span>:     with nogil:</pre>
<pre class='cython code score-4 '>  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      <span class='pyx_c_api'>__Pyx_FastGIL_Remember</span>();
      #endif
      /*try:*/ {
/* … */
      /*finally:*/ {
        /*normal exit:*/{
          #ifdef WITH_THREAD
          <span class='pyx_c_api'>__Pyx_FastGIL_Forget</span>();
          Py_BLOCK_THREADS
          #endif
          goto __pyx_L5;
        }
        __pyx_L5:;
      }
  }
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">435</span>:         for m in range(odfn):</pre>
<pre class='cython code score-0 '>        __pyx_t_1 = __pyx_v_odfn;
        for (__pyx_t_2 = 0; __pyx_t_2 &lt; __pyx_t_1; __pyx_t_2+=1) {
          __pyx_v_m = __pyx_t_2;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">436</span>:             for i in range(radiusn):</pre>
<pre class='cython code score-0 '>          __pyx_t_3 = __pyx_v_radiusn;
          for (__pyx_t_4 = 0; __pyx_t_4 &lt; __pyx_t_3; __pyx_t_4+=1) {
            __pyx_v_i = __pyx_t_4;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">437</span>:                 for j in range(anglesn):</pre>
<pre class='cython code score-0 '>            __pyx_t_5 = __pyx_v_anglesn;
            for (__pyx_t_6 = 0; __pyx_t_6 &lt; __pyx_t_5; __pyx_t_6+=1) {
              __pyx_v_j = __pyx_t_6;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">438</span>:                     odf[m]=odf[m]-LEs[(m*radiusn+i)*anglesn+j]*radius[i]</pre>
<pre class='cython code score-0 '>              __pyx_t_7 = __pyx_v_m;
              __pyx_t_8 = ((((__pyx_v_m * __pyx_v_radiusn) + __pyx_v_i) * __pyx_v_anglesn) + __pyx_v_j);
              __pyx_t_9 = __pyx_v_i;
              __pyx_t_10 = __pyx_v_m;
              *__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_odf.rcbuffer-&gt;pybuffer.buf, __pyx_t_10, __pyx_pybuffernd_odf.diminfo[0].strides) = ((*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_odf.rcbuffer-&gt;pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_odf.diminfo[0].strides)) - ((*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_LEs.rcbuffer-&gt;pybuffer.buf, __pyx_t_8, __pyx_pybuffernd_LEs.diminfo[0].strides)) * (*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_radius.rcbuffer-&gt;pybuffer.buf, __pyx_t_9, __pyx_pybuffernd_radius.diminfo[0].strides))));
            }
          }
        }
      }
</pre><pre class="cython line score-0">&#xA0;<span class="">439</span>: </pre>
<pre class="cython line score-2" onclick='toggleDiv(this)'>+<span class="">440</span>:     return</pre>
<pre class='cython code score-2 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">441</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">442</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">443</span>: @cython.boundscheck(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">444</span>: @cython.wraparound(False)</pre>
<pre class="cython line score-98" onclick='toggleDiv(this)'>+<span class="">445</span>: def sum_on_blocks_1d(cnp.ndarray[double, ndim=1] arr,\</pre>
<pre class='cython code score-98 '>/* Python wrapper */
static PyObject *__pyx_pw_4dipy_7reconst_8recspeed_11sum_on_blocks_1d(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4dipy_7reconst_8recspeed_10sum_on_blocks_1d[] = "Summations on blocks of 1d array\n    ";
static PyMethodDef __pyx_mdef_4dipy_7reconst_8recspeed_11sum_on_blocks_1d = {"sum_on_blocks_1d", (PyCFunction)__pyx_pw_4dipy_7reconst_8recspeed_11sum_on_blocks_1d, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4dipy_7reconst_8recspeed_10sum_on_blocks_1d};
static PyObject *__pyx_pw_4dipy_7reconst_8recspeed_11sum_on_blocks_1d(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyArrayObject *__pyx_v_arr = 0;
  PyArrayObject *__pyx_v_blocks = 0;
  PyArrayObject *__pyx_v_out = 0;
  int __pyx_v_outn;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("sum_on_blocks_1d (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_arr,&amp;__pyx_n_s_blocks,&amp;__pyx_n_s_out,&amp;__pyx_n_s_outn,0};
    PyObject* values[4] = {0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_arr)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_blocks)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("sum_on_blocks_1d", 1, 4, 4, 1); <span class='error_goto'>__PYX_ERR(0, 445, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_out)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("sum_on_blocks_1d", 1, 4, 4, 2); <span class='error_goto'>__PYX_ERR(0, 445, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_outn)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("sum_on_blocks_1d", 1, 4, 4, 3); <span class='error_goto'>__PYX_ERR(0, 445, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "sum_on_blocks_1d") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 445, __pyx_L3_error)</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 4) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
      values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
    }
    __pyx_v_arr = ((PyArrayObject *)values[0]);
    __pyx_v_blocks = ((PyArrayObject *)values[1]);
    __pyx_v_out = ((PyArrayObject *)values[2]);
    __pyx_v_outn = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[3]); if (unlikely((__pyx_v_outn == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 447, __pyx_L3_error)</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("sum_on_blocks_1d", 1, 4, 4, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 445, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("dipy.reconst.recspeed.sum_on_blocks_1d", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_arr), __pyx_ptype_5numpy_ndarray, 1, "arr", 0))) <span class='error_goto'>__PYX_ERR(0, 445, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_blocks), __pyx_ptype_5numpy_ndarray, 1, "blocks", 0))) <span class='error_goto'>__PYX_ERR(0, 446, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_out), __pyx_ptype_5numpy_ndarray, 1, "out", 0))) <span class='error_goto'>__PYX_ERR(0, 447, __pyx_L1_error)</span>
  __pyx_r = __pyx_pf_4dipy_7reconst_8recspeed_10sum_on_blocks_1d(__pyx_self, __pyx_v_arr, __pyx_v_blocks, __pyx_v_out, __pyx_v_outn);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_4dipy_7reconst_8recspeed_10sum_on_blocks_1d(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_arr, PyArrayObject *__pyx_v_blocks, PyArrayObject *__pyx_v_out, int __pyx_v_outn) {
  int __pyx_v_m;
  int __pyx_v_i;
  int __pyx_v_j;
  double __pyx_v_sum;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_arr;
  __Pyx_Buffer __pyx_pybuffer_arr;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_blocks;
  __Pyx_Buffer __pyx_pybuffer_blocks;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_out;
  __Pyx_Buffer __pyx_pybuffer_out;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("sum_on_blocks_1d", 0);
  __pyx_pybuffer_arr.pybuffer.buf = NULL;
  __pyx_pybuffer_arr.refcount = 0;
  __pyx_pybuffernd_arr.data = NULL;
  __pyx_pybuffernd_arr.rcbuffer = &amp;__pyx_pybuffer_arr;
  __pyx_pybuffer_blocks.pybuffer.buf = NULL;
  __pyx_pybuffer_blocks.refcount = 0;
  __pyx_pybuffernd_blocks.data = NULL;
  __pyx_pybuffernd_blocks.rcbuffer = &amp;__pyx_pybuffer_blocks;
  __pyx_pybuffer_out.pybuffer.buf = NULL;
  __pyx_pybuffer_out.refcount = 0;
  __pyx_pybuffernd_out.data = NULL;
  __pyx_pybuffernd_out.rcbuffer = &amp;__pyx_pybuffer_out;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_arr.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_arr, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 445, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_arr.diminfo[0].strides = __pyx_pybuffernd_arr.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_arr.diminfo[0].shape = __pyx_pybuffernd_arr.rcbuffer-&gt;pybuffer.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_blocks.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_blocks, &amp;__Pyx_TypeInfo_long, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 445, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_blocks.diminfo[0].strides = __pyx_pybuffernd_blocks.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_blocks.diminfo[0].shape = __pyx_pybuffernd_blocks.rcbuffer-&gt;pybuffer.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_out.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_out, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 445, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_out.diminfo[0].strides = __pyx_pybuffernd_out.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_out.diminfo[0].shape = __pyx_pybuffernd_out.rcbuffer-&gt;pybuffer.shape[0];
/* … */
  /* function exit code */
  __pyx_L1_error:;
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_arr.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_blocks.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_out.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("dipy.reconst.recspeed.sum_on_blocks_1d", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_arr.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_blocks.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_out.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__48 = <span class='py_c_api'>PyTuple_Pack</span>(8, __pyx_n_s_arr, __pyx_n_s_blocks, __pyx_n_s_out, __pyx_n_s_outn, __pyx_n_s_m, __pyx_n_s_i, __pyx_n_s_j, __pyx_n_s_sum);<span class='error_goto'> if (unlikely(!__pyx_tuple__48)) __PYX_ERR(0, 445, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__48);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__48);
/* … */
  __pyx_t_1 = PyCFunction_NewEx(&amp;__pyx_mdef_4dipy_7reconst_8recspeed_11sum_on_blocks_1d, NULL, __pyx_n_s_dipy_reconst_recspeed);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 445, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_sum_on_blocks_1d, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 445, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_codeobj__49 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(4, 0, 8, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__48, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_dipy_reconst_recspeed_pyx, __pyx_n_s_sum_on_blocks_1d, 445, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__49)) __PYX_ERR(0, 445, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">446</span>:     cnp.ndarray[long, ndim=1] blocks,\</pre>
<pre class="cython line score-0">&#xA0;<span class="">447</span>:     cnp.ndarray[double, ndim=1] out,int outn):</pre>
<pre class="cython line score-0">&#xA0;<span class="">448</span>:     """Summations on blocks of 1d array</pre>
<pre class="cython line score-0">&#xA0;<span class="">449</span>:     """</pre>
<pre class="cython line score-0">&#xA0;<span class="">450</span>:     cdef:</pre>
<pre class="cython line score-0">&#xA0;<span class="">451</span>:         int m,i,j</pre>
<pre class="cython line score-0">&#xA0;<span class="">452</span>:         double sum</pre>
<pre class="cython line score-0">&#xA0;<span class="">453</span>: </pre>
<pre class="cython line score-4" onclick='toggleDiv(this)'>+<span class="">454</span>:     with nogil:</pre>
<pre class='cython code score-4 '>  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      <span class='pyx_c_api'>__Pyx_FastGIL_Remember</span>();
      #endif
      /*try:*/ {
/* … */
      /*finally:*/ {
        /*normal exit:*/{
          #ifdef WITH_THREAD
          <span class='pyx_c_api'>__Pyx_FastGIL_Forget</span>();
          Py_BLOCK_THREADS
          #endif
          goto __pyx_L5;
        }
        __pyx_L5:;
      }
  }
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">455</span>:         j=0</pre>
<pre class='cython code score-0 '>        __pyx_v_j = 0;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">456</span>:         for m in range(outn):</pre>
<pre class='cython code score-0 '>        __pyx_t_1 = __pyx_v_outn;
        for (__pyx_t_2 = 0; __pyx_t_2 &lt; __pyx_t_1; __pyx_t_2+=1) {
          __pyx_v_m = __pyx_t_2;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">457</span>:             sum=0</pre>
<pre class='cython code score-0 '>          __pyx_v_sum = 0.0;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">458</span>:             for i in range(j,j+blocks[m]):</pre>
<pre class='cython code score-0 '>          __pyx_t_3 = __pyx_v_m;
          __pyx_t_4 = (__pyx_v_j + (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_blocks.rcbuffer-&gt;pybuffer.buf, __pyx_t_3, __pyx_pybuffernd_blocks.diminfo[0].strides)));
          for (__pyx_t_5 = __pyx_v_j; __pyx_t_5 &lt; __pyx_t_4; __pyx_t_5+=1) {
            __pyx_v_i = __pyx_t_5;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">459</span>:                 sum+=arr[i]</pre>
<pre class='cython code score-0 '>            __pyx_t_6 = __pyx_v_i;
            __pyx_v_sum = (__pyx_v_sum + (*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_arr.rcbuffer-&gt;pybuffer.buf, __pyx_t_6, __pyx_pybuffernd_arr.diminfo[0].strides)));
          }
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">460</span>:             out[m]=sum</pre>
<pre class='cython code score-0 '>          __pyx_t_7 = __pyx_v_m;
          *__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_out.rcbuffer-&gt;pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_out.diminfo[0].strides) = __pyx_v_sum;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">461</span>:             j+=blocks[m]</pre>
<pre class='cython code score-0 '>          __pyx_t_8 = __pyx_v_m;
          __pyx_v_j = (__pyx_v_j + (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_blocks.rcbuffer-&gt;pybuffer.buf, __pyx_t_8, __pyx_pybuffernd_blocks.diminfo[0].strides)));
        }
      }
</pre><pre class="cython line score-2" onclick='toggleDiv(this)'>+<span class="">462</span>:     return</pre>
<pre class='cython code score-2 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">463</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">464</span>: </pre>
<pre class="cython line score-62" onclick='toggleDiv(this)'>+<span class="">465</span>: def argmax_from_adj(vals, vertex_inds, adj_inds):</pre>
<pre class='cython code score-62 '>/* Python wrapper */
static PyObject *__pyx_pw_4dipy_7reconst_8recspeed_13argmax_from_adj(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4dipy_7reconst_8recspeed_12argmax_from_adj[] = "Indices of local maxima from `vals` given adjacent points\n\n    Parameters\n    ----------\n    vals : (N,) array, dtype np.float64\n       values at all vertices referred to in either of `vertex_inds` or\n       `adj_inds`'\n    vertex_inds : (V,) array\n       indices into `vals` giving vertices that may be local maxima.\n    adj_inds : sequence\n       For every vertex in ``vertex_inds``, the indices (into `vals`) of\n       the neighboring points\n\n    Returns\n    -------\n    inds : (M,) array\n       Indices into `vals` giving local maxima of vals, given topology\n       from `adj_inds`, and restrictions from `vertex_inds`.  Inds are\n       returned sorted by value at that index - i.e. smallest value (at\n       index) first.\n    ";
static PyMethodDef __pyx_mdef_4dipy_7reconst_8recspeed_13argmax_from_adj = {"argmax_from_adj", (PyCFunction)__pyx_pw_4dipy_7reconst_8recspeed_13argmax_from_adj, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4dipy_7reconst_8recspeed_12argmax_from_adj};
static PyObject *__pyx_pw_4dipy_7reconst_8recspeed_13argmax_from_adj(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_vals = 0;
  PyObject *__pyx_v_vertex_inds = 0;
  PyObject *__pyx_v_adj_inds = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("argmax_from_adj (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_vals,&amp;__pyx_n_s_vertex_inds,&amp;__pyx_n_s_adj_inds,0};
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_vals)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_vertex_inds)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("argmax_from_adj", 1, 3, 3, 1); <span class='error_goto'>__PYX_ERR(0, 465, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_adj_inds)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("argmax_from_adj", 1, 3, 3, 2); <span class='error_goto'>__PYX_ERR(0, 465, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "argmax_from_adj") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 465, __pyx_L3_error)</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 3) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
    }
    __pyx_v_vals = values[0];
    __pyx_v_vertex_inds = values[1];
    __pyx_v_adj_inds = values[2];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("argmax_from_adj", 1, 3, 3, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 465, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("dipy.reconst.recspeed.argmax_from_adj", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_4dipy_7reconst_8recspeed_12argmax_from_adj(__pyx_self, __pyx_v_vals, __pyx_v_vertex_inds, __pyx_v_adj_inds);

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_4dipy_7reconst_8recspeed_12argmax_from_adj(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_vals, PyObject *__pyx_v_vertex_inds, PyObject *__pyx_v_adj_inds) {
  PyObject *__pyx_v_cvals = NULL;
  PyObject *__pyx_v_cvertinds = NULL;
  PyObject *__pyx_v_cadj_counts = NULL;
  PyObject *__pyx_v_cadj_inds = NULL;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("argmax_from_adj", 0);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("dipy.reconst.recspeed.argmax_from_adj", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_cvals);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_cvertinds);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_cadj_counts);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_cadj_inds);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__50 = <span class='py_c_api'>PyTuple_Pack</span>(7, __pyx_n_s_vals, __pyx_n_s_vertex_inds, __pyx_n_s_adj_inds, __pyx_n_s_cvals, __pyx_n_s_cvertinds, __pyx_n_s_cadj_counts, __pyx_n_s_cadj_inds);<span class='error_goto'> if (unlikely(!__pyx_tuple__50)) __PYX_ERR(0, 465, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__50);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__50);
/* … */
  __pyx_t_1 = PyCFunction_NewEx(&amp;__pyx_mdef_4dipy_7reconst_8recspeed_13argmax_from_adj, NULL, __pyx_n_s_dipy_reconst_recspeed);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 465, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_argmax_from_adj, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 465, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_codeobj__51 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(3, 0, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__50, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_dipy_reconst_recspeed_pyx, __pyx_n_s_argmax_from_adj, 465, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__51)) __PYX_ERR(0, 465, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">466</span>:     """Indices of local maxima from `vals` given adjacent points</pre>
<pre class="cython line score-0">&#xA0;<span class="">467</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">468</span>:     Parameters</pre>
<pre class="cython line score-0">&#xA0;<span class="">469</span>:     ----------</pre>
<pre class="cython line score-0">&#xA0;<span class="">470</span>:     vals : (N,) array, dtype np.float64</pre>
<pre class="cython line score-0">&#xA0;<span class="">471</span>:        values at all vertices referred to in either of `vertex_inds` or</pre>
<pre class="cython line score-0">&#xA0;<span class="">472</span>:        `adj_inds`'</pre>
<pre class="cython line score-0">&#xA0;<span class="">473</span>:     vertex_inds : (V,) array</pre>
<pre class="cython line score-0">&#xA0;<span class="">474</span>:        indices into `vals` giving vertices that may be local maxima.</pre>
<pre class="cython line score-0">&#xA0;<span class="">475</span>:     adj_inds : sequence</pre>
<pre class="cython line score-0">&#xA0;<span class="">476</span>:        For every vertex in ``vertex_inds``, the indices (into `vals`) of</pre>
<pre class="cython line score-0">&#xA0;<span class="">477</span>:        the neighboring points</pre>
<pre class="cython line score-0">&#xA0;<span class="">478</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">479</span>:     Returns</pre>
<pre class="cython line score-0">&#xA0;<span class="">480</span>:     -------</pre>
<pre class="cython line score-0">&#xA0;<span class="">481</span>:     inds : (M,) array</pre>
<pre class="cython line score-0">&#xA0;<span class="">482</span>:        Indices into `vals` giving local maxima of vals, given topology</pre>
<pre class="cython line score-0">&#xA0;<span class="">483</span>:        from `adj_inds`, and restrictions from `vertex_inds`.  Inds are</pre>
<pre class="cython line score-0">&#xA0;<span class="">484</span>:        returned sorted by value at that index - i.e. smallest value (at</pre>
<pre class="cython line score-0">&#xA0;<span class="">485</span>:        index) first.</pre>
<pre class="cython line score-0">&#xA0;<span class="">486</span>:     """</pre>
<pre class="cython line score-86" onclick='toggleDiv(this)'>+<span class="">487</span>:     cvals, cvertinds = proc_reco_args(vals, vertex_inds)</pre>
<pre class='cython code score-86 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_proc_reco_args);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 487, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = NULL;
  __pyx_t_4 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_2))) {
    __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_2, function);
      __pyx_t_4 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_2)) {
    PyObject *__pyx_temp[3] = {__pyx_t_3, __pyx_v_vals, __pyx_v_vertex_inds};
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_2, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 487, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_2)) {
    PyObject *__pyx_temp[3] = {__pyx_t_3, __pyx_v_vals, __pyx_v_vertex_inds};
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_2, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 487, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  } else
  #endif
  {
    __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 487, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    if (__pyx_t_3) {
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_3); __pyx_t_3 = NULL;
    }
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_vals);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_vals);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0+__pyx_t_4, __pyx_v_vals);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_vertex_inds);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_vertex_inds);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 1+__pyx_t_4, __pyx_v_vertex_inds);
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_t_5, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 487, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if ((likely(<span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_1))) || (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_1))) {
    PyObject* sequence = __pyx_t_1;
    #if !CYTHON_COMPILING_IN_PYPY
    Py_ssize_t size = Py_SIZE(sequence);
    #else
    Py_ssize_t size = <span class='py_c_api'>PySequence_Size</span>(sequence);
    #endif
    if (unlikely(size != 2)) {
      if (size &gt; 2) <span class='pyx_c_api'>__Pyx_RaiseTooManyValuesError</span>(2);
      else if (size &gt;= 0) <span class='pyx_c_api'>__Pyx_RaiseNeedMoreValuesError</span>(size);
      <span class='error_goto'>__PYX_ERR(0, 487, __pyx_L1_error)</span>
    }
    #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
    if (likely(<span class='py_c_api'>PyTuple_CheckExact</span>(sequence))) {
      __pyx_t_2 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(sequence, 0); 
      __pyx_t_5 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(sequence, 1); 
    } else {
      __pyx_t_2 = <span class='py_macro_api'>PyList_GET_ITEM</span>(sequence, 0); 
      __pyx_t_5 = <span class='py_macro_api'>PyList_GET_ITEM</span>(sequence, 1); 
    }
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5);
    #else
    __pyx_t_2 = <span class='py_macro_api'>PySequence_ITEM</span>(sequence, 0);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 487, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    __pyx_t_5 = <span class='py_macro_api'>PySequence_ITEM</span>(sequence, 1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 487, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    #endif
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  } else {
    Py_ssize_t index = -1;
    __pyx_t_3 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 487, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_6 = Py_TYPE(__pyx_t_3)-&gt;tp_iternext;
    index = 0; __pyx_t_2 = __pyx_t_6(__pyx_t_3); if (unlikely(!__pyx_t_2)) goto __pyx_L3_unpacking_failed;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    index = 1; __pyx_t_5 = __pyx_t_6(__pyx_t_3); if (unlikely(!__pyx_t_5)) goto __pyx_L3_unpacking_failed;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    if (<span class='pyx_c_api'>__Pyx_IternextUnpackEndCheck</span>(__pyx_t_6(__pyx_t_3), 2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 487, __pyx_L1_error)</span>
    __pyx_t_6 = NULL;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    goto __pyx_L4_unpacking_done;
    __pyx_L3_unpacking_failed:;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_6 = NULL;
    if (<span class='pyx_c_api'>__Pyx_IterFinish</span>() == 0) <span class='pyx_c_api'>__Pyx_RaiseNeedMoreValuesError</span>(index);
    <span class='error_goto'>__PYX_ERR(0, 487, __pyx_L1_error)</span>
    __pyx_L4_unpacking_done:;
  }
  __pyx_v_cvals = __pyx_t_2;
  __pyx_t_2 = 0;
  __pyx_v_cvertinds = __pyx_t_5;
  __pyx_t_5 = 0;
</pre><pre class="cython line score-86" onclick='toggleDiv(this)'>+<span class="">488</span>:     cadj_counts, cadj_inds = adj_to_countarrs(adj_inds)</pre>
<pre class='cython code score-86 '>  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_adj_to_countarrs);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 488, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_2 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_5))) {
    __pyx_t_2 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_5);
    if (likely(__pyx_t_2)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_5, function);
    }
  }
  if (!__pyx_t_2) {
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_5, __pyx_v_adj_inds);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 488, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  } else {
    #if CYTHON_FAST_PYCALL
    if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_5)) {
      PyObject *__pyx_temp[2] = {__pyx_t_2, __pyx_v_adj_inds};
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_5, __pyx_temp+1-1, 1+1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 488, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_5)) {
      PyObject *__pyx_temp[2] = {__pyx_t_2, __pyx_v_adj_inds};
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_5, __pyx_temp+1-1, 1+1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 488, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    } else
    #endif
    {
      __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1+1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 488, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_2); __pyx_t_2 = NULL;
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_adj_inds);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_adj_inds);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0+1, __pyx_v_adj_inds);
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_5, __pyx_t_3, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 488, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    }
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  if ((likely(<span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_1))) || (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_1))) {
    PyObject* sequence = __pyx_t_1;
    #if !CYTHON_COMPILING_IN_PYPY
    Py_ssize_t size = Py_SIZE(sequence);
    #else
    Py_ssize_t size = <span class='py_c_api'>PySequence_Size</span>(sequence);
    #endif
    if (unlikely(size != 2)) {
      if (size &gt; 2) <span class='pyx_c_api'>__Pyx_RaiseTooManyValuesError</span>(2);
      else if (size &gt;= 0) <span class='pyx_c_api'>__Pyx_RaiseNeedMoreValuesError</span>(size);
      <span class='error_goto'>__PYX_ERR(0, 488, __pyx_L1_error)</span>
    }
    #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
    if (likely(<span class='py_c_api'>PyTuple_CheckExact</span>(sequence))) {
      __pyx_t_5 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(sequence, 0); 
      __pyx_t_3 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(sequence, 1); 
    } else {
      __pyx_t_5 = <span class='py_macro_api'>PyList_GET_ITEM</span>(sequence, 0); 
      __pyx_t_3 = <span class='py_macro_api'>PyList_GET_ITEM</span>(sequence, 1); 
    }
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
    #else
    __pyx_t_5 = <span class='py_macro_api'>PySequence_ITEM</span>(sequence, 0);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 488, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    __pyx_t_3 = <span class='py_macro_api'>PySequence_ITEM</span>(sequence, 1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 488, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    #endif
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  } else {
    Py_ssize_t index = -1;
    __pyx_t_2 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 488, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_6 = Py_TYPE(__pyx_t_2)-&gt;tp_iternext;
    index = 0; __pyx_t_5 = __pyx_t_6(__pyx_t_2); if (unlikely(!__pyx_t_5)) goto __pyx_L5_unpacking_failed;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    index = 1; __pyx_t_3 = __pyx_t_6(__pyx_t_2); if (unlikely(!__pyx_t_3)) goto __pyx_L5_unpacking_failed;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    if (<span class='pyx_c_api'>__Pyx_IternextUnpackEndCheck</span>(__pyx_t_6(__pyx_t_2), 2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 488, __pyx_L1_error)</span>
    __pyx_t_6 = NULL;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    goto __pyx_L6_unpacking_done;
    __pyx_L5_unpacking_failed:;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_6 = NULL;
    if (<span class='pyx_c_api'>__Pyx_IterFinish</span>() == 0) <span class='pyx_c_api'>__Pyx_RaiseNeedMoreValuesError</span>(index);
    <span class='error_goto'>__PYX_ERR(0, 488, __pyx_L1_error)</span>
    __pyx_L6_unpacking_done:;
  }
  __pyx_v_cadj_counts = __pyx_t_5;
  __pyx_t_5 = 0;
  __pyx_v_cadj_inds = __pyx_t_3;
  __pyx_t_3 = 0;
</pre><pre class="cython line score-44" onclick='toggleDiv(this)'>+<span class="">489</span>:     return argmax_from_countarrs(cvals, cvertinds, cadj_counts, cadj_inds)</pre>
<pre class='cython code score-44 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_argmax_from_countarrs);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 489, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_5 = NULL;
  __pyx_t_4 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
    __pyx_t_5 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
    if (likely(__pyx_t_5)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
      __pyx_t_4 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_3)) {
    PyObject *__pyx_temp[5] = {__pyx_t_5, __pyx_v_cvals, __pyx_v_cvertinds, __pyx_v_cadj_counts, __pyx_v_cadj_inds};
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_3, __pyx_temp+1-__pyx_t_4, 4+__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 489, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_3)) {
    PyObject *__pyx_temp[5] = {__pyx_t_5, __pyx_v_cvals, __pyx_v_cvertinds, __pyx_v_cadj_counts, __pyx_v_cadj_inds};
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_3, __pyx_temp+1-__pyx_t_4, 4+__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 489, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  } else
  #endif
  {
    __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(4+__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 489, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    if (__pyx_t_5) {
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, __pyx_t_5); __pyx_t_5 = NULL;
    }
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_cvals);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_cvals);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0+__pyx_t_4, __pyx_v_cvals);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_cvertinds);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_cvertinds);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 1+__pyx_t_4, __pyx_v_cvertinds);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_cadj_counts);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_cadj_counts);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 2+__pyx_t_4, __pyx_v_cadj_counts);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_cadj_inds);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_cadj_inds);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 3+__pyx_t_4, __pyx_v_cadj_inds);
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_3, __pyx_t_2, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 489, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">490</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">491</span>: </pre>
<pre class="cython line score-56" onclick='toggleDiv(this)'>+<span class="">492</span>: def proc_reco_args(vals, vertinds):</pre>
<pre class='cython code score-56 '>/* Python wrapper */
static PyObject *__pyx_pw_4dipy_7reconst_8recspeed_15proc_reco_args(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_4dipy_7reconst_8recspeed_15proc_reco_args = {"proc_reco_args", (PyCFunction)__pyx_pw_4dipy_7reconst_8recspeed_15proc_reco_args, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_4dipy_7reconst_8recspeed_15proc_reco_args(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_vals = 0;
  PyObject *__pyx_v_vertinds = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("proc_reco_args (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_vals,&amp;__pyx_n_s_vertinds,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_vals)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_vertinds)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("proc_reco_args", 1, 2, 2, 1); <span class='error_goto'>__PYX_ERR(0, 492, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "proc_reco_args") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 492, __pyx_L3_error)</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
    }
    __pyx_v_vals = values[0];
    __pyx_v_vertinds = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("proc_reco_args", 1, 2, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 492, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("dipy.reconst.recspeed.proc_reco_args", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_4dipy_7reconst_8recspeed_14proc_reco_args(__pyx_self, __pyx_v_vals, __pyx_v_vertinds);

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_4dipy_7reconst_8recspeed_14proc_reco_args(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_vals, PyObject *__pyx_v_vertinds) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("proc_reco_args", 0);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_vals);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_vertinds);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("dipy.reconst.recspeed.proc_reco_args", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_vals);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_vertinds);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__52 = <span class='py_c_api'>PyTuple_Pack</span>(2, __pyx_n_s_vals, __pyx_n_s_vertinds);<span class='error_goto'> if (unlikely(!__pyx_tuple__52)) __PYX_ERR(0, 492, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__52);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__52);
/* … */
  __pyx_t_1 = PyCFunction_NewEx(&amp;__pyx_mdef_4dipy_7reconst_8recspeed_15proc_reco_args, NULL, __pyx_n_s_dipy_reconst_recspeed);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 492, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_proc_reco_args, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 492, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_codeobj__53 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(2, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__52, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_dipy_reconst_recspeed_pyx, __pyx_n_s_proc_reco_args, 492, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__53)) __PYX_ERR(0, 492, __pyx_L1_error)</span>
</pre><pre class="cython line score-91" onclick='toggleDiv(this)'>+<span class="">493</span>:     vals = np.ascontiguousarray(vals.astype(np.float))</pre>
<pre class='cython code score-91 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 493, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_ascontiguousarray);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 493, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_vals, __pyx_n_s_astype);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 493, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 493, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_5, __pyx_n_s_float);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 493, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_4))) {
    __pyx_t_5 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_4);
    if (likely(__pyx_t_5)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_4, function);
    }
  }
  if (!__pyx_t_5) {
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_4, __pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 493, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  } else {
    #if CYTHON_FAST_PYCALL
    if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_4)) {
      PyObject *__pyx_temp[2] = {__pyx_t_5, __pyx_t_6};
      __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_4, __pyx_temp+1-1, 1+1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 493, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_4)) {
      PyObject *__pyx_temp[2] = {__pyx_t_5, __pyx_t_6};
      __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_4, __pyx_temp+1-1, 1+1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 493, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    } else
    #endif
    {
      __pyx_t_7 = <span class='py_c_api'>PyTuple_New</span>(1+1);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 493, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 0, __pyx_t_5); __pyx_t_5 = NULL;
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 0+1, __pyx_t_6);
      __pyx_t_6 = 0;
      __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_4, __pyx_t_7, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 493, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    }
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
    __pyx_t_4 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
    if (likely(__pyx_t_4)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
    }
  }
  if (!__pyx_t_4) {
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_3, __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 493, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  } else {
    #if CYTHON_FAST_PYCALL
    if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_3)) {
      PyObject *__pyx_temp[2] = {__pyx_t_4, __pyx_t_2};
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_3, __pyx_temp+1-1, 1+1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 493, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_3)) {
      PyObject *__pyx_temp[2] = {__pyx_t_4, __pyx_t_2};
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_3, __pyx_temp+1-1, 1+1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 493, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    } else
    #endif
    {
      __pyx_t_7 = <span class='py_c_api'>PyTuple_New</span>(1+1);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 493, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 0, __pyx_t_4); __pyx_t_4 = NULL;
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 0+1, __pyx_t_2);
      __pyx_t_2 = 0;
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_3, __pyx_t_7, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 493, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    }
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_vals, __pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class="cython line score-91" onclick='toggleDiv(this)'>+<span class="">494</span>:     vertinds = np.ascontiguousarray(vertinds.astype(np.uint32))</pre>
<pre class='cython code score-91 '>  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 494, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_ascontiguousarray);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 494, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_vertinds, __pyx_n_s_astype);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 494, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 494, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_n_s_uint32);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 494, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_2))) {
    __pyx_t_4 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_2);
    if (likely(__pyx_t_4)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_2, function);
    }
  }
  if (!__pyx_t_4) {
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_2, __pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 494, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  } else {
    #if CYTHON_FAST_PYCALL
    if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_2)) {
      PyObject *__pyx_temp[2] = {__pyx_t_4, __pyx_t_6};
      __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_2, __pyx_temp+1-1, 1+1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 494, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_2)) {
      PyObject *__pyx_temp[2] = {__pyx_t_4, __pyx_t_6};
      __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_2, __pyx_temp+1-1, 1+1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 494, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    } else
    #endif
    {
      __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(1+1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 494, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_4); __pyx_t_4 = NULL;
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0+1, __pyx_t_6);
      __pyx_t_6 = 0;
      __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_t_5, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 494, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    }
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_7))) {
    __pyx_t_2 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_7);
    if (likely(__pyx_t_2)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_7);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_7, function);
    }
  }
  if (!__pyx_t_2) {
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_7, __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 494, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  } else {
    #if CYTHON_FAST_PYCALL
    if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_7)) {
      PyObject *__pyx_temp[2] = {__pyx_t_2, __pyx_t_3};
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_7, __pyx_temp+1-1, 1+1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 494, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_7)) {
      PyObject *__pyx_temp[2] = {__pyx_t_2, __pyx_t_3};
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_7, __pyx_temp+1-1, 1+1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 494, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    } else
    #endif
    {
      __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(1+1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 494, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_2); __pyx_t_2 = NULL;
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0+1, __pyx_t_3);
      __pyx_t_3 = 0;
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_7, __pyx_t_5, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 494, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    }
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_vertinds, __pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class="cython line score-10" onclick='toggleDiv(this)'>+<span class="">495</span>:     return vals, vertinds</pre>
<pre class='cython code score-10 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 495, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_vals);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_vals);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_v_vals);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_vertinds);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_vertinds);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 1, __pyx_v_vertinds);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">496</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">497</span>: </pre>
<pre class="cython line score-26" onclick='toggleDiv(this)'>+<span class="">498</span>: def adj_to_countarrs(adj_inds):</pre>
<pre class='cython code score-26 '>/* Python wrapper */
static PyObject *__pyx_pw_4dipy_7reconst_8recspeed_17adj_to_countarrs(PyObject *__pyx_self, PyObject *__pyx_v_adj_inds); /*proto*/
static char __pyx_doc_4dipy_7reconst_8recspeed_16adj_to_countarrs[] = "Convert adjacency sequence to counts and flattened indices\n\n    We use this to provide expected input to ``argmax_from_countarrs``\n\n    Parameters\n    ------------\n    adj_indices : sequence\n       length V sequence of sequences, where sequence ``i`` contains the\n       neighbors of a particular vertex.\n\n    Returns\n    ---------\n    counts : (V,) array\n       Number of neighbors for each vertex\n    adj_inds : (n,) array\n       flat array containing `adj_indices` unrolled as a vector\n    ";
static PyMethodDef __pyx_mdef_4dipy_7reconst_8recspeed_17adj_to_countarrs = {"adj_to_countarrs", (PyCFunction)__pyx_pw_4dipy_7reconst_8recspeed_17adj_to_countarrs, METH_O, __pyx_doc_4dipy_7reconst_8recspeed_16adj_to_countarrs};
static PyObject *__pyx_pw_4dipy_7reconst_8recspeed_17adj_to_countarrs(PyObject *__pyx_self, PyObject *__pyx_v_adj_inds) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("adj_to_countarrs (wrapper)", 0);
  __pyx_r = __pyx_pf_4dipy_7reconst_8recspeed_16adj_to_countarrs(__pyx_self, ((PyObject *)__pyx_v_adj_inds));

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_4dipy_7reconst_8recspeed_16adj_to_countarrs(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_adj_inds) {
  PyObject *__pyx_v_counts = NULL;
  PyObject *__pyx_v_all_inds = NULL;
  PyObject *__pyx_v_verts = NULL;
  PyObject *__pyx_v_v = NULL;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("adj_to_countarrs", 0);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_adj_inds);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("dipy.reconst.recspeed.adj_to_countarrs", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_counts);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_all_inds);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_verts);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_v);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_adj_inds);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__54 = <span class='py_c_api'>PyTuple_Pack</span>(5, __pyx_n_s_adj_inds, __pyx_n_s_counts, __pyx_n_s_all_inds, __pyx_n_s_verts, __pyx_n_s_v);<span class='error_goto'> if (unlikely(!__pyx_tuple__54)) __PYX_ERR(0, 498, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__54);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__54);
/* … */
  __pyx_t_1 = PyCFunction_NewEx(&amp;__pyx_mdef_4dipy_7reconst_8recspeed_17adj_to_countarrs, NULL, __pyx_n_s_dipy_reconst_recspeed);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 498, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_adj_to_countarrs, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 498, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_codeobj__55 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(1, 0, 5, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__54, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_dipy_reconst_recspeed_pyx, __pyx_n_s_adj_to_countarrs, 498, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__55)) __PYX_ERR(0, 498, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">499</span>:     """Convert adjacency sequence to counts and flattened indices</pre>
<pre class="cython line score-0">&#xA0;<span class="">500</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">501</span>:     We use this to provide expected input to ``argmax_from_countarrs``</pre>
<pre class="cython line score-0">&#xA0;<span class="">502</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">503</span>:     Parameters</pre>
<pre class="cython line score-0">&#xA0;<span class="">504</span>:     ------------</pre>
<pre class="cython line score-0">&#xA0;<span class="">505</span>:     adj_indices : sequence</pre>
<pre class="cython line score-0">&#xA0;<span class="">506</span>:        length V sequence of sequences, where sequence ``i`` contains the</pre>
<pre class="cython line score-0">&#xA0;<span class="">507</span>:        neighbors of a particular vertex.</pre>
<pre class="cython line score-0">&#xA0;<span class="">508</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">509</span>:     Returns</pre>
<pre class="cython line score-0">&#xA0;<span class="">510</span>:     ---------</pre>
<pre class="cython line score-0">&#xA0;<span class="">511</span>:     counts : (V,) array</pre>
<pre class="cython line score-0">&#xA0;<span class="">512</span>:        Number of neighbors for each vertex</pre>
<pre class="cython line score-0">&#xA0;<span class="">513</span>:     adj_inds : (n,) array</pre>
<pre class="cython line score-0">&#xA0;<span class="">514</span>:        flat array containing `adj_indices` unrolled as a vector</pre>
<pre class="cython line score-0">&#xA0;<span class="">515</span>:     """</pre>
<pre class="cython line score-5" onclick='toggleDiv(this)'>+<span class="">516</span>:     counts = []</pre>
<pre class='cython code score-5 '>  __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 516, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_v_counts = __pyx_t_1;
  __pyx_t_1 = 0;
</pre><pre class="cython line score-5" onclick='toggleDiv(this)'>+<span class="">517</span>:     all_inds = []</pre>
<pre class='cython code score-5 '>  __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 517, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_v_all_inds = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class="cython line score-43" onclick='toggleDiv(this)'>+<span class="">518</span>:     for verts in adj_inds:</pre>
<pre class='cython code score-43 '>  if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_v_adj_inds)) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_v_adj_inds)) {
    __pyx_t_1 = __pyx_v_adj_inds; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1); __pyx_t_2 = 0;
    __pyx_t_3 = NULL;
  } else {
    __pyx_t_2 = -1; __pyx_t_1 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_v_adj_inds);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 518, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_3 = Py_TYPE(__pyx_t_1)-&gt;tp_iternext;<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 518, __pyx_L1_error)</span>
  }
  for (;;) {
    if (likely(!__pyx_t_3)) {
      if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_1))) {
        if (__pyx_t_2 &gt;= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_1)) break;
        #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_4 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_1, __pyx_t_2); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4); __pyx_t_2++; if (unlikely(0 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 518, __pyx_L1_error)</span>
        #else
        __pyx_t_4 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_1, __pyx_t_2); __pyx_t_2++;<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 518, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
        #endif
      } else {
        if (__pyx_t_2 &gt;= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_1)) break;
        #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_4 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_1, __pyx_t_2); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4); __pyx_t_2++; if (unlikely(0 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 518, __pyx_L1_error)</span>
        #else
        __pyx_t_4 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_1, __pyx_t_2); __pyx_t_2++;<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 518, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
        #endif
      }
    } else {
      __pyx_t_4 = __pyx_t_3(__pyx_t_1);
      if (unlikely(!__pyx_t_4)) {
        PyObject* exc_type = <span class='py_c_api'>PyErr_Occurred</span>();
        if (exc_type) {
          if (likely(<span class='pyx_c_api'>__Pyx_PyErr_GivenExceptionMatches</span>(exc_type, PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
          else <span class='error_goto'>__PYX_ERR(0, 518, __pyx_L1_error)</span>
        }
        break;
      }
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    }
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_verts, __pyx_t_4);
    __pyx_t_4 = 0;
/* … */
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-6" onclick='toggleDiv(this)'>+<span class="">519</span>:         v = list(verts)</pre>
<pre class='cython code score-6 '>    __pyx_t_4 = <span class='py_c_api'>PySequence_List</span>(__pyx_v_verts);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 519, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_v, ((PyObject*)__pyx_t_4));
    __pyx_t_4 = 0;
</pre><pre class="cython line score-6" onclick='toggleDiv(this)'>+<span class="">520</span>:         all_inds += v</pre>
<pre class='cython code score-6 '>    __pyx_t_4 = <span class='py_c_api'>PyNumber_InPlaceAdd</span>(__pyx_v_all_inds, __pyx_v_v);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 520, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_all_inds, ((PyObject*)__pyx_t_4));
    __pyx_t_4 = 0;
</pre><pre class="cython line score-9" onclick='toggleDiv(this)'>+<span class="">521</span>:         counts.append(len(v))</pre>
<pre class='cython code score-9 '>    __pyx_t_5 = <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_v_v);<span class='error_goto'> if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 521, __pyx_L1_error)</span>
    __pyx_t_4 = <span class='py_c_api'>PyInt_FromSsize_t</span>(__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 521, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_Append</span>(__pyx_v_counts, __pyx_t_4);<span class='error_goto'> if (unlikely(__pyx_t_6 == ((int)-1))) __PYX_ERR(0, 521, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
</pre><pre class="cython line score-31" onclick='toggleDiv(this)'>+<span class="">522</span>:     adj_inds = np.array(all_inds, dtype=np.uint32)</pre>
<pre class='cython code score-31 '>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 522, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_array);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 522, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 522, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_all_inds);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_all_inds);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_v_all_inds);
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 522, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 522, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_8, __pyx_n_s_uint32);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 522, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_9) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 522, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_4, __pyx_t_1, __pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 522, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_adj_inds, __pyx_t_9);
  __pyx_t_9 = 0;
</pre><pre class="cython line score-31" onclick='toggleDiv(this)'>+<span class="">523</span>:     counts = np.array(counts, dtype=np.uint32)</pre>
<pre class='cython code score-31 '>  __pyx_t_9 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 523, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_9, __pyx_n_s_array);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 523, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  __pyx_t_9 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 523, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_counts);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_counts);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 0, __pyx_v_counts);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 523, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 523, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_n_s_uint32);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 523, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_8) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 523, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_7, __pyx_t_9, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 523, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_counts, __pyx_t_8);
  __pyx_t_8 = 0;
</pre><pre class="cython line score-10" onclick='toggleDiv(this)'>+<span class="">524</span>:     return counts, adj_inds</pre>
<pre class='cython code score-10 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_8 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 524, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_counts);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_counts);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 0, __pyx_v_counts);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_adj_inds);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_adj_inds);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 1, __pyx_v_adj_inds);
  __pyx_r = __pyx_t_8;
  __pyx_t_8 = 0;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">525</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">526</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">527</span>: # prefetch argsort for small speedup</pre>
<pre class="cython line score-6" onclick='toggleDiv(this)'>+<span class="">528</span>: cdef object argsort = np.argsort</pre>
<pre class='cython code score-6 '>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 528, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_argsort);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 528, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_v_4dipy_7reconst_8recspeed_argsort);
  <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_4dipy_7reconst_8recspeed_argsort, __pyx_t_3);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
  __pyx_t_3 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">529</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">530</span>: </pre>
<pre class="cython line score-110" onclick='toggleDiv(this)'>+<span class="">531</span>: def argmax_from_countarrs(cnp.ndarray vals,</pre>
<pre class='cython code score-110 '>/* Python wrapper */
static PyObject *__pyx_pw_4dipy_7reconst_8recspeed_19argmax_from_countarrs(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4dipy_7reconst_8recspeed_18argmax_from_countarrs[] = "Indices of local maxima from `vals` from count, array neighbors\n\n    Parameters\n    ----------\n    vals : (N,) array, dtype float\n       values at all vertices referred to in either of `vertex_inds` or\n       `adj_inds`'\n    vertinds : (V,) array, dtype uint32\n       indices into `vals` giving vertices that may be local maxima.\n    adj_counts : (V,) array, dtype uint32\n       For every vertex ``i`` in ``vertex_inds``, the number of\n       neighbors for vertex ``i``\n    adj_inds : (P,) array, dtype uint32\n       Indices for neighbors for each point.  ``P=sum(adj_counts)`` \n\n    Returns\n    -------\n    inds : (M,) array\n       Indices into `vals` giving local maxima of vals, given topology\n       from `adj_counts` and `adj_inds`, and restrictions from\n       `vertex_inds`.  Inds are returned sorted by value at that index -\n       i.e. smallest value (at index) first.\n    ";
static PyMethodDef __pyx_mdef_4dipy_7reconst_8recspeed_19argmax_from_countarrs = {"argmax_from_countarrs", (PyCFunction)__pyx_pw_4dipy_7reconst_8recspeed_19argmax_from_countarrs, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4dipy_7reconst_8recspeed_18argmax_from_countarrs};
static PyObject *__pyx_pw_4dipy_7reconst_8recspeed_19argmax_from_countarrs(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyArrayObject *__pyx_v_vals = 0;
  PyArrayObject *__pyx_v_vertinds = 0;
  PyArrayObject *__pyx_v_adj_counts = 0;
  PyArrayObject *__pyx_v_adj_inds = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("argmax_from_countarrs (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_vals,&amp;__pyx_n_s_vertinds,&amp;__pyx_n_s_adj_counts,&amp;__pyx_n_s_adj_inds,0};
    PyObject* values[4] = {0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_vals)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_vertinds)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("argmax_from_countarrs", 1, 4, 4, 1); <span class='error_goto'>__PYX_ERR(0, 531, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_adj_counts)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("argmax_from_countarrs", 1, 4, 4, 2); <span class='error_goto'>__PYX_ERR(0, 531, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_adj_inds)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("argmax_from_countarrs", 1, 4, 4, 3); <span class='error_goto'>__PYX_ERR(0, 531, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "argmax_from_countarrs") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 531, __pyx_L3_error)</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 4) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
      values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
    }
    __pyx_v_vals = ((PyArrayObject *)values[0]);
    __pyx_v_vertinds = ((PyArrayObject *)values[1]);
    __pyx_v_adj_counts = ((PyArrayObject *)values[2]);
    __pyx_v_adj_inds = ((PyArrayObject *)values[3]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("argmax_from_countarrs", 1, 4, 4, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 531, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("dipy.reconst.recspeed.argmax_from_countarrs", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_vals), __pyx_ptype_5numpy_ndarray, 1, "vals", 0))) <span class='error_goto'>__PYX_ERR(0, 531, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_vertinds), __pyx_ptype_5numpy_ndarray, 1, "vertinds", 0))) <span class='error_goto'>__PYX_ERR(0, 532, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_adj_counts), __pyx_ptype_5numpy_ndarray, 1, "adj_counts", 0))) <span class='error_goto'>__PYX_ERR(0, 533, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_adj_inds), __pyx_ptype_5numpy_ndarray, 1, "adj_inds", 0))) <span class='error_goto'>__PYX_ERR(0, 534, __pyx_L1_error)</span>
  __pyx_r = __pyx_pf_4dipy_7reconst_8recspeed_18argmax_from_countarrs(__pyx_self, __pyx_v_vals, __pyx_v_vertinds, __pyx_v_adj_counts, __pyx_v_adj_inds);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_4dipy_7reconst_8recspeed_18argmax_from_countarrs(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_vals, PyArrayObject *__pyx_v_vertinds, PyArrayObject *__pyx_v_adj_counts, PyArrayObject *__pyx_v_adj_inds) {
  PyArrayObject *__pyx_v_cvals = 0;
  PyArrayObject *__pyx_v_cvertinds = 0;
  PyArrayObject *__pyx_v_cadj_counts = 0;
  PyArrayObject *__pyx_v_cadj_inds = 0;
  PyArrayObject *__pyx_v_maxes = 0;
  PyArrayObject *__pyx_v_maxinds = 0;
  npy_intp __pyx_v_i;
  npy_intp __pyx_v_j;
  npy_intp __pyx_v_V;
  npy_intp __pyx_v_C;
  npy_intp __pyx_v_n_maxes;
  npy_intp __pyx_v_adj_size;
  npy_intp __pyx_v_adj_pos;
  int __pyx_v_is_max;
  __pyx_t_5numpy_float64_t *__pyx_v_vals_ptr;
  double __pyx_v_val;
  __pyx_t_5numpy_uint32_t __pyx_v_vert_ind;
  __pyx_t_5numpy_uint32_t *__pyx_v_vertinds_ptr;
  __pyx_t_5numpy_uint32_t *__pyx_v_counts_ptr;
  __pyx_t_5numpy_uint32_t *__pyx_v_adj_ptr;
  __pyx_t_5numpy_uint32_t __pyx_v_ind;
  __pyx_t_5numpy_uint32_t __pyx_v_vals_size;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_cadj_counts;
  __Pyx_Buffer __pyx_pybuffer_cadj_counts;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_cadj_inds;
  __Pyx_Buffer __pyx_pybuffer_cadj_inds;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_cvals;
  __Pyx_Buffer __pyx_pybuffer_cvals;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_cvertinds;
  __Pyx_Buffer __pyx_pybuffer_cvertinds;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_maxes;
  __Pyx_Buffer __pyx_pybuffer_maxes;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_maxinds;
  __Pyx_Buffer __pyx_pybuffer_maxinds;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("argmax_from_countarrs", 0);
  __pyx_pybuffer_cvals.pybuffer.buf = NULL;
  __pyx_pybuffer_cvals.refcount = 0;
  __pyx_pybuffernd_cvals.data = NULL;
  __pyx_pybuffernd_cvals.rcbuffer = &amp;__pyx_pybuffer_cvals;
  __pyx_pybuffer_cvertinds.pybuffer.buf = NULL;
  __pyx_pybuffer_cvertinds.refcount = 0;
  __pyx_pybuffernd_cvertinds.data = NULL;
  __pyx_pybuffernd_cvertinds.rcbuffer = &amp;__pyx_pybuffer_cvertinds;
  __pyx_pybuffer_cadj_counts.pybuffer.buf = NULL;
  __pyx_pybuffer_cadj_counts.refcount = 0;
  __pyx_pybuffernd_cadj_counts.data = NULL;
  __pyx_pybuffernd_cadj_counts.rcbuffer = &amp;__pyx_pybuffer_cadj_counts;
  __pyx_pybuffer_cadj_inds.pybuffer.buf = NULL;
  __pyx_pybuffer_cadj_inds.refcount = 0;
  __pyx_pybuffernd_cadj_inds.data = NULL;
  __pyx_pybuffernd_cadj_inds.rcbuffer = &amp;__pyx_pybuffer_cadj_inds;
  __pyx_pybuffer_maxes.pybuffer.buf = NULL;
  __pyx_pybuffer_maxes.refcount = 0;
  __pyx_pybuffernd_maxes.data = NULL;
  __pyx_pybuffernd_maxes.rcbuffer = &amp;__pyx_pybuffer_maxes;
  __pyx_pybuffer_maxinds.pybuffer.buf = NULL;
  __pyx_pybuffer_maxinds.refcount = 0;
  __pyx_pybuffernd_maxinds.data = NULL;
  __pyx_pybuffernd_maxinds.rcbuffer = &amp;__pyx_pybuffer_maxinds;
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_15);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_16);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_cadj_counts.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_cadj_inds.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_cvals.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_cvertinds.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_maxes.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_maxinds.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("dipy.reconst.recspeed.argmax_from_countarrs", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_cadj_counts.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_cadj_inds.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_cvals.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_cvertinds.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_maxes.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_maxinds.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_cvals);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_cvertinds);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_cadj_counts);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_cadj_inds);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_maxes);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_maxinds);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__56 = <span class='py_c_api'>PyTuple_Pack</span>(27, __pyx_n_s_vals, __pyx_n_s_vertinds, __pyx_n_s_adj_counts, __pyx_n_s_adj_inds, __pyx_n_s_cvals, __pyx_n_s_cvertinds, __pyx_n_s_cadj_counts, __pyx_n_s_cadj_inds, __pyx_n_s_maxes, __pyx_n_s_maxinds, __pyx_n_s_i, __pyx_n_s_j, __pyx_n_s_V, __pyx_n_s_C, __pyx_n_s_n_maxes, __pyx_n_s_adj_size, __pyx_n_s_adj_pos, __pyx_n_s_is_max, __pyx_n_s_vals_ptr, __pyx_n_s_val, __pyx_n_s_vert_ind, __pyx_n_s_vertinds_ptr, __pyx_n_s_counts_ptr, __pyx_n_s_adj_ptr, __pyx_n_s_ind, __pyx_n_s_vals_size, __pyx_n_s_vert_size);<span class='error_goto'> if (unlikely(!__pyx_tuple__56)) __PYX_ERR(0, 531, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__56);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__56);
/* … */
  __pyx_t_3 = PyCFunction_NewEx(&amp;__pyx_mdef_4dipy_7reconst_8recspeed_19argmax_from_countarrs, NULL, __pyx_n_s_dipy_reconst_recspeed);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 531, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_argmax_from_countarrs, __pyx_t_3) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 531, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_codeobj__57 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(4, 0, 27, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__56, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_dipy_reconst_recspeed_pyx, __pyx_n_s_argmax_from_countarrs, 531, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__57)) __PYX_ERR(0, 531, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">532</span>:                           cnp.ndarray vertinds,</pre>
<pre class="cython line score-0">&#xA0;<span class="">533</span>:                           cnp.ndarray adj_counts,</pre>
<pre class="cython line score-0">&#xA0;<span class="">534</span>:                           cnp.ndarray adj_inds):</pre>
<pre class="cython line score-0">&#xA0;<span class="">535</span>:     """Indices of local maxima from `vals` from count, array neighbors</pre>
<pre class="cython line score-0">&#xA0;<span class="">536</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">537</span>:     Parameters</pre>
<pre class="cython line score-0">&#xA0;<span class="">538</span>:     ----------</pre>
<pre class="cython line score-0">&#xA0;<span class="">539</span>:     vals : (N,) array, dtype float</pre>
<pre class="cython line score-0">&#xA0;<span class="">540</span>:        values at all vertices referred to in either of `vertex_inds` or</pre>
<pre class="cython line score-0">&#xA0;<span class="">541</span>:        `adj_inds`'</pre>
<pre class="cython line score-0">&#xA0;<span class="">542</span>:     vertinds : (V,) array, dtype uint32</pre>
<pre class="cython line score-0">&#xA0;<span class="">543</span>:        indices into `vals` giving vertices that may be local maxima.</pre>
<pre class="cython line score-0">&#xA0;<span class="">544</span>:     adj_counts : (V,) array, dtype uint32</pre>
<pre class="cython line score-0">&#xA0;<span class="">545</span>:        For every vertex ``i`` in ``vertex_inds``, the number of</pre>
<pre class="cython line score-0">&#xA0;<span class="">546</span>:        neighbors for vertex ``i``</pre>
<pre class="cython line score-0">&#xA0;<span class="">547</span>:     adj_inds : (P,) array, dtype uint32</pre>
<pre class="cython line score-0">&#xA0;<span class="">548</span>:        Indices for neighbors for each point.  ``P=sum(adj_counts)``</pre>
<pre class="cython line score-0">&#xA0;<span class="">549</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">550</span>:     Returns</pre>
<pre class="cython line score-0">&#xA0;<span class="">551</span>:     -------</pre>
<pre class="cython line score-0">&#xA0;<span class="">552</span>:     inds : (M,) array</pre>
<pre class="cython line score-0">&#xA0;<span class="">553</span>:        Indices into `vals` giving local maxima of vals, given topology</pre>
<pre class="cython line score-0">&#xA0;<span class="">554</span>:        from `adj_counts` and `adj_inds`, and restrictions from</pre>
<pre class="cython line score-0">&#xA0;<span class="">555</span>:        `vertex_inds`.  Inds are returned sorted by value at that index -</pre>
<pre class="cython line score-0">&#xA0;<span class="">556</span>:        i.e. smallest value (at index) first.</pre>
<pre class="cython line score-0">&#xA0;<span class="">557</span>:     """</pre>
<pre class="cython line score-0">&#xA0;<span class="">558</span>:     cdef:</pre>
<pre class="cython line score-4" onclick='toggleDiv(this)'>+<span class="">559</span>:         cnp.ndarray[cnp.float64_t, ndim=1] cvals = vals</pre>
<pre class='cython code score-4 '>  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_cvals.rcbuffer-&gt;pybuffer, (PyObject*)((PyArrayObject *)__pyx_v_vals), &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_float64_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
      __pyx_v_cvals = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_cvals.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 559, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_cvals.diminfo[0].strides = __pyx_pybuffernd_cvals.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_cvals.diminfo[0].shape = __pyx_pybuffernd_cvals.rcbuffer-&gt;pybuffer.shape[0];
    }
  }
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_vals));
  __pyx_v_cvals = ((PyArrayObject *)__pyx_v_vals);
</pre><pre class="cython line score-4" onclick='toggleDiv(this)'>+<span class="">560</span>:         cnp.ndarray[cnp.uint32_t, ndim=1] cvertinds = vertinds</pre>
<pre class='cython code score-4 '>  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_cvertinds.rcbuffer-&gt;pybuffer, (PyObject*)((PyArrayObject *)__pyx_v_vertinds), &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_uint32_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
      __pyx_v_cvertinds = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_cvertinds.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 560, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_cvertinds.diminfo[0].strides = __pyx_pybuffernd_cvertinds.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_cvertinds.diminfo[0].shape = __pyx_pybuffernd_cvertinds.rcbuffer-&gt;pybuffer.shape[0];
    }
  }
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_vertinds));
  __pyx_v_cvertinds = ((PyArrayObject *)__pyx_v_vertinds);
</pre><pre class="cython line score-4" onclick='toggleDiv(this)'>+<span class="">561</span>:         cnp.ndarray[cnp.uint32_t, ndim=1] cadj_counts = adj_counts</pre>
<pre class='cython code score-4 '>  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_cadj_counts.rcbuffer-&gt;pybuffer, (PyObject*)((PyArrayObject *)__pyx_v_adj_counts), &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_uint32_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
      __pyx_v_cadj_counts = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_cadj_counts.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 561, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_cadj_counts.diminfo[0].strides = __pyx_pybuffernd_cadj_counts.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_cadj_counts.diminfo[0].shape = __pyx_pybuffernd_cadj_counts.rcbuffer-&gt;pybuffer.shape[0];
    }
  }
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_adj_counts));
  __pyx_v_cadj_counts = ((PyArrayObject *)__pyx_v_adj_counts);
</pre><pre class="cython line score-4" onclick='toggleDiv(this)'>+<span class="">562</span>:         cnp.ndarray[cnp.uint32_t, ndim=1] cadj_inds = adj_inds</pre>
<pre class='cython code score-4 '>  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_cadj_inds.rcbuffer-&gt;pybuffer, (PyObject*)((PyArrayObject *)__pyx_v_adj_inds), &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_uint32_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
      __pyx_v_cadj_inds = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_cadj_inds.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 562, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_cadj_inds.diminfo[0].strides = __pyx_pybuffernd_cadj_inds.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_cadj_inds.diminfo[0].shape = __pyx_pybuffernd_cadj_inds.rcbuffer-&gt;pybuffer.shape[0];
    }
  }
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_adj_inds));
  __pyx_v_cadj_inds = ((PyArrayObject *)__pyx_v_adj_inds);
</pre><pre class="cython line score-0">&#xA0;<span class="">563</span>:         # temporary arrays for storing maxes</pre>
<pre class="cython line score-23" onclick='toggleDiv(this)'>+<span class="">564</span>:         cnp.ndarray[cnp.float64_t, ndim=1] maxes = vals.copy()</pre>
<pre class='cython code score-23 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(((PyObject *)__pyx_v_vals), __pyx_n_s_copy);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 564, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_2))) {
    __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_2, function);
    }
  }
  if (__pyx_t_3) {
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_2, __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 564, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  } else {
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_CallNoArg</span>(__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 564, __pyx_L1_error)</span>
  }
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 564, __pyx_L1_error)</span>
  __pyx_t_4 = ((PyArrayObject *)__pyx_t_1);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_maxes.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_4, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_float64_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {
      __pyx_v_maxes = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_maxes.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 564, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_maxes.diminfo[0].strides = __pyx_pybuffernd_maxes.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_maxes.diminfo[0].shape = __pyx_pybuffernd_maxes.rcbuffer-&gt;pybuffer.shape[0];
    }
  }
  __pyx_t_4 = 0;
  __pyx_v_maxes = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class="cython line score-23" onclick='toggleDiv(this)'>+<span class="">565</span>:         cnp.ndarray[cnp.uint32_t, ndim=1] maxinds = vertinds.copy()</pre>
<pre class='cython code score-23 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(((PyObject *)__pyx_v_vertinds), __pyx_n_s_copy);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 565, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_2))) {
    __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_2, function);
    }
  }
  if (__pyx_t_3) {
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_2, __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 565, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  } else {
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_CallNoArg</span>(__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 565, __pyx_L1_error)</span>
  }
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 565, __pyx_L1_error)</span>
  __pyx_t_5 = ((PyArrayObject *)__pyx_t_1);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_maxinds.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_5, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_uint32_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {
      __pyx_v_maxinds = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_maxinds.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 565, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_maxinds.diminfo[0].strides = __pyx_pybuffernd_maxinds.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_maxinds.diminfo[0].shape = __pyx_pybuffernd_maxinds.rcbuffer-&gt;pybuffer.shape[0];
    }
  }
  __pyx_t_5 = 0;
  __pyx_v_maxinds = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">566</span>:         cnp.npy_intp i, j, V, C, n_maxes=0, adj_size, adj_pos=0</pre>
<pre class='cython code score-0 '>  __pyx_v_n_maxes = 0;
  __pyx_v_adj_pos = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">567</span>:         int is_max</pre>
<pre class="cython line score-0">&#xA0;<span class="">568</span>:         cnp.float64_t *vals_ptr</pre>
<pre class="cython line score-0">&#xA0;<span class="">569</span>:         double val</pre>
<pre class="cython line score-0">&#xA0;<span class="">570</span>:         cnp.uint32_t vert_ind, *vertinds_ptr, *counts_ptr, *adj_ptr, ind</pre>
<pre class="cython line score-0">&#xA0;<span class="">571</span>:         cnp.uint32_t vals_size, vert_size</pre>
<pre class="cython line score-1" onclick='toggleDiv(this)'>+<span class="">572</span>:     if not (cnp.PyArray_ISCONTIGUOUS(cvals) and</pre>
<pre class='cython code score-1 '>  __pyx_t_7 = (<span class='py_macro_api'>PyArray_ISCONTIGUOUS</span>(((PyArrayObject *)__pyx_v_cvals)) != 0);
  if (__pyx_t_7) {
  } else {
    __pyx_t_6 = __pyx_t_7;
    goto __pyx_L4_bool_binop_done;
  }
/* … */
  __pyx_t_7 = ((!__pyx_t_6) != 0);
  if (__pyx_t_7) {
/* … */
  }
</pre><pre class="cython line score-1" onclick='toggleDiv(this)'>+<span class="">573</span>:             cnp.PyArray_ISCONTIGUOUS(cvertinds) and</pre>
<pre class='cython code score-1 '>  __pyx_t_7 = (<span class='py_macro_api'>PyArray_ISCONTIGUOUS</span>(((PyArrayObject *)__pyx_v_cvertinds)) != 0);
  if (__pyx_t_7) {
  } else {
    __pyx_t_6 = __pyx_t_7;
    goto __pyx_L4_bool_binop_done;
  }
</pre><pre class="cython line score-1" onclick='toggleDiv(this)'>+<span class="">574</span>:             cnp.PyArray_ISCONTIGUOUS(cadj_counts) and</pre>
<pre class='cython code score-1 '>  __pyx_t_7 = (<span class='py_macro_api'>PyArray_ISCONTIGUOUS</span>(((PyArrayObject *)__pyx_v_cadj_counts)) != 0);
  if (__pyx_t_7) {
  } else {
    __pyx_t_6 = __pyx_t_7;
    goto __pyx_L4_bool_binop_done;
  }
</pre><pre class="cython line score-1" onclick='toggleDiv(this)'>+<span class="">575</span>:             cnp.PyArray_ISCONTIGUOUS(cadj_inds)):</pre>
<pre class='cython code score-1 '>  __pyx_t_7 = (<span class='py_macro_api'>PyArray_ISCONTIGUOUS</span>(((PyArrayObject *)__pyx_v_cadj_inds)) != 0);
  __pyx_t_6 = __pyx_t_7;
  __pyx_L4_bool_binop_done:;
</pre><pre class="cython line score-10" onclick='toggleDiv(this)'>+<span class="">576</span>:         raise ValueError('Need contiguous arrays as input')</pre>
<pre class='cython code score-10 '>    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_builtin_ValueError, __pyx_tuple__6, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 576, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_1, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    <span class='error_goto'>__PYX_ERR(0, 576, __pyx_L1_error)</span>
/* … */
  __pyx_tuple__6 = <span class='py_c_api'>PyTuple_Pack</span>(1, __pyx_kp_s_Need_contiguous_arrays_as_input);<span class='error_goto'> if (unlikely(!__pyx_tuple__6)) __PYX_ERR(0, 576, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__6);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__6);
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">577</span>:     vals_size = cvals.shape[0]</pre>
<pre class='cython code score-0 '>  __pyx_v_vals_size = (__pyx_v_cvals-&gt;dimensions[0]);
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">578</span>:     vals_ptr = &lt;cnp.float64_t *&gt;cvals.data</pre>
<pre class='cython code score-0 '>  __pyx_v_vals_ptr = ((__pyx_t_5numpy_float64_t *)__pyx_v_cvals-&gt;data);
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">579</span>:     vertinds_ptr = &lt;cnp.uint32_t *&gt;cvertinds.data</pre>
<pre class='cython code score-0 '>  __pyx_v_vertinds_ptr = ((__pyx_t_5numpy_uint32_t *)__pyx_v_cvertinds-&gt;data);
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">580</span>:     adj_ptr = &lt;cnp.uint32_t *&gt;cadj_inds.data</pre>
<pre class='cython code score-0 '>  __pyx_v_adj_ptr = ((__pyx_t_5numpy_uint32_t *)__pyx_v_cadj_inds-&gt;data);
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">581</span>:     counts_ptr = &lt;cnp.uint32_t *&gt;cadj_counts.data</pre>
<pre class='cython code score-0 '>  __pyx_v_counts_ptr = ((__pyx_t_5numpy_uint32_t *)__pyx_v_cadj_counts-&gt;data);
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">582</span>:     V = cadj_counts.shape[0]</pre>
<pre class='cython code score-0 '>  __pyx_v_V = (__pyx_v_cadj_counts-&gt;dimensions[0]);
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">583</span>:     adj_size = cadj_inds.shape[0]</pre>
<pre class='cython code score-0 '>  __pyx_v_adj_size = (__pyx_v_cadj_inds-&gt;dimensions[0]);
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">584</span>:     if cvertinds.shape[0] &lt; V:</pre>
<pre class='cython code score-0 '>  __pyx_t_7 = (((__pyx_v_cvertinds-&gt;dimensions[0]) &lt; __pyx_v_V) != 0);
  if (__pyx_t_7) {
/* … */
  }
</pre><pre class="cython line score-10" onclick='toggleDiv(this)'>+<span class="">585</span>:         raise ValueError('Too few indices for adj arrays')</pre>
<pre class='cython code score-10 '>    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_builtin_ValueError, __pyx_tuple__7, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 585, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_1, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    <span class='error_goto'>__PYX_ERR(0, 585, __pyx_L1_error)</span>
/* … */
  __pyx_tuple__7 = <span class='py_c_api'>PyTuple_Pack</span>(1, __pyx_kp_s_Too_few_indices_for_adj_arrays);<span class='error_goto'> if (unlikely(!__pyx_tuple__7)) __PYX_ERR(0, 585, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__7);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__7);
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">586</span>:     for i in range(V):</pre>
<pre class='cython code score-0 '>  __pyx_t_8 = __pyx_v_V;
  for (__pyx_t_9 = 0; __pyx_t_9 &lt; __pyx_t_8; __pyx_t_9+=1) {
    __pyx_v_i = __pyx_t_9;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">587</span>:         vert_ind = vertinds_ptr[i]</pre>
<pre class='cython code score-0 '>    __pyx_v_vert_ind = (__pyx_v_vertinds_ptr[__pyx_v_i]);
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">588</span>:         if vert_ind &gt;= vals_size:</pre>
<pre class='cython code score-0 '>    __pyx_t_7 = ((__pyx_v_vert_ind &gt;= __pyx_v_vals_size) != 0);
    if (__pyx_t_7) {
/* … */
    }
</pre><pre class="cython line score-10" onclick='toggleDiv(this)'>+<span class="">589</span>:             raise IndexError('Overshoot on vals')</pre>
<pre class='cython code score-10 '>      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_builtin_IndexError, __pyx_tuple__8, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 589, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_1, 0, 0, 0);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      <span class='error_goto'>__PYX_ERR(0, 589, __pyx_L1_error)</span>
/* … */
  __pyx_tuple__8 = <span class='py_c_api'>PyTuple_Pack</span>(1, __pyx_kp_s_Overshoot_on_vals);<span class='error_goto'> if (unlikely(!__pyx_tuple__8)) __PYX_ERR(0, 589, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__8);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__8);
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">590</span>:         val = vals_ptr[vert_ind]</pre>
<pre class='cython code score-0 '>    __pyx_v_val = (__pyx_v_vals_ptr[__pyx_v_vert_ind]);
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">591</span>:         C = counts_ptr[i]</pre>
<pre class='cython code score-0 '>    __pyx_v_C = (__pyx_v_counts_ptr[__pyx_v_i]);
</pre><pre class="cython line score-0">&#xA0;<span class="">592</span>:         # check for overshoot</pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">593</span>:         adj_pos += C</pre>
<pre class='cython code score-0 '>    __pyx_v_adj_pos = (__pyx_v_adj_pos + __pyx_v_C);
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">594</span>:         if adj_pos &gt; adj_size:</pre>
<pre class='cython code score-0 '>    __pyx_t_7 = ((__pyx_v_adj_pos &gt; __pyx_v_adj_size) != 0);
    if (__pyx_t_7) {
/* … */
    }
</pre><pre class="cython line score-10" onclick='toggleDiv(this)'>+<span class="">595</span>:             raise IndexError('Overshoot on adj_inds array')</pre>
<pre class='cython code score-10 '>      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_builtin_IndexError, __pyx_tuple__9, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 595, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_1, 0, 0, 0);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      <span class='error_goto'>__PYX_ERR(0, 595, __pyx_L1_error)</span>
/* … */
  __pyx_tuple__9 = <span class='py_c_api'>PyTuple_Pack</span>(1, __pyx_kp_s_Overshoot_on_adj_inds_array);<span class='error_goto'> if (unlikely(!__pyx_tuple__9)) __PYX_ERR(0, 595, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__9);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__9);
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">596</span>:         is_max = 1</pre>
<pre class='cython code score-0 '>    __pyx_v_is_max = 1;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">597</span>:         for j in range(C):</pre>
<pre class='cython code score-0 '>    __pyx_t_10 = __pyx_v_C;
    for (__pyx_t_11 = 0; __pyx_t_11 &lt; __pyx_t_10; __pyx_t_11+=1) {
      __pyx_v_j = __pyx_t_11;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">598</span>:             ind = adj_ptr[j]</pre>
<pre class='cython code score-0 '>      __pyx_v_ind = (__pyx_v_adj_ptr[__pyx_v_j]);
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">599</span>:             if ind &gt;= vals_size:</pre>
<pre class='cython code score-0 '>      __pyx_t_7 = ((__pyx_v_ind &gt;= __pyx_v_vals_size) != 0);
      if (__pyx_t_7) {
/* … */
      }
</pre><pre class="cython line score-10" onclick='toggleDiv(this)'>+<span class="">600</span>:                 raise IndexError('Overshoot on vals')</pre>
<pre class='cython code score-10 '>        __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_builtin_IndexError, __pyx_tuple__10, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 600, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
        <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_1, 0, 0, 0);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
        <span class='error_goto'>__PYX_ERR(0, 600, __pyx_L1_error)</span>
/* … */
  __pyx_tuple__10 = <span class='py_c_api'>PyTuple_Pack</span>(1, __pyx_kp_s_Overshoot_on_vals);<span class='error_goto'> if (unlikely(!__pyx_tuple__10)) __PYX_ERR(0, 600, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__10);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__10);
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">601</span>:             if val &lt;= vals_ptr[ind]:</pre>
<pre class='cython code score-0 '>      __pyx_t_7 = ((__pyx_v_val &lt;= (__pyx_v_vals_ptr[__pyx_v_ind])) != 0);
      if (__pyx_t_7) {
/* … */
      }
    }
    __pyx_L14_break:;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">602</span>:                 is_max = 0</pre>
<pre class='cython code score-0 '>        __pyx_v_is_max = 0;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">603</span>:                 break</pre>
<pre class='cython code score-0 '>        goto __pyx_L14_break;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">604</span>:         if is_max:</pre>
<pre class='cython code score-0 '>    __pyx_t_7 = (__pyx_v_is_max != 0);
    if (__pyx_t_7) {
/* … */
    }
</pre><pre class="cython line score-2" onclick='toggleDiv(this)'>+<span class="">605</span>:             maxinds[n_maxes] = vert_ind</pre>
<pre class='cython code score-2 '>      __pyx_t_12 = __pyx_v_n_maxes;
      __pyx_t_13 = -1;
      if (__pyx_t_12 &lt; 0) {
        __pyx_t_12 += __pyx_pybuffernd_maxinds.diminfo[0].shape;
        if (unlikely(__pyx_t_12 &lt; 0)) __pyx_t_13 = 0;
      } else if (unlikely(__pyx_t_12 &gt;= __pyx_pybuffernd_maxinds.diminfo[0].shape)) __pyx_t_13 = 0;
      if (unlikely(__pyx_t_13 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_13);
        <span class='error_goto'>__PYX_ERR(0, 605, __pyx_L1_error)</span>
      }
      *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_uint32_t *, __pyx_pybuffernd_maxinds.rcbuffer-&gt;pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_maxinds.diminfo[0].strides) = __pyx_v_vert_ind;
</pre><pre class="cython line score-2" onclick='toggleDiv(this)'>+<span class="">606</span>:             maxes[n_maxes] = val</pre>
<pre class='cython code score-2 '>      __pyx_t_14 = __pyx_v_n_maxes;
      __pyx_t_13 = -1;
      if (__pyx_t_14 &lt; 0) {
        __pyx_t_14 += __pyx_pybuffernd_maxes.diminfo[0].shape;
        if (unlikely(__pyx_t_14 &lt; 0)) __pyx_t_13 = 0;
      } else if (unlikely(__pyx_t_14 &gt;= __pyx_pybuffernd_maxes.diminfo[0].shape)) __pyx_t_13 = 0;
      if (unlikely(__pyx_t_13 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_13);
        <span class='error_goto'>__PYX_ERR(0, 606, __pyx_L1_error)</span>
      }
      *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_maxes.rcbuffer-&gt;pybuffer.buf, __pyx_t_14, __pyx_pybuffernd_maxes.diminfo[0].strides) = __pyx_v_val;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">607</span>:             n_maxes +=1</pre>
<pre class='cython code score-0 '>      __pyx_v_n_maxes = (__pyx_v_n_maxes + 1);
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">608</span>:         adj_ptr += C</pre>
<pre class='cython code score-0 '>    __pyx_v_adj_ptr = (__pyx_v_adj_ptr + __pyx_v_C);
  }
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">609</span>:     if n_maxes == 0:</pre>
<pre class='cython code score-0 '>  __pyx_t_7 = ((__pyx_v_n_maxes == 0) != 0);
  if (__pyx_t_7) {
/* … */
  }
</pre><pre class="cython line score-50" onclick='toggleDiv(this)'>+<span class="">610</span>:         return np.array([])</pre>
<pre class='cython code score-50 '>    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 610, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_array);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 610, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = <span class='py_c_api'>PyList_New</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 610, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    __pyx_t_15 = NULL;
    if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
      __pyx_t_15 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
      if (likely(__pyx_t_15)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_15);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
      }
    }
    if (!__pyx_t_15) {
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_3, __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 610, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    } else {
      #if CYTHON_FAST_PYCALL
      if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_3)) {
        PyObject *__pyx_temp[2] = {__pyx_t_15, __pyx_t_2};
        __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_3, __pyx_temp+1-1, 1+1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 610, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_15); __pyx_t_15 = 0;
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      } else
      #endif
      #if CYTHON_FAST_PYCCALL
      if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_3)) {
        PyObject *__pyx_temp[2] = {__pyx_t_15, __pyx_t_2};
        __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_3, __pyx_temp+1-1, 1+1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 610, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_15); __pyx_t_15 = 0;
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      } else
      #endif
      {
        __pyx_t_16 = <span class='py_c_api'>PyTuple_New</span>(1+1);<span class='error_goto'> if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 610, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_16);
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_15); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_16, 0, __pyx_t_15); __pyx_t_15 = NULL;
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
        <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_16, 0+1, __pyx_t_2);
        __pyx_t_2 = 0;
        __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_3, __pyx_t_16, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 610, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_16); __pyx_t_16 = 0;
      }
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_r = __pyx_t_1;
    __pyx_t_1 = 0;
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">611</span>:     # fancy indexing always produces a copy</pre>
<pre class="cython line score-61" onclick='toggleDiv(this)'>+<span class="">612</span>:     return maxinds[argsort(maxes[:n_maxes])]</pre>
<pre class='cython code score-61 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_From_Py_intptr_t</span>(__pyx_v_n_maxes);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 612, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_16 = <span class='py_c_api'>PySlice_New</span>(Py_None, __pyx_t_3, Py_None);<span class='error_goto'> if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 612, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_16);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = <span class='py_c_api'>PyObject_GetItem</span>(((PyObject *)__pyx_v_maxes), __pyx_t_16);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 612, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_16); __pyx_t_16 = 0;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_4dipy_7reconst_8recspeed_argsort);
  __pyx_t_16 = __pyx_v_4dipy_7reconst_8recspeed_argsort; __pyx_t_2 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_16))) {
    __pyx_t_2 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_16);
    if (likely(__pyx_t_2)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_16);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_16, function);
    }
  }
  if (!__pyx_t_2) {
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_16, __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 612, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  } else {
    #if CYTHON_FAST_PYCALL
    if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_16)) {
      PyObject *__pyx_temp[2] = {__pyx_t_2, __pyx_t_3};
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_16, __pyx_temp+1-1, 1+1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 612, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_16)) {
      PyObject *__pyx_temp[2] = {__pyx_t_2, __pyx_t_3};
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_16, __pyx_temp+1-1, 1+1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 612, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    } else
    #endif
    {
      __pyx_t_15 = <span class='py_c_api'>PyTuple_New</span>(1+1);<span class='error_goto'> if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 612, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_15, 0, __pyx_t_2); __pyx_t_2 = NULL;
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_15, 0+1, __pyx_t_3);
      __pyx_t_3 = 0;
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_16, __pyx_t_15, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 612, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_15); __pyx_t_15 = 0;
    }
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_16); __pyx_t_16 = 0;
  __pyx_t_16 = <span class='py_c_api'>PyObject_GetItem</span>(((PyObject *)__pyx_v_maxinds), __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 612, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_16);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_r = __pyx_t_16;
  __pyx_t_16 = 0;
  goto __pyx_L0;
</pre></div></body></html>
