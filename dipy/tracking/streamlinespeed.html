<!DOCTYPE html>
<!-- Generated by Cython 0.27.3 -->
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Cython: streamlinespeed.pyx</title>
    <style type="text/css">
    
body.cython { font-family: courier; font-size: 12; }

.cython.tag  {  }
.cython.line { margin: 0em }
.cython.code { font-size: 9; color: #444444; display: none; margin: 0px 0px 0px 8px; border-left: 8px none; }

.cython.line .run { background-color: #B0FFB0; }
.cython.line .mis { background-color: #FFB0B0; }
.cython.code.run  { border-left: 8px solid #B0FFB0; }
.cython.code.mis  { border-left: 8px solid #FFB0B0; }

.cython.code .py_c_api  { color: red; }
.cython.code .py_macro_api  { color: #FF7000; }
.cython.code .pyx_c_api  { color: #FF3000; }
.cython.code .pyx_macro_api  { color: #FF7000; }
.cython.code .refnanny  { color: #FFA000; }
.cython.code .trace  { color: #FFA000; }
.cython.code .error_goto  { color: #FFA000; }

.cython.code .coerce  { color: #008000; border: 1px dotted #008000 }
.cython.code .py_attr { color: #FF0000; font-weight: bold; }
.cython.code .c_attr  { color: #0000FF; }
.cython.code .py_call { color: #FF0000; font-weight: bold; }
.cython.code .c_call  { color: #0000FF; }

.cython.score-0 {background-color: #FFFFff;}
.cython.score-1 {background-color: #FFFFe7;}
.cython.score-2 {background-color: #FFFFd4;}
.cython.score-3 {background-color: #FFFFc4;}
.cython.score-4 {background-color: #FFFFb6;}
.cython.score-5 {background-color: #FFFFaa;}
.cython.score-6 {background-color: #FFFF9f;}
.cython.score-7 {background-color: #FFFF96;}
.cython.score-8 {background-color: #FFFF8d;}
.cython.score-9 {background-color: #FFFF86;}
.cython.score-10 {background-color: #FFFF7f;}
.cython.score-11 {background-color: #FFFF79;}
.cython.score-12 {background-color: #FFFF73;}
.cython.score-13 {background-color: #FFFF6e;}
.cython.score-14 {background-color: #FFFF6a;}
.cython.score-15 {background-color: #FFFF66;}
.cython.score-16 {background-color: #FFFF62;}
.cython.score-17 {background-color: #FFFF5e;}
.cython.score-18 {background-color: #FFFF5b;}
.cython.score-19 {background-color: #FFFF57;}
.cython.score-20 {background-color: #FFFF55;}
.cython.score-21 {background-color: #FFFF52;}
.cython.score-22 {background-color: #FFFF4f;}
.cython.score-23 {background-color: #FFFF4d;}
.cython.score-24 {background-color: #FFFF4b;}
.cython.score-25 {background-color: #FFFF48;}
.cython.score-26 {background-color: #FFFF46;}
.cython.score-27 {background-color: #FFFF44;}
.cython.score-28 {background-color: #FFFF43;}
.cython.score-29 {background-color: #FFFF41;}
.cython.score-30 {background-color: #FFFF3f;}
.cython.score-31 {background-color: #FFFF3e;}
.cython.score-32 {background-color: #FFFF3c;}
.cython.score-33 {background-color: #FFFF3b;}
.cython.score-34 {background-color: #FFFF39;}
.cython.score-35 {background-color: #FFFF38;}
.cython.score-36 {background-color: #FFFF37;}
.cython.score-37 {background-color: #FFFF36;}
.cython.score-38 {background-color: #FFFF35;}
.cython.score-39 {background-color: #FFFF34;}
.cython.score-40 {background-color: #FFFF33;}
.cython.score-41 {background-color: #FFFF32;}
.cython.score-42 {background-color: #FFFF31;}
.cython.score-43 {background-color: #FFFF30;}
.cython.score-44 {background-color: #FFFF2f;}
.cython.score-45 {background-color: #FFFF2e;}
.cython.score-46 {background-color: #FFFF2d;}
.cython.score-47 {background-color: #FFFF2c;}
.cython.score-48 {background-color: #FFFF2b;}
.cython.score-49 {background-color: #FFFF2b;}
.cython.score-50 {background-color: #FFFF2a;}
.cython.score-51 {background-color: #FFFF29;}
.cython.score-52 {background-color: #FFFF29;}
.cython.score-53 {background-color: #FFFF28;}
.cython.score-54 {background-color: #FFFF27;}
.cython.score-55 {background-color: #FFFF27;}
.cython.score-56 {background-color: #FFFF26;}
.cython.score-57 {background-color: #FFFF26;}
.cython.score-58 {background-color: #FFFF25;}
.cython.score-59 {background-color: #FFFF24;}
.cython.score-60 {background-color: #FFFF24;}
.cython.score-61 {background-color: #FFFF23;}
.cython.score-62 {background-color: #FFFF23;}
.cython.score-63 {background-color: #FFFF22;}
.cython.score-64 {background-color: #FFFF22;}
.cython.score-65 {background-color: #FFFF22;}
.cython.score-66 {background-color: #FFFF21;}
.cython.score-67 {background-color: #FFFF21;}
.cython.score-68 {background-color: #FFFF20;}
.cython.score-69 {background-color: #FFFF20;}
.cython.score-70 {background-color: #FFFF1f;}
.cython.score-71 {background-color: #FFFF1f;}
.cython.score-72 {background-color: #FFFF1f;}
.cython.score-73 {background-color: #FFFF1e;}
.cython.score-74 {background-color: #FFFF1e;}
.cython.score-75 {background-color: #FFFF1e;}
.cython.score-76 {background-color: #FFFF1d;}
.cython.score-77 {background-color: #FFFF1d;}
.cython.score-78 {background-color: #FFFF1c;}
.cython.score-79 {background-color: #FFFF1c;}
.cython.score-80 {background-color: #FFFF1c;}
.cython.score-81 {background-color: #FFFF1c;}
.cython.score-82 {background-color: #FFFF1b;}
.cython.score-83 {background-color: #FFFF1b;}
.cython.score-84 {background-color: #FFFF1b;}
.cython.score-85 {background-color: #FFFF1a;}
.cython.score-86 {background-color: #FFFF1a;}
.cython.score-87 {background-color: #FFFF1a;}
.cython.score-88 {background-color: #FFFF1a;}
.cython.score-89 {background-color: #FFFF19;}
.cython.score-90 {background-color: #FFFF19;}
.cython.score-91 {background-color: #FFFF19;}
.cython.score-92 {background-color: #FFFF19;}
.cython.score-93 {background-color: #FFFF18;}
.cython.score-94 {background-color: #FFFF18;}
.cython.score-95 {background-color: #FFFF18;}
.cython.score-96 {background-color: #FFFF18;}
.cython.score-97 {background-color: #FFFF17;}
.cython.score-98 {background-color: #FFFF17;}
.cython.score-99 {background-color: #FFFF17;}
.cython.score-100 {background-color: #FFFF17;}
.cython.score-101 {background-color: #FFFF16;}
.cython.score-102 {background-color: #FFFF16;}
.cython.score-103 {background-color: #FFFF16;}
.cython.score-104 {background-color: #FFFF16;}
.cython.score-105 {background-color: #FFFF16;}
.cython.score-106 {background-color: #FFFF15;}
.cython.score-107 {background-color: #FFFF15;}
.cython.score-108 {background-color: #FFFF15;}
.cython.score-109 {background-color: #FFFF15;}
.cython.score-110 {background-color: #FFFF15;}
.cython.score-111 {background-color: #FFFF15;}
.cython.score-112 {background-color: #FFFF14;}
.cython.score-113 {background-color: #FFFF14;}
.cython.score-114 {background-color: #FFFF14;}
.cython.score-115 {background-color: #FFFF14;}
.cython.score-116 {background-color: #FFFF14;}
.cython.score-117 {background-color: #FFFF14;}
.cython.score-118 {background-color: #FFFF13;}
.cython.score-119 {background-color: #FFFF13;}
.cython.score-120 {background-color: #FFFF13;}
.cython.score-121 {background-color: #FFFF13;}
.cython.score-122 {background-color: #FFFF13;}
.cython.score-123 {background-color: #FFFF13;}
.cython.score-124 {background-color: #FFFF13;}
.cython.score-125 {background-color: #FFFF12;}
.cython.score-126 {background-color: #FFFF12;}
.cython.score-127 {background-color: #FFFF12;}
.cython.score-128 {background-color: #FFFF12;}
.cython.score-129 {background-color: #FFFF12;}
.cython.score-130 {background-color: #FFFF12;}
.cython.score-131 {background-color: #FFFF12;}
.cython.score-132 {background-color: #FFFF11;}
.cython.score-133 {background-color: #FFFF11;}
.cython.score-134 {background-color: #FFFF11;}
.cython.score-135 {background-color: #FFFF11;}
.cython.score-136 {background-color: #FFFF11;}
.cython.score-137 {background-color: #FFFF11;}
.cython.score-138 {background-color: #FFFF11;}
.cython.score-139 {background-color: #FFFF11;}
.cython.score-140 {background-color: #FFFF11;}
.cython.score-141 {background-color: #FFFF10;}
.cython.score-142 {background-color: #FFFF10;}
.cython.score-143 {background-color: #FFFF10;}
.cython.score-144 {background-color: #FFFF10;}
.cython.score-145 {background-color: #FFFF10;}
.cython.score-146 {background-color: #FFFF10;}
.cython.score-147 {background-color: #FFFF10;}
.cython.score-148 {background-color: #FFFF10;}
.cython.score-149 {background-color: #FFFF10;}
.cython.score-150 {background-color: #FFFF0f;}
.cython.score-151 {background-color: #FFFF0f;}
.cython.score-152 {background-color: #FFFF0f;}
.cython.score-153 {background-color: #FFFF0f;}
.cython.score-154 {background-color: #FFFF0f;}
.cython.score-155 {background-color: #FFFF0f;}
.cython.score-156 {background-color: #FFFF0f;}
.cython.score-157 {background-color: #FFFF0f;}
.cython.score-158 {background-color: #FFFF0f;}
.cython.score-159 {background-color: #FFFF0f;}
.cython.score-160 {background-color: #FFFF0f;}
.cython.score-161 {background-color: #FFFF0e;}
.cython.score-162 {background-color: #FFFF0e;}
.cython.score-163 {background-color: #FFFF0e;}
.cython.score-164 {background-color: #FFFF0e;}
.cython.score-165 {background-color: #FFFF0e;}
.cython.score-166 {background-color: #FFFF0e;}
.cython.score-167 {background-color: #FFFF0e;}
.cython.score-168 {background-color: #FFFF0e;}
.cython.score-169 {background-color: #FFFF0e;}
.cython.score-170 {background-color: #FFFF0e;}
.cython.score-171 {background-color: #FFFF0e;}
.cython.score-172 {background-color: #FFFF0e;}
.cython.score-173 {background-color: #FFFF0d;}
.cython.score-174 {background-color: #FFFF0d;}
.cython.score-175 {background-color: #FFFF0d;}
.cython.score-176 {background-color: #FFFF0d;}
.cython.score-177 {background-color: #FFFF0d;}
.cython.score-178 {background-color: #FFFF0d;}
.cython.score-179 {background-color: #FFFF0d;}
.cython.score-180 {background-color: #FFFF0d;}
.cython.score-181 {background-color: #FFFF0d;}
.cython.score-182 {background-color: #FFFF0d;}
.cython.score-183 {background-color: #FFFF0d;}
.cython.score-184 {background-color: #FFFF0d;}
.cython.score-185 {background-color: #FFFF0d;}
.cython.score-186 {background-color: #FFFF0d;}
.cython.score-187 {background-color: #FFFF0c;}
.cython.score-188 {background-color: #FFFF0c;}
.cython.score-189 {background-color: #FFFF0c;}
.cython.score-190 {background-color: #FFFF0c;}
.cython.score-191 {background-color: #FFFF0c;}
.cython.score-192 {background-color: #FFFF0c;}
.cython.score-193 {background-color: #FFFF0c;}
.cython.score-194 {background-color: #FFFF0c;}
.cython.score-195 {background-color: #FFFF0c;}
.cython.score-196 {background-color: #FFFF0c;}
.cython.score-197 {background-color: #FFFF0c;}
.cython.score-198 {background-color: #FFFF0c;}
.cython.score-199 {background-color: #FFFF0c;}
.cython.score-200 {background-color: #FFFF0c;}
.cython.score-201 {background-color: #FFFF0c;}
.cython.score-202 {background-color: #FFFF0c;}
.cython.score-203 {background-color: #FFFF0b;}
.cython.score-204 {background-color: #FFFF0b;}
.cython.score-205 {background-color: #FFFF0b;}
.cython.score-206 {background-color: #FFFF0b;}
.cython.score-207 {background-color: #FFFF0b;}
.cython.score-208 {background-color: #FFFF0b;}
.cython.score-209 {background-color: #FFFF0b;}
.cython.score-210 {background-color: #FFFF0b;}
.cython.score-211 {background-color: #FFFF0b;}
.cython.score-212 {background-color: #FFFF0b;}
.cython.score-213 {background-color: #FFFF0b;}
.cython.score-214 {background-color: #FFFF0b;}
.cython.score-215 {background-color: #FFFF0b;}
.cython.score-216 {background-color: #FFFF0b;}
.cython.score-217 {background-color: #FFFF0b;}
.cython.score-218 {background-color: #FFFF0b;}
.cython.score-219 {background-color: #FFFF0b;}
.cython.score-220 {background-color: #FFFF0b;}
.cython.score-221 {background-color: #FFFF0b;}
.cython.score-222 {background-color: #FFFF0a;}
.cython.score-223 {background-color: #FFFF0a;}
.cython.score-224 {background-color: #FFFF0a;}
.cython.score-225 {background-color: #FFFF0a;}
.cython.score-226 {background-color: #FFFF0a;}
.cython.score-227 {background-color: #FFFF0a;}
.cython.score-228 {background-color: #FFFF0a;}
.cython.score-229 {background-color: #FFFF0a;}
.cython.score-230 {background-color: #FFFF0a;}
.cython.score-231 {background-color: #FFFF0a;}
.cython.score-232 {background-color: #FFFF0a;}
.cython.score-233 {background-color: #FFFF0a;}
.cython.score-234 {background-color: #FFFF0a;}
.cython.score-235 {background-color: #FFFF0a;}
.cython.score-236 {background-color: #FFFF0a;}
.cython.score-237 {background-color: #FFFF0a;}
.cython.score-238 {background-color: #FFFF0a;}
.cython.score-239 {background-color: #FFFF0a;}
.cython.score-240 {background-color: #FFFF0a;}
.cython.score-241 {background-color: #FFFF0a;}
.cython.score-242 {background-color: #FFFF0a;}
.cython.score-243 {background-color: #FFFF0a;}
.cython.score-244 {background-color: #FFFF0a;}
.cython.score-245 {background-color: #FFFF0a;}
.cython.score-246 {background-color: #FFFF09;}
.cython.score-247 {background-color: #FFFF09;}
.cython.score-248 {background-color: #FFFF09;}
.cython.score-249 {background-color: #FFFF09;}
.cython.score-250 {background-color: #FFFF09;}
.cython.score-251 {background-color: #FFFF09;}
.cython.score-252 {background-color: #FFFF09;}
.cython.score-253 {background-color: #FFFF09;}
.cython.score-254 {background-color: #FFFF09;}
    </style>
    <script>
    function toggleDiv(id) {
        theDiv = id.nextElementSibling
        if (theDiv.style.display != 'block') theDiv.style.display = 'block';
        else theDiv.style.display = 'none';
    }
    </script>
</head>
<body class="cython">
<p><span style="border-bottom: solid 1px grey;">Generated by Cython 0.27.3</span></p>
<p>
    <span style="background-color: #FFFF00">Yellow lines</span> hint at Python interaction.<br />
    Click on a line that starts with a "<code>+</code>" to see the C code that Cython generated for it.
</p>
<p>Raw output: <a href="streamlinespeed.c">streamlinespeed.c</a></p>
<div class="cython"><pre class="cython line score-23" onclick='toggleDiv(this)'>+<span class="">001</span>: # distutils: language = c</pre>
<pre class='cython code score-23 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_2, __pyx_kp_u_length_line_57, __pyx_kp_u_Euclidean_length_of_streamlines) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 1, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_2, __pyx_kp_u_set_number_of_points_line_268, __pyx_kp_u_Change_the_number_of_points_of) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 1, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_2, __pyx_kp_u_compress_streamlines_line_540, __pyx_kp_u_Compress_streamlines_by_lineari) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 1, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_test, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 1, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">002</span>: # cython: wraparound=False, cdivision=True, boundscheck=False</pre>
<pre class="cython line score-0">&#xA0;<span class="">003</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">004</span>: import cython</pre>
<pre class="cython line score-8" onclick='toggleDiv(this)'>+<span class="">005</span>: import numpy as np</pre>
<pre class='cython code score-8 '>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_numpy, 0, -1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_np, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 5, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">006</span>: from libc.math cimport sqrt</pre>
<pre class="cython line score-0">&#xA0;<span class="">007</span>: from libc.stdlib cimport malloc, free</pre>
<pre class="cython line score-0">&#xA0;<span class="">008</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">009</span>: cimport numpy as np</pre>
<pre class="cython line score-0">&#xA0;<span class="">010</span>: </pre>
<pre class="cython line score-19" onclick='toggleDiv(this)'>+<span class="">011</span>: from dipy.tracking import Streamlines</pre>
<pre class='cython code score-19 '>  __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 11, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_n_s_Streamlines);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_n_s_Streamlines);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_1, 0, __pyx_n_s_Streamlines);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_dipy_tracking, __pyx_t_1, -1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 11, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_ImportFrom</span>(__pyx_t_2, __pyx_n_s_Streamlines);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 11, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_Streamlines, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 11, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">012</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">013</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">014</span>: cdef extern from "dpy_math.h" nogil:</pre>
<pre class="cython line score-0">&#xA0;<span class="">015</span>:     bint dpy_isnan(double x)</pre>
<pre class="cython line score-0">&#xA0;<span class="">016</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">017</span>: </pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">018</span>: cdef double c_length(Streamline streamline) nogil:</pre>
<pre class='cython code score-0 '>static double __pyx_fuse_0__pyx_f_4dipy_8tracking_15streamlinespeed_c_length(__pyx_t_4dipy_8tracking_15streamlinespeed_float2d __pyx_v_streamline) {
  npy_intp __pyx_v_i;
  double __pyx_v_out;
  double __pyx_v_dn;
  double __pyx_v_sum_dn_sqr;
  Py_ssize_t __pyx_v_j;
  double __pyx_r;
/* … */
  /* function exit code */
  __pyx_L0:;
  return __pyx_r;
}

static double __pyx_fuse_1__pyx_f_4dipy_8tracking_15streamlinespeed_c_length(__pyx_t_4dipy_8tracking_15streamlinespeed_double2d __pyx_v_streamline) {
  npy_intp __pyx_v_i;
  double __pyx_v_out;
  double __pyx_v_dn;
  double __pyx_v_sum_dn_sqr;
  Py_ssize_t __pyx_v_j;
  double __pyx_r;
/* … */
  /* function exit code */
  __pyx_L0:;
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">019</span>:     cdef:</pre>
<pre class="cython line score-0">&#xA0;<span class="">020</span>:         np.npy_intp i</pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">021</span>:         double out = 0.0</pre>
<pre class='cython code score-0 '>  __pyx_v_out = 0.0;
/* … */
  __pyx_v_out = 0.0;
</pre><pre class="cython line score-0">&#xA0;<span class="">022</span>:         double dn, sum_dn_sqr</pre>
<pre class="cython line score-0">&#xA0;<span class="">023</span>: </pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">024</span>:     for i in range(1, streamline.shape[0]):</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = (__pyx_v_streamline.shape[0]);
  for (__pyx_t_2 = 1; __pyx_t_2 &lt; __pyx_t_1; __pyx_t_2+=1) {
    __pyx_v_i = __pyx_t_2;
/* … */
  __pyx_t_1 = (__pyx_v_streamline.shape[0]);
  for (__pyx_t_2 = 1; __pyx_t_2 &lt; __pyx_t_1; __pyx_t_2+=1) {
    __pyx_v_i = __pyx_t_2;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">025</span>:         sum_dn_sqr = 0.0</pre>
<pre class='cython code score-0 '>    __pyx_v_sum_dn_sqr = 0.0;
/* … */
    __pyx_v_sum_dn_sqr = 0.0;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">026</span>:         for j in range(streamline.shape[1]):</pre>
<pre class='cython code score-0 '>    __pyx_t_3 = (__pyx_v_streamline.shape[1]);
    for (__pyx_t_4 = 0; __pyx_t_4 &lt; __pyx_t_3; __pyx_t_4+=1) {
      __pyx_v_j = __pyx_t_4;
/* … */
    __pyx_t_3 = (__pyx_v_streamline.shape[1]);
    for (__pyx_t_4 = 0; __pyx_t_4 &lt; __pyx_t_3; __pyx_t_4+=1) {
      __pyx_v_j = __pyx_t_4;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">027</span>:             dn = streamline[i, j] - streamline[i-1, j]</pre>
<pre class='cython code score-0 '>      __pyx_t_5 = __pyx_v_i;
      __pyx_t_6 = __pyx_v_j;
      __pyx_t_7 = (__pyx_v_i - 1);
      __pyx_t_8 = __pyx_v_j;
      __pyx_v_dn = ((*((float *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_streamline.data + __pyx_t_5 * __pyx_v_streamline.strides[0]) ) + __pyx_t_6 * __pyx_v_streamline.strides[1]) ))) - (*((float *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_streamline.data + __pyx_t_7 * __pyx_v_streamline.strides[0]) ) + __pyx_t_8 * __pyx_v_streamline.strides[1]) ))));
/* … */
      __pyx_t_5 = __pyx_v_i;
      __pyx_t_6 = __pyx_v_j;
      __pyx_t_7 = (__pyx_v_i - 1);
      __pyx_t_8 = __pyx_v_j;
      __pyx_v_dn = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_streamline.data + __pyx_t_5 * __pyx_v_streamline.strides[0]) ) + __pyx_t_6 * __pyx_v_streamline.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_streamline.data + __pyx_t_7 * __pyx_v_streamline.strides[0]) ) + __pyx_t_8 * __pyx_v_streamline.strides[1]) ))));
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">028</span>:             sum_dn_sqr += dn*dn</pre>
<pre class='cython code score-0 '>      __pyx_v_sum_dn_sqr = (__pyx_v_sum_dn_sqr + (__pyx_v_dn * __pyx_v_dn));
    }
/* … */
      __pyx_v_sum_dn_sqr = (__pyx_v_sum_dn_sqr + (__pyx_v_dn * __pyx_v_dn));
    }
</pre><pre class="cython line score-0">&#xA0;<span class="">029</span>: </pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">030</span>:         out += sqrt(sum_dn_sqr)</pre>
<pre class='cython code score-0 '>    __pyx_v_out = (__pyx_v_out + sqrt(__pyx_v_sum_dn_sqr));
  }
/* … */
    __pyx_v_out = (__pyx_v_out + sqrt(__pyx_v_sum_dn_sqr));
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">031</span>: </pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">032</span>:     return out</pre>
<pre class='cython code score-0 '>  __pyx_r = __pyx_v_out;
  goto __pyx_L0;
/* … */
  __pyx_r = __pyx_v_out;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">033</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">034</span>: </pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">035</span>: cdef void c_arclengths_from_arraysequence(Streamline points,</pre>
<pre class='cython code score-0 '>static void __pyx_fuse_0__pyx_f_4dipy_8tracking_15streamlinespeed_c_arclengths_from_arraysequence(__pyx_t_4dipy_8tracking_15streamlinespeed_float2d __pyx_v_points, __Pyx_memviewslice __pyx_v_offsets, __Pyx_memviewslice __pyx_v_lengths, __Pyx_memviewslice __pyx_v_arclengths) {
  npy_intp __pyx_v_i;
  npy_intp __pyx_v_j;
  npy_intp __pyx_v_k;
  npy_intp __pyx_v_offset;
  double __pyx_v_dn;
  double __pyx_v_sum_dn_sqr;
/* … */
  /* function exit code */
}

static void __pyx_fuse_1__pyx_f_4dipy_8tracking_15streamlinespeed_c_arclengths_from_arraysequence(__pyx_t_4dipy_8tracking_15streamlinespeed_double2d __pyx_v_points, __Pyx_memviewslice __pyx_v_offsets, __Pyx_memviewslice __pyx_v_lengths, __Pyx_memviewslice __pyx_v_arclengths) {
  npy_intp __pyx_v_i;
  npy_intp __pyx_v_j;
  npy_intp __pyx_v_k;
  npy_intp __pyx_v_offset;
  double __pyx_v_dn;
  double __pyx_v_sum_dn_sqr;
/* … */
  /* function exit code */
}
</pre><pre class="cython line score-0">&#xA0;<span class="">036</span>:                                           np.npy_intp[:] offsets,</pre>
<pre class="cython line score-0">&#xA0;<span class="">037</span>:                                           np.npy_intp[:] lengths,</pre>
<pre class="cython line score-0">&#xA0;<span class="">038</span>:                                           double[:] arclengths) nogil:</pre>
<pre class="cython line score-0">&#xA0;<span class="">039</span>:     cdef:</pre>
<pre class="cython line score-0">&#xA0;<span class="">040</span>:         np.npy_intp i, j, k</pre>
<pre class="cython line score-0">&#xA0;<span class="">041</span>:         np.npy_intp offset</pre>
<pre class="cython line score-0">&#xA0;<span class="">042</span>:         double dn, sum_dn_sqr</pre>
<pre class="cython line score-0">&#xA0;<span class="">043</span>: </pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">044</span>:     for i in range(offsets.shape[0]):</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = (__pyx_v_offsets.shape[0]);
  for (__pyx_t_2 = 0; __pyx_t_2 &lt; __pyx_t_1; __pyx_t_2+=1) {
    __pyx_v_i = __pyx_t_2;
/* … */
  __pyx_t_1 = (__pyx_v_offsets.shape[0]);
  for (__pyx_t_2 = 0; __pyx_t_2 &lt; __pyx_t_1; __pyx_t_2+=1) {
    __pyx_v_i = __pyx_t_2;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">045</span>:         offset = offsets[i]</pre>
<pre class='cython code score-0 '>    __pyx_t_3 = __pyx_v_i;
    __pyx_v_offset = (*((npy_intp *) ( /* dim=0 */ (__pyx_v_offsets.data + __pyx_t_3 * __pyx_v_offsets.strides[0]) )));
/* … */
    __pyx_t_3 = __pyx_v_i;
    __pyx_v_offset = (*((npy_intp *) ( /* dim=0 */ (__pyx_v_offsets.data + __pyx_t_3 * __pyx_v_offsets.strides[0]) )));
</pre><pre class="cython line score-0">&#xA0;<span class="">046</span>: </pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">047</span>:         arclengths[i] = 0</pre>
<pre class='cython code score-0 '>    __pyx_t_4 = __pyx_v_i;
    *((double *) ( /* dim=0 */ (__pyx_v_arclengths.data + __pyx_t_4 * __pyx_v_arclengths.strides[0]) )) = 0.0;
/* … */
    __pyx_t_4 = __pyx_v_i;
    *((double *) ( /* dim=0 */ (__pyx_v_arclengths.data + __pyx_t_4 * __pyx_v_arclengths.strides[0]) )) = 0.0;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">048</span>:         for j in range(1, lengths[i]):</pre>
<pre class='cython code score-0 '>    __pyx_t_5 = __pyx_v_i;
    __pyx_t_6 = (*((npy_intp *) ( /* dim=0 */ (__pyx_v_lengths.data + __pyx_t_5 * __pyx_v_lengths.strides[0]) )));
    for (__pyx_t_7 = 1; __pyx_t_7 &lt; __pyx_t_6; __pyx_t_7+=1) {
      __pyx_v_j = __pyx_t_7;
/* … */
    __pyx_t_5 = __pyx_v_i;
    __pyx_t_6 = (*((npy_intp *) ( /* dim=0 */ (__pyx_v_lengths.data + __pyx_t_5 * __pyx_v_lengths.strides[0]) )));
    for (__pyx_t_7 = 1; __pyx_t_7 &lt; __pyx_t_6; __pyx_t_7+=1) {
      __pyx_v_j = __pyx_t_7;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">049</span>:             sum_dn_sqr = 0.0</pre>
<pre class='cython code score-0 '>      __pyx_v_sum_dn_sqr = 0.0;
/* … */
      __pyx_v_sum_dn_sqr = 0.0;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">050</span>:             for k in range(points.shape[1]):</pre>
<pre class='cython code score-0 '>      __pyx_t_8 = (__pyx_v_points.shape[1]);
      for (__pyx_t_9 = 0; __pyx_t_9 &lt; __pyx_t_8; __pyx_t_9+=1) {
        __pyx_v_k = __pyx_t_9;
/* … */
      __pyx_t_8 = (__pyx_v_points.shape[1]);
      for (__pyx_t_9 = 0; __pyx_t_9 &lt; __pyx_t_8; __pyx_t_9+=1) {
        __pyx_v_k = __pyx_t_9;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">051</span>:                 dn = points[offset+j, k] - points[offset+j-1, k]</pre>
<pre class='cython code score-0 '>        __pyx_t_10 = (__pyx_v_offset + __pyx_v_j);
        __pyx_t_11 = __pyx_v_k;
        __pyx_t_12 = ((__pyx_v_offset + __pyx_v_j) - 1);
        __pyx_t_13 = __pyx_v_k;
        __pyx_v_dn = ((*((float *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_points.data + __pyx_t_10 * __pyx_v_points.strides[0]) ) + __pyx_t_11 * __pyx_v_points.strides[1]) ))) - (*((float *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_points.data + __pyx_t_12 * __pyx_v_points.strides[0]) ) + __pyx_t_13 * __pyx_v_points.strides[1]) ))));
/* … */
        __pyx_t_10 = (__pyx_v_offset + __pyx_v_j);
        __pyx_t_11 = __pyx_v_k;
        __pyx_t_12 = ((__pyx_v_offset + __pyx_v_j) - 1);
        __pyx_t_13 = __pyx_v_k;
        __pyx_v_dn = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_points.data + __pyx_t_10 * __pyx_v_points.strides[0]) ) + __pyx_t_11 * __pyx_v_points.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_points.data + __pyx_t_12 * __pyx_v_points.strides[0]) ) + __pyx_t_13 * __pyx_v_points.strides[1]) ))));
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">052</span>:                 sum_dn_sqr += dn*dn</pre>
<pre class='cython code score-0 '>        __pyx_v_sum_dn_sqr = (__pyx_v_sum_dn_sqr + (__pyx_v_dn * __pyx_v_dn));
      }
/* … */
        __pyx_v_sum_dn_sqr = (__pyx_v_sum_dn_sqr + (__pyx_v_dn * __pyx_v_dn));
      }
</pre><pre class="cython line score-0">&#xA0;<span class="">053</span>: </pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">054</span>:             arclengths[i] += sqrt(sum_dn_sqr)</pre>
<pre class='cython code score-0 '>      __pyx_t_14 = __pyx_v_i;
      *((double *) ( /* dim=0 */ (__pyx_v_arclengths.data + __pyx_t_14 * __pyx_v_arclengths.strides[0]) )) += sqrt(__pyx_v_sum_dn_sqr);
    }
  }
/* … */
      __pyx_t_14 = __pyx_v_i;
      *((double *) ( /* dim=0 */ (__pyx_v_arclengths.data + __pyx_t_14 * __pyx_v_arclengths.strides[0]) )) += sqrt(__pyx_v_sum_dn_sqr);
    }
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">055</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">056</span>: </pre>
<pre class="cython line score-27" onclick='toggleDiv(this)'>+<span class="">057</span>: def length(streamlines):</pre>
<pre class='cython code score-27 '>/* Python wrapper */
static PyObject *__pyx_pw_4dipy_8tracking_15streamlinespeed_1length(PyObject *__pyx_self, PyObject *__pyx_v_streamlines); /*proto*/
static char __pyx_doc_4dipy_8tracking_15streamlinespeed_length[] = " Euclidean length of streamlines\n\n    Length is in mm only if streamlines are expressed in world coordinates.\n\n    Parameters\n    ------------\n    streamlines : ndarray or a list or :class:`dipy.tracking.Streamlines`\n        If ndarray, must have shape (N,3) where N is the number of points\n        of the streamline.\n        If list, each item must be ndarray shape (Ni,3) where Ni is the number\n        of points of streamline i.\n        If :class:`dipy.tracking.Streamlines`, its `common_shape` must be 3.\n\n    Returns\n    ---------\n    lengths : scalar or ndarray shape (N,)\n       If there is only one streamline, a scalar representing the length of the\n       streamline.\n       If there are several streamlines, ndarray containing the length of every\n       streamline.\n\n    Examples\n    ----------\n    &gt;&gt;&gt; from dipy.tracking.streamline import length\n    &gt;&gt;&gt; import numpy as np\n    &gt;&gt;&gt; streamline = np.array([[1, 1, 1], [2, 3, 4], [0, 0, 0]])\n    &gt;&gt;&gt; expected_length = np.sqrt([1+2**2+3**2, 2**2+3**2+4**2]).sum()\n    &gt;&gt;&gt; length(streamline) == expected_length\n    True\n    &gt;&gt;&gt; streamlines = [streamline, np.vstack([streamline, streamline[::-1]])]\n    &gt;&gt;&gt; expected_lengths = [expected_length, 2*expected_length]\n    &gt;&gt;&gt; lengths = [length(streamlines[0]), length(streamlines[1])]\n    &gt;&gt;&gt; np.allclose(lengths, expected_lengths)\n    True\n    &gt;&gt;&gt; length([])\n    0.0\n    &gt;&gt;&gt; length(np.array([[1, 2, 3]]))\n    0.0\n\n    ";
static PyMethodDef __pyx_mdef_4dipy_8tracking_15streamlinespeed_1length = {"length", (PyCFunction)__pyx_pw_4dipy_8tracking_15streamlinespeed_1length, METH_O, __pyx_doc_4dipy_8tracking_15streamlinespeed_length};
static PyObject *__pyx_pw_4dipy_8tracking_15streamlinespeed_1length(PyObject *__pyx_self, PyObject *__pyx_v_streamlines) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("length (wrapper)", 0);
  __pyx_r = __pyx_pf_4dipy_8tracking_15streamlinespeed_length(__pyx_self, ((PyObject *)__pyx_v_streamlines));

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_4dipy_8tracking_15streamlinespeed_length(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_streamlines) {
  PyObject *__pyx_v_arclengths = NULL;
  int __pyx_v_only_one_streamlines;
  PyObject *__pyx_v_dtype = NULL;
  PyObject *__pyx_v_streamline = NULL;
  PyObject *__pyx_v_streamlines_length = NULL;
  npy_intp __pyx_v_i;
  PyObject *__pyx_v_is_integer = NULL;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("length", 0);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_streamlines);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_9, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_10, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_11, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_12, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_13, 1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("dipy.tracking.streamlinespeed.length", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_arclengths);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_dtype);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_streamline);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_streamlines_length);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_is_integer);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_streamlines);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__31 = <span class='py_c_api'>PyTuple_Pack</span>(8, __pyx_n_s_streamlines, __pyx_n_s_arclengths, __pyx_n_s_only_one_streamlines, __pyx_n_s_dtype, __pyx_n_s_streamline, __pyx_n_s_streamlines_length, __pyx_n_s_i, __pyx_n_s_is_integer);<span class='error_goto'> if (unlikely(!__pyx_tuple__31)) __PYX_ERR(0, 57, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__31);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__31);
/* … */
  __pyx_t_2 = PyCFunction_NewEx(&amp;__pyx_mdef_4dipy_8tracking_15streamlinespeed_1length, NULL, __pyx_n_s_dipy_tracking_streamlinespeed);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 57, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_length, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 57, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_codeobj__32 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(1, 0, 8, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__31, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_dipy_tracking_streamlinespeed_py, __pyx_n_s_length, 57, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__32)) __PYX_ERR(0, 57, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">058</span>:     ''' Euclidean length of streamlines</pre>
<pre class="cython line score-0">&#xA0;<span class="">059</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">060</span>:     Length is in mm only if streamlines are expressed in world coordinates.</pre>
<pre class="cython line score-0">&#xA0;<span class="">061</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">062</span>:     Parameters</pre>
<pre class="cython line score-0">&#xA0;<span class="">063</span>:     ------------</pre>
<pre class="cython line score-0">&#xA0;<span class="">064</span>:     streamlines : ndarray or a list or :class:`dipy.tracking.Streamlines`</pre>
<pre class="cython line score-0">&#xA0;<span class="">065</span>:         If ndarray, must have shape (N,3) where N is the number of points</pre>
<pre class="cython line score-0">&#xA0;<span class="">066</span>:         of the streamline.</pre>
<pre class="cython line score-0">&#xA0;<span class="">067</span>:         If list, each item must be ndarray shape (Ni,3) where Ni is the number</pre>
<pre class="cython line score-0">&#xA0;<span class="">068</span>:         of points of streamline i.</pre>
<pre class="cython line score-0">&#xA0;<span class="">069</span>:         If :class:`dipy.tracking.Streamlines`, its `common_shape` must be 3.</pre>
<pre class="cython line score-0">&#xA0;<span class="">070</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">071</span>:     Returns</pre>
<pre class="cython line score-0">&#xA0;<span class="">072</span>:     ---------</pre>
<pre class="cython line score-0">&#xA0;<span class="">073</span>:     lengths : scalar or ndarray shape (N,)</pre>
<pre class="cython line score-0">&#xA0;<span class="">074</span>:        If there is only one streamline, a scalar representing the length of the</pre>
<pre class="cython line score-0">&#xA0;<span class="">075</span>:        streamline.</pre>
<pre class="cython line score-0">&#xA0;<span class="">076</span>:        If there are several streamlines, ndarray containing the length of every</pre>
<pre class="cython line score-0">&#xA0;<span class="">077</span>:        streamline.</pre>
<pre class="cython line score-0">&#xA0;<span class="">078</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">079</span>:     Examples</pre>
<pre class="cython line score-0">&#xA0;<span class="">080</span>:     ----------</pre>
<pre class="cython line score-0">&#xA0;<span class="">081</span>:     &gt;&gt;&gt; from dipy.tracking.streamline import length</pre>
<pre class="cython line score-0">&#xA0;<span class="">082</span>:     &gt;&gt;&gt; import numpy as np</pre>
<pre class="cython line score-0">&#xA0;<span class="">083</span>:     &gt;&gt;&gt; streamline = np.array([[1, 1, 1], [2, 3, 4], [0, 0, 0]])</pre>
<pre class="cython line score-0">&#xA0;<span class="">084</span>:     &gt;&gt;&gt; expected_length = np.sqrt([1+2**2+3**2, 2**2+3**2+4**2]).sum()</pre>
<pre class="cython line score-0">&#xA0;<span class="">085</span>:     &gt;&gt;&gt; length(streamline) == expected_length</pre>
<pre class="cython line score-0">&#xA0;<span class="">086</span>:     True</pre>
<pre class="cython line score-0">&#xA0;<span class="">087</span>:     &gt;&gt;&gt; streamlines = [streamline, np.vstack([streamline, streamline[::-1]])]</pre>
<pre class="cython line score-0">&#xA0;<span class="">088</span>:     &gt;&gt;&gt; expected_lengths = [expected_length, 2*expected_length]</pre>
<pre class="cython line score-0">&#xA0;<span class="">089</span>:     &gt;&gt;&gt; lengths = [length(streamlines[0]), length(streamlines[1])]</pre>
<pre class="cython line score-0">&#xA0;<span class="">090</span>:     &gt;&gt;&gt; np.allclose(lengths, expected_lengths)</pre>
<pre class="cython line score-0">&#xA0;<span class="">091</span>:     True</pre>
<pre class="cython line score-0">&#xA0;<span class="">092</span>:     &gt;&gt;&gt; length([])</pre>
<pre class="cython line score-0">&#xA0;<span class="">093</span>:     0.0</pre>
<pre class="cython line score-0">&#xA0;<span class="">094</span>:     &gt;&gt;&gt; length(np.array([[1, 2, 3]]))</pre>
<pre class="cython line score-0">&#xA0;<span class="">095</span>:     0.0</pre>
<pre class="cython line score-0">&#xA0;<span class="">096</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">097</span>:     '''</pre>
<pre class="cython line score-8" onclick='toggleDiv(this)'>+<span class="">098</span>:     if isinstance(streamlines, Streamlines):</pre>
<pre class='cython code score-8 '>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_Streamlines);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 98, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyObject_IsInstance</span>(__pyx_v_streamlines, __pyx_t_1);<span class='error_goto'> if (unlikely(__pyx_t_2 == ((int)-1))) __PYX_ERR(0, 98, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_3 = (__pyx_t_2 != 0);
  if (__pyx_t_3) {
/* … */
  }
</pre><pre class="cython line score-5" onclick='toggleDiv(this)'>+<span class="">099</span>:         if len(streamlines) == 0:</pre>
<pre class='cython code score-5 '>    __pyx_t_4 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_streamlines);<span class='error_goto'> if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 99, __pyx_L1_error)</span>
    __pyx_t_3 = ((__pyx_t_4 == 0) != 0);
    if (__pyx_t_3) {
/* … */
    }
</pre><pre class="cython line score-2" onclick='toggleDiv(this)'>+<span class="">100</span>:             return 0.0</pre>
<pre class='cython code score-2 '>      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_float_0_0);
      __pyx_r = __pyx_float_0_0;
      goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">101</span>: </pre>
<pre class="cython line score-39" onclick='toggleDiv(this)'>+<span class="">102</span>:         arclengths = np.zeros(len(streamlines), dtype=np.float64)</pre>
<pre class='cython code score-39 '>    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 102, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_zeros);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 102, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_4 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_streamlines);<span class='error_goto'> if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 102, __pyx_L1_error)</span>
    __pyx_t_1 = <span class='py_c_api'>PyInt_FromSsize_t</span>(__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 102, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_6 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 102, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 0, __pyx_t_1);
    __pyx_t_1 = 0;
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 102, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_7 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 102, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_7, __pyx_n_s_float64);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 102, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_8) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 102, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_5, __pyx_t_6, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 102, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_v_arclengths = __pyx_t_8;
    __pyx_t_8 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">103</span>: </pre>
<pre class="cython line score-20" onclick='toggleDiv(this)'>+<span class="">104</span>:         if streamlines.data.dtype == np.float32:</pre>
<pre class='cython code score-20 '>    __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_streamlines, __pyx_n_s_data);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 104, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_8, __pyx_n_s_dtype);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 104, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    __pyx_t_8 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 104, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_8, __pyx_n_s_float32);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 104, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    __pyx_t_8 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_t_1, __pyx_t_6, Py_EQ); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_8);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 104, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_8); if (unlikely(__pyx_t_3 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 104, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    if (__pyx_t_3) {
/* … */
      goto __pyx_L5;
    }
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">105</span>:             c_arclengths_from_arraysequence[float2d](</pre>
<pre class='cython code score-0 '>      __pyx_fuse_0__pyx_f_4dipy_8tracking_15streamlinespeed_c_arclengths_from_arraysequence(__pyx_t_9, __pyx_t_10, __pyx_t_11, __pyx_t_12);
      __PYX_XDEC_MEMVIEW(&amp;__pyx_t_9, 1);
      __pyx_t_9.memview = NULL;
      __pyx_t_9.data = NULL;
      __PYX_XDEC_MEMVIEW(&amp;__pyx_t_10, 1);
      __pyx_t_10.memview = NULL;
      __pyx_t_10.data = NULL;
      __PYX_XDEC_MEMVIEW(&amp;__pyx_t_11, 1);
      __pyx_t_11.memview = NULL;
      __pyx_t_11.data = NULL;
      __PYX_XDEC_MEMVIEW(&amp;__pyx_t_12, 1);
      __pyx_t_12.memview = NULL;
      __pyx_t_12.data = NULL;
</pre><pre class="cython line score-5" onclick='toggleDiv(this)'>+<span class="">106</span>:                                     streamlines.data,</pre>
<pre class='cython code score-5 '>      __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_streamlines, __pyx_n_s_data);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 106, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
      __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_float</span>(__pyx_t_8);
      if (unlikely(!__pyx_t_9.memview)) <span class='error_goto'>__PYX_ERR(0, 106, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
</pre><pre class="cython line score-52" onclick='toggleDiv(this)'>+<span class="">107</span>:                                     streamlines._offsets.astype(np.intp),</pre>
<pre class='cython code score-52 '>      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_streamlines, __pyx_n_s_offsets);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 107, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_6, __pyx_n_s_astype);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 107, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 107, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_6, __pyx_n_s_intp);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 107, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_6 = NULL;
      if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_1))) {
        __pyx_t_6 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_1);
        if (likely(__pyx_t_6)) {
          PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_1);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_6);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
          <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_1, function);
        }
      }
      if (!__pyx_t_6) {
        __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_1, __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 107, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
      } else {
        #if CYTHON_FAST_PYCALL
        if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_1)) {
          PyObject *__pyx_temp[2] = {__pyx_t_6, __pyx_t_5};
          __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_1, __pyx_temp+1-1, 1+1);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 107, __pyx_L1_error)</span>
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
        } else
        #endif
        #if CYTHON_FAST_PYCCALL
        if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_1)) {
          PyObject *__pyx_temp[2] = {__pyx_t_6, __pyx_t_5};
          __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_1, __pyx_temp+1-1, 1+1);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 107, __pyx_L1_error)</span>
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
        } else
        #endif
        {
          __pyx_t_7 = <span class='py_c_api'>PyTuple_New</span>(1+1);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 107, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 0, __pyx_t_6); __pyx_t_6 = NULL;
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 0+1, __pyx_t_5);
          __pyx_t_5 = 0;
          __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_1, __pyx_t_7, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 107, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
        }
      }
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_nn_npy_intp</span>(__pyx_t_8);
      if (unlikely(!__pyx_t_10.memview)) <span class='error_goto'>__PYX_ERR(0, 107, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
</pre><pre class="cython line score-52" onclick='toggleDiv(this)'>+<span class="">108</span>:                                     streamlines._lengths.astype(np.intp),</pre>
<pre class='cython code score-52 '>      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_streamlines, __pyx_n_s_lengths);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 108, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_astype);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 108, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 108, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_intp);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 108, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = NULL;
      if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_7))) {
        __pyx_t_1 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_7);
        if (likely(__pyx_t_1)) {
          PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_7);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
          <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_7, function);
        }
      }
      if (!__pyx_t_1) {
        __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_7, __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 108, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
      } else {
        #if CYTHON_FAST_PYCALL
        if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_7)) {
          PyObject *__pyx_temp[2] = {__pyx_t_1, __pyx_t_5};
          __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_7, __pyx_temp+1-1, 1+1);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 108, __pyx_L1_error)</span>
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
        } else
        #endif
        #if CYTHON_FAST_PYCCALL
        if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_7)) {
          PyObject *__pyx_temp[2] = {__pyx_t_1, __pyx_t_5};
          __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_7, __pyx_temp+1-1, 1+1);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 108, __pyx_L1_error)</span>
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
        } else
        #endif
        {
          __pyx_t_6 = <span class='py_c_api'>PyTuple_New</span>(1+1);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 108, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 0, __pyx_t_1); __pyx_t_1 = NULL;
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 0+1, __pyx_t_5);
          __pyx_t_5 = 0;
          __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_7, __pyx_t_6, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 108, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
        }
      }
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_nn_npy_intp</span>(__pyx_t_8);
      if (unlikely(!__pyx_t_11.memview)) <span class='error_goto'>__PYX_ERR(0, 108, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
</pre><pre class="cython line score-2" onclick='toggleDiv(this)'>+<span class="">109</span>:                                     arclengths)</pre>
<pre class='cython code score-2 '>      __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(__pyx_v_arclengths);
      if (unlikely(!__pyx_t_12.memview)) <span class='error_goto'>__PYX_ERR(0, 109, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">110</span>:         else:</pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">111</span>:             c_arclengths_from_arraysequence[double2d](</pre>
<pre class='cython code score-0 '>    /*else*/ {
/* … */
      __pyx_fuse_1__pyx_f_4dipy_8tracking_15streamlinespeed_c_arclengths_from_arraysequence(__pyx_t_13, __pyx_t_11, __pyx_t_10, __pyx_t_12);
      __PYX_XDEC_MEMVIEW(&amp;__pyx_t_13, 1);
      __pyx_t_13.memview = NULL;
      __pyx_t_13.data = NULL;
      __PYX_XDEC_MEMVIEW(&amp;__pyx_t_11, 1);
      __pyx_t_11.memview = NULL;
      __pyx_t_11.data = NULL;
      __PYX_XDEC_MEMVIEW(&amp;__pyx_t_10, 1);
      __pyx_t_10.memview = NULL;
      __pyx_t_10.data = NULL;
      __PYX_XDEC_MEMVIEW(&amp;__pyx_t_12, 1);
      __pyx_t_12.memview = NULL;
      __pyx_t_12.data = NULL;
    }
    __pyx_L5:;
</pre><pre class="cython line score-5" onclick='toggleDiv(this)'>+<span class="">112</span>:                                       streamlines.data,</pre>
<pre class='cython code score-5 '>      __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_streamlines, __pyx_n_s_data);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 112, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
      __pyx_t_13 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(__pyx_t_8);
      if (unlikely(!__pyx_t_13.memview)) <span class='error_goto'>__PYX_ERR(0, 112, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
</pre><pre class="cython line score-52" onclick='toggleDiv(this)'>+<span class="">113</span>:                                       streamlines._offsets.astype(np.intp),</pre>
<pre class='cython code score-52 '>      __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_streamlines, __pyx_n_s_offsets);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 113, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_7, __pyx_n_s_astype);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 113, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_t_7 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 113, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_7, __pyx_n_s_intp);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 113, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_t_7 = NULL;
      if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_6))) {
        __pyx_t_7 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_6);
        if (likely(__pyx_t_7)) {
          PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_6);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_7);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
          <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_6, function);
        }
      }
      if (!__pyx_t_7) {
        __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_6, __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 113, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
      } else {
        #if CYTHON_FAST_PYCALL
        if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_6)) {
          PyObject *__pyx_temp[2] = {__pyx_t_7, __pyx_t_5};
          __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_6, __pyx_temp+1-1, 1+1);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 113, __pyx_L1_error)</span>
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
        } else
        #endif
        #if CYTHON_FAST_PYCCALL
        if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_6)) {
          PyObject *__pyx_temp[2] = {__pyx_t_7, __pyx_t_5};
          __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_6, __pyx_temp+1-1, 1+1);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 113, __pyx_L1_error)</span>
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
        } else
        #endif
        {
          __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1+1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 113, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_7); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_t_7); __pyx_t_7 = NULL;
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0+1, __pyx_t_5);
          __pyx_t_5 = 0;
          __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_6, __pyx_t_1, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 113, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
        }
      }
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_nn_npy_intp</span>(__pyx_t_8);
      if (unlikely(!__pyx_t_11.memview)) <span class='error_goto'>__PYX_ERR(0, 113, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
</pre><pre class="cython line score-52" onclick='toggleDiv(this)'>+<span class="">114</span>:                                       streamlines._lengths.astype(np.intp),</pre>
<pre class='cython code score-52 '>      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_streamlines, __pyx_n_s_lengths);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 114, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_6, __pyx_n_s_astype);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 114, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 114, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_6, __pyx_n_s_intp);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 114, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_6 = NULL;
      if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_1))) {
        __pyx_t_6 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_1);
        if (likely(__pyx_t_6)) {
          PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_1);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_6);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
          <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_1, function);
        }
      }
      if (!__pyx_t_6) {
        __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_1, __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 114, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
      } else {
        #if CYTHON_FAST_PYCALL
        if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_1)) {
          PyObject *__pyx_temp[2] = {__pyx_t_6, __pyx_t_5};
          __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_1, __pyx_temp+1-1, 1+1);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 114, __pyx_L1_error)</span>
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
        } else
        #endif
        #if CYTHON_FAST_PYCCALL
        if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_1)) {
          PyObject *__pyx_temp[2] = {__pyx_t_6, __pyx_t_5};
          __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_1, __pyx_temp+1-1, 1+1);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 114, __pyx_L1_error)</span>
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
        } else
        #endif
        {
          __pyx_t_7 = <span class='py_c_api'>PyTuple_New</span>(1+1);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 114, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 0, __pyx_t_6); __pyx_t_6 = NULL;
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 0+1, __pyx_t_5);
          __pyx_t_5 = 0;
          __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_1, __pyx_t_7, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 114, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
        }
      }
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_nn_npy_intp</span>(__pyx_t_8);
      if (unlikely(!__pyx_t_10.memview)) <span class='error_goto'>__PYX_ERR(0, 114, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
</pre><pre class="cython line score-2" onclick='toggleDiv(this)'>+<span class="">115</span>:                                       arclengths)</pre>
<pre class='cython code score-2 '>      __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(__pyx_v_arclengths);
      if (unlikely(!__pyx_t_12.memview)) <span class='error_goto'>__PYX_ERR(0, 115, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">116</span>: </pre>
<pre class="cython line score-2" onclick='toggleDiv(this)'>+<span class="">117</span>:         return arclengths</pre>
<pre class='cython code score-2 '>    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_arclengths);
    __pyx_r = __pyx_v_arclengths;
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">118</span>: </pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">119</span>:     only_one_streamlines = False</pre>
<pre class='cython code score-0 '>  __pyx_v_only_one_streamlines = 0;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">120</span>:     if type(streamlines) is np.ndarray:</pre>
<pre class='cython code score-0 '>  __pyx_t_3 = (((PyObject *)Py_TYPE(__pyx_v_streamlines)) == ((PyObject *)__pyx_ptype_5numpy_ndarray));
  __pyx_t_2 = (__pyx_t_3 != 0);
  if (__pyx_t_2) {
/* … */
  }
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">121</span>:         only_one_streamlines = True</pre>
<pre class='cython code score-0 '>    __pyx_v_only_one_streamlines = 1;
</pre><pre class="cython line score-8" onclick='toggleDiv(this)'>+<span class="">122</span>:         streamlines = [streamlines]</pre>
<pre class='cython code score-8 '>    __pyx_t_8 = <span class='py_c_api'>PyList_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 122, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_streamlines);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_streamlines);
    <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_8, 0, __pyx_v_streamlines);
    <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_streamlines, __pyx_t_8);
    __pyx_t_8 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">123</span>: </pre>
<pre class="cython line score-5" onclick='toggleDiv(this)'>+<span class="">124</span>:     if len(streamlines) == 0:</pre>
<pre class='cython code score-5 '>  __pyx_t_4 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_streamlines);<span class='error_goto'> if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 124, __pyx_L1_error)</span>
  __pyx_t_2 = ((__pyx_t_4 == 0) != 0);
  if (__pyx_t_2) {
/* … */
  }
</pre><pre class="cython line score-2" onclick='toggleDiv(this)'>+<span class="">125</span>:         return 0.0</pre>
<pre class='cython code score-2 '>    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_float_0_0);
    __pyx_r = __pyx_float_0_0;
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">126</span>: </pre>
<pre class="cython line score-5" onclick='toggleDiv(this)'>+<span class="">127</span>:     dtype = streamlines[0].dtype</pre>
<pre class='cython code score-5 '>  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_streamlines, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 127, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_8, __pyx_n_s_dtype);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 127, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_v_dtype = __pyx_t_1;
  __pyx_t_1 = 0;
</pre><pre class="cython line score-43" onclick='toggleDiv(this)'>+<span class="">128</span>:     for streamline in streamlines:</pre>
<pre class='cython code score-43 '>  if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_v_streamlines)) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_v_streamlines)) {
    __pyx_t_1 = __pyx_v_streamlines; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1); __pyx_t_4 = 0;
    __pyx_t_14 = NULL;
  } else {
    __pyx_t_4 = -1; __pyx_t_1 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_v_streamlines);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 128, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_14 = Py_TYPE(__pyx_t_1)-&gt;tp_iternext;<span class='error_goto'> if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 128, __pyx_L1_error)</span>
  }
  for (;;) {
    if (likely(!__pyx_t_14)) {
      if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_1))) {
        if (__pyx_t_4 &gt;= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_1)) break;
        #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_8 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_1, __pyx_t_4); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_8); __pyx_t_4++; if (unlikely(0 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 128, __pyx_L1_error)</span>
        #else
        __pyx_t_8 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_1, __pyx_t_4); __pyx_t_4++;<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 128, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
        #endif
      } else {
        if (__pyx_t_4 &gt;= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_1)) break;
        #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_8 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_1, __pyx_t_4); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_8); __pyx_t_4++; if (unlikely(0 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 128, __pyx_L1_error)</span>
        #else
        __pyx_t_8 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_1, __pyx_t_4); __pyx_t_4++;<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 128, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
        #endif
      }
    } else {
      __pyx_t_8 = __pyx_t_14(__pyx_t_1);
      if (unlikely(!__pyx_t_8)) {
        PyObject* exc_type = <span class='py_c_api'>PyErr_Occurred</span>();
        if (exc_type) {
          if (likely(<span class='pyx_c_api'>__Pyx_PyErr_GivenExceptionMatches</span>(exc_type, PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
          else <span class='error_goto'>__PYX_ERR(0, 128, __pyx_L1_error)</span>
        }
        break;
      }
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
    }
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_streamline, __pyx_t_8);
    __pyx_t_8 = 0;
/* … */
  }
  __pyx_L9_break:;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-11" onclick='toggleDiv(this)'>+<span class="">129</span>:         if streamline.dtype != dtype:</pre>
<pre class='cython code score-11 '>    __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_streamline, __pyx_n_s_dtype);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 129, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
    __pyx_t_7 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_t_8, __pyx_v_dtype, Py_NE); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 129, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_7); if (unlikely(__pyx_t_2 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 129, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    if (__pyx_t_2) {
/* … */
    }
</pre><pre class="cython line score-2" onclick='toggleDiv(this)'>+<span class="">130</span>:             dtype = None</pre>
<pre class='cython code score-2 '>      <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_dtype, Py_None);
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">131</span>:             break</pre>
<pre class='cython code score-0 '>      goto __pyx_L9_break;
</pre><pre class="cython line score-0">&#xA0;<span class="">132</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">133</span>:     # Allocate memory for each streamline length.</pre>
<pre class="cython line score-39" onclick='toggleDiv(this)'>+<span class="">134</span>:     streamlines_length = np.empty(len(streamlines), dtype=np.float64)</pre>
<pre class='cython code score-39 '>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 134, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_empty);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 134, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_4 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_streamlines);<span class='error_goto'> if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 134, __pyx_L1_error)</span>
  __pyx_t_1 = <span class='py_c_api'>PyInt_FromSsize_t</span>(__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 134, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_8 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 134, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 0, __pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 134, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 134, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_5, __pyx_n_s_float64);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 134, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_6) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 134, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_7, __pyx_t_8, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 134, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_streamlines_length = __pyx_t_6;
  __pyx_t_6 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">135</span>:     cdef np.npy_intp i</pre>
<pre class="cython line score-0">&#xA0;<span class="">136</span>: </pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">137</span>:     if dtype is None:</pre>
<pre class='cython code score-0 '>  __pyx_t_2 = (__pyx_v_dtype == Py_None);
  __pyx_t_3 = (__pyx_t_2 != 0);
  if (__pyx_t_3) {
/* … */
    goto __pyx_L11;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">138</span>:         # List of streamlines having different dtypes</pre>
<pre class="cython line score-5" onclick='toggleDiv(this)'>+<span class="">139</span>:         for i in range(len(streamlines)):</pre>
<pre class='cython code score-5 '>    __pyx_t_4 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_streamlines);<span class='error_goto'> if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 139, __pyx_L1_error)</span>
    for (__pyx_t_15 = 0; __pyx_t_15 &lt; __pyx_t_4; __pyx_t_15+=1) {
      __pyx_v_i = __pyx_t_15;
</pre><pre class="cython line score-6" onclick='toggleDiv(this)'>+<span class="">140</span>:             dtype = streamlines[i].dtype</pre>
<pre class='cython code score-6 '>      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_streamlines, __pyx_v_i, npy_intp, 1, __Pyx_PyInt_From_Py_intptr_t, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 140, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_6, __pyx_n_s_dtype);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 140, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_dtype, __pyx_t_1);
      __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">141</span>:             # HACK: To avoid memleaks we have to recast with astype(dtype).</pre>
<pre class="cython line score-43" onclick='toggleDiv(this)'>+<span class="">142</span>:             streamline = streamlines[i].astype(dtype)</pre>
<pre class='cython code score-43 '>      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_streamlines, __pyx_v_i, npy_intp, 1, __Pyx_PyInt_From_Py_intptr_t, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 142, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_6, __pyx_n_s_astype);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 142, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_6 = NULL;
      if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_8))) {
        __pyx_t_6 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_8);
        if (likely(__pyx_t_6)) {
          PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_8);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_6);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
          <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_8, function);
        }
      }
      if (!__pyx_t_6) {
        __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_8, __pyx_v_dtype);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 142, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      } else {
        #if CYTHON_FAST_PYCALL
        if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_8)) {
          PyObject *__pyx_temp[2] = {__pyx_t_6, __pyx_v_dtype};
          __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_8, __pyx_temp+1-1, 1+1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 142, __pyx_L1_error)</span>
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
        } else
        #endif
        #if CYTHON_FAST_PYCCALL
        if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_8)) {
          PyObject *__pyx_temp[2] = {__pyx_t_6, __pyx_v_dtype};
          __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_8, __pyx_temp+1-1, 1+1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 142, __pyx_L1_error)</span>
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
        } else
        #endif
        {
          __pyx_t_7 = <span class='py_c_api'>PyTuple_New</span>(1+1);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 142, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 0, __pyx_t_6); __pyx_t_6 = NULL;
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_dtype);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_dtype);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 0+1, __pyx_v_dtype);
          __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_8, __pyx_t_7, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 142, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
        }
      }
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
      <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_streamline, __pyx_t_1);
      __pyx_t_1 = 0;
</pre><pre class="cython line score-28" onclick='toggleDiv(this)'>+<span class="">143</span>:             if dtype != np.float32 and dtype != np.float64:</pre>
<pre class='cython code score-28 '>      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 143, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_float32);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 143, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_v_dtype, __pyx_t_8, Py_NE); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 143, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
      __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_1); if (unlikely(__pyx_t_2 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 143, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      if (__pyx_t_2) {
      } else {
        __pyx_t_3 = __pyx_t_2;
        goto __pyx_L15_bool_binop_done;
      }
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 143, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_float64);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 143, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_v_dtype, __pyx_t_8, Py_NE); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 143, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
      __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_1); if (unlikely(__pyx_t_2 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 143, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_3 = __pyx_t_2;
      __pyx_L15_bool_binop_done:;
      if (__pyx_t_3) {
/* … */
      }
</pre><pre class="cython line score-30" onclick='toggleDiv(this)'>+<span class="">144</span>:                 is_integer = dtype == np.int64 or dtype == np.uint64</pre>
<pre class='cython code score-30 '>        __pyx_t_8 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 144, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
        __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_8, __pyx_n_s_int64);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 144, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
        __pyx_t_8 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_v_dtype, __pyx_t_7, Py_EQ); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_8);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 144, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
        __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_8); if (unlikely(__pyx_t_3 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 144, __pyx_L1_error)</span>
        if (!__pyx_t_3) {
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
        } else {
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_8);
          __pyx_t_1 = __pyx_t_8;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
          goto __pyx_L17_bool_binop_done;
        }
        __pyx_t_8 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 144, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
        __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_8, __pyx_n_s_uint64);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 144, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
        __pyx_t_8 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_v_dtype, __pyx_t_7, Py_EQ); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_8);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 144, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_8);
        __pyx_t_1 = __pyx_t_8;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
        __pyx_L17_bool_binop_done:;
        <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_is_integer, __pyx_t_1);
        __pyx_t_1 = 0;
</pre><pre class="cython line score-13" onclick='toggleDiv(this)'>+<span class="">145</span>:                 dtype = np.float64 if is_integer else np.float32</pre>
<pre class='cython code score-13 '>        __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_v_is_integer); if (unlikely(__pyx_t_3 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 145, __pyx_L1_error)</span>
        if (__pyx_t_3) {
          __pyx_t_8 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 145, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
          __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_8, __pyx_n_s_float64);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 145, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
          __pyx_t_1 = __pyx_t_7;
          __pyx_t_7 = 0;
        } else {
          __pyx_t_7 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 145, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
          __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_7, __pyx_n_s_float32);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 145, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
          __pyx_t_1 = __pyx_t_8;
          __pyx_t_8 = 0;
        }
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_dtype, __pyx_t_1);
        __pyx_t_1 = 0;
</pre><pre class="cython line score-43" onclick='toggleDiv(this)'>+<span class="">146</span>:                 streamline = streamlines[i].astype(dtype)</pre>
<pre class='cython code score-43 '>        __pyx_t_8 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_streamlines, __pyx_v_i, npy_intp, 1, __Pyx_PyInt_From_Py_intptr_t, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 146, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
        __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_8, __pyx_n_s_astype);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 146, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
        __pyx_t_8 = NULL;
        if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_7))) {
          __pyx_t_8 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_7);
          if (likely(__pyx_t_8)) {
            PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_7);
            <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_8);
            <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
            <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_7, function);
          }
        }
        if (!__pyx_t_8) {
          __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_7, __pyx_v_dtype);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 146, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
        } else {
          #if CYTHON_FAST_PYCALL
          if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_7)) {
            PyObject *__pyx_temp[2] = {__pyx_t_8, __pyx_v_dtype};
            __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_7, __pyx_temp+1-1, 1+1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 146, __pyx_L1_error)</span>
            <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
          } else
          #endif
          #if CYTHON_FAST_PYCCALL
          if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_7)) {
            PyObject *__pyx_temp[2] = {__pyx_t_8, __pyx_v_dtype};
            __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_7, __pyx_temp+1-1, 1+1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 146, __pyx_L1_error)</span>
            <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
          } else
          #endif
          {
            __pyx_t_6 = <span class='py_c_api'>PyTuple_New</span>(1+1);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 146, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
            <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_8); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 0, __pyx_t_8); __pyx_t_8 = NULL;
            <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_dtype);
            <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_dtype);
            <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 0+1, __pyx_v_dtype);
            __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_7, __pyx_t_6, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 146, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
          }
        }
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_streamline, __pyx_t_1);
        __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">147</span>: </pre>
<pre class="cython line score-14" onclick='toggleDiv(this)'>+<span class="">148</span>:             if dtype == np.float32:</pre>
<pre class='cython code score-14 '>      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 148, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_float32);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 148, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_v_dtype, __pyx_t_7, Py_EQ); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 148, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_1); if (unlikely(__pyx_t_3 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 148, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      if (__pyx_t_3) {
/* … */
        goto __pyx_L19;
      }
</pre><pre class="cython line score-10" onclick='toggleDiv(this)'>+<span class="">149</span>:                 streamlines_length[i] = c_length[float2d](streamline)</pre>
<pre class='cython code score-10 '>        __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_float</span>(__pyx_v_streamline);
        if (unlikely(!__pyx_t_9.memview)) <span class='error_goto'>__PYX_ERR(0, 149, __pyx_L1_error)</span>
        __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_fuse_0__pyx_f_4dipy_8tracking_15streamlinespeed_c_length(__pyx_t_9));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 149, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
        __PYX_XDEC_MEMVIEW(&amp;__pyx_t_9, 1);
        __pyx_t_9.memview = NULL;
        __pyx_t_9.data = NULL;
        if (unlikely(<span class='pyx_c_api'>__Pyx_SetItemInt</span>(__pyx_v_streamlines_length, __pyx_v_i, __pyx_t_1, npy_intp, 1, __Pyx_PyInt_From_Py_intptr_t, 0, 0, 0) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 149, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">150</span>:             else:</pre>
<pre class="cython line score-10" onclick='toggleDiv(this)'>+<span class="">151</span>:                 streamlines_length[i] = c_length[double2d](streamline)</pre>
<pre class='cython code score-10 '>      /*else*/ {
        __pyx_t_13 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(__pyx_v_streamline);
        if (unlikely(!__pyx_t_13.memview)) <span class='error_goto'>__PYX_ERR(0, 151, __pyx_L1_error)</span>
        __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_fuse_1__pyx_f_4dipy_8tracking_15streamlinespeed_c_length(__pyx_t_13));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 151, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
        __PYX_XDEC_MEMVIEW(&amp;__pyx_t_13, 1);
        __pyx_t_13.memview = NULL;
        __pyx_t_13.data = NULL;
        if (unlikely(<span class='pyx_c_api'>__Pyx_SetItemInt</span>(__pyx_v_streamlines_length, __pyx_v_i, __pyx_t_1, npy_intp, 1, __Pyx_PyInt_From_Py_intptr_t, 0, 0, 0) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 151, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      }
      __pyx_L19:;
    }
</pre><pre class="cython line score-0">&#xA0;<span class="">152</span>: </pre>
<pre class="cython line score-14" onclick='toggleDiv(this)'>+<span class="">153</span>:     elif dtype == np.float32:</pre>
<pre class='cython code score-14 '>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 153, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_float32);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 153, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_v_dtype, __pyx_t_7, Py_EQ); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 153, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_1); if (unlikely(__pyx_t_3 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 153, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_3) {
/* … */
    goto __pyx_L11;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">154</span>:         # All streamlines have composed of float32 points</pre>
<pre class="cython line score-5" onclick='toggleDiv(this)'>+<span class="">155</span>:         for i in range(len(streamlines)):</pre>
<pre class='cython code score-5 '>    __pyx_t_4 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_streamlines);<span class='error_goto'> if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 155, __pyx_L1_error)</span>
    for (__pyx_t_15 = 0; __pyx_t_15 &lt; __pyx_t_4; __pyx_t_15+=1) {
      __pyx_v_i = __pyx_t_15;
</pre><pre class="cython line score-0">&#xA0;<span class="">156</span>:             # HACK: To avoid memleaks we have to recast with astype(dtype).</pre>
<pre class="cython line score-43" onclick='toggleDiv(this)'>+<span class="">157</span>:             streamline = streamlines[i].astype(dtype)</pre>
<pre class='cython code score-43 '>      __pyx_t_7 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_streamlines, __pyx_v_i, npy_intp, 1, __Pyx_PyInt_From_Py_intptr_t, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 157, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_7, __pyx_n_s_astype);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 157, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_t_7 = NULL;
      if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_6))) {
        __pyx_t_7 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_6);
        if (likely(__pyx_t_7)) {
          PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_6);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_7);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
          <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_6, function);
        }
      }
      if (!__pyx_t_7) {
        __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_6, __pyx_v_dtype);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 157, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      } else {
        #if CYTHON_FAST_PYCALL
        if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_6)) {
          PyObject *__pyx_temp[2] = {__pyx_t_7, __pyx_v_dtype};
          __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_6, __pyx_temp+1-1, 1+1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 157, __pyx_L1_error)</span>
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
        } else
        #endif
        #if CYTHON_FAST_PYCCALL
        if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_6)) {
          PyObject *__pyx_temp[2] = {__pyx_t_7, __pyx_v_dtype};
          __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_6, __pyx_temp+1-1, 1+1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 157, __pyx_L1_error)</span>
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
        } else
        #endif
        {
          __pyx_t_8 = <span class='py_c_api'>PyTuple_New</span>(1+1);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 157, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_7); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 0, __pyx_t_7); __pyx_t_7 = NULL;
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_dtype);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_dtype);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 0+1, __pyx_v_dtype);
          __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_6, __pyx_t_8, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 157, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
        }
      }
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_streamline, __pyx_t_1);
      __pyx_t_1 = 0;
</pre><pre class="cython line score-10" onclick='toggleDiv(this)'>+<span class="">158</span>:             streamlines_length[i] = c_length[float2d](streamline)</pre>
<pre class='cython code score-10 '>      __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_float</span>(__pyx_v_streamline);
      if (unlikely(!__pyx_t_9.memview)) <span class='error_goto'>__PYX_ERR(0, 158, __pyx_L1_error)</span>
      __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_fuse_0__pyx_f_4dipy_8tracking_15streamlinespeed_c_length(__pyx_t_9));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 158, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      __PYX_XDEC_MEMVIEW(&amp;__pyx_t_9, 1);
      __pyx_t_9.memview = NULL;
      __pyx_t_9.data = NULL;
      if (unlikely(<span class='pyx_c_api'>__Pyx_SetItemInt</span>(__pyx_v_streamlines_length, __pyx_v_i, __pyx_t_1, npy_intp, 1, __Pyx_PyInt_From_Py_intptr_t, 0, 0, 0) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 158, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    }
</pre><pre class="cython line score-14" onclick='toggleDiv(this)'>+<span class="">159</span>:     elif dtype == np.float64:</pre>
<pre class='cython code score-14 '>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 159, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_float64);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 159, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_v_dtype, __pyx_t_6, Py_EQ); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 159, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_1); if (unlikely(__pyx_t_3 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 159, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_3) {
/* … */
    goto __pyx_L11;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">160</span>:         # All streamlines are composed of float64 points</pre>
<pre class="cython line score-5" onclick='toggleDiv(this)'>+<span class="">161</span>:         for i in range(len(streamlines)):</pre>
<pre class='cython code score-5 '>    __pyx_t_4 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_streamlines);<span class='error_goto'> if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 161, __pyx_L1_error)</span>
    for (__pyx_t_15 = 0; __pyx_t_15 &lt; __pyx_t_4; __pyx_t_15+=1) {
      __pyx_v_i = __pyx_t_15;
</pre><pre class="cython line score-0">&#xA0;<span class="">162</span>:             # HACK: To avoid memleaks we have to recast with astype(dtype).</pre>
<pre class="cython line score-43" onclick='toggleDiv(this)'>+<span class="">163</span>:             streamline = streamlines[i].astype(dtype)</pre>
<pre class='cython code score-43 '>      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_streamlines, __pyx_v_i, npy_intp, 1, __Pyx_PyInt_From_Py_intptr_t, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 163, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_6, __pyx_n_s_astype);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 163, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_6 = NULL;
      if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_8))) {
        __pyx_t_6 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_8);
        if (likely(__pyx_t_6)) {
          PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_8);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_6);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
          <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_8, function);
        }
      }
      if (!__pyx_t_6) {
        __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_8, __pyx_v_dtype);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 163, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      } else {
        #if CYTHON_FAST_PYCALL
        if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_8)) {
          PyObject *__pyx_temp[2] = {__pyx_t_6, __pyx_v_dtype};
          __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_8, __pyx_temp+1-1, 1+1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 163, __pyx_L1_error)</span>
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
        } else
        #endif
        #if CYTHON_FAST_PYCCALL
        if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_8)) {
          PyObject *__pyx_temp[2] = {__pyx_t_6, __pyx_v_dtype};
          __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_8, __pyx_temp+1-1, 1+1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 163, __pyx_L1_error)</span>
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
        } else
        #endif
        {
          __pyx_t_7 = <span class='py_c_api'>PyTuple_New</span>(1+1);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 163, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 0, __pyx_t_6); __pyx_t_6 = NULL;
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_dtype);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_dtype);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 0+1, __pyx_v_dtype);
          __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_8, __pyx_t_7, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 163, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
        }
      }
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
      <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_streamline, __pyx_t_1);
      __pyx_t_1 = 0;
</pre><pre class="cython line score-10" onclick='toggleDiv(this)'>+<span class="">164</span>:             streamlines_length[i] = c_length[double2d](streamline)</pre>
<pre class='cython code score-10 '>      __pyx_t_13 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(__pyx_v_streamline);
      if (unlikely(!__pyx_t_13.memview)) <span class='error_goto'>__PYX_ERR(0, 164, __pyx_L1_error)</span>
      __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_fuse_1__pyx_f_4dipy_8tracking_15streamlinespeed_c_length(__pyx_t_13));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 164, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      __PYX_XDEC_MEMVIEW(&amp;__pyx_t_13, 1);
      __pyx_t_13.memview = NULL;
      __pyx_t_13.data = NULL;
      if (unlikely(<span class='pyx_c_api'>__Pyx_SetItemInt</span>(__pyx_v_streamlines_length, __pyx_v_i, __pyx_t_1, npy_intp, 1, __Pyx_PyInt_From_Py_intptr_t, 0, 0, 0) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 164, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    }
</pre><pre class="cython line score-28" onclick='toggleDiv(this)'>+<span class="">165</span>:     elif dtype == np.int64 or dtype == np.uint64:</pre>
<pre class='cython code score-28 '>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 165, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_int64);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 165, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_v_dtype, __pyx_t_8, Py_EQ); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 165, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_1); if (unlikely(__pyx_t_2 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 165, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (!__pyx_t_2) {
  } else {
    __pyx_t_3 = __pyx_t_2;
    goto __pyx_L24_bool_binop_done;
  }
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 165, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_uint64);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 165, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_v_dtype, __pyx_t_8, Py_EQ); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 165, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_1); if (unlikely(__pyx_t_2 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 165, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_3 = __pyx_t_2;
  __pyx_L24_bool_binop_done:;
  if (__pyx_t_3) {
/* … */
    goto __pyx_L11;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">166</span>:         # All streamlines are composed of int64 or uint64 points so convert</pre>
<pre class="cython line score-0">&#xA0;<span class="">167</span>:         # them in float64 one at the time.</pre>
<pre class="cython line score-5" onclick='toggleDiv(this)'>+<span class="">168</span>:         for i in range(len(streamlines)):</pre>
<pre class='cython code score-5 '>    __pyx_t_4 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_streamlines);<span class='error_goto'> if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 168, __pyx_L1_error)</span>
    for (__pyx_t_15 = 0; __pyx_t_15 &lt; __pyx_t_4; __pyx_t_15+=1) {
      __pyx_v_i = __pyx_t_15;
</pre><pre class="cython line score-50" onclick='toggleDiv(this)'>+<span class="">169</span>:             streamline = streamlines[i].astype(np.float64)</pre>
<pre class='cython code score-50 '>      __pyx_t_8 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_streamlines, __pyx_v_i, npy_intp, 1, __Pyx_PyInt_From_Py_intptr_t, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 169, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
      __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_8, __pyx_n_s_astype);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 169, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
      __pyx_t_8 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 169, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_8, __pyx_n_s_float64);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 169, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
      __pyx_t_8 = NULL;
      if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_7))) {
        __pyx_t_8 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_7);
        if (likely(__pyx_t_8)) {
          PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_7);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_8);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
          <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_7, function);
        }
      }
      if (!__pyx_t_8) {
        __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_7, __pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 169, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      } else {
        #if CYTHON_FAST_PYCALL
        if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_7)) {
          PyObject *__pyx_temp[2] = {__pyx_t_8, __pyx_t_6};
          __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_7, __pyx_temp+1-1, 1+1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 169, __pyx_L1_error)</span>
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
        } else
        #endif
        #if CYTHON_FAST_PYCCALL
        if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_7)) {
          PyObject *__pyx_temp[2] = {__pyx_t_8, __pyx_t_6};
          __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_7, __pyx_temp+1-1, 1+1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 169, __pyx_L1_error)</span>
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
        } else
        #endif
        {
          __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(1+1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 169, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_8); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_8); __pyx_t_8 = NULL;
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0+1, __pyx_t_6);
          __pyx_t_6 = 0;
          __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_7, __pyx_t_5, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 169, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
        }
      }
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
      <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_streamline, __pyx_t_1);
      __pyx_t_1 = 0;
</pre><pre class="cython line score-10" onclick='toggleDiv(this)'>+<span class="">170</span>:             streamlines_length[i] = c_length[double2d](streamline)</pre>
<pre class='cython code score-10 '>      __pyx_t_13 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(__pyx_v_streamline);
      if (unlikely(!__pyx_t_13.memview)) <span class='error_goto'>__PYX_ERR(0, 170, __pyx_L1_error)</span>
      __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_fuse_1__pyx_f_4dipy_8tracking_15streamlinespeed_c_length(__pyx_t_13));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 170, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      __PYX_XDEC_MEMVIEW(&amp;__pyx_t_13, 1);
      __pyx_t_13.memview = NULL;
      __pyx_t_13.data = NULL;
      if (unlikely(<span class='pyx_c_api'>__Pyx_SetItemInt</span>(__pyx_v_streamlines_length, __pyx_v_i, __pyx_t_1, npy_intp, 1, __Pyx_PyInt_From_Py_intptr_t, 0, 0, 0) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 170, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    }
</pre><pre class="cython line score-0">&#xA0;<span class="">171</span>:     else:</pre>
<pre class="cython line score-0">&#xA0;<span class="">172</span>:         # All streamlines are composed of points with a dtype fitting in</pre>
<pre class="cython line score-0">&#xA0;<span class="">173</span>:         # 32 bits so convert them in float32 one at the time.</pre>
<pre class="cython line score-5" onclick='toggleDiv(this)'>+<span class="">174</span>:         for i in range(len(streamlines)):</pre>
<pre class='cython code score-5 '>  /*else*/ {
    __pyx_t_4 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_streamlines);<span class='error_goto'> if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 174, __pyx_L1_error)</span>
    for (__pyx_t_15 = 0; __pyx_t_15 &lt; __pyx_t_4; __pyx_t_15+=1) {
      __pyx_v_i = __pyx_t_15;
</pre><pre class="cython line score-50" onclick='toggleDiv(this)'>+<span class="">175</span>:             streamline = streamlines[i].astype(np.float32)</pre>
<pre class='cython code score-50 '>      __pyx_t_7 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_streamlines, __pyx_v_i, npy_intp, 1, __Pyx_PyInt_From_Py_intptr_t, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 175, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_7, __pyx_n_s_astype);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 175, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_t_7 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 175, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_7, __pyx_n_s_float32);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 175, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_t_7 = NULL;
      if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_5))) {
        __pyx_t_7 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_5);
        if (likely(__pyx_t_7)) {
          PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_5);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_7);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
          <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_5, function);
        }
      }
      if (!__pyx_t_7) {
        __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_5, __pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 175, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      } else {
        #if CYTHON_FAST_PYCALL
        if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_5)) {
          PyObject *__pyx_temp[2] = {__pyx_t_7, __pyx_t_6};
          __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_5, __pyx_temp+1-1, 1+1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 175, __pyx_L1_error)</span>
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
        } else
        #endif
        #if CYTHON_FAST_PYCCALL
        if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_5)) {
          PyObject *__pyx_temp[2] = {__pyx_t_7, __pyx_t_6};
          __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_5, __pyx_temp+1-1, 1+1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 175, __pyx_L1_error)</span>
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
        } else
        #endif
        {
          __pyx_t_8 = <span class='py_c_api'>PyTuple_New</span>(1+1);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 175, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_7); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 0, __pyx_t_7); __pyx_t_7 = NULL;
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 0+1, __pyx_t_6);
          __pyx_t_6 = 0;
          __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_5, __pyx_t_8, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 175, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
        }
      }
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_streamline, __pyx_t_1);
      __pyx_t_1 = 0;
</pre><pre class="cython line score-10" onclick='toggleDiv(this)'>+<span class="">176</span>:             streamlines_length[i] = c_length[float2d](streamline)</pre>
<pre class='cython code score-10 '>      __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_float</span>(__pyx_v_streamline);
      if (unlikely(!__pyx_t_9.memview)) <span class='error_goto'>__PYX_ERR(0, 176, __pyx_L1_error)</span>
      __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_fuse_0__pyx_f_4dipy_8tracking_15streamlinespeed_c_length(__pyx_t_9));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 176, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      __PYX_XDEC_MEMVIEW(&amp;__pyx_t_9, 1);
      __pyx_t_9.memview = NULL;
      __pyx_t_9.data = NULL;
      if (unlikely(<span class='pyx_c_api'>__Pyx_SetItemInt</span>(__pyx_v_streamlines_length, __pyx_v_i, __pyx_t_1, npy_intp, 1, __Pyx_PyInt_From_Py_intptr_t, 0, 0, 0) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 176, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    }
  }
  __pyx_L11:;
</pre><pre class="cython line score-0">&#xA0;<span class="">177</span>: </pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">178</span>:     if only_one_streamlines:</pre>
<pre class='cython code score-0 '>  __pyx_t_3 = (__pyx_v_only_one_streamlines != 0);
  if (__pyx_t_3) {
/* … */
  }
</pre><pre class="cython line score-3" onclick='toggleDiv(this)'>+<span class="">179</span>:         return streamlines_length[0]</pre>
<pre class='cython code score-3 '>    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_streamlines_length, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 179, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_r = __pyx_t_1;
    __pyx_t_1 = 0;
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">180</span>:     else:</pre>
<pre class="cython line score-2" onclick='toggleDiv(this)'>+<span class="">181</span>:         return streamlines_length</pre>
<pre class='cython code score-2 '>  /*else*/ {
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_streamlines_length);
    __pyx_r = __pyx_v_streamlines_length;
    goto __pyx_L0;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">182</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">183</span>: </pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">184</span>: cdef void c_arclengths(Streamline streamline, double* out) nogil:</pre>
<pre class='cython code score-0 '>static void __pyx_fuse_0__pyx_f_4dipy_8tracking_15streamlinespeed_c_arclengths(__pyx_t_4dipy_8tracking_15streamlinespeed_float2d __pyx_v_streamline, double *__pyx_v_out) {
  npy_intp __pyx_v_i;
  double __pyx_v_dn;
  Py_ssize_t __pyx_v_j;
/* … */
  /* function exit code */
}

static void __pyx_fuse_1__pyx_f_4dipy_8tracking_15streamlinespeed_c_arclengths(__pyx_t_4dipy_8tracking_15streamlinespeed_double2d __pyx_v_streamline, double *__pyx_v_out) {
  npy_intp __pyx_v_i;
  double __pyx_v_dn;
  Py_ssize_t __pyx_v_j;
/* … */
  /* function exit code */
}
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">185</span>:     cdef np.npy_intp i = 0</pre>
<pre class='cython code score-0 '>  __pyx_v_i = 0;
/* … */
  __pyx_v_i = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">186</span>:     cdef double dn</pre>
<pre class="cython line score-0">&#xA0;<span class="">187</span>: </pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">188</span>:     out[0] = 0.0</pre>
<pre class='cython code score-0 '>  (__pyx_v_out[0]) = 0.0;
/* … */
  (__pyx_v_out[0]) = 0.0;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">189</span>:     for i in range(1, streamline.shape[0]):</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = (__pyx_v_streamline.shape[0]);
  for (__pyx_t_2 = 1; __pyx_t_2 &lt; __pyx_t_1; __pyx_t_2+=1) {
    __pyx_v_i = __pyx_t_2;
/* … */
  __pyx_t_1 = (__pyx_v_streamline.shape[0]);
  for (__pyx_t_2 = 1; __pyx_t_2 &lt; __pyx_t_1; __pyx_t_2+=1) {
    __pyx_v_i = __pyx_t_2;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">190</span>:         out[i] = 0.0</pre>
<pre class='cython code score-0 '>    (__pyx_v_out[__pyx_v_i]) = 0.0;
/* … */
    (__pyx_v_out[__pyx_v_i]) = 0.0;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">191</span>:         for j in range(streamline.shape[1]):</pre>
<pre class='cython code score-0 '>    __pyx_t_3 = (__pyx_v_streamline.shape[1]);
    for (__pyx_t_4 = 0; __pyx_t_4 &lt; __pyx_t_3; __pyx_t_4+=1) {
      __pyx_v_j = __pyx_t_4;
/* … */
    __pyx_t_3 = (__pyx_v_streamline.shape[1]);
    for (__pyx_t_4 = 0; __pyx_t_4 &lt; __pyx_t_3; __pyx_t_4+=1) {
      __pyx_v_j = __pyx_t_4;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">192</span>:             dn = streamline[i, j] - streamline[i-1, j]</pre>
<pre class='cython code score-0 '>      __pyx_t_5 = __pyx_v_i;
      __pyx_t_6 = __pyx_v_j;
      __pyx_t_7 = (__pyx_v_i - 1);
      __pyx_t_8 = __pyx_v_j;
      __pyx_v_dn = ((*((float *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_streamline.data + __pyx_t_5 * __pyx_v_streamline.strides[0]) ) + __pyx_t_6 * __pyx_v_streamline.strides[1]) ))) - (*((float *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_streamline.data + __pyx_t_7 * __pyx_v_streamline.strides[0]) ) + __pyx_t_8 * __pyx_v_streamline.strides[1]) ))));
/* … */
      __pyx_t_5 = __pyx_v_i;
      __pyx_t_6 = __pyx_v_j;
      __pyx_t_7 = (__pyx_v_i - 1);
      __pyx_t_8 = __pyx_v_j;
      __pyx_v_dn = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_streamline.data + __pyx_t_5 * __pyx_v_streamline.strides[0]) ) + __pyx_t_6 * __pyx_v_streamline.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_streamline.data + __pyx_t_7 * __pyx_v_streamline.strides[0]) ) + __pyx_t_8 * __pyx_v_streamline.strides[1]) ))));
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">193</span>:             out[i] += dn*dn</pre>
<pre class='cython code score-0 '>      __pyx_t_9 = __pyx_v_i;
      (__pyx_v_out[__pyx_t_9]) = ((__pyx_v_out[__pyx_t_9]) + (__pyx_v_dn * __pyx_v_dn));
    }
/* … */
      __pyx_t_9 = __pyx_v_i;
      (__pyx_v_out[__pyx_t_9]) = ((__pyx_v_out[__pyx_t_9]) + (__pyx_v_dn * __pyx_v_dn));
    }
</pre><pre class="cython line score-0">&#xA0;<span class="">194</span>: </pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">195</span>:         out[i] = out[i-1] + sqrt(out[i])</pre>
<pre class='cython code score-0 '>    (__pyx_v_out[__pyx_v_i]) = ((__pyx_v_out[(__pyx_v_i - 1)]) + sqrt((__pyx_v_out[__pyx_v_i])));
  }
/* … */
    (__pyx_v_out[__pyx_v_i]) = ((__pyx_v_out[(__pyx_v_i - 1)]) + sqrt((__pyx_v_out[__pyx_v_i])));
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">196</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">197</span>: </pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">198</span>: cdef void c_set_number_of_points(Streamline streamline, Streamline out) nogil:</pre>
<pre class='cython code score-0 '>static void __pyx_fuse_0__pyx_f_4dipy_8tracking_15streamlinespeed_c_set_number_of_points(__pyx_t_4dipy_8tracking_15streamlinespeed_float2d __pyx_v_streamline, __pyx_t_4dipy_8tracking_15streamlinespeed_float2d __pyx_v_out) {
  npy_intp __pyx_v_N;
  npy_intp __pyx_v_D;
  npy_intp __pyx_v_new_N;
  double __pyx_v_ratio;
  double __pyx_v_step;
  double __pyx_v_next_point;
  double __pyx_v_delta;
  npy_intp __pyx_v_i;
  npy_intp __pyx_v_j;
  npy_intp __pyx_v_k;
  npy_intp __pyx_v_dim;
  double *__pyx_v_arclengths;
/* … */
  /* function exit code */
}

static void __pyx_fuse_1__pyx_f_4dipy_8tracking_15streamlinespeed_c_set_number_of_points(__pyx_t_4dipy_8tracking_15streamlinespeed_double2d __pyx_v_streamline, __pyx_t_4dipy_8tracking_15streamlinespeed_double2d __pyx_v_out) {
  npy_intp __pyx_v_N;
  npy_intp __pyx_v_D;
  npy_intp __pyx_v_new_N;
  double __pyx_v_ratio;
  double __pyx_v_step;
  double __pyx_v_next_point;
  double __pyx_v_delta;
  npy_intp __pyx_v_i;
  npy_intp __pyx_v_j;
  npy_intp __pyx_v_k;
  npy_intp __pyx_v_dim;
  double *__pyx_v_arclengths;
/* … */
  /* function exit code */
}
</pre><pre class="cython line score-0">&#xA0;<span class="">199</span>:     cdef:</pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">200</span>:         np.npy_intp N = streamline.shape[0]</pre>
<pre class='cython code score-0 '>  __pyx_v_N = (__pyx_v_streamline.shape[0]);
/* … */
  __pyx_v_N = (__pyx_v_streamline.shape[0]);
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">201</span>:         np.npy_intp D = streamline.shape[1]</pre>
<pre class='cython code score-0 '>  __pyx_v_D = (__pyx_v_streamline.shape[1]);
/* … */
  __pyx_v_D = (__pyx_v_streamline.shape[1]);
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">202</span>:         np.npy_intp new_N = out.shape[0]</pre>
<pre class='cython code score-0 '>  __pyx_v_new_N = (__pyx_v_out.shape[0]);
/* … */
  __pyx_v_new_N = (__pyx_v_out.shape[0]);
</pre><pre class="cython line score-0">&#xA0;<span class="">203</span>:         double ratio, step, next_point, delta</pre>
<pre class="cython line score-0">&#xA0;<span class="">204</span>:         np.npy_intp i, j, k, dim</pre>
<pre class="cython line score-0">&#xA0;<span class="">205</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">206</span>:     # Get arclength at each point.</pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">207</span>:     arclengths = &lt;double*&gt; malloc(streamline.shape[0] * sizeof(double))</pre>
<pre class='cython code score-0 '>  __pyx_v_arclengths = ((double *)malloc(((__pyx_v_streamline.shape[0]) * (sizeof(double)))));
/* … */
  __pyx_v_arclengths = ((double *)malloc(((__pyx_v_streamline.shape[0]) * (sizeof(double)))));
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">208</span>:     c_arclengths(streamline, arclengths)</pre>
<pre class='cython code score-0 '>  __pyx_fuse_0__pyx_f_4dipy_8tracking_15streamlinespeed_c_arclengths(__pyx_v_streamline, __pyx_v_arclengths);
/* … */
  __pyx_fuse_1__pyx_f_4dipy_8tracking_15streamlinespeed_c_arclengths(__pyx_v_streamline, __pyx_v_arclengths);
</pre><pre class="cython line score-0">&#xA0;<span class="">209</span>: </pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">210</span>:     step = arclengths[N-1] / (new_N-1)</pre>
<pre class='cython code score-0 '>  __pyx_v_step = ((__pyx_v_arclengths[(__pyx_v_N - 1)]) / (__pyx_v_new_N - 1));
/* … */
  __pyx_v_step = ((__pyx_v_arclengths[(__pyx_v_N - 1)]) / (__pyx_v_new_N - 1));
</pre><pre class="cython line score-0">&#xA0;<span class="">211</span>: </pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">212</span>:     next_point = 0.0</pre>
<pre class='cython code score-0 '>  __pyx_v_next_point = 0.0;
/* … */
  __pyx_v_next_point = 0.0;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">213</span>:     i = 0</pre>
<pre class='cython code score-0 '>  __pyx_v_i = 0;
/* … */
  __pyx_v_i = 0;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">214</span>:     j = 0</pre>
<pre class='cython code score-0 '>  __pyx_v_j = 0;
/* … */
  __pyx_v_j = 0;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">215</span>:     k = 0</pre>
<pre class='cython code score-0 '>  __pyx_v_k = 0;
/* … */
  __pyx_v_k = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">216</span>: </pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">217</span>:     while next_point &lt; arclengths[N-1]:</pre>
<pre class='cython code score-0 '>  while (1) {
    __pyx_t_1 = ((__pyx_v_next_point &lt; (__pyx_v_arclengths[(__pyx_v_N - 1)])) != 0);
    if (!__pyx_t_1) break;
/* … */
  while (1) {
    __pyx_t_1 = ((__pyx_v_next_point &lt; (__pyx_v_arclengths[(__pyx_v_N - 1)])) != 0);
    if (!__pyx_t_1) break;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">218</span>:         if next_point == arclengths[k]:</pre>
<pre class='cython code score-0 '>    __pyx_t_1 = ((__pyx_v_next_point == (__pyx_v_arclengths[__pyx_v_k])) != 0);
    if (__pyx_t_1) {
/* … */
      goto __pyx_L5;
    }
/* … */
    __pyx_t_1 = ((__pyx_v_next_point == (__pyx_v_arclengths[__pyx_v_k])) != 0);
    if (__pyx_t_1) {
/* … */
      goto __pyx_L5;
    }
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">219</span>:             for dim in range(D):</pre>
<pre class='cython code score-0 '>      __pyx_t_2 = __pyx_v_D;
      for (__pyx_t_3 = 0; __pyx_t_3 &lt; __pyx_t_2; __pyx_t_3+=1) {
        __pyx_v_dim = __pyx_t_3;
/* … */
      __pyx_t_2 = __pyx_v_D;
      for (__pyx_t_3 = 0; __pyx_t_3 &lt; __pyx_t_2; __pyx_t_3+=1) {
        __pyx_v_dim = __pyx_t_3;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">220</span>:                 out[i, dim] = streamline[j, dim]</pre>
<pre class='cython code score-0 '>        __pyx_t_4 = __pyx_v_j;
        __pyx_t_5 = __pyx_v_dim;
        __pyx_t_6 = __pyx_v_i;
        __pyx_t_7 = __pyx_v_dim;
        *((float *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_out.data + __pyx_t_6 * __pyx_v_out.strides[0]) ) + __pyx_t_7 * __pyx_v_out.strides[1]) )) = (*((float *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_streamline.data + __pyx_t_4 * __pyx_v_streamline.strides[0]) ) + __pyx_t_5 * __pyx_v_streamline.strides[1]) )));
      }
/* … */
        __pyx_t_4 = __pyx_v_j;
        __pyx_t_5 = __pyx_v_dim;
        __pyx_t_6 = __pyx_v_i;
        __pyx_t_7 = __pyx_v_dim;
        *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_out.data + __pyx_t_6 * __pyx_v_out.strides[0]) ) + __pyx_t_7 * __pyx_v_out.strides[1]) )) = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_streamline.data + __pyx_t_4 * __pyx_v_streamline.strides[0]) ) + __pyx_t_5 * __pyx_v_streamline.strides[1]) )));
      }
</pre><pre class="cython line score-0">&#xA0;<span class="">221</span>: </pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">222</span>:             next_point += step</pre>
<pre class='cython code score-0 '>      __pyx_v_next_point = (__pyx_v_next_point + __pyx_v_step);
/* … */
      __pyx_v_next_point = (__pyx_v_next_point + __pyx_v_step);
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">223</span>:             i += 1</pre>
<pre class='cython code score-0 '>      __pyx_v_i = (__pyx_v_i + 1);
/* … */
      __pyx_v_i = (__pyx_v_i + 1);
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">224</span>:             j += 1</pre>
<pre class='cython code score-0 '>      __pyx_v_j = (__pyx_v_j + 1);
/* … */
      __pyx_v_j = (__pyx_v_j + 1);
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">225</span>:             k += 1</pre>
<pre class='cython code score-0 '>      __pyx_v_k = (__pyx_v_k + 1);
/* … */
      __pyx_v_k = (__pyx_v_k + 1);
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">226</span>:         elif next_point &lt; arclengths[k]:</pre>
<pre class='cython code score-0 '>    __pyx_t_1 = ((__pyx_v_next_point &lt; (__pyx_v_arclengths[__pyx_v_k])) != 0);
    if (__pyx_t_1) {
/* … */
      goto __pyx_L5;
    }
/* … */
    __pyx_t_1 = ((__pyx_v_next_point &lt; (__pyx_v_arclengths[__pyx_v_k])) != 0);
    if (__pyx_t_1) {
/* … */
      goto __pyx_L5;
    }
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">227</span>:             ratio = 1 - ((arclengths[k]-next_point) /</pre>
<pre class='cython code score-0 '>      __pyx_v_ratio = (1.0 - (((__pyx_v_arclengths[__pyx_v_k]) - __pyx_v_next_point) / ((__pyx_v_arclengths[__pyx_v_k]) - (__pyx_v_arclengths[(__pyx_v_k - 1)]))));
/* … */
      __pyx_v_ratio = (1.0 - (((__pyx_v_arclengths[__pyx_v_k]) - __pyx_v_next_point) / ((__pyx_v_arclengths[__pyx_v_k]) - (__pyx_v_arclengths[(__pyx_v_k - 1)]))));
</pre><pre class="cython line score-0">&#xA0;<span class="">228</span>:                          (arclengths[k]-arclengths[k-1]))</pre>
<pre class="cython line score-0">&#xA0;<span class="">229</span>: </pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">230</span>:             for dim in range(D):</pre>
<pre class='cython code score-0 '>      __pyx_t_2 = __pyx_v_D;
      for (__pyx_t_3 = 0; __pyx_t_3 &lt; __pyx_t_2; __pyx_t_3+=1) {
        __pyx_v_dim = __pyx_t_3;
/* … */
      __pyx_t_2 = __pyx_v_D;
      for (__pyx_t_3 = 0; __pyx_t_3 &lt; __pyx_t_2; __pyx_t_3+=1) {
        __pyx_v_dim = __pyx_t_3;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">231</span>:                 delta = streamline[j, dim] - streamline[j-1, dim]</pre>
<pre class='cython code score-0 '>        __pyx_t_8 = __pyx_v_j;
        __pyx_t_9 = __pyx_v_dim;
        __pyx_t_10 = (__pyx_v_j - 1);
        __pyx_t_11 = __pyx_v_dim;
        __pyx_v_delta = ((*((float *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_streamline.data + __pyx_t_8 * __pyx_v_streamline.strides[0]) ) + __pyx_t_9 * __pyx_v_streamline.strides[1]) ))) - (*((float *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_streamline.data + __pyx_t_10 * __pyx_v_streamline.strides[0]) ) + __pyx_t_11 * __pyx_v_streamline.strides[1]) ))));
/* … */
        __pyx_t_8 = __pyx_v_j;
        __pyx_t_9 = __pyx_v_dim;
        __pyx_t_10 = (__pyx_v_j - 1);
        __pyx_t_11 = __pyx_v_dim;
        __pyx_v_delta = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_streamline.data + __pyx_t_8 * __pyx_v_streamline.strides[0]) ) + __pyx_t_9 * __pyx_v_streamline.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_streamline.data + __pyx_t_10 * __pyx_v_streamline.strides[0]) ) + __pyx_t_11 * __pyx_v_streamline.strides[1]) ))));
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">232</span>:                 out[i, dim] = streamline[j-1, dim] + ratio * delta</pre>
<pre class='cython code score-0 '>        __pyx_t_12 = (__pyx_v_j - 1);
        __pyx_t_13 = __pyx_v_dim;
        __pyx_t_14 = __pyx_v_i;
        __pyx_t_15 = __pyx_v_dim;
        *((float *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_out.data + __pyx_t_14 * __pyx_v_out.strides[0]) ) + __pyx_t_15 * __pyx_v_out.strides[1]) )) = ((*((float *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_streamline.data + __pyx_t_12 * __pyx_v_streamline.strides[0]) ) + __pyx_t_13 * __pyx_v_streamline.strides[1]) ))) + (__pyx_v_ratio * __pyx_v_delta));
      }
/* … */
        __pyx_t_12 = (__pyx_v_j - 1);
        __pyx_t_13 = __pyx_v_dim;
        __pyx_t_14 = __pyx_v_i;
        __pyx_t_15 = __pyx_v_dim;
        *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_out.data + __pyx_t_14 * __pyx_v_out.strides[0]) ) + __pyx_t_15 * __pyx_v_out.strides[1]) )) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_streamline.data + __pyx_t_12 * __pyx_v_streamline.strides[0]) ) + __pyx_t_13 * __pyx_v_streamline.strides[1]) ))) + (__pyx_v_ratio * __pyx_v_delta));
      }
</pre><pre class="cython line score-0">&#xA0;<span class="">233</span>: </pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">234</span>:             next_point += step</pre>
<pre class='cython code score-0 '>      __pyx_v_next_point = (__pyx_v_next_point + __pyx_v_step);
/* … */
      __pyx_v_next_point = (__pyx_v_next_point + __pyx_v_step);
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">235</span>:             i += 1</pre>
<pre class='cython code score-0 '>      __pyx_v_i = (__pyx_v_i + 1);
/* … */
      __pyx_v_i = (__pyx_v_i + 1);
</pre><pre class="cython line score-0">&#xA0;<span class="">236</span>:         else:</pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">237</span>:             j += 1</pre>
<pre class='cython code score-0 '>    /*else*/ {
      __pyx_v_j = (__pyx_v_j + 1);
/* … */
    /*else*/ {
      __pyx_v_j = (__pyx_v_j + 1);
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">238</span>:             k += 1</pre>
<pre class='cython code score-0 '>      __pyx_v_k = (__pyx_v_k + 1);
    }
    __pyx_L5:;
  }
/* … */
      __pyx_v_k = (__pyx_v_k + 1);
    }
    __pyx_L5:;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">239</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">240</span>:     # Last resampled point always the one from original streamline.</pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">241</span>:     for dim in range(D):</pre>
<pre class='cython code score-0 '>  __pyx_t_2 = __pyx_v_D;
  for (__pyx_t_3 = 0; __pyx_t_3 &lt; __pyx_t_2; __pyx_t_3+=1) {
    __pyx_v_dim = __pyx_t_3;
/* … */
  __pyx_t_2 = __pyx_v_D;
  for (__pyx_t_3 = 0; __pyx_t_3 &lt; __pyx_t_2; __pyx_t_3+=1) {
    __pyx_v_dim = __pyx_t_3;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">242</span>:         out[new_N-1, dim] = streamline[N-1, dim]</pre>
<pre class='cython code score-0 '>    __pyx_t_16 = (__pyx_v_N - 1);
    __pyx_t_17 = __pyx_v_dim;
    __pyx_t_18 = (__pyx_v_new_N - 1);
    __pyx_t_19 = __pyx_v_dim;
    *((float *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_out.data + __pyx_t_18 * __pyx_v_out.strides[0]) ) + __pyx_t_19 * __pyx_v_out.strides[1]) )) = (*((float *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_streamline.data + __pyx_t_16 * __pyx_v_streamline.strides[0]) ) + __pyx_t_17 * __pyx_v_streamline.strides[1]) )));
  }
/* … */
    __pyx_t_16 = (__pyx_v_N - 1);
    __pyx_t_17 = __pyx_v_dim;
    __pyx_t_18 = (__pyx_v_new_N - 1);
    __pyx_t_19 = __pyx_v_dim;
    *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_out.data + __pyx_t_18 * __pyx_v_out.strides[0]) ) + __pyx_t_19 * __pyx_v_out.strides[1]) )) = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_streamline.data + __pyx_t_16 * __pyx_v_streamline.strides[0]) ) + __pyx_t_17 * __pyx_v_streamline.strides[1]) )));
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">243</span>: </pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">244</span>:     free(arclengths)</pre>
<pre class='cython code score-0 '>  free(__pyx_v_arclengths);
/* … */
  free(__pyx_v_arclengths);
</pre><pre class="cython line score-0">&#xA0;<span class="">245</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">246</span>: </pre>
<pre class="cython line score-4" onclick='toggleDiv(this)'>+<span class="">247</span>: cdef void c_set_number_of_points_from_arraysequence(Streamline points,</pre>
<pre class='cython code score-4 '>static void __pyx_fuse_0__pyx_f_4dipy_8tracking_15streamlinespeed_c_set_number_of_points_from_arraysequence(__pyx_t_4dipy_8tracking_15streamlinespeed_float2d __pyx_v_points, __Pyx_memviewslice __pyx_v_offsets, __Pyx_memviewslice __pyx_v_lengths, long __pyx_v_nb_points, __pyx_t_4dipy_8tracking_15streamlinespeed_float2d __pyx_v_out) {
  npy_intp __pyx_v_i;
  npy_intp __pyx_v_offset;
  npy_intp __pyx_v_length;
  npy_intp __pyx_v_offset_out;
/* … */
  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_5, 0);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_7, 0);
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("dipy.tracking.streamlinespeed.c_set_number_of_points_from_arraysequence", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 1);
  __pyx_L0:;
}

static void __pyx_fuse_1__pyx_f_4dipy_8tracking_15streamlinespeed_c_set_number_of_points_from_arraysequence(__pyx_t_4dipy_8tracking_15streamlinespeed_double2d __pyx_v_points, __Pyx_memviewslice __pyx_v_offsets, __Pyx_memviewslice __pyx_v_lengths, long __pyx_v_nb_points, __pyx_t_4dipy_8tracking_15streamlinespeed_double2d __pyx_v_out) {
  npy_intp __pyx_v_i;
  npy_intp __pyx_v_offset;
  npy_intp __pyx_v_length;
  npy_intp __pyx_v_offset_out;
/* … */
  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_5, 0);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_7, 0);
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("dipy.tracking.streamlinespeed.c_set_number_of_points_from_arraysequence", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 1);
  __pyx_L0:;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">248</span>:                                                     np.npy_intp[:] offsets,</pre>
<pre class="cython line score-0">&#xA0;<span class="">249</span>:                                                     np.npy_intp[:] lengths,</pre>
<pre class="cython line score-0">&#xA0;<span class="">250</span>:                                                     long nb_points,</pre>
<pre class="cython line score-0">&#xA0;<span class="">251</span>:                                                     Streamline out) nogil:</pre>
<pre class="cython line score-0">&#xA0;<span class="">252</span>:     cdef:</pre>
<pre class="cython line score-0">&#xA0;<span class="">253</span>:         np.npy_intp i, j, k</pre>
<pre class="cython line score-0">&#xA0;<span class="">254</span>:         np.npy_intp offset, length</pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">255</span>:         np.npy_intp offset_out = 0</pre>
<pre class='cython code score-0 '>  __pyx_v_offset_out = 0;
/* … */
  __pyx_v_offset_out = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">256</span>:         double dn, sum_dn_sqr</pre>
<pre class="cython line score-0">&#xA0;<span class="">257</span>: </pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">258</span>:     for i in range(offsets.shape[0]):</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = (__pyx_v_offsets.shape[0]);
  for (__pyx_t_2 = 0; __pyx_t_2 &lt; __pyx_t_1; __pyx_t_2+=1) {
    __pyx_v_i = __pyx_t_2;
/* … */
  __pyx_t_1 = (__pyx_v_offsets.shape[0]);
  for (__pyx_t_2 = 0; __pyx_t_2 &lt; __pyx_t_1; __pyx_t_2+=1) {
    __pyx_v_i = __pyx_t_2;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">259</span>:         offset = offsets[i]</pre>
<pre class='cython code score-0 '>    __pyx_t_3 = __pyx_v_i;
    __pyx_v_offset = (*((npy_intp *) ( /* dim=0 */ (__pyx_v_offsets.data + __pyx_t_3 * __pyx_v_offsets.strides[0]) )));
/* … */
    __pyx_t_3 = __pyx_v_i;
    __pyx_v_offset = (*((npy_intp *) ( /* dim=0 */ (__pyx_v_offsets.data + __pyx_t_3 * __pyx_v_offsets.strides[0]) )));
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">260</span>:         length = lengths[i]</pre>
<pre class='cython code score-0 '>    __pyx_t_4 = __pyx_v_i;
    __pyx_v_length = (*((npy_intp *) ( /* dim=0 */ (__pyx_v_lengths.data + __pyx_t_4 * __pyx_v_lengths.strides[0]) )));
/* … */
    __pyx_t_4 = __pyx_v_i;
    __pyx_v_length = (*((npy_intp *) ( /* dim=0 */ (__pyx_v_lengths.data + __pyx_t_4 * __pyx_v_lengths.strides[0]) )));
</pre><pre class="cython line score-0">&#xA0;<span class="">261</span>: </pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">262</span>:         c_set_number_of_points(points[offset:offset+length, :],</pre>
<pre class='cython code score-0 '>    __pyx_t_5.data = __pyx_v_points.data;
    __pyx_t_5.memview = __pyx_v_points.memview;
    __PYX_INC_MEMVIEW(&amp;__pyx_t_5, 0);
    __pyx_t_6 = -1;
    if (unlikely(__pyx_memoryview_slice_memviewslice(
    &amp;__pyx_t_5,
    __pyx_v_points.shape[0], __pyx_v_points.strides[0], __pyx_v_points.suboffsets[0],
    0,
    0,
    &amp;__pyx_t_6,
    __pyx_v_offset,
    (__pyx_v_offset + __pyx_v_length),
    0,
    1,
    1,
    0,
    1) &lt; 0))
{
    <span class='error_goto'>__PYX_ERR(0, 262, __pyx_L1_error)</span>
}

__pyx_t_5.shape[1] = __pyx_v_points.shape[1];
__pyx_t_5.strides[1] = __pyx_v_points.strides[1];
    __pyx_t_5.suboffsets[1] = -1;

__pyx_fuse_0__pyx_f_4dipy_8tracking_15streamlinespeed_c_set_number_of_points(__pyx_t_5, __pyx_t_7);
/* … */
    __PYX_XDEC_MEMVIEW(&amp;__pyx_t_5, 0);
    __pyx_t_5.memview = NULL;
    __pyx_t_5.data = NULL;
    __PYX_XDEC_MEMVIEW(&amp;__pyx_t_7, 0);
    __pyx_t_7.memview = NULL;
    __pyx_t_7.data = NULL;
/* … */
    __pyx_t_5.data = __pyx_v_points.data;
    __pyx_t_5.memview = __pyx_v_points.memview;
    __PYX_INC_MEMVIEW(&amp;__pyx_t_5, 0);
    __pyx_t_6 = -1;
    if (unlikely(__pyx_memoryview_slice_memviewslice(
    &amp;__pyx_t_5,
    __pyx_v_points.shape[0], __pyx_v_points.strides[0], __pyx_v_points.suboffsets[0],
    0,
    0,
    &amp;__pyx_t_6,
    __pyx_v_offset,
    (__pyx_v_offset + __pyx_v_length),
    0,
    1,
    1,
    0,
    1) &lt; 0))
{
    <span class='error_goto'>__PYX_ERR(0, 262, __pyx_L1_error)</span>
}

__pyx_t_5.shape[1] = __pyx_v_points.shape[1];
__pyx_t_5.strides[1] = __pyx_v_points.strides[1];
    __pyx_t_5.suboffsets[1] = -1;

__pyx_fuse_1__pyx_f_4dipy_8tracking_15streamlinespeed_c_set_number_of_points(__pyx_t_5, __pyx_t_7);
/* … */
    __PYX_XDEC_MEMVIEW(&amp;__pyx_t_5, 0);
    __pyx_t_5.memview = NULL;
    __pyx_t_5.data = NULL;
    __PYX_XDEC_MEMVIEW(&amp;__pyx_t_7, 0);
    __pyx_t_7.memview = NULL;
    __pyx_t_7.data = NULL;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">263</span>:                                out[offset_out:offset_out+nb_points, :])</pre>
<pre class='cython code score-0 '>__pyx_t_7.data = __pyx_v_out.data;
/* … */
    __pyx_t_7.memview = __pyx_v_out.memview;
    __PYX_INC_MEMVIEW(&amp;__pyx_t_7, 0);
    __pyx_t_6 = -1;
    if (unlikely(__pyx_memoryview_slice_memviewslice(
    &amp;__pyx_t_7,
    __pyx_v_out.shape[0], __pyx_v_out.strides[0], __pyx_v_out.suboffsets[0],
    0,
    0,
    &amp;__pyx_t_6,
    __pyx_v_offset_out,
    (__pyx_v_offset_out + __pyx_v_nb_points),
    0,
    1,
    1,
    0,
    1) &lt; 0))
{
    <span class='error_goto'>__PYX_ERR(0, 263, __pyx_L1_error)</span>
}

__pyx_t_7.shape[1] = __pyx_v_out.shape[1];
__pyx_t_7.strides[1] = __pyx_v_out.strides[1];
    __pyx_t_7.suboffsets[1] = -1;

__pyx_t_7.data = __pyx_v_out.data;
/* … */
    __pyx_t_7.memview = __pyx_v_out.memview;
    __PYX_INC_MEMVIEW(&amp;__pyx_t_7, 0);
    __pyx_t_6 = -1;
    if (unlikely(__pyx_memoryview_slice_memviewslice(
    &amp;__pyx_t_7,
    __pyx_v_out.shape[0], __pyx_v_out.strides[0], __pyx_v_out.suboffsets[0],
    0,
    0,
    &amp;__pyx_t_6,
    __pyx_v_offset_out,
    (__pyx_v_offset_out + __pyx_v_nb_points),
    0,
    1,
    1,
    0,
    1) &lt; 0))
{
    <span class='error_goto'>__PYX_ERR(0, 263, __pyx_L1_error)</span>
}

__pyx_t_7.shape[1] = __pyx_v_out.shape[1];
__pyx_t_7.strides[1] = __pyx_v_out.strides[1];
    __pyx_t_7.suboffsets[1] = -1;

</pre><pre class="cython line score-0">&#xA0;<span class="">264</span>: </pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">265</span>:         offset_out += nb_points</pre>
<pre class='cython code score-0 '>    __pyx_v_offset_out = (__pyx_v_offset_out + __pyx_v_nb_points);
  }
/* … */
    __pyx_v_offset_out = (__pyx_v_offset_out + __pyx_v_nb_points);
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">266</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">267</span>: </pre>
<pre class="cython line score-56" onclick='toggleDiv(this)'>+<span class="">268</span>: def set_number_of_points(streamlines, nb_points=3):</pre>
<pre class='cython code score-56 '>/* Python wrapper */
static PyObject *__pyx_pw_4dipy_8tracking_15streamlinespeed_3set_number_of_points(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4dipy_8tracking_15streamlinespeed_2set_number_of_points[] = " Change the number of points of streamlines\n        (either by downsampling or upsampling)\n\n    Change the number of points of streamlines in order to obtain\n    `nb_points`-1 segments of equal length. Points of streamlines will be\n    modified along the curve.\n\n    Parameters\n    ----------\n    streamlines : ndarray or a list or :class:`dipy.tracking.Streamlines`\n        If ndarray, must have shape (N,3) where N is the number of points\n        of the streamline.\n        If list, each item must be ndarray shape (Ni,3) where Ni is the number\n        of points of streamline i.\n        If :class:`dipy.tracking.Streamlines`, its `common_shape` must be 3.\n\n    nb_points : int\n        integer representing number of points wanted along the curve.\n\n    Returns\n    -------\n    new_streamlines : ndarray or a list or :class:`dipy.tracking.Streamlines`\n        Results of the downsampling or upsampling process.\n\n    Examples\n    --------\n    &gt;&gt;&gt; from dipy.tracking.streamline import set_number_of_points\n    &gt;&gt;&gt; import numpy as np\n\n    One streamline, a semi-circle:\n\n    &gt;&gt;&gt; theta = np.pi*np.linspace(0, 1, 100)\n    &gt;&gt;&gt; x = np.cos(theta)\n    &gt;&gt;&gt; y = np.sin(theta)\n    &gt;&gt;&gt; z = 0 * x\n    &gt;&gt;&gt; streamline = np.vstack((x, y, z)).T\n    &gt;&gt;&gt; modified_streamline = set_number_of_points(streamline, 3)\n    &gt;&gt;&gt; len(modified_streamline)\n    3\n\n    Multiple streamlines:\n\n    &gt;&gt;&gt; streamlines = [streamline, streamline[::2]]\n    &gt;&gt;&gt; new_streamlines = set_number_of_points(streamlines, 10)\n    &gt;&gt;&gt; [len(s) for s in streamlines]\n    [100, 50]\n    &gt;&gt;&gt; [len(s) for s in new_streamlines]\n    [10, 10]\n\n    ";
static PyMethodDef __pyx_mdef_4dipy_8tracking_15streamlinespeed_3set_number_of_points = {"set_number_of_points", (PyCFunction)__pyx_pw_4dipy_8tracking_15streamlinespeed_3set_number_of_points, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4dipy_8tracking_15streamlinespeed_2set_number_of_points};
static PyObject *__pyx_pw_4dipy_8tracking_15streamlinespeed_3set_number_of_points(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_streamlines = 0;
  PyObject *__pyx_v_nb_points = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("set_number_of_points (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_streamlines,&amp;__pyx_n_s_nb_points,0};
    PyObject* values[2] = {0,0};
    values[1] = ((PyObject *)__pyx_int_3);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_streamlines)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_nb_points);
          if (value) { values[1] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "set_number_of_points") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 268, __pyx_L3_error)</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_streamlines = values[0];
    __pyx_v_nb_points = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("set_number_of_points", 0, 1, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 268, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("dipy.tracking.streamlinespeed.set_number_of_points", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_4dipy_8tracking_15streamlinespeed_2set_number_of_points(__pyx_self, __pyx_v_streamlines, __pyx_v_nb_points);

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_4dipy_8tracking_15streamlinespeed_2set_number_of_points(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_streamlines, PyObject *__pyx_v_nb_points) {
  PyObject *__pyx_v_nb_streamlines = NULL;
  PyObject *__pyx_v_dtype = NULL;
  PyObject *__pyx_v_new_streamlines = NULL;
  int __pyx_v_only_one_streamlines;
  PyObject *__pyx_v_streamline = NULL;
  npy_intp __pyx_v_i;
  PyObject *__pyx_v_new_streamline = NULL;
  PyObject *__pyx_v_modified_streamline = NULL;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("set_number_of_points", 0);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_streamlines);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_9, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_10, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_11, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_13, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_14, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_15, 1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("dipy.tracking.streamlinespeed.set_number_of_points", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_nb_streamlines);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_dtype);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_new_streamlines);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_streamline);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_new_streamline);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_modified_streamline);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_streamlines);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__33 = <span class='py_c_api'>PyTuple_Pack</span>(10, __pyx_n_s_streamlines, __pyx_n_s_nb_points, __pyx_n_s_nb_streamlines, __pyx_n_s_dtype, __pyx_n_s_new_streamlines, __pyx_n_s_only_one_streamlines, __pyx_n_s_streamline, __pyx_n_s_i, __pyx_n_s_new_streamline, __pyx_n_s_modified_streamline);<span class='error_goto'> if (unlikely(!__pyx_tuple__33)) __PYX_ERR(0, 268, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__33);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__33);
/* … */
  __pyx_t_2 = PyCFunction_NewEx(&amp;__pyx_mdef_4dipy_8tracking_15streamlinespeed_3set_number_of_points, NULL, __pyx_n_s_dipy_tracking_streamlinespeed);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 268, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_set_number_of_points, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 268, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_codeobj__34 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(2, 0, 10, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__33, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_dipy_tracking_streamlinespeed_py, __pyx_n_s_set_number_of_points, 268, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__34)) __PYX_ERR(0, 268, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">269</span>:     ''' Change the number of points of streamlines</pre>
<pre class="cython line score-0">&#xA0;<span class="">270</span>:         (either by downsampling or upsampling)</pre>
<pre class="cython line score-0">&#xA0;<span class="">271</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">272</span>:     Change the number of points of streamlines in order to obtain</pre>
<pre class="cython line score-0">&#xA0;<span class="">273</span>:     `nb_points`-1 segments of equal length. Points of streamlines will be</pre>
<pre class="cython line score-0">&#xA0;<span class="">274</span>:     modified along the curve.</pre>
<pre class="cython line score-0">&#xA0;<span class="">275</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">276</span>:     Parameters</pre>
<pre class="cython line score-0">&#xA0;<span class="">277</span>:     ----------</pre>
<pre class="cython line score-0">&#xA0;<span class="">278</span>:     streamlines : ndarray or a list or :class:`dipy.tracking.Streamlines`</pre>
<pre class="cython line score-0">&#xA0;<span class="">279</span>:         If ndarray, must have shape (N,3) where N is the number of points</pre>
<pre class="cython line score-0">&#xA0;<span class="">280</span>:         of the streamline.</pre>
<pre class="cython line score-0">&#xA0;<span class="">281</span>:         If list, each item must be ndarray shape (Ni,3) where Ni is the number</pre>
<pre class="cython line score-0">&#xA0;<span class="">282</span>:         of points of streamline i.</pre>
<pre class="cython line score-0">&#xA0;<span class="">283</span>:         If :class:`dipy.tracking.Streamlines`, its `common_shape` must be 3.</pre>
<pre class="cython line score-0">&#xA0;<span class="">284</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">285</span>:     nb_points : int</pre>
<pre class="cython line score-0">&#xA0;<span class="">286</span>:         integer representing number of points wanted along the curve.</pre>
<pre class="cython line score-0">&#xA0;<span class="">287</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">288</span>:     Returns</pre>
<pre class="cython line score-0">&#xA0;<span class="">289</span>:     -------</pre>
<pre class="cython line score-0">&#xA0;<span class="">290</span>:     new_streamlines : ndarray or a list or :class:`dipy.tracking.Streamlines`</pre>
<pre class="cython line score-0">&#xA0;<span class="">291</span>:         Results of the downsampling or upsampling process.</pre>
<pre class="cython line score-0">&#xA0;<span class="">292</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">293</span>:     Examples</pre>
<pre class="cython line score-0">&#xA0;<span class="">294</span>:     --------</pre>
<pre class="cython line score-0">&#xA0;<span class="">295</span>:     &gt;&gt;&gt; from dipy.tracking.streamline import set_number_of_points</pre>
<pre class="cython line score-0">&#xA0;<span class="">296</span>:     &gt;&gt;&gt; import numpy as np</pre>
<pre class="cython line score-0">&#xA0;<span class="">297</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">298</span>:     One streamline, a semi-circle:</pre>
<pre class="cython line score-0">&#xA0;<span class="">299</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">300</span>:     &gt;&gt;&gt; theta = np.pi*np.linspace(0, 1, 100)</pre>
<pre class="cython line score-0">&#xA0;<span class="">301</span>:     &gt;&gt;&gt; x = np.cos(theta)</pre>
<pre class="cython line score-0">&#xA0;<span class="">302</span>:     &gt;&gt;&gt; y = np.sin(theta)</pre>
<pre class="cython line score-0">&#xA0;<span class="">303</span>:     &gt;&gt;&gt; z = 0 * x</pre>
<pre class="cython line score-0">&#xA0;<span class="">304</span>:     &gt;&gt;&gt; streamline = np.vstack((x, y, z)).T</pre>
<pre class="cython line score-0">&#xA0;<span class="">305</span>:     &gt;&gt;&gt; modified_streamline = set_number_of_points(streamline, 3)</pre>
<pre class="cython line score-0">&#xA0;<span class="">306</span>:     &gt;&gt;&gt; len(modified_streamline)</pre>
<pre class="cython line score-0">&#xA0;<span class="">307</span>:     3</pre>
<pre class="cython line score-0">&#xA0;<span class="">308</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">309</span>:     Multiple streamlines:</pre>
<pre class="cython line score-0">&#xA0;<span class="">310</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">311</span>:     &gt;&gt;&gt; streamlines = [streamline, streamline[::2]]</pre>
<pre class="cython line score-0">&#xA0;<span class="">312</span>:     &gt;&gt;&gt; new_streamlines = set_number_of_points(streamlines, 10)</pre>
<pre class="cython line score-0">&#xA0;<span class="">313</span>:     &gt;&gt;&gt; [len(s) for s in streamlines]</pre>
<pre class="cython line score-0">&#xA0;<span class="">314</span>:     [100, 50]</pre>
<pre class="cython line score-0">&#xA0;<span class="">315</span>:     &gt;&gt;&gt; [len(s) for s in new_streamlines]</pre>
<pre class="cython line score-0">&#xA0;<span class="">316</span>:     [10, 10]</pre>
<pre class="cython line score-0">&#xA0;<span class="">317</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">318</span>:     '''</pre>
<pre class="cython line score-8" onclick='toggleDiv(this)'>+<span class="">319</span>:     if isinstance(streamlines, Streamlines):</pre>
<pre class='cython code score-8 '>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_Streamlines);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 319, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyObject_IsInstance</span>(__pyx_v_streamlines, __pyx_t_1);<span class='error_goto'> if (unlikely(__pyx_t_2 == ((int)-1))) __PYX_ERR(0, 319, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_3 = (__pyx_t_2 != 0);
  if (__pyx_t_3) {
/* … */
  }
</pre><pre class="cython line score-5" onclick='toggleDiv(this)'>+<span class="">320</span>:         if len(streamlines) == 0:</pre>
<pre class='cython code score-5 '>    __pyx_t_4 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_streamlines);<span class='error_goto'> if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 320, __pyx_L1_error)</span>
    __pyx_t_3 = ((__pyx_t_4 == 0) != 0);
    if (__pyx_t_3) {
/* … */
    }
</pre><pre class="cython line score-19" onclick='toggleDiv(this)'>+<span class="">321</span>:             return Streamlines()</pre>
<pre class='cython code score-19 '>      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_Streamlines);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 321, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      __pyx_t_6 = NULL;
      if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_5))) {
        __pyx_t_6 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_5);
        if (likely(__pyx_t_6)) {
          PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_5);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_6);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
          <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_5, function);
        }
      }
      if (__pyx_t_6) {
        __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_5, __pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 321, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      } else {
        __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_CallNoArg</span>(__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 321, __pyx_L1_error)</span>
      }
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_r = __pyx_t_1;
      __pyx_t_1 = 0;
      goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">322</span>: </pre>
<pre class="cython line score-10" onclick='toggleDiv(this)'>+<span class="">323</span>:         nb_streamlines = len(streamlines)</pre>
<pre class='cython code score-10 '>    __pyx_t_4 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_streamlines);<span class='error_goto'> if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 323, __pyx_L1_error)</span>
    __pyx_t_1 = <span class='py_c_api'>PyInt_FromSsize_t</span>(__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 323, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_v_nb_streamlines = __pyx_t_1;
    __pyx_t_1 = 0;
</pre><pre class="cython line score-5" onclick='toggleDiv(this)'>+<span class="">324</span>:         dtype = streamlines._data.dtype</pre>
<pre class='cython code score-5 '>    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_streamlines, __pyx_n_s_data_2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 324, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_dtype);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 324, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_v_dtype = __pyx_t_5;
    __pyx_t_5 = 0;
</pre><pre class="cython line score-18" onclick='toggleDiv(this)'>+<span class="">325</span>:         new_streamlines = Streamlines()</pre>
<pre class='cython code score-18 '>    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_Streamlines);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 325, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_6 = NULL;
    if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_1))) {
      __pyx_t_6 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_1);
      if (likely(__pyx_t_6)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_1);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_6);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_1, function);
      }
    }
    if (__pyx_t_6) {
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_1, __pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 325, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    } else {
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_CallNoArg</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 325, __pyx_L1_error)</span>
    }
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_v_new_streamlines = __pyx_t_5;
    __pyx_t_5 = 0;
</pre><pre class="cython line score-32" onclick='toggleDiv(this)'>+<span class="">326</span>:         new_streamlines._data = np.zeros((nb_streamlines * nb_points, 3),</pre>
<pre class='cython code score-32 '>    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 326, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_5, __pyx_n_s_zeros);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 326, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_v_nb_streamlines, __pyx_v_nb_points);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 326, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    __pyx_t_6 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 326, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 0, __pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_3);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_3);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 1, __pyx_int_3);
    __pyx_t_5 = 0;
    __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 326, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_6);
    __pyx_t_6 = 0;
/* … */
    __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_1, __pyx_t_5, __pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 326, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    if (<span class='pyx_c_api'>__Pyx_PyObject_SetAttrStr</span>(__pyx_v_new_streamlines, __pyx_n_s_data_2, __pyx_t_7) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 326, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
</pre><pre class="cython line score-7" onclick='toggleDiv(this)'>+<span class="">327</span>:                                          dtype=dtype)</pre>
<pre class='cython code score-7 '>    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 327, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_6, __pyx_n_s_dtype, __pyx_v_dtype) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 327, __pyx_L1_error)</span>
</pre><pre class="cython line score-26" onclick='toggleDiv(this)'>+<span class="">328</span>:         new_streamlines._offsets = nb_points * np.arange(nb_streamlines,</pre>
<pre class='cython code score-26 '>    __pyx_t_7 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 328, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_7, __pyx_n_s_arange);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 328, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    __pyx_t_7 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 328, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_nb_streamlines);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_nb_streamlines);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 0, __pyx_v_nb_streamlines);
/* … */
    __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_6, __pyx_t_7, __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 328, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_v_nb_points, __pyx_t_8);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 328, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    if (<span class='pyx_c_api'>__Pyx_PyObject_SetAttrStr</span>(__pyx_v_new_streamlines, __pyx_n_s_offsets, __pyx_t_5) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 328, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
</pre><pre class="cython line score-13" onclick='toggleDiv(this)'>+<span class="">329</span>:                                                          dtype=np.intp)</pre>
<pre class='cython code score-13 '>    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 329, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 329, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_intp);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 329, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_8) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 329, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
</pre><pre class="cython line score-26" onclick='toggleDiv(this)'>+<span class="">330</span>:         new_streamlines._lengths = nb_points * np.ones(nb_streamlines,</pre>
<pre class='cython code score-26 '>    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 330, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_5, __pyx_n_s_ones);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 330, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 330, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_nb_streamlines);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_nb_streamlines);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_v_nb_streamlines);
/* … */
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_8, __pyx_t_5, __pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 330, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    __pyx_t_7 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_v_nb_points, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 330, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    if (<span class='pyx_c_api'>__Pyx_PyObject_SetAttrStr</span>(__pyx_v_new_streamlines, __pyx_n_s_lengths, __pyx_t_7) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 330, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
</pre><pre class="cython line score-13" onclick='toggleDiv(this)'>+<span class="">331</span>:                                                        dtype=np.intp)</pre>
<pre class='cython code score-13 '>    __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 331, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 331, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_6, __pyx_n_s_intp);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 331, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 331, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">332</span>: </pre>
<pre class="cython line score-14" onclick='toggleDiv(this)'>+<span class="">333</span>:         if dtype == np.float32:</pre>
<pre class='cython code score-14 '>    __pyx_t_7 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 333, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_7, __pyx_n_s_float32);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 333, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    __pyx_t_7 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_v_dtype, __pyx_t_1, Py_EQ); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 333, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_7); if (unlikely(__pyx_t_3 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 333, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    if (__pyx_t_3) {
/* … */
      goto __pyx_L5;
    }
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">334</span>:             c_set_number_of_points_from_arraysequence[float2d](</pre>
<pre class='cython code score-0 '>      __pyx_fuse_0__pyx_f_4dipy_8tracking_15streamlinespeed_c_set_number_of_points_from_arraysequence(__pyx_t_9, __pyx_t_10, __pyx_t_11, __pyx_t_12, __pyx_t_13);
      __PYX_XDEC_MEMVIEW(&amp;__pyx_t_9, 1);
      __pyx_t_9.memview = NULL;
      __pyx_t_9.data = NULL;
      __PYX_XDEC_MEMVIEW(&amp;__pyx_t_10, 1);
      __pyx_t_10.memview = NULL;
      __pyx_t_10.data = NULL;
      __PYX_XDEC_MEMVIEW(&amp;__pyx_t_11, 1);
      __pyx_t_11.memview = NULL;
      __pyx_t_11.data = NULL;
      __PYX_XDEC_MEMVIEW(&amp;__pyx_t_13, 1);
      __pyx_t_13.memview = NULL;
      __pyx_t_13.data = NULL;
</pre><pre class="cython line score-57" onclick='toggleDiv(this)'>+<span class="">335</span>:                 streamlines._data, streamlines._offsets.astype(np.intp),</pre>
<pre class='cython code score-57 '>      __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_streamlines, __pyx_n_s_data_2);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 335, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
      __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_float</span>(__pyx_t_7);
      if (unlikely(!__pyx_t_9.memview)) <span class='error_goto'>__PYX_ERR(0, 335, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_streamlines, __pyx_n_s_offsets);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 335, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_astype);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 335, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 335, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_intp);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 335, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = NULL;
      if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_5))) {
        __pyx_t_1 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_5);
        if (likely(__pyx_t_1)) {
          PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_5);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
          <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_5, function);
        }
      }
      if (!__pyx_t_1) {
        __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_5, __pyx_t_8);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 335, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
      } else {
        #if CYTHON_FAST_PYCALL
        if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_5)) {
          PyObject *__pyx_temp[2] = {__pyx_t_1, __pyx_t_8};
          __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_5, __pyx_temp+1-1, 1+1);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 335, __pyx_L1_error)</span>
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
        } else
        #endif
        #if CYTHON_FAST_PYCCALL
        if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_5)) {
          PyObject *__pyx_temp[2] = {__pyx_t_1, __pyx_t_8};
          __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_5, __pyx_temp+1-1, 1+1);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 335, __pyx_L1_error)</span>
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
        } else
        #endif
        {
          __pyx_t_6 = <span class='py_c_api'>PyTuple_New</span>(1+1);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 335, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 0, __pyx_t_1); __pyx_t_1 = NULL;
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_8);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 0+1, __pyx_t_8);
          __pyx_t_8 = 0;
          __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_5, __pyx_t_6, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 335, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
        }
      }
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_nn_npy_intp</span>(__pyx_t_7);
      if (unlikely(!__pyx_t_10.memview)) <span class='error_goto'>__PYX_ERR(0, 335, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
</pre><pre class="cython line score-59" onclick='toggleDiv(this)'>+<span class="">336</span>:                 streamlines._lengths.astype(np.intp), nb_points,</pre>
<pre class='cython code score-59 '>      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_streamlines, __pyx_n_s_lengths);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 336, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_5, __pyx_n_s_astype);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 336, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 336, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_5, __pyx_n_s_intp);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 336, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_5 = NULL;
      if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_6))) {
        __pyx_t_5 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_6);
        if (likely(__pyx_t_5)) {
          PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_6);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
          <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_6, function);
        }
      }
      if (!__pyx_t_5) {
        __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_6, __pyx_t_8);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 336, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
      } else {
        #if CYTHON_FAST_PYCALL
        if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_6)) {
          PyObject *__pyx_temp[2] = {__pyx_t_5, __pyx_t_8};
          __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_6, __pyx_temp+1-1, 1+1);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 336, __pyx_L1_error)</span>
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
        } else
        #endif
        #if CYTHON_FAST_PYCCALL
        if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_6)) {
          PyObject *__pyx_temp[2] = {__pyx_t_5, __pyx_t_8};
          __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_6, __pyx_temp+1-1, 1+1);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 336, __pyx_L1_error)</span>
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
        } else
        #endif
        {
          __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1+1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 336, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_t_5); __pyx_t_5 = NULL;
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_8);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0+1, __pyx_t_8);
          __pyx_t_8 = 0;
          __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_6, __pyx_t_1, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 336, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
        }
      }
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_nn_npy_intp</span>(__pyx_t_7);
      if (unlikely(!__pyx_t_11.memview)) <span class='error_goto'>__PYX_ERR(0, 336, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(__pyx_v_nb_points); if (unlikely((__pyx_t_12 == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 336, __pyx_L1_error)</span>
</pre><pre class="cython line score-5" onclick='toggleDiv(this)'>+<span class="">337</span>:                 new_streamlines._data)</pre>
<pre class='cython code score-5 '>      __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_new_streamlines, __pyx_n_s_data_2);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 337, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
      __pyx_t_13 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_float</span>(__pyx_t_7);
      if (unlikely(!__pyx_t_13.memview)) <span class='error_goto'>__PYX_ERR(0, 337, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">338</span>:         else:</pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">339</span>:             c_set_number_of_points_from_arraysequence[double2d](</pre>
<pre class='cython code score-0 '>    /*else*/ {
/* … */
      __pyx_fuse_1__pyx_f_4dipy_8tracking_15streamlinespeed_c_set_number_of_points_from_arraysequence(__pyx_t_14, __pyx_t_11, __pyx_t_10, __pyx_t_12, __pyx_t_15);
      __PYX_XDEC_MEMVIEW(&amp;__pyx_t_14, 1);
      __pyx_t_14.memview = NULL;
      __pyx_t_14.data = NULL;
      __PYX_XDEC_MEMVIEW(&amp;__pyx_t_11, 1);
      __pyx_t_11.memview = NULL;
      __pyx_t_11.data = NULL;
      __PYX_XDEC_MEMVIEW(&amp;__pyx_t_10, 1);
      __pyx_t_10.memview = NULL;
      __pyx_t_10.data = NULL;
      __PYX_XDEC_MEMVIEW(&amp;__pyx_t_15, 1);
      __pyx_t_15.memview = NULL;
      __pyx_t_15.data = NULL;
    }
    __pyx_L5:;
</pre><pre class="cython line score-57" onclick='toggleDiv(this)'>+<span class="">340</span>:                 streamlines._data, streamlines._offsets.astype(np.intp),</pre>
<pre class='cython code score-57 '>      __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_streamlines, __pyx_n_s_data_2);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 340, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
      __pyx_t_14 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(__pyx_t_7);
      if (unlikely(!__pyx_t_14.memview)) <span class='error_goto'>__PYX_ERR(0, 340, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_streamlines, __pyx_n_s_offsets);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 340, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_6, __pyx_n_s_astype);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 340, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 340, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_6, __pyx_n_s_intp);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 340, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_6 = NULL;
      if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_1))) {
        __pyx_t_6 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_1);
        if (likely(__pyx_t_6)) {
          PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_1);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_6);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
          <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_1, function);
        }
      }
      if (!__pyx_t_6) {
        __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_1, __pyx_t_8);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 340, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
      } else {
        #if CYTHON_FAST_PYCALL
        if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_1)) {
          PyObject *__pyx_temp[2] = {__pyx_t_6, __pyx_t_8};
          __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_1, __pyx_temp+1-1, 1+1);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 340, __pyx_L1_error)</span>
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
        } else
        #endif
        #if CYTHON_FAST_PYCCALL
        if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_1)) {
          PyObject *__pyx_temp[2] = {__pyx_t_6, __pyx_t_8};
          __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_1, __pyx_temp+1-1, 1+1);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 340, __pyx_L1_error)</span>
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
        } else
        #endif
        {
          __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(1+1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 340, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_6); __pyx_t_6 = NULL;
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_8);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0+1, __pyx_t_8);
          __pyx_t_8 = 0;
          __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_1, __pyx_t_5, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 340, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
        }
      }
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_nn_npy_intp</span>(__pyx_t_7);
      if (unlikely(!__pyx_t_11.memview)) <span class='error_goto'>__PYX_ERR(0, 340, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
</pre><pre class="cython line score-59" onclick='toggleDiv(this)'>+<span class="">341</span>:                 streamlines._lengths.astype(np.intp), nb_points,</pre>
<pre class='cython code score-59 '>      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_streamlines, __pyx_n_s_lengths);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 341, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_astype);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 341, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 341, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_intp);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 341, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = NULL;
      if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_5))) {
        __pyx_t_1 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_5);
        if (likely(__pyx_t_1)) {
          PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_5);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
          <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_5, function);
        }
      }
      if (!__pyx_t_1) {
        __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_5, __pyx_t_8);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 341, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
      } else {
        #if CYTHON_FAST_PYCALL
        if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_5)) {
          PyObject *__pyx_temp[2] = {__pyx_t_1, __pyx_t_8};
          __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_5, __pyx_temp+1-1, 1+1);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 341, __pyx_L1_error)</span>
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
        } else
        #endif
        #if CYTHON_FAST_PYCCALL
        if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_5)) {
          PyObject *__pyx_temp[2] = {__pyx_t_1, __pyx_t_8};
          __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_5, __pyx_temp+1-1, 1+1);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 341, __pyx_L1_error)</span>
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
        } else
        #endif
        {
          __pyx_t_6 = <span class='py_c_api'>PyTuple_New</span>(1+1);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 341, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 0, __pyx_t_1); __pyx_t_1 = NULL;
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_8);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 0+1, __pyx_t_8);
          __pyx_t_8 = 0;
          __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_5, __pyx_t_6, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 341, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
        }
      }
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_nn_npy_intp</span>(__pyx_t_7);
      if (unlikely(!__pyx_t_10.memview)) <span class='error_goto'>__PYX_ERR(0, 341, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(__pyx_v_nb_points); if (unlikely((__pyx_t_12 == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 341, __pyx_L1_error)</span>
</pre><pre class="cython line score-5" onclick='toggleDiv(this)'>+<span class="">342</span>:                 new_streamlines._data)</pre>
<pre class='cython code score-5 '>      __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_new_streamlines, __pyx_n_s_data_2);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 342, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
      __pyx_t_15 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(__pyx_t_7);
      if (unlikely(!__pyx_t_15.memview)) <span class='error_goto'>__PYX_ERR(0, 342, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">343</span>: </pre>
<pre class="cython line score-2" onclick='toggleDiv(this)'>+<span class="">344</span>:         return new_streamlines</pre>
<pre class='cython code score-2 '>    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_new_streamlines);
    __pyx_r = __pyx_v_new_streamlines;
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">345</span>: </pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">346</span>:     only_one_streamlines = False</pre>
<pre class='cython code score-0 '>  __pyx_v_only_one_streamlines = 0;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">347</span>:     if type(streamlines) is np.ndarray:</pre>
<pre class='cython code score-0 '>  __pyx_t_3 = (((PyObject *)Py_TYPE(__pyx_v_streamlines)) == ((PyObject *)__pyx_ptype_5numpy_ndarray));
  __pyx_t_2 = (__pyx_t_3 != 0);
  if (__pyx_t_2) {
/* … */
  }
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">348</span>:         only_one_streamlines = True</pre>
<pre class='cython code score-0 '>    __pyx_v_only_one_streamlines = 1;
</pre><pre class="cython line score-8" onclick='toggleDiv(this)'>+<span class="">349</span>:         streamlines = [streamlines]</pre>
<pre class='cython code score-8 '>    __pyx_t_7 = <span class='py_c_api'>PyList_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 349, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_streamlines);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_streamlines);
    <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_7, 0, __pyx_v_streamlines);
    <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_streamlines, __pyx_t_7);
    __pyx_t_7 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">350</span>: </pre>
<pre class="cython line score-5" onclick='toggleDiv(this)'>+<span class="">351</span>:     if len(streamlines) == 0:</pre>
<pre class='cython code score-5 '>  __pyx_t_4 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_streamlines);<span class='error_goto'> if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 351, __pyx_L1_error)</span>
  __pyx_t_2 = ((__pyx_t_4 == 0) != 0);
  if (__pyx_t_2) {
/* … */
  }
</pre><pre class="cython line score-6" onclick='toggleDiv(this)'>+<span class="">352</span>:         return []</pre>
<pre class='cython code score-6 '>    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
    __pyx_t_7 = <span class='py_c_api'>PyList_New</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 352, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    __pyx_r = __pyx_t_7;
    __pyx_t_7 = 0;
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">353</span>: </pre>
<pre class="cython line score-8" onclick='toggleDiv(this)'>+<span class="">354</span>:     if nb_points &lt; 2:</pre>
<pre class='cython code score-8 '>  __pyx_t_7 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_v_nb_points, __pyx_int_2, Py_LT); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 354, __pyx_L1_error)</span>
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_7); if (unlikely(__pyx_t_2 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 354, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  if (__pyx_t_2) {
/* … */
  }
</pre><pre class="cython line score-10" onclick='toggleDiv(this)'>+<span class="">355</span>:         raise ValueError("nb_points must be at least 2")</pre>
<pre class='cython code score-10 '>    __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_builtin_ValueError, __pyx_tuple_, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 355, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_7, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    <span class='error_goto'>__PYX_ERR(0, 355, __pyx_L1_error)</span>
/* … */
  __pyx_tuple_ = <span class='py_c_api'>PyTuple_Pack</span>(1, __pyx_kp_s_nb_points_must_be_at_least_2);<span class='error_goto'> if (unlikely(!__pyx_tuple_)) __PYX_ERR(0, 355, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple_);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple_);
</pre><pre class="cython line score-0">&#xA0;<span class="">356</span>: </pre>
<pre class="cython line score-5" onclick='toggleDiv(this)'>+<span class="">357</span>:     dtype = streamlines[0].dtype</pre>
<pre class='cython code score-5 '>  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_streamlines, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 357, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_7, __pyx_n_s_dtype);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 357, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_v_dtype = __pyx_t_5;
  __pyx_t_5 = 0;
</pre><pre class="cython line score-43" onclick='toggleDiv(this)'>+<span class="">358</span>:     for streamline in streamlines:</pre>
<pre class='cython code score-43 '>  if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_v_streamlines)) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_v_streamlines)) {
    __pyx_t_5 = __pyx_v_streamlines; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5); __pyx_t_4 = 0;
    __pyx_t_16 = NULL;
  } else {
    __pyx_t_4 = -1; __pyx_t_5 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_v_streamlines);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 358, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    __pyx_t_16 = Py_TYPE(__pyx_t_5)-&gt;tp_iternext;<span class='error_goto'> if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 358, __pyx_L1_error)</span>
  }
  for (;;) {
    if (likely(!__pyx_t_16)) {
      if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_5))) {
        if (__pyx_t_4 &gt;= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_5)) break;
        #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_7 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_5, __pyx_t_4); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_7); __pyx_t_4++; if (unlikely(0 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 358, __pyx_L1_error)</span>
        #else
        __pyx_t_7 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_5, __pyx_t_4); __pyx_t_4++;<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 358, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
        #endif
      } else {
        if (__pyx_t_4 &gt;= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_5)) break;
        #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_7 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_5, __pyx_t_4); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_7); __pyx_t_4++; if (unlikely(0 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 358, __pyx_L1_error)</span>
        #else
        __pyx_t_7 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_5, __pyx_t_4); __pyx_t_4++;<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 358, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
        #endif
      }
    } else {
      __pyx_t_7 = __pyx_t_16(__pyx_t_5);
      if (unlikely(!__pyx_t_7)) {
        PyObject* exc_type = <span class='py_c_api'>PyErr_Occurred</span>();
        if (exc_type) {
          if (likely(<span class='pyx_c_api'>__Pyx_PyErr_GivenExceptionMatches</span>(exc_type, PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
          else <span class='error_goto'>__PYX_ERR(0, 358, __pyx_L1_error)</span>
        }
        break;
      }
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    }
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_streamline, __pyx_t_7);
    __pyx_t_7 = 0;
/* … */
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
</pre><pre class="cython line score-11" onclick='toggleDiv(this)'>+<span class="">359</span>:         if streamline.dtype != dtype:</pre>
<pre class='cython code score-11 '>    __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_streamline, __pyx_n_s_dtype);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 359, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    __pyx_t_6 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_t_7, __pyx_v_dtype, Py_NE); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 359, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_6); if (unlikely(__pyx_t_2 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 359, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    if (__pyx_t_2) {
/* … */
    }
</pre><pre class="cython line score-2" onclick='toggleDiv(this)'>+<span class="">360</span>:             dtype = None</pre>
<pre class='cython code score-2 '>      <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_dtype, Py_None);
</pre><pre class="cython line score-0">&#xA0;<span class="">361</span>: </pre>
<pre class="cython line score-5" onclick='toggleDiv(this)'>+<span class="">362</span>:         if len(streamline) &lt; 2:</pre>
<pre class='cython code score-5 '>    __pyx_t_17 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_streamline);<span class='error_goto'> if (unlikely(__pyx_t_17 == ((Py_ssize_t)-1))) __PYX_ERR(0, 362, __pyx_L1_error)</span>
    __pyx_t_2 = ((__pyx_t_17 &lt; 2) != 0);
    if (__pyx_t_2) {
/* … */
    }
</pre><pre class="cython line score-10" onclick='toggleDiv(this)'>+<span class="">363</span>:             raise ValueError("All streamlines must have at least 2 points.")</pre>
<pre class='cython code score-10 '>      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_builtin_ValueError, __pyx_tuple__2, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 363, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_6, 0, 0, 0);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      <span class='error_goto'>__PYX_ERR(0, 363, __pyx_L1_error)</span>
/* … */
  __pyx_tuple__2 = <span class='py_c_api'>PyTuple_Pack</span>(1, __pyx_kp_s_All_streamlines_must_have_at_lea);<span class='error_goto'> if (unlikely(!__pyx_tuple__2)) __PYX_ERR(0, 363, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__2);
</pre><pre class="cython line score-0">&#xA0;<span class="">364</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">365</span>:     # Allocate memory for each modified streamline</pre>
<pre class="cython line score-5" onclick='toggleDiv(this)'>+<span class="">366</span>:     new_streamlines = []</pre>
<pre class='cython code score-5 '>  __pyx_t_5 = <span class='py_c_api'>PyList_New</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 366, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_v_new_streamlines = __pyx_t_5;
  __pyx_t_5 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">367</span>:     cdef np.npy_intp i</pre>
<pre class="cython line score-0">&#xA0;<span class="">368</span>: </pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">369</span>:     if dtype is None:</pre>
<pre class='cython code score-0 '>  __pyx_t_2 = (__pyx_v_dtype == Py_None);
  __pyx_t_3 = (__pyx_t_2 != 0);
  if (__pyx_t_3) {
/* … */
    goto __pyx_L13;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">370</span>:         # List of streamlines having different dtypes</pre>
<pre class="cython line score-5" onclick='toggleDiv(this)'>+<span class="">371</span>:         for i in range(len(streamlines)):</pre>
<pre class='cython code score-5 '>    __pyx_t_4 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_streamlines);<span class='error_goto'> if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 371, __pyx_L1_error)</span>
    for (__pyx_t_18 = 0; __pyx_t_18 &lt; __pyx_t_4; __pyx_t_18+=1) {
      __pyx_v_i = __pyx_t_18;
</pre><pre class="cython line score-6" onclick='toggleDiv(this)'>+<span class="">372</span>:             dtype = streamlines[i].dtype</pre>
<pre class='cython code score-6 '>      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_streamlines, __pyx_v_i, npy_intp, 1, __Pyx_PyInt_From_Py_intptr_t, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 372, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_5, __pyx_n_s_dtype);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 372, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_dtype, __pyx_t_6);
      __pyx_t_6 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">373</span>:             # HACK: To avoid memleaks we have to recast with astype(dtype).</pre>
<pre class="cython line score-43" onclick='toggleDiv(this)'>+<span class="">374</span>:             streamline = streamlines[i].astype(dtype)</pre>
<pre class='cython code score-43 '>      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_streamlines, __pyx_v_i, npy_intp, 1, __Pyx_PyInt_From_Py_intptr_t, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 374, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_5, __pyx_n_s_astype);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 374, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_5 = NULL;
      if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_7))) {
        __pyx_t_5 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_7);
        if (likely(__pyx_t_5)) {
          PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_7);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
          <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_7, function);
        }
      }
      if (!__pyx_t_5) {
        __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_7, __pyx_v_dtype);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 374, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      } else {
        #if CYTHON_FAST_PYCALL
        if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_7)) {
          PyObject *__pyx_temp[2] = {__pyx_t_5, __pyx_v_dtype};
          __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_7, __pyx_temp+1-1, 1+1);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 374, __pyx_L1_error)</span>
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
        } else
        #endif
        #if CYTHON_FAST_PYCCALL
        if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_7)) {
          PyObject *__pyx_temp[2] = {__pyx_t_5, __pyx_v_dtype};
          __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_7, __pyx_temp+1-1, 1+1);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 374, __pyx_L1_error)</span>
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
        } else
        #endif
        {
          __pyx_t_8 = <span class='py_c_api'>PyTuple_New</span>(1+1);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 374, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 0, __pyx_t_5); __pyx_t_5 = NULL;
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_dtype);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_dtype);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 0+1, __pyx_v_dtype);
          __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_7, __pyx_t_8, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 374, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
        }
      }
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
      <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_streamline, __pyx_t_6);
      __pyx_t_6 = 0;
</pre><pre class="cython line score-28" onclick='toggleDiv(this)'>+<span class="">375</span>:             if dtype != np.float32 and dtype != np.float64:</pre>
<pre class='cython code score-28 '>      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 375, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_6, __pyx_n_s_float32);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 375, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_6 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_v_dtype, __pyx_t_7, Py_NE); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 375, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_6); if (unlikely(__pyx_t_2 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 375, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      if (__pyx_t_2) {
      } else {
        __pyx_t_3 = __pyx_t_2;
        goto __pyx_L17_bool_binop_done;
      }
      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 375, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_6, __pyx_n_s_float64);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 375, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_6 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_v_dtype, __pyx_t_7, Py_NE); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 375, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_6); if (unlikely(__pyx_t_2 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 375, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_3 = __pyx_t_2;
      __pyx_L17_bool_binop_done:;
      if (__pyx_t_3) {
/* … */
      }
</pre><pre class="cython line score-6" onclick='toggleDiv(this)'>+<span class="">376</span>:                 dtype = np.float32</pre>
<pre class='cython code score-6 '>        __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 376, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
        __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_6, __pyx_n_s_float32);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 376, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_dtype, __pyx_t_7);
        __pyx_t_7 = 0;
</pre><pre class="cython line score-28" onclick='toggleDiv(this)'>+<span class="">377</span>:                 if dtype == np.int64 or dtype == np.uint64:</pre>
<pre class='cython code score-28 '>        __pyx_t_7 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 377, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
        __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_7, __pyx_n_s_int64);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 377, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
        __pyx_t_7 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_v_dtype, __pyx_t_6, Py_EQ); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 377, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
        __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_7); if (unlikely(__pyx_t_2 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 377, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
        if (!__pyx_t_2) {
        } else {
          __pyx_t_3 = __pyx_t_2;
          goto __pyx_L20_bool_binop_done;
        }
        __pyx_t_7 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 377, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
        __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_7, __pyx_n_s_uint64);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 377, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
        __pyx_t_7 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_v_dtype, __pyx_t_6, Py_EQ); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 377, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
        __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_7); if (unlikely(__pyx_t_2 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 377, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
        __pyx_t_3 = __pyx_t_2;
        __pyx_L20_bool_binop_done:;
        if (__pyx_t_3) {
/* … */
        }
</pre><pre class="cython line score-6" onclick='toggleDiv(this)'>+<span class="">378</span>:                     dtype = np.float64</pre>
<pre class='cython code score-6 '>          __pyx_t_7 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 378, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
          __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_7, __pyx_n_s_float64);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 378, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_dtype, __pyx_t_6);
          __pyx_t_6 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">379</span>: </pre>
<pre class="cython line score-40" onclick='toggleDiv(this)'>+<span class="">380</span>:                 streamline = streamline.astype(dtype)</pre>
<pre class='cython code score-40 '>        __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_streamline, __pyx_n_s_astype);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 380, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
        __pyx_t_8 = NULL;
        if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_7))) {
          __pyx_t_8 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_7);
          if (likely(__pyx_t_8)) {
            PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_7);
            <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_8);
            <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
            <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_7, function);
          }
        }
        if (!__pyx_t_8) {
          __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_7, __pyx_v_dtype);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 380, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
        } else {
          #if CYTHON_FAST_PYCALL
          if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_7)) {
            PyObject *__pyx_temp[2] = {__pyx_t_8, __pyx_v_dtype};
            __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_7, __pyx_temp+1-1, 1+1);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 380, __pyx_L1_error)</span>
            <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
          } else
          #endif
          #if CYTHON_FAST_PYCCALL
          if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_7)) {
            PyObject *__pyx_temp[2] = {__pyx_t_8, __pyx_v_dtype};
            __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_7, __pyx_temp+1-1, 1+1);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 380, __pyx_L1_error)</span>
            <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
          } else
          #endif
          {
            __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(1+1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 380, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
            <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_8); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_8); __pyx_t_8 = NULL;
            <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_dtype);
            <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_dtype);
            <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0+1, __pyx_v_dtype);
            __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_7, __pyx_t_5, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 380, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
          }
        }
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_streamline, __pyx_t_6);
        __pyx_t_6 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">381</span>: </pre>
<pre class="cython line score-30" onclick='toggleDiv(this)'>+<span class="">382</span>:             new_streamline = np.empty((nb_points, streamline.shape[1]),</pre>
<pre class='cython code score-30 '>      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 382, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_6, __pyx_n_s_empty);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 382, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_streamline, __pyx_n_s_shape);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 382, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_6, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 382, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_6 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 382, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_nb_points);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_nb_points);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 0, __pyx_v_nb_points);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 1, __pyx_t_5);
      __pyx_t_5 = 0;
      __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 382, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_6);
      __pyx_t_6 = 0;
/* … */
      __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_7, __pyx_t_5, __pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 382, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_new_streamline, __pyx_t_8);
      __pyx_t_8 = 0;
</pre><pre class="cython line score-7" onclick='toggleDiv(this)'>+<span class="">383</span>:                                       dtype=dtype)</pre>
<pre class='cython code score-7 '>      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 383, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_6, __pyx_n_s_dtype, __pyx_v_dtype) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 383, __pyx_L1_error)</span>
</pre><pre class="cython line score-14" onclick='toggleDiv(this)'>+<span class="">384</span>:             if dtype == np.float32:</pre>
<pre class='cython code score-14 '>      __pyx_t_8 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 384, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_8, __pyx_n_s_float32);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 384, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
      __pyx_t_8 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_v_dtype, __pyx_t_6, Py_EQ); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_8);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 384, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_8); if (unlikely(__pyx_t_3 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 384, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
      if (__pyx_t_3) {
/* … */
        goto __pyx_L22;
      }
</pre><pre class="cython line score-4" onclick='toggleDiv(this)'>+<span class="">385</span>:                 c_set_number_of_points[float2d](streamline, new_streamline)</pre>
<pre class='cython code score-4 '>        __pyx_t_13 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_float</span>(__pyx_v_streamline);
        if (unlikely(!__pyx_t_13.memview)) <span class='error_goto'>__PYX_ERR(0, 385, __pyx_L1_error)</span>
        __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_float</span>(__pyx_v_new_streamline);
        if (unlikely(!__pyx_t_9.memview)) <span class='error_goto'>__PYX_ERR(0, 385, __pyx_L1_error)</span>
        __pyx_fuse_0__pyx_f_4dipy_8tracking_15streamlinespeed_c_set_number_of_points(__pyx_t_13, __pyx_t_9);
        __PYX_XDEC_MEMVIEW(&amp;__pyx_t_13, 1);
        __pyx_t_13.memview = NULL;
        __pyx_t_13.data = NULL;
        __PYX_XDEC_MEMVIEW(&amp;__pyx_t_9, 1);
        __pyx_t_9.memview = NULL;
        __pyx_t_9.data = NULL;
</pre><pre class="cython line score-0">&#xA0;<span class="">386</span>:             else:</pre>
<pre class="cython line score-4" onclick='toggleDiv(this)'>+<span class="">387</span>:                 c_set_number_of_points[double2d](streamline, new_streamline)</pre>
<pre class='cython code score-4 '>      /*else*/ {
        __pyx_t_15 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(__pyx_v_streamline);
        if (unlikely(!__pyx_t_15.memview)) <span class='error_goto'>__PYX_ERR(0, 387, __pyx_L1_error)</span>
        __pyx_t_14 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(__pyx_v_new_streamline);
        if (unlikely(!__pyx_t_14.memview)) <span class='error_goto'>__PYX_ERR(0, 387, __pyx_L1_error)</span>
        __pyx_fuse_1__pyx_f_4dipy_8tracking_15streamlinespeed_c_set_number_of_points(__pyx_t_15, __pyx_t_14);
        __PYX_XDEC_MEMVIEW(&amp;__pyx_t_15, 1);
        __pyx_t_15.memview = NULL;
        __pyx_t_15.data = NULL;
        __PYX_XDEC_MEMVIEW(&amp;__pyx_t_14, 1);
        __pyx_t_14.memview = NULL;
        __pyx_t_14.data = NULL;
      }
      __pyx_L22:;
</pre><pre class="cython line score-0">&#xA0;<span class="">388</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">389</span>:             # HACK: To avoid memleaks we have to recast with astype(dtype).</pre>
<pre class="cython line score-42" onclick='toggleDiv(this)'>+<span class="">390</span>:             new_streamlines.append(new_streamline.astype(dtype))</pre>
<pre class='cython code score-42 '>      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_new_streamline, __pyx_n_s_astype);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 390, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      __pyx_t_5 = NULL;
      if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_6))) {
        __pyx_t_5 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_6);
        if (likely(__pyx_t_5)) {
          PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_6);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
          <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_6, function);
        }
      }
      if (!__pyx_t_5) {
        __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_6, __pyx_v_dtype);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 390, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
      } else {
        #if CYTHON_FAST_PYCALL
        if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_6)) {
          PyObject *__pyx_temp[2] = {__pyx_t_5, __pyx_v_dtype};
          __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_6, __pyx_temp+1-1, 1+1);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 390, __pyx_L1_error)</span>
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
        } else
        #endif
        #if CYTHON_FAST_PYCCALL
        if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_6)) {
          PyObject *__pyx_temp[2] = {__pyx_t_5, __pyx_v_dtype};
          __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_6, __pyx_temp+1-1, 1+1);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 390, __pyx_L1_error)</span>
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
        } else
        #endif
        {
          __pyx_t_7 = <span class='py_c_api'>PyTuple_New</span>(1+1);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 390, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 0, __pyx_t_5); __pyx_t_5 = NULL;
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_dtype);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_dtype);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 0+1, __pyx_v_dtype);
          __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_6, __pyx_t_7, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 390, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
        }
      }
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_19 = <span class='pyx_c_api'>__Pyx_PyObject_Append</span>(__pyx_v_new_streamlines, __pyx_t_8);<span class='error_goto'> if (unlikely(__pyx_t_19 == ((int)-1))) __PYX_ERR(0, 390, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    }
</pre><pre class="cython line score-0">&#xA0;<span class="">391</span>: </pre>
<pre class="cython line score-14" onclick='toggleDiv(this)'>+<span class="">392</span>:     elif dtype == np.float32:</pre>
<pre class='cython code score-14 '>  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 392, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_8, __pyx_n_s_float32);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 392, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_t_8 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_v_dtype, __pyx_t_6, Py_EQ); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_8);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 392, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_8); if (unlikely(__pyx_t_3 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 392, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  if (__pyx_t_3) {
/* … */
    goto __pyx_L13;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">393</span>:         # All streamlines have composed of float32 points</pre>
<pre class="cython line score-5" onclick='toggleDiv(this)'>+<span class="">394</span>:         for i in range(len(streamlines)):</pre>
<pre class='cython code score-5 '>    __pyx_t_4 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_streamlines);<span class='error_goto'> if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 394, __pyx_L1_error)</span>
    for (__pyx_t_18 = 0; __pyx_t_18 &lt; __pyx_t_4; __pyx_t_18+=1) {
      __pyx_v_i = __pyx_t_18;
</pre><pre class="cython line score-43" onclick='toggleDiv(this)'>+<span class="">395</span>:             streamline = streamlines[i].astype(dtype)</pre>
<pre class='cython code score-43 '>      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_streamlines, __pyx_v_i, npy_intp, 1, __Pyx_PyInt_From_Py_intptr_t, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 395, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_6, __pyx_n_s_astype);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 395, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_6 = NULL;
      if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_7))) {
        __pyx_t_6 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_7);
        if (likely(__pyx_t_6)) {
          PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_7);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_6);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
          <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_7, function);
        }
      }
      if (!__pyx_t_6) {
        __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_7, __pyx_v_dtype);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 395, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
      } else {
        #if CYTHON_FAST_PYCALL
        if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_7)) {
          PyObject *__pyx_temp[2] = {__pyx_t_6, __pyx_v_dtype};
          __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_7, __pyx_temp+1-1, 1+1);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 395, __pyx_L1_error)</span>
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
        } else
        #endif
        #if CYTHON_FAST_PYCCALL
        if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_7)) {
          PyObject *__pyx_temp[2] = {__pyx_t_6, __pyx_v_dtype};
          __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_7, __pyx_temp+1-1, 1+1);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 395, __pyx_L1_error)</span>
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
        } else
        #endif
        {
          __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(1+1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 395, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_6); __pyx_t_6 = NULL;
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_dtype);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_dtype);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0+1, __pyx_v_dtype);
          __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_7, __pyx_t_5, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 395, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
        }
      }
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
      <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_streamline, __pyx_t_8);
      __pyx_t_8 = 0;
</pre><pre class="cython line score-30" onclick='toggleDiv(this)'>+<span class="">396</span>:             modified_streamline = np.empty((nb_points, streamline.shape[1]),</pre>
<pre class='cython code score-30 '>      __pyx_t_8 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 396, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
      __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_8, __pyx_n_s_empty);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 396, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
      __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_streamline, __pyx_n_s_shape);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 396, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_8, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 396, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
      __pyx_t_8 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 396, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_nb_points);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_nb_points);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 0, __pyx_v_nb_points);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 1, __pyx_t_5);
      __pyx_t_5 = 0;
      __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 396, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_8);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_8);
      __pyx_t_8 = 0;
/* … */
      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_7, __pyx_t_5, __pyx_t_8);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 396, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
      <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_modified_streamline, __pyx_t_6);
      __pyx_t_6 = 0;
</pre><pre class="cython line score-10" onclick='toggleDiv(this)'>+<span class="">397</span>:                                            dtype=streamline.dtype)</pre>
<pre class='cython code score-10 '>      __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 397, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_streamline, __pyx_n_s_dtype);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 397, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_8, __pyx_n_s_dtype, __pyx_t_6) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 397, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
</pre><pre class="cython line score-4" onclick='toggleDiv(this)'>+<span class="">398</span>:             c_set_number_of_points[float2d](streamline, modified_streamline)</pre>
<pre class='cython code score-4 '>      __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_float</span>(__pyx_v_streamline);
      if (unlikely(!__pyx_t_9.memview)) <span class='error_goto'>__PYX_ERR(0, 398, __pyx_L1_error)</span>
      __pyx_t_13 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_float</span>(__pyx_v_modified_streamline);
      if (unlikely(!__pyx_t_13.memview)) <span class='error_goto'>__PYX_ERR(0, 398, __pyx_L1_error)</span>
      __pyx_fuse_0__pyx_f_4dipy_8tracking_15streamlinespeed_c_set_number_of_points(__pyx_t_9, __pyx_t_13);
      __PYX_XDEC_MEMVIEW(&amp;__pyx_t_9, 1);
      __pyx_t_9.memview = NULL;
      __pyx_t_9.data = NULL;
      __PYX_XDEC_MEMVIEW(&amp;__pyx_t_13, 1);
      __pyx_t_13.memview = NULL;
      __pyx_t_13.data = NULL;
</pre><pre class="cython line score-0">&#xA0;<span class="">399</span>:             # HACK: To avoid memleaks we have to recast with astype(dtype).</pre>
<pre class="cython line score-42" onclick='toggleDiv(this)'>+<span class="">400</span>:             new_streamlines.append(modified_streamline.astype(dtype))</pre>
<pre class='cython code score-42 '>      __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_modified_streamline, __pyx_n_s_astype);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 400, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
      __pyx_t_5 = NULL;
      if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_8))) {
        __pyx_t_5 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_8);
        if (likely(__pyx_t_5)) {
          PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_8);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
          <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_8, function);
        }
      }
      if (!__pyx_t_5) {
        __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_8, __pyx_v_dtype);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 400, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      } else {
        #if CYTHON_FAST_PYCALL
        if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_8)) {
          PyObject *__pyx_temp[2] = {__pyx_t_5, __pyx_v_dtype};
          __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_8, __pyx_temp+1-1, 1+1);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 400, __pyx_L1_error)</span>
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
        } else
        #endif
        #if CYTHON_FAST_PYCCALL
        if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_8)) {
          PyObject *__pyx_temp[2] = {__pyx_t_5, __pyx_v_dtype};
          __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_8, __pyx_temp+1-1, 1+1);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 400, __pyx_L1_error)</span>
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
        } else
        #endif
        {
          __pyx_t_7 = <span class='py_c_api'>PyTuple_New</span>(1+1);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 400, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 0, __pyx_t_5); __pyx_t_5 = NULL;
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_dtype);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_dtype);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 0+1, __pyx_v_dtype);
          __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_8, __pyx_t_7, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 400, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
        }
      }
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
      __pyx_t_19 = <span class='pyx_c_api'>__Pyx_PyObject_Append</span>(__pyx_v_new_streamlines, __pyx_t_6);<span class='error_goto'> if (unlikely(__pyx_t_19 == ((int)-1))) __PYX_ERR(0, 400, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    }
</pre><pre class="cython line score-14" onclick='toggleDiv(this)'>+<span class="">401</span>:     elif dtype == np.float64:</pre>
<pre class='cython code score-14 '>  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 401, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_6, __pyx_n_s_float64);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 401, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_6 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_v_dtype, __pyx_t_8, Py_EQ); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 401, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_6); if (unlikely(__pyx_t_3 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 401, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  if (__pyx_t_3) {
/* … */
    goto __pyx_L13;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">402</span>:         # All streamlines are composed of float64 points</pre>
<pre class="cython line score-5" onclick='toggleDiv(this)'>+<span class="">403</span>:         for i in range(len(streamlines)):</pre>
<pre class='cython code score-5 '>    __pyx_t_4 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_streamlines);<span class='error_goto'> if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 403, __pyx_L1_error)</span>
    for (__pyx_t_18 = 0; __pyx_t_18 &lt; __pyx_t_4; __pyx_t_18+=1) {
      __pyx_v_i = __pyx_t_18;
</pre><pre class="cython line score-43" onclick='toggleDiv(this)'>+<span class="">404</span>:             streamline = streamlines[i].astype(dtype)</pre>
<pre class='cython code score-43 '>      __pyx_t_8 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_streamlines, __pyx_v_i, npy_intp, 1, __Pyx_PyInt_From_Py_intptr_t, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 404, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
      __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_8, __pyx_n_s_astype);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 404, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
      __pyx_t_8 = NULL;
      if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_7))) {
        __pyx_t_8 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_7);
        if (likely(__pyx_t_8)) {
          PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_7);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_8);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
          <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_7, function);
        }
      }
      if (!__pyx_t_8) {
        __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_7, __pyx_v_dtype);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 404, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      } else {
        #if CYTHON_FAST_PYCALL
        if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_7)) {
          PyObject *__pyx_temp[2] = {__pyx_t_8, __pyx_v_dtype};
          __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_7, __pyx_temp+1-1, 1+1);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 404, __pyx_L1_error)</span>
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
        } else
        #endif
        #if CYTHON_FAST_PYCCALL
        if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_7)) {
          PyObject *__pyx_temp[2] = {__pyx_t_8, __pyx_v_dtype};
          __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_7, __pyx_temp+1-1, 1+1);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 404, __pyx_L1_error)</span>
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
        } else
        #endif
        {
          __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(1+1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 404, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_8); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_8); __pyx_t_8 = NULL;
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_dtype);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_dtype);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0+1, __pyx_v_dtype);
          __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_7, __pyx_t_5, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 404, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
        }
      }
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
      <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_streamline, __pyx_t_6);
      __pyx_t_6 = 0;
</pre><pre class="cython line score-30" onclick='toggleDiv(this)'>+<span class="">405</span>:             modified_streamline = np.empty((nb_points, streamline.shape[1]),</pre>
<pre class='cython code score-30 '>      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 405, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_6, __pyx_n_s_empty);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 405, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_streamline, __pyx_n_s_shape);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 405, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_6, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 405, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_6 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 405, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_nb_points);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_nb_points);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 0, __pyx_v_nb_points);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 1, __pyx_t_5);
      __pyx_t_5 = 0;
      __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 405, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_6);
      __pyx_t_6 = 0;
/* … */
      __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_7, __pyx_t_5, __pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 405, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_modified_streamline, __pyx_t_8);
      __pyx_t_8 = 0;
</pre><pre class="cython line score-10" onclick='toggleDiv(this)'>+<span class="">406</span>:                                            dtype=streamline.dtype)</pre>
<pre class='cython code score-10 '>      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 406, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_streamline, __pyx_n_s_dtype);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 406, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
      if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_6, __pyx_n_s_dtype, __pyx_t_8) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 406, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
</pre><pre class="cython line score-4" onclick='toggleDiv(this)'>+<span class="">407</span>:             c_set_number_of_points[double2d](streamline, modified_streamline)</pre>
<pre class='cython code score-4 '>      __pyx_t_14 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(__pyx_v_streamline);
      if (unlikely(!__pyx_t_14.memview)) <span class='error_goto'>__PYX_ERR(0, 407, __pyx_L1_error)</span>
      __pyx_t_15 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(__pyx_v_modified_streamline);
      if (unlikely(!__pyx_t_15.memview)) <span class='error_goto'>__PYX_ERR(0, 407, __pyx_L1_error)</span>
      __pyx_fuse_1__pyx_f_4dipy_8tracking_15streamlinespeed_c_set_number_of_points(__pyx_t_14, __pyx_t_15);
      __PYX_XDEC_MEMVIEW(&amp;__pyx_t_14, 1);
      __pyx_t_14.memview = NULL;
      __pyx_t_14.data = NULL;
      __PYX_XDEC_MEMVIEW(&amp;__pyx_t_15, 1);
      __pyx_t_15.memview = NULL;
      __pyx_t_15.data = NULL;
</pre><pre class="cython line score-0">&#xA0;<span class="">408</span>:             # HACK: To avoid memleaks we have to recast with astype(dtype).</pre>
<pre class="cython line score-42" onclick='toggleDiv(this)'>+<span class="">409</span>:             new_streamlines.append(modified_streamline.astype(dtype))</pre>
<pre class='cython code score-42 '>      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_modified_streamline, __pyx_n_s_astype);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 409, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      __pyx_t_5 = NULL;
      if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_6))) {
        __pyx_t_5 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_6);
        if (likely(__pyx_t_5)) {
          PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_6);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
          <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_6, function);
        }
      }
      if (!__pyx_t_5) {
        __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_6, __pyx_v_dtype);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 409, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
      } else {
        #if CYTHON_FAST_PYCALL
        if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_6)) {
          PyObject *__pyx_temp[2] = {__pyx_t_5, __pyx_v_dtype};
          __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_6, __pyx_temp+1-1, 1+1);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 409, __pyx_L1_error)</span>
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
        } else
        #endif
        #if CYTHON_FAST_PYCCALL
        if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_6)) {
          PyObject *__pyx_temp[2] = {__pyx_t_5, __pyx_v_dtype};
          __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_6, __pyx_temp+1-1, 1+1);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 409, __pyx_L1_error)</span>
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
        } else
        #endif
        {
          __pyx_t_7 = <span class='py_c_api'>PyTuple_New</span>(1+1);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 409, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 0, __pyx_t_5); __pyx_t_5 = NULL;
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_dtype);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_dtype);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 0+1, __pyx_v_dtype);
          __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_6, __pyx_t_7, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 409, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
        }
      }
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_19 = <span class='pyx_c_api'>__Pyx_PyObject_Append</span>(__pyx_v_new_streamlines, __pyx_t_8);<span class='error_goto'> if (unlikely(__pyx_t_19 == ((int)-1))) __PYX_ERR(0, 409, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    }
</pre><pre class="cython line score-28" onclick='toggleDiv(this)'>+<span class="">410</span>:     elif dtype == np.int64 or dtype == np.uint64:</pre>
<pre class='cython code score-28 '>  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 410, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_8, __pyx_n_s_int64);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 410, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_t_8 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_v_dtype, __pyx_t_6, Py_EQ); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_8);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 410, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_8); if (unlikely(__pyx_t_2 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 410, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  if (!__pyx_t_2) {
  } else {
    __pyx_t_3 = __pyx_t_2;
    goto __pyx_L27_bool_binop_done;
  }
  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 410, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_8, __pyx_n_s_uint64);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 410, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_t_8 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_v_dtype, __pyx_t_6, Py_EQ); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_8);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 410, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_8); if (unlikely(__pyx_t_2 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 410, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_t_3 = __pyx_t_2;
  __pyx_L27_bool_binop_done:;
  if (__pyx_t_3) {
/* … */
    goto __pyx_L13;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">411</span>:         # All streamlines are composed of int64 or uint64 points so convert</pre>
<pre class="cython line score-0">&#xA0;<span class="">412</span>:         # them in float64 one at the time</pre>
<pre class="cython line score-5" onclick='toggleDiv(this)'>+<span class="">413</span>:         for i in range(len(streamlines)):</pre>
<pre class='cython code score-5 '>    __pyx_t_4 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_streamlines);<span class='error_goto'> if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 413, __pyx_L1_error)</span>
    for (__pyx_t_18 = 0; __pyx_t_18 &lt; __pyx_t_4; __pyx_t_18+=1) {
      __pyx_v_i = __pyx_t_18;
</pre><pre class="cython line score-50" onclick='toggleDiv(this)'>+<span class="">414</span>:             streamline = streamlines[i].astype(np.float64)</pre>
<pre class='cython code score-50 '>      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_streamlines, __pyx_v_i, npy_intp, 1, __Pyx_PyInt_From_Py_intptr_t, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 414, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_6, __pyx_n_s_astype);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 414, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 414, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_6, __pyx_n_s_float64);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 414, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_6 = NULL;
      if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_7))) {
        __pyx_t_6 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_7);
        if (likely(__pyx_t_6)) {
          PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_7);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_6);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
          <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_7, function);
        }
      }
      if (!__pyx_t_6) {
        __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_7, __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 414, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
      } else {
        #if CYTHON_FAST_PYCALL
        if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_7)) {
          PyObject *__pyx_temp[2] = {__pyx_t_6, __pyx_t_5};
          __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_7, __pyx_temp+1-1, 1+1);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 414, __pyx_L1_error)</span>
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
        } else
        #endif
        #if CYTHON_FAST_PYCCALL
        if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_7)) {
          PyObject *__pyx_temp[2] = {__pyx_t_6, __pyx_t_5};
          __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_7, __pyx_temp+1-1, 1+1);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 414, __pyx_L1_error)</span>
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
        } else
        #endif
        {
          __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1+1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 414, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_t_6); __pyx_t_6 = NULL;
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0+1, __pyx_t_5);
          __pyx_t_5 = 0;
          __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_7, __pyx_t_1, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 414, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
        }
      }
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
      <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_streamline, __pyx_t_8);
      __pyx_t_8 = 0;
</pre><pre class="cython line score-30" onclick='toggleDiv(this)'>+<span class="">415</span>:             modified_streamline = np.empty((nb_points, streamline.shape[1]),</pre>
<pre class='cython code score-30 '>      __pyx_t_8 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 415, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
      __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_8, __pyx_n_s_empty);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 415, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
      __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_streamline, __pyx_n_s_shape);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 415, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_8, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 415, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
      __pyx_t_8 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 415, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_nb_points);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_nb_points);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 0, __pyx_v_nb_points);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 1, __pyx_t_1);
      __pyx_t_1 = 0;
      __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 415, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_8);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_t_8);
      __pyx_t_8 = 0;
/* … */
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_7, __pyx_t_1, __pyx_t_8);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 415, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
      <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_modified_streamline, __pyx_t_5);
      __pyx_t_5 = 0;
</pre><pre class="cython line score-10" onclick='toggleDiv(this)'>+<span class="">416</span>:                                            dtype=streamline.dtype)</pre>
<pre class='cython code score-10 '>      __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 416, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_streamline, __pyx_n_s_dtype);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 416, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_8, __pyx_n_s_dtype, __pyx_t_5) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 416, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
</pre><pre class="cython line score-4" onclick='toggleDiv(this)'>+<span class="">417</span>:             c_set_number_of_points[double2d](streamline, modified_streamline)</pre>
<pre class='cython code score-4 '>      __pyx_t_15 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(__pyx_v_streamline);
      if (unlikely(!__pyx_t_15.memview)) <span class='error_goto'>__PYX_ERR(0, 417, __pyx_L1_error)</span>
      __pyx_t_14 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(__pyx_v_modified_streamline);
      if (unlikely(!__pyx_t_14.memview)) <span class='error_goto'>__PYX_ERR(0, 417, __pyx_L1_error)</span>
      __pyx_fuse_1__pyx_f_4dipy_8tracking_15streamlinespeed_c_set_number_of_points(__pyx_t_15, __pyx_t_14);
      __PYX_XDEC_MEMVIEW(&amp;__pyx_t_15, 1);
      __pyx_t_15.memview = NULL;
      __pyx_t_15.data = NULL;
      __PYX_XDEC_MEMVIEW(&amp;__pyx_t_14, 1);
      __pyx_t_14.memview = NULL;
      __pyx_t_14.data = NULL;
</pre><pre class="cython line score-0">&#xA0;<span class="">418</span>:             # HACK: To avoid memleaks we've to recast with astype(np.float64).</pre>
<pre class="cython line score-49" onclick='toggleDiv(this)'>+<span class="">419</span>:             new_streamlines.append(modified_streamline.astype(np.float64))</pre>
<pre class='cython code score-49 '>      __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_modified_streamline, __pyx_n_s_astype);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 419, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 419, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_float64);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 419, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = NULL;
      if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_8))) {
        __pyx_t_1 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_8);
        if (likely(__pyx_t_1)) {
          PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_8);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
          <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_8, function);
        }
      }
      if (!__pyx_t_1) {
        __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_8, __pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 419, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      } else {
        #if CYTHON_FAST_PYCALL
        if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_8)) {
          PyObject *__pyx_temp[2] = {__pyx_t_1, __pyx_t_7};
          __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_8, __pyx_temp+1-1, 1+1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 419, __pyx_L1_error)</span>
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
        } else
        #endif
        #if CYTHON_FAST_PYCCALL
        if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_8)) {
          PyObject *__pyx_temp[2] = {__pyx_t_1, __pyx_t_7};
          __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_8, __pyx_temp+1-1, 1+1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 419, __pyx_L1_error)</span>
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
        } else
        #endif
        {
          __pyx_t_6 = <span class='py_c_api'>PyTuple_New</span>(1+1);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 419, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 0, __pyx_t_1); __pyx_t_1 = NULL;
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_7);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 0+1, __pyx_t_7);
          __pyx_t_7 = 0;
          __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_8, __pyx_t_6, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 419, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
        }
      }
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
      __pyx_t_19 = <span class='pyx_c_api'>__Pyx_PyObject_Append</span>(__pyx_v_new_streamlines, __pyx_t_5);<span class='error_goto'> if (unlikely(__pyx_t_19 == ((int)-1))) __PYX_ERR(0, 419, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    }
</pre><pre class="cython line score-0">&#xA0;<span class="">420</span>:     else:</pre>
<pre class="cython line score-0">&#xA0;<span class="">421</span>:         # All streamlines are composed of points with a dtype fitting in</pre>
<pre class="cython line score-0">&#xA0;<span class="">422</span>:         # 32bits so convert them in float32 one at the time</pre>
<pre class="cython line score-5" onclick='toggleDiv(this)'>+<span class="">423</span>:         for i in range(len(streamlines)):</pre>
<pre class='cython code score-5 '>  /*else*/ {
    __pyx_t_4 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_streamlines);<span class='error_goto'> if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 423, __pyx_L1_error)</span>
    for (__pyx_t_18 = 0; __pyx_t_18 &lt; __pyx_t_4; __pyx_t_18+=1) {
      __pyx_v_i = __pyx_t_18;
</pre><pre class="cython line score-50" onclick='toggleDiv(this)'>+<span class="">424</span>:             streamline = streamlines[i].astype(np.float32)</pre>
<pre class='cython code score-50 '>      __pyx_t_8 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_streamlines, __pyx_v_i, npy_intp, 1, __Pyx_PyInt_From_Py_intptr_t, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 424, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_8, __pyx_n_s_astype);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 424, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
      __pyx_t_8 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 424, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
      __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_8, __pyx_n_s_float32);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 424, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
      __pyx_t_8 = NULL;
      if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_6))) {
        __pyx_t_8 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_6);
        if (likely(__pyx_t_8)) {
          PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_6);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_8);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
          <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_6, function);
        }
      }
      if (!__pyx_t_8) {
        __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_6, __pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 424, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      } else {
        #if CYTHON_FAST_PYCALL
        if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_6)) {
          PyObject *__pyx_temp[2] = {__pyx_t_8, __pyx_t_7};
          __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_6, __pyx_temp+1-1, 1+1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 424, __pyx_L1_error)</span>
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
        } else
        #endif
        #if CYTHON_FAST_PYCCALL
        if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_6)) {
          PyObject *__pyx_temp[2] = {__pyx_t_8, __pyx_t_7};
          __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_6, __pyx_temp+1-1, 1+1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 424, __pyx_L1_error)</span>
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
        } else
        #endif
        {
          __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1+1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 424, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_8); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_t_8); __pyx_t_8 = NULL;
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_7);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0+1, __pyx_t_7);
          __pyx_t_7 = 0;
          __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_6, __pyx_t_1, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 424, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
        }
      }
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_streamline, __pyx_t_5);
      __pyx_t_5 = 0;
</pre><pre class="cython line score-30" onclick='toggleDiv(this)'>+<span class="">425</span>:             modified_streamline = np.empty((nb_points, streamline.shape[1]),</pre>
<pre class='cython code score-30 '>      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 425, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_5, __pyx_n_s_empty);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 425, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_streamline, __pyx_n_s_shape);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 425, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_5, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 425, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 425, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_nb_points);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_nb_points);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_v_nb_points);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 1, __pyx_t_1);
      __pyx_t_1 = 0;
      __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 425, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_t_5);
      __pyx_t_5 = 0;
/* … */
      __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_6, __pyx_t_1, __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 425, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_modified_streamline, __pyx_t_7);
      __pyx_t_7 = 0;
</pre><pre class="cython line score-10" onclick='toggleDiv(this)'>+<span class="">426</span>:                                            dtype=streamline.dtype)</pre>
<pre class='cython code score-10 '>      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 426, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_streamline, __pyx_n_s_dtype);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 426, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
      if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_7) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 426, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
</pre><pre class="cython line score-4" onclick='toggleDiv(this)'>+<span class="">427</span>:             c_set_number_of_points[float2d](streamline, modified_streamline)</pre>
<pre class='cython code score-4 '>      __pyx_t_13 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_float</span>(__pyx_v_streamline);
      if (unlikely(!__pyx_t_13.memview)) <span class='error_goto'>__PYX_ERR(0, 427, __pyx_L1_error)</span>
      __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_float</span>(__pyx_v_modified_streamline);
      if (unlikely(!__pyx_t_9.memview)) <span class='error_goto'>__PYX_ERR(0, 427, __pyx_L1_error)</span>
      __pyx_fuse_0__pyx_f_4dipy_8tracking_15streamlinespeed_c_set_number_of_points(__pyx_t_13, __pyx_t_9);
      __PYX_XDEC_MEMVIEW(&amp;__pyx_t_13, 1);
      __pyx_t_13.memview = NULL;
      __pyx_t_13.data = NULL;
      __PYX_XDEC_MEMVIEW(&amp;__pyx_t_9, 1);
      __pyx_t_9.memview = NULL;
      __pyx_t_9.data = NULL;
</pre><pre class="cython line score-0">&#xA0;<span class="">428</span>:             # HACK: To avoid memleaks we've to recast with astype(np.float32).</pre>
<pre class="cython line score-49" onclick='toggleDiv(this)'>+<span class="">429</span>:             new_streamlines.append(modified_streamline.astype(np.float32))</pre>
<pre class='cython code score-49 '>      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_modified_streamline, __pyx_n_s_astype);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 429, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 429, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_float32);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 429, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = NULL;
      if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_5))) {
        __pyx_t_1 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_5);
        if (likely(__pyx_t_1)) {
          PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_5);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
          <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_5, function);
        }
      }
      if (!__pyx_t_1) {
        __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_5, __pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 429, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
      } else {
        #if CYTHON_FAST_PYCALL
        if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_5)) {
          PyObject *__pyx_temp[2] = {__pyx_t_1, __pyx_t_6};
          __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_5, __pyx_temp+1-1, 1+1);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 429, __pyx_L1_error)</span>
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
        } else
        #endif
        #if CYTHON_FAST_PYCCALL
        if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_5)) {
          PyObject *__pyx_temp[2] = {__pyx_t_1, __pyx_t_6};
          __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_5, __pyx_temp+1-1, 1+1);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 429, __pyx_L1_error)</span>
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
        } else
        #endif
        {
          __pyx_t_8 = <span class='py_c_api'>PyTuple_New</span>(1+1);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 429, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 0, __pyx_t_1); __pyx_t_1 = NULL;
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 0+1, __pyx_t_6);
          __pyx_t_6 = 0;
          __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_5, __pyx_t_8, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 429, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
        }
      }
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_19 = <span class='pyx_c_api'>__Pyx_PyObject_Append</span>(__pyx_v_new_streamlines, __pyx_t_7);<span class='error_goto'> if (unlikely(__pyx_t_19 == ((int)-1))) __PYX_ERR(0, 429, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    }
  }
  __pyx_L13:;
</pre><pre class="cython line score-0">&#xA0;<span class="">430</span>: </pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">431</span>:     if only_one_streamlines:</pre>
<pre class='cython code score-0 '>  __pyx_t_3 = (__pyx_v_only_one_streamlines != 0);
  if (__pyx_t_3) {
/* … */
  }
</pre><pre class="cython line score-3" onclick='toggleDiv(this)'>+<span class="">432</span>:         return new_streamlines[0]</pre>
<pre class='cython code score-3 '>    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
    __pyx_t_7 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_new_streamlines, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 432, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    __pyx_r = __pyx_t_7;
    __pyx_t_7 = 0;
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">433</span>:     else:</pre>
<pre class="cython line score-2" onclick='toggleDiv(this)'>+<span class="">434</span>:         return new_streamlines</pre>
<pre class='cython code score-2 '>  /*else*/ {
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_new_streamlines);
    __pyx_r = __pyx_v_new_streamlines;
    goto __pyx_L0;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">435</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">436</span>: </pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">437</span>: cdef double c_norm_of_cross_product(double bx, double by, double bz,</pre>
<pre class='cython code score-0 '>static double __pyx_f_4dipy_8tracking_15streamlinespeed_c_norm_of_cross_product(double __pyx_v_bx, double __pyx_v_by, double __pyx_v_bz, double __pyx_v_cx, double __pyx_v_cy, double __pyx_v_cz) {
  double __pyx_v_ax;
  double __pyx_v_ay;
  double __pyx_v_az;
  double __pyx_r;
/* … */
  /* function exit code */
  __pyx_L0:;
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">438</span>:                                     double cx, double cy, double cz) nogil:</pre>
<pre class="cython line score-0">&#xA0;<span class="">439</span>:     """ Computes the norm of the cross-product in 3D. """</pre>
<pre class="cython line score-0">&#xA0;<span class="">440</span>:     cdef double ax, ay, az</pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">441</span>:     ax = by*cz - bz*cy</pre>
<pre class='cython code score-0 '>  __pyx_v_ax = ((__pyx_v_by * __pyx_v_cz) - (__pyx_v_bz * __pyx_v_cy));
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">442</span>:     ay = bz*cx - bx*cz</pre>
<pre class='cython code score-0 '>  __pyx_v_ay = ((__pyx_v_bz * __pyx_v_cx) - (__pyx_v_bx * __pyx_v_cz));
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">443</span>:     az = bx*cy - by*cx</pre>
<pre class='cython code score-0 '>  __pyx_v_az = ((__pyx_v_bx * __pyx_v_cy) - (__pyx_v_by * __pyx_v_cx));
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">444</span>:     return sqrt(ax*ax + ay*ay + az*az)</pre>
<pre class='cython code score-0 '>  __pyx_r = sqrt((((__pyx_v_ax * __pyx_v_ax) + (__pyx_v_ay * __pyx_v_ay)) + (__pyx_v_az * __pyx_v_az)));
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">445</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">446</span>: </pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">447</span>: cdef double c_dist_to_line(Streamline streamline, np.npy_intp prev,</pre>
<pre class='cython code score-0 '>static double __pyx_fuse_0__pyx_f_4dipy_8tracking_15streamlinespeed_c_dist_to_line(__pyx_t_4dipy_8tracking_15streamlinespeed_float2d __pyx_v_streamline, npy_intp __pyx_v_prev, npy_intp __pyx_v_next, npy_intp __pyx_v_curr) {
  double __pyx_v_dn;
  double __pyx_v_norm1;
  double __pyx_v_norm2;
  npy_intp __pyx_v_D;
  npy_intp __pyx_v_d;
  double __pyx_r;
/* … */
  /* function exit code */
  __pyx_L0:;
  return __pyx_r;
}

static double __pyx_fuse_1__pyx_f_4dipy_8tracking_15streamlinespeed_c_dist_to_line(__pyx_t_4dipy_8tracking_15streamlinespeed_double2d __pyx_v_streamline, npy_intp __pyx_v_prev, npy_intp __pyx_v_next, npy_intp __pyx_v_curr) {
  double __pyx_v_dn;
  double __pyx_v_norm1;
  double __pyx_v_norm2;
  npy_intp __pyx_v_D;
  npy_intp __pyx_v_d;
  double __pyx_r;
/* … */
  /* function exit code */
  __pyx_L0:;
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">448</span>:                            np.npy_intp next, np.npy_intp curr) nogil:</pre>
<pre class="cython line score-0">&#xA0;<span class="">449</span>:     """ Computes the shortest Euclidean distance between a point `curr` and</pre>
<pre class="cython line score-0">&#xA0;<span class="">450</span>:         the line passing through `prev` and `next`. """</pre>
<pre class="cython line score-0">&#xA0;<span class="">451</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">452</span>:     cdef:</pre>
<pre class="cython line score-0">&#xA0;<span class="">453</span>:         double dn, norm1, norm2</pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">454</span>:         np.npy_intp D = streamline.shape[1]</pre>
<pre class='cython code score-0 '>  __pyx_v_D = (__pyx_v_streamline.shape[1]);
/* … */
  __pyx_v_D = (__pyx_v_streamline.shape[1]);
</pre><pre class="cython line score-0">&#xA0;<span class="">455</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">456</span>:     # Compute cross product of next-prev and curr-next</pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">457</span>:     norm1 = c_norm_of_cross_product(streamline[next, 0]-streamline[prev, 0],</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = __pyx_v_next;
  __pyx_t_2 = 0;
  __pyx_t_3 = __pyx_v_prev;
  __pyx_t_4 = 0;
/* … */
  __pyx_v_norm1 = __pyx_f_4dipy_8tracking_15streamlinespeed_c_norm_of_cross_product(((*((float *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_streamline.data + __pyx_t_1 * __pyx_v_streamline.strides[0]) ) + __pyx_t_2 * __pyx_v_streamline.strides[1]) ))) - (*((float *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_streamline.data + __pyx_t_3 * __pyx_v_streamline.strides[0]) ) + __pyx_t_4 * __pyx_v_streamline.strides[1]) )))), ((*((float *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_streamline.data + __pyx_t_5 * __pyx_v_streamline.strides[0]) ) + __pyx_t_6 * __pyx_v_streamline.strides[1]) ))) - (*((float *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_streamline.data + __pyx_t_7 * __pyx_v_streamline.strides[0]) ) + __pyx_t_8 * __pyx_v_streamline.strides[1]) )))), ((*((float *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_streamline.data + __pyx_t_9 * __pyx_v_streamline.strides[0]) ) + __pyx_t_10 * __pyx_v_streamline.strides[1]) ))) - (*((float *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_streamline.data + __pyx_t_11 * __pyx_v_streamline.strides[0]) ) + __pyx_t_12 * __pyx_v_streamline.strides[1]) )))), ((*((float *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_streamline.data + __pyx_t_13 * __pyx_v_streamline.strides[0]) ) + __pyx_t_14 * __pyx_v_streamline.strides[1]) ))) - (*((float *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_streamline.data + __pyx_t_15 * __pyx_v_streamline.strides[0]) ) + __pyx_t_16 * __pyx_v_streamline.strides[1]) )))), ((*((float *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_streamline.data + __pyx_t_17 * __pyx_v_streamline.strides[0]) ) + __pyx_t_18 * __pyx_v_streamline.strides[1]) ))) - (*((float *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_streamline.data + __pyx_t_19 * __pyx_v_streamline.strides[0]) ) + __pyx_t_20 * __pyx_v_streamline.strides[1]) )))), ((*((float *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_streamline.data + __pyx_t_21 * __pyx_v_streamline.strides[0]) ) + __pyx_t_22 * __pyx_v_streamline.strides[1]) ))) - (*((float *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_streamline.data + __pyx_t_23 * __pyx_v_streamline.strides[0]) ) + __pyx_t_24 * __pyx_v_streamline.strides[1]) )))));
/* … */
  __pyx_t_1 = __pyx_v_next;
  __pyx_t_2 = 0;
  __pyx_t_3 = __pyx_v_prev;
  __pyx_t_4 = 0;
/* … */
  __pyx_v_norm1 = __pyx_f_4dipy_8tracking_15streamlinespeed_c_norm_of_cross_product(((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_streamline.data + __pyx_t_1 * __pyx_v_streamline.strides[0]) ) + __pyx_t_2 * __pyx_v_streamline.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_streamline.data + __pyx_t_3 * __pyx_v_streamline.strides[0]) ) + __pyx_t_4 * __pyx_v_streamline.strides[1]) )))), ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_streamline.data + __pyx_t_5 * __pyx_v_streamline.strides[0]) ) + __pyx_t_6 * __pyx_v_streamline.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_streamline.data + __pyx_t_7 * __pyx_v_streamline.strides[0]) ) + __pyx_t_8 * __pyx_v_streamline.strides[1]) )))), ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_streamline.data + __pyx_t_9 * __pyx_v_streamline.strides[0]) ) + __pyx_t_10 * __pyx_v_streamline.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_streamline.data + __pyx_t_11 * __pyx_v_streamline.strides[0]) ) + __pyx_t_12 * __pyx_v_streamline.strides[1]) )))), ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_streamline.data + __pyx_t_13 * __pyx_v_streamline.strides[0]) ) + __pyx_t_14 * __pyx_v_streamline.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_streamline.data + __pyx_t_15 * __pyx_v_streamline.strides[0]) ) + __pyx_t_16 * __pyx_v_streamline.strides[1]) )))), ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_streamline.data + __pyx_t_17 * __pyx_v_streamline.strides[0]) ) + __pyx_t_18 * __pyx_v_streamline.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_streamline.data + __pyx_t_19 * __pyx_v_streamline.strides[0]) ) + __pyx_t_20 * __pyx_v_streamline.strides[1]) )))), ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_streamline.data + __pyx_t_21 * __pyx_v_streamline.strides[0]) ) + __pyx_t_22 * __pyx_v_streamline.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_streamline.data + __pyx_t_23 * __pyx_v_streamline.strides[0]) ) + __pyx_t_24 * __pyx_v_streamline.strides[1]) )))));
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">458</span>:                                     streamline[next, 1]-streamline[prev, 1],</pre>
<pre class='cython code score-0 '>  __pyx_t_5 = __pyx_v_next;
  __pyx_t_6 = 1;
  __pyx_t_7 = __pyx_v_prev;
  __pyx_t_8 = 1;
/* … */
  __pyx_t_5 = __pyx_v_next;
  __pyx_t_6 = 1;
  __pyx_t_7 = __pyx_v_prev;
  __pyx_t_8 = 1;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">459</span>:                                     streamline[next, 2]-streamline[prev, 2],</pre>
<pre class='cython code score-0 '>  __pyx_t_9 = __pyx_v_next;
  __pyx_t_10 = 2;
  __pyx_t_11 = __pyx_v_prev;
  __pyx_t_12 = 2;
/* … */
  __pyx_t_9 = __pyx_v_next;
  __pyx_t_10 = 2;
  __pyx_t_11 = __pyx_v_prev;
  __pyx_t_12 = 2;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">460</span>:                                     streamline[curr, 0]-streamline[next, 0],</pre>
<pre class='cython code score-0 '>  __pyx_t_13 = __pyx_v_curr;
  __pyx_t_14 = 0;
  __pyx_t_15 = __pyx_v_next;
  __pyx_t_16 = 0;
/* … */
  __pyx_t_13 = __pyx_v_curr;
  __pyx_t_14 = 0;
  __pyx_t_15 = __pyx_v_next;
  __pyx_t_16 = 0;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">461</span>:                                     streamline[curr, 1]-streamline[next, 1],</pre>
<pre class='cython code score-0 '>  __pyx_t_17 = __pyx_v_curr;
  __pyx_t_18 = 1;
  __pyx_t_19 = __pyx_v_next;
  __pyx_t_20 = 1;
/* … */
  __pyx_t_17 = __pyx_v_curr;
  __pyx_t_18 = 1;
  __pyx_t_19 = __pyx_v_next;
  __pyx_t_20 = 1;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">462</span>:                                     streamline[curr, 2]-streamline[next, 2])</pre>
<pre class='cython code score-0 '>  __pyx_t_21 = __pyx_v_curr;
  __pyx_t_22 = 2;
  __pyx_t_23 = __pyx_v_next;
  __pyx_t_24 = 2;
/* … */
  __pyx_t_21 = __pyx_v_curr;
  __pyx_t_22 = 2;
  __pyx_t_23 = __pyx_v_next;
  __pyx_t_24 = 2;
</pre><pre class="cython line score-0">&#xA0;<span class="">463</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">464</span>:     # Norm of next-prev</pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">465</span>:     norm2 = 0.0</pre>
<pre class='cython code score-0 '>  __pyx_v_norm2 = 0.0;
/* … */
  __pyx_v_norm2 = 0.0;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">466</span>:     for d in range(D):</pre>
<pre class='cython code score-0 '>  __pyx_t_25 = __pyx_v_D;
  for (__pyx_t_26 = 0; __pyx_t_26 &lt; __pyx_t_25; __pyx_t_26+=1) {
    __pyx_v_d = __pyx_t_26;
/* … */
  __pyx_t_25 = __pyx_v_D;
  for (__pyx_t_26 = 0; __pyx_t_26 &lt; __pyx_t_25; __pyx_t_26+=1) {
    __pyx_v_d = __pyx_t_26;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">467</span>:         dn = streamline[next, d]-streamline[prev, d]</pre>
<pre class='cython code score-0 '>    __pyx_t_27 = __pyx_v_next;
    __pyx_t_28 = __pyx_v_d;
    __pyx_t_29 = __pyx_v_prev;
    __pyx_t_30 = __pyx_v_d;
    __pyx_v_dn = ((*((float *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_streamline.data + __pyx_t_27 * __pyx_v_streamline.strides[0]) ) + __pyx_t_28 * __pyx_v_streamline.strides[1]) ))) - (*((float *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_streamline.data + __pyx_t_29 * __pyx_v_streamline.strides[0]) ) + __pyx_t_30 * __pyx_v_streamline.strides[1]) ))));
/* … */
    __pyx_t_27 = __pyx_v_next;
    __pyx_t_28 = __pyx_v_d;
    __pyx_t_29 = __pyx_v_prev;
    __pyx_t_30 = __pyx_v_d;
    __pyx_v_dn = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_streamline.data + __pyx_t_27 * __pyx_v_streamline.strides[0]) ) + __pyx_t_28 * __pyx_v_streamline.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_streamline.data + __pyx_t_29 * __pyx_v_streamline.strides[0]) ) + __pyx_t_30 * __pyx_v_streamline.strides[1]) ))));
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">468</span>:         norm2 += dn*dn</pre>
<pre class='cython code score-0 '>    __pyx_v_norm2 = (__pyx_v_norm2 + (__pyx_v_dn * __pyx_v_dn));
  }
/* … */
    __pyx_v_norm2 = (__pyx_v_norm2 + (__pyx_v_dn * __pyx_v_dn));
  }
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">469</span>:     norm2 = sqrt(norm2)</pre>
<pre class='cython code score-0 '>  __pyx_v_norm2 = sqrt(__pyx_v_norm2);
/* … */
  __pyx_v_norm2 = sqrt(__pyx_v_norm2);
</pre><pre class="cython line score-0">&#xA0;<span class="">470</span>: </pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">471</span>:     return norm1 / norm2</pre>
<pre class='cython code score-0 '>  __pyx_r = (__pyx_v_norm1 / __pyx_v_norm2);
  goto __pyx_L0;
/* … */
  __pyx_r = (__pyx_v_norm1 / __pyx_v_norm2);
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">472</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">473</span>: </pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">474</span>: cdef double c_segment_length(Streamline streamline,</pre>
<pre class='cython code score-0 '>static double __pyx_fuse_0__pyx_f_4dipy_8tracking_15streamlinespeed_c_segment_length(__pyx_t_4dipy_8tracking_15streamlinespeed_float2d __pyx_v_streamline, npy_intp __pyx_v_start, npy_intp __pyx_v_end) {
  npy_intp __pyx_v_D;
  npy_intp __pyx_v_d;
  double __pyx_v_segment_length;
  double __pyx_v_dn;
  double __pyx_r;
/* … */
  /* function exit code */
  __pyx_L0:;
  return __pyx_r;
}

static double __pyx_fuse_1__pyx_f_4dipy_8tracking_15streamlinespeed_c_segment_length(__pyx_t_4dipy_8tracking_15streamlinespeed_double2d __pyx_v_streamline, npy_intp __pyx_v_start, npy_intp __pyx_v_end) {
  npy_intp __pyx_v_D;
  npy_intp __pyx_v_d;
  double __pyx_v_segment_length;
  double __pyx_v_dn;
  double __pyx_r;
/* … */
  /* function exit code */
  __pyx_L0:;
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">475</span>:                              np.npy_intp start, np.npy_intp end) nogil:</pre>
<pre class="cython line score-0">&#xA0;<span class="">476</span>:     """ Computes the length of the segment going from `start` to `end`. """</pre>
<pre class="cython line score-0">&#xA0;<span class="">477</span>:     cdef:</pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">478</span>:         np.npy_intp D = streamline.shape[1]</pre>
<pre class='cython code score-0 '>  __pyx_v_D = (__pyx_v_streamline.shape[1]);
/* … */
  __pyx_v_D = (__pyx_v_streamline.shape[1]);
</pre><pre class="cython line score-0">&#xA0;<span class="">479</span>:         np.npy_intp d</pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">480</span>:         double segment_length = 0.0</pre>
<pre class='cython code score-0 '>  __pyx_v_segment_length = 0.0;
/* … */
  __pyx_v_segment_length = 0.0;
</pre><pre class="cython line score-0">&#xA0;<span class="">481</span>:         double dn</pre>
<pre class="cython line score-0">&#xA0;<span class="">482</span>: </pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">483</span>:     for d in range(D):</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = __pyx_v_D;
  for (__pyx_t_2 = 0; __pyx_t_2 &lt; __pyx_t_1; __pyx_t_2+=1) {
    __pyx_v_d = __pyx_t_2;
/* … */
  __pyx_t_1 = __pyx_v_D;
  for (__pyx_t_2 = 0; __pyx_t_2 &lt; __pyx_t_1; __pyx_t_2+=1) {
    __pyx_v_d = __pyx_t_2;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">484</span>:         dn = streamline[end, d] - streamline[start, d]</pre>
<pre class='cython code score-0 '>    __pyx_t_3 = __pyx_v_end;
    __pyx_t_4 = __pyx_v_d;
    __pyx_t_5 = __pyx_v_start;
    __pyx_t_6 = __pyx_v_d;
    __pyx_v_dn = ((*((float *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_streamline.data + __pyx_t_3 * __pyx_v_streamline.strides[0]) ) + __pyx_t_4 * __pyx_v_streamline.strides[1]) ))) - (*((float *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_streamline.data + __pyx_t_5 * __pyx_v_streamline.strides[0]) ) + __pyx_t_6 * __pyx_v_streamline.strides[1]) ))));
/* … */
    __pyx_t_3 = __pyx_v_end;
    __pyx_t_4 = __pyx_v_d;
    __pyx_t_5 = __pyx_v_start;
    __pyx_t_6 = __pyx_v_d;
    __pyx_v_dn = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_streamline.data + __pyx_t_3 * __pyx_v_streamline.strides[0]) ) + __pyx_t_4 * __pyx_v_streamline.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_streamline.data + __pyx_t_5 * __pyx_v_streamline.strides[0]) ) + __pyx_t_6 * __pyx_v_streamline.strides[1]) ))));
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">485</span>:         segment_length += dn*dn</pre>
<pre class='cython code score-0 '>    __pyx_v_segment_length = (__pyx_v_segment_length + (__pyx_v_dn * __pyx_v_dn));
  }
/* … */
    __pyx_v_segment_length = (__pyx_v_segment_length + (__pyx_v_dn * __pyx_v_dn));
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">486</span>: </pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">487</span>:     return sqrt(segment_length)</pre>
<pre class='cython code score-0 '>  __pyx_r = sqrt(__pyx_v_segment_length);
  goto __pyx_L0;
/* … */
  __pyx_r = sqrt(__pyx_v_segment_length);
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">488</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">489</span>: </pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">490</span>: cdef np.npy_intp c_compress_streamline(Streamline streamline, Streamline out,</pre>
<pre class='cython code score-0 '>static npy_intp __pyx_fuse_0__pyx_f_4dipy_8tracking_15streamlinespeed_c_compress_streamline(__pyx_t_4dipy_8tracking_15streamlinespeed_float2d __pyx_v_streamline, __pyx_t_4dipy_8tracking_15streamlinespeed_float2d __pyx_v_out, double __pyx_v_tol_error, double __pyx_v_max_segment_length) {
  npy_intp __pyx_v_N;
  npy_intp __pyx_v_D;
  npy_intp __pyx_v_nb_points;
  npy_intp __pyx_v_d;
  npy_intp __pyx_v_prev;
  npy_intp __pyx_v_next;
  npy_intp __pyx_v_curr;
  double __pyx_v_dist;
  npy_intp __pyx_r;
/* … */
  /* function exit code */
  __pyx_L0:;
  return __pyx_r;
}

static npy_intp __pyx_fuse_1__pyx_f_4dipy_8tracking_15streamlinespeed_c_compress_streamline(__pyx_t_4dipy_8tracking_15streamlinespeed_double2d __pyx_v_streamline, __pyx_t_4dipy_8tracking_15streamlinespeed_double2d __pyx_v_out, double __pyx_v_tol_error, double __pyx_v_max_segment_length) {
  npy_intp __pyx_v_N;
  npy_intp __pyx_v_D;
  npy_intp __pyx_v_nb_points;
  npy_intp __pyx_v_d;
  npy_intp __pyx_v_prev;
  npy_intp __pyx_v_next;
  npy_intp __pyx_v_curr;
  double __pyx_v_dist;
  npy_intp __pyx_r;
/* … */
  /* function exit code */
  __pyx_L0:;
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">491</span>:                                        double tol_error, double max_segment_length) nogil:</pre>
<pre class="cython line score-0">&#xA0;<span class="">492</span>:     """ Compresses a streamline (see function `compress_streamlines`)."""</pre>
<pre class="cython line score-0">&#xA0;<span class="">493</span>:     cdef:</pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">494</span>:         np.npy_intp N = streamline.shape[0]</pre>
<pre class='cython code score-0 '>  __pyx_v_N = (__pyx_v_streamline.shape[0]);
/* … */
  __pyx_v_N = (__pyx_v_streamline.shape[0]);
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">495</span>:         np.npy_intp D = streamline.shape[1]</pre>
<pre class='cython code score-0 '>  __pyx_v_D = (__pyx_v_streamline.shape[1]);
/* … */
  __pyx_v_D = (__pyx_v_streamline.shape[1]);
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">496</span>:         np.npy_intp nb_points = 0</pre>
<pre class='cython code score-0 '>  __pyx_v_nb_points = 0;
/* … */
  __pyx_v_nb_points = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">497</span>:         np.npy_intp d, prev, next, curr</pre>
<pre class="cython line score-0">&#xA0;<span class="">498</span>:         double segment_length</pre>
<pre class="cython line score-0">&#xA0;<span class="">499</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">500</span>:     # Copy first point since it is always kept.</pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">501</span>:     for d in range(D):</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = __pyx_v_D;
  for (__pyx_t_2 = 0; __pyx_t_2 &lt; __pyx_t_1; __pyx_t_2+=1) {
    __pyx_v_d = __pyx_t_2;
/* … */
  __pyx_t_1 = __pyx_v_D;
  for (__pyx_t_2 = 0; __pyx_t_2 &lt; __pyx_t_1; __pyx_t_2+=1) {
    __pyx_v_d = __pyx_t_2;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">502</span>:         out[0, d] = streamline[0, d]</pre>
<pre class='cython code score-0 '>    __pyx_t_3 = 0;
    __pyx_t_4 = __pyx_v_d;
    __pyx_t_5 = 0;
    __pyx_t_6 = __pyx_v_d;
    *((float *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_out.data + __pyx_t_5 * __pyx_v_out.strides[0]) ) + __pyx_t_6 * __pyx_v_out.strides[1]) )) = (*((float *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_streamline.data + __pyx_t_3 * __pyx_v_streamline.strides[0]) ) + __pyx_t_4 * __pyx_v_streamline.strides[1]) )));
  }
/* … */
    __pyx_t_3 = 0;
    __pyx_t_4 = __pyx_v_d;
    __pyx_t_5 = 0;
    __pyx_t_6 = __pyx_v_d;
    *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_out.data + __pyx_t_5 * __pyx_v_out.strides[0]) ) + __pyx_t_6 * __pyx_v_out.strides[1]) )) = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_streamline.data + __pyx_t_3 * __pyx_v_streamline.strides[0]) ) + __pyx_t_4 * __pyx_v_streamline.strides[1]) )));
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">503</span>: </pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">504</span>:     nb_points = 1</pre>
<pre class='cython code score-0 '>  __pyx_v_nb_points = 1;
/* … */
  __pyx_v_nb_points = 1;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">505</span>:     prev = 0</pre>
<pre class='cython code score-0 '>  __pyx_v_prev = 0;
/* … */
  __pyx_v_prev = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">506</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">507</span>:     # Loop through the points of the streamline checking if we can use the</pre>
<pre class="cython line score-0">&#xA0;<span class="">508</span>:     # linearized segment: next-prev. We start with next=2 (third points) since</pre>
<pre class="cython line score-0">&#xA0;<span class="">509</span>:     # we already added point 0 and segment between the two firsts is linear.</pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">510</span>:     for next in range(2, N):</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = __pyx_v_N;
  for (__pyx_t_2 = 2; __pyx_t_2 &lt; __pyx_t_1; __pyx_t_2+=1) {
    __pyx_v_next = __pyx_t_2;
/* … */
  __pyx_t_1 = __pyx_v_N;
  for (__pyx_t_2 = 2; __pyx_t_2 &lt; __pyx_t_1; __pyx_t_2+=1) {
    __pyx_v_next = __pyx_t_2;
</pre><pre class="cython line score-0">&#xA0;<span class="">511</span>:         # Euclidean distance between last added point and current point.</pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">512</span>:         if c_segment_length(streamline, prev, next) &gt; max_segment_length:</pre>
<pre class='cython code score-0 '>    __pyx_t_7 = ((__pyx_fuse_0__pyx_f_4dipy_8tracking_15streamlinespeed_c_segment_length(__pyx_v_streamline, __pyx_v_prev, __pyx_v_next) &gt; __pyx_v_max_segment_length) != 0);
    if (__pyx_t_7) {
/* … */
    }
/* … */
    __pyx_t_7 = ((__pyx_fuse_1__pyx_f_4dipy_8tracking_15streamlinespeed_c_segment_length(__pyx_v_streamline, __pyx_v_prev, __pyx_v_next) &gt; __pyx_v_max_segment_length) != 0);
    if (__pyx_t_7) {
/* … */
    }
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">513</span>:             for d in range(D):</pre>
<pre class='cython code score-0 '>      __pyx_t_8 = __pyx_v_D;
      for (__pyx_t_9 = 0; __pyx_t_9 &lt; __pyx_t_8; __pyx_t_9+=1) {
        __pyx_v_d = __pyx_t_9;
/* … */
      __pyx_t_8 = __pyx_v_D;
      for (__pyx_t_9 = 0; __pyx_t_9 &lt; __pyx_t_8; __pyx_t_9+=1) {
        __pyx_v_d = __pyx_t_9;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">514</span>:                 out[nb_points, d] = streamline[next-1, d]</pre>
<pre class='cython code score-0 '>        __pyx_t_10 = (__pyx_v_next - 1);
        __pyx_t_11 = __pyx_v_d;
        __pyx_t_12 = __pyx_v_nb_points;
        __pyx_t_13 = __pyx_v_d;
        *((float *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_out.data + __pyx_t_12 * __pyx_v_out.strides[0]) ) + __pyx_t_13 * __pyx_v_out.strides[1]) )) = (*((float *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_streamline.data + __pyx_t_10 * __pyx_v_streamline.strides[0]) ) + __pyx_t_11 * __pyx_v_streamline.strides[1]) )));
      }
/* … */
        __pyx_t_10 = (__pyx_v_next - 1);
        __pyx_t_11 = __pyx_v_d;
        __pyx_t_12 = __pyx_v_nb_points;
        __pyx_t_13 = __pyx_v_d;
        *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_out.data + __pyx_t_12 * __pyx_v_out.strides[0]) ) + __pyx_t_13 * __pyx_v_out.strides[1]) )) = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_streamline.data + __pyx_t_10 * __pyx_v_streamline.strides[0]) ) + __pyx_t_11 * __pyx_v_streamline.strides[1]) )));
      }
</pre><pre class="cython line score-0">&#xA0;<span class="">515</span>: </pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">516</span>:             nb_points += 1</pre>
<pre class='cython code score-0 '>      __pyx_v_nb_points = (__pyx_v_nb_points + 1);
/* … */
      __pyx_v_nb_points = (__pyx_v_nb_points + 1);
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">517</span>:             prev = next-1</pre>
<pre class='cython code score-0 '>      __pyx_v_prev = (__pyx_v_next - 1);
/* … */
      __pyx_v_prev = (__pyx_v_next - 1);
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">518</span>:             continue</pre>
<pre class='cython code score-0 '>      goto __pyx_L5_continue;
/* … */
      goto __pyx_L5_continue;
</pre><pre class="cython line score-0">&#xA0;<span class="">519</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">520</span>:         # Check that each point is not offset by more than `tol_error` mm.</pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">521</span>:         for curr in range(prev+1, next):</pre>
<pre class='cython code score-0 '>    __pyx_t_8 = __pyx_v_next;
    for (__pyx_t_9 = (__pyx_v_prev + 1); __pyx_t_9 &lt; __pyx_t_8; __pyx_t_9+=1) {
      __pyx_v_curr = __pyx_t_9;
/* … */
    __pyx_t_8 = __pyx_v_next;
    for (__pyx_t_9 = (__pyx_v_prev + 1); __pyx_t_9 &lt; __pyx_t_8; __pyx_t_9+=1) {
      __pyx_v_curr = __pyx_t_9;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">522</span>:             dist = c_dist_to_line(streamline, prev, next, curr)</pre>
<pre class='cython code score-0 '>      __pyx_v_dist = __pyx_fuse_0__pyx_f_4dipy_8tracking_15streamlinespeed_c_dist_to_line(__pyx_v_streamline, __pyx_v_prev, __pyx_v_next, __pyx_v_curr);
/* … */
      __pyx_v_dist = __pyx_fuse_1__pyx_f_4dipy_8tracking_15streamlinespeed_c_dist_to_line(__pyx_v_streamline, __pyx_v_prev, __pyx_v_next, __pyx_v_curr);
</pre><pre class="cython line score-0">&#xA0;<span class="">523</span>: </pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">524</span>:             if dpy_isnan(dist) or dist &gt; tol_error:</pre>
<pre class='cython code score-0 '>      __pyx_t_14 = (dpy_isnan(__pyx_v_dist) != 0);
      if (!__pyx_t_14) {
      } else {
        __pyx_t_7 = __pyx_t_14;
        goto __pyx_L13_bool_binop_done;
      }
      __pyx_t_14 = ((__pyx_v_dist &gt; __pyx_v_tol_error) != 0);
      __pyx_t_7 = __pyx_t_14;
      __pyx_L13_bool_binop_done:;
      if (__pyx_t_7) {
/* … */
      }
    }
    __pyx_L11_break:;
    __pyx_L5_continue:;
  }
/* … */
      __pyx_t_14 = (dpy_isnan(__pyx_v_dist) != 0);
      if (!__pyx_t_14) {
      } else {
        __pyx_t_7 = __pyx_t_14;
        goto __pyx_L13_bool_binop_done;
      }
      __pyx_t_14 = ((__pyx_v_dist &gt; __pyx_v_tol_error) != 0);
      __pyx_t_7 = __pyx_t_14;
      __pyx_L13_bool_binop_done:;
      if (__pyx_t_7) {
/* … */
      }
    }
    __pyx_L11_break:;
    __pyx_L5_continue:;
  }
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">525</span>:                 for d in range(D):</pre>
<pre class='cython code score-0 '>        __pyx_t_15 = __pyx_v_D;
        for (__pyx_t_16 = 0; __pyx_t_16 &lt; __pyx_t_15; __pyx_t_16+=1) {
          __pyx_v_d = __pyx_t_16;
/* … */
        __pyx_t_15 = __pyx_v_D;
        for (__pyx_t_16 = 0; __pyx_t_16 &lt; __pyx_t_15; __pyx_t_16+=1) {
          __pyx_v_d = __pyx_t_16;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">526</span>:                     out[nb_points, d] = streamline[next-1, d]</pre>
<pre class='cython code score-0 '>          __pyx_t_17 = (__pyx_v_next - 1);
          __pyx_t_18 = __pyx_v_d;
          __pyx_t_19 = __pyx_v_nb_points;
          __pyx_t_20 = __pyx_v_d;
          *((float *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_out.data + __pyx_t_19 * __pyx_v_out.strides[0]) ) + __pyx_t_20 * __pyx_v_out.strides[1]) )) = (*((float *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_streamline.data + __pyx_t_17 * __pyx_v_streamline.strides[0]) ) + __pyx_t_18 * __pyx_v_streamline.strides[1]) )));
        }
/* … */
          __pyx_t_17 = (__pyx_v_next - 1);
          __pyx_t_18 = __pyx_v_d;
          __pyx_t_19 = __pyx_v_nb_points;
          __pyx_t_20 = __pyx_v_d;
          *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_out.data + __pyx_t_19 * __pyx_v_out.strides[0]) ) + __pyx_t_20 * __pyx_v_out.strides[1]) )) = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_streamline.data + __pyx_t_17 * __pyx_v_streamline.strides[0]) ) + __pyx_t_18 * __pyx_v_streamline.strides[1]) )));
        }
</pre><pre class="cython line score-0">&#xA0;<span class="">527</span>: </pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">528</span>:                 nb_points += 1</pre>
<pre class='cython code score-0 '>        __pyx_v_nb_points = (__pyx_v_nb_points + 1);
/* … */
        __pyx_v_nb_points = (__pyx_v_nb_points + 1);
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">529</span>:                 prev = next-1</pre>
<pre class='cython code score-0 '>        __pyx_v_prev = (__pyx_v_next - 1);
/* … */
        __pyx_v_prev = (__pyx_v_next - 1);
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">530</span>:                 break</pre>
<pre class='cython code score-0 '>        goto __pyx_L11_break;
/* … */
        goto __pyx_L11_break;
</pre><pre class="cython line score-0">&#xA0;<span class="">531</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">532</span>:     # Copy last point since it is always kept.</pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">533</span>:     for d in range(D):</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = __pyx_v_D;
  for (__pyx_t_2 = 0; __pyx_t_2 &lt; __pyx_t_1; __pyx_t_2+=1) {
    __pyx_v_d = __pyx_t_2;
/* … */
  __pyx_t_1 = __pyx_v_D;
  for (__pyx_t_2 = 0; __pyx_t_2 &lt; __pyx_t_1; __pyx_t_2+=1) {
    __pyx_v_d = __pyx_t_2;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">534</span>:         out[nb_points, d] = streamline[N-1, d]</pre>
<pre class='cython code score-0 '>    __pyx_t_21 = (__pyx_v_N - 1);
    __pyx_t_22 = __pyx_v_d;
    __pyx_t_23 = __pyx_v_nb_points;
    __pyx_t_24 = __pyx_v_d;
    *((float *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_out.data + __pyx_t_23 * __pyx_v_out.strides[0]) ) + __pyx_t_24 * __pyx_v_out.strides[1]) )) = (*((float *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_streamline.data + __pyx_t_21 * __pyx_v_streamline.strides[0]) ) + __pyx_t_22 * __pyx_v_streamline.strides[1]) )));
  }
/* … */
    __pyx_t_21 = (__pyx_v_N - 1);
    __pyx_t_22 = __pyx_v_d;
    __pyx_t_23 = __pyx_v_nb_points;
    __pyx_t_24 = __pyx_v_d;
    *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_out.data + __pyx_t_23 * __pyx_v_out.strides[0]) ) + __pyx_t_24 * __pyx_v_out.strides[1]) )) = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_streamline.data + __pyx_t_21 * __pyx_v_streamline.strides[0]) ) + __pyx_t_22 * __pyx_v_streamline.strides[1]) )));
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">535</span>: </pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">536</span>:     nb_points += 1</pre>
<pre class='cython code score-0 '>  __pyx_v_nb_points = (__pyx_v_nb_points + 1);
/* … */
  __pyx_v_nb_points = (__pyx_v_nb_points + 1);
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">537</span>:     return nb_points</pre>
<pre class='cython code score-0 '>  __pyx_r = __pyx_v_nb_points;
  goto __pyx_L0;
/* … */
  __pyx_r = __pyx_v_nb_points;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">538</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">539</span>: </pre>
<pre class="cython line score-63" onclick='toggleDiv(this)'>+<span class="">540</span>: def compress_streamlines(streamlines, tol_error=0.01, max_segment_length=10):</pre>
<pre class='cython code score-63 '>/* Python wrapper */
static PyObject *__pyx_pw_4dipy_8tracking_15streamlinespeed_5compress_streamlines(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4dipy_8tracking_15streamlinespeed_4compress_streamlines[] = " Compress streamlines by linearization as in [Presseau15]_.\n\n    The compression consists in merging consecutive segments that are\n    nearly collinear. The merging is achieved by removing the point the two\n    segments have in common.\n\n    The linearization process [Presseau15]_ ensures that every point being\n    removed are within a certain margin (in mm) of the resulting streamline.\n    Recommendations for setting this margin can be found in [Presseau15]_\n    (in which they called it tolerance error).\n\n    The compression also ensures that two consecutive points won't be too far\n    from each other (precisely less or equal than `max_segment_length`mm).\n    This is a tradeoff to speed up the linearization process [Rheault15]_. A low\n    value will result in a faster linearization but low compression, whereas\n    a high value will result in a slower linearization but high compression.\n\n    Parameters\n    ----------\n    streamlines : one or a list of array-like of shape (N,3)\n        Array representing x,y,z of N points in a streamline.\n    tol_error : float (optional)\n        Tolerance error in mm (default: 0.01). A rule of thumb is to set it\n        to 0.01mm for deterministic streamlines and 0.1mm for probabilitic\n        streamlines.\n    max_segment_length : float (optional)\n        Maximum length in mm of any given segment produced by the compression.\n        The default is 10mm. (In [Presseau15]_, they used a value of `np.inf`).\n\n    Returns\n    -------\n    compressed_streamlines : one or a list of array-like\n        Results of the linearization process.\n\n    Examples\n    --------\n    &gt;&gt;&gt; from dipy.tracking.streamline import compress_streamlines\n    &gt;&gt;&gt; import numpy as np\n    &gt;&gt;&gt; # One streamline: a wiggling line\n    &gt;&gt;&gt; rng = np.random.RandomState(42)\n    &gt;&gt;&gt; streamline = np.linspace(0, 10, 100*3).reshape((100, 3))\n    &gt;&gt;&gt; streamline += 0.2 * rng.rand(100, 3)\n    &gt;&gt;&gt; c_streamline = compress_streamlines(streamline, tol""_error=0.2)\n    &gt;&gt;&gt; len(streamline)\n    100\n    &gt;&gt;&gt; len(c_streamline)\n    10\n    &gt;&gt;&gt; # Multiple streamlines\n    &gt;&gt;&gt; streamlines = [streamline, streamline[::2]]\n    &gt;&gt;&gt; c_streamlines = compress_streamlines(streamlines, tol_error=0.2)\n    &gt;&gt;&gt; [len(s) for s in streamlines]\n    [100, 50]\n    &gt;&gt;&gt; [len(s) for s in c_streamlines]\n    [10, 7]\n\n\n    Notes\n    -----\n    Be aware that compressed streamlines have variable step sizes. One needs to\n    be careful when computing streamlines-based metrics [Houde15]_.\n\n    References\n    ----------\n    .. [Presseau15] Presseau C. et al., A new compression format for fiber\n                    tracking datasets, NeuroImage, no 109, 73-83, 2015.\n    .. [Rheault15] Rheault F. et al., Real Time Interaction with Millions of\n                   Streamlines, ISMRM, 2015.\n    .. [Houde15] Houde J.-C. et al. How to Avoid Biased Streamlines-Based\n                 Metrics for Streamlines with Variable Step Sizes, ISMRM, 2015.\n    ";
static PyMethodDef __pyx_mdef_4dipy_8tracking_15streamlinespeed_5compress_streamlines = {"compress_streamlines", (PyCFunction)__pyx_pw_4dipy_8tracking_15streamlinespeed_5compress_streamlines, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4dipy_8tracking_15streamlinespeed_4compress_streamlines};
static PyObject *__pyx_pw_4dipy_8tracking_15streamlinespeed_5compress_streamlines(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_streamlines = 0;
  PyObject *__pyx_v_tol_error = 0;
  PyObject *__pyx_v_max_segment_length = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("compress_streamlines (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_streamlines,&amp;__pyx_n_s_tol_error,&amp;__pyx_n_s_max_segment_length,0};
    PyObject* values[3] = {0,0,0};
    values[1] = ((PyObject *)__pyx_float_0_01);
    values[2] = ((PyObject *)__pyx_int_10);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_streamlines)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_tol_error);
          if (value) { values[1] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_max_segment_length);
          if (value) { values[2] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "compress_streamlines") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 540, __pyx_L3_error)</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_streamlines = values[0];
    __pyx_v_tol_error = values[1];
    __pyx_v_max_segment_length = values[2];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("compress_streamlines", 0, 1, 3, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 540, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("dipy.tracking.streamlinespeed.compress_streamlines", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_4dipy_8tracking_15streamlinespeed_4compress_streamlines(__pyx_self, __pyx_v_streamlines, __pyx_v_tol_error, __pyx_v_max_segment_length);

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_4dipy_8tracking_15streamlinespeed_4compress_streamlines(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_streamlines, PyObject *__pyx_v_tol_error, PyObject *__pyx_v_max_segment_length) {
  int __pyx_v_only_one_streamlines;
  PyObject *__pyx_v_compressed_streamlines = NULL;
  npy_intp __pyx_v_i;
  PyObject *__pyx_v_dtype = NULL;
  PyObject *__pyx_v_streamline = NULL;
  PyObject *__pyx_v_shape = NULL;
  PyObject *__pyx_v_compressed_streamline = NULL;
  PyObject *__pyx_v_nb_points = NULL;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("compress_streamlines", 0);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_streamlines);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_11, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_12, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_15, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_16, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_17);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("dipy.tracking.streamlinespeed.compress_streamlines", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_compressed_streamlines);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_dtype);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_streamline);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_shape);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_compressed_streamline);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_nb_points);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_streamlines);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__35 = <span class='py_c_api'>PyTuple_Pack</span>(11, __pyx_n_s_streamlines, __pyx_n_s_tol_error, __pyx_n_s_max_segment_length, __pyx_n_s_only_one_streamlines, __pyx_n_s_compressed_streamlines, __pyx_n_s_i, __pyx_n_s_dtype, __pyx_n_s_streamline, __pyx_n_s_shape, __pyx_n_s_compressed_streamline, __pyx_n_s_nb_points);<span class='error_goto'> if (unlikely(!__pyx_tuple__35)) __PYX_ERR(0, 540, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__35);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__35);
/* … */
  __pyx_t_2 = PyCFunction_NewEx(&amp;__pyx_mdef_4dipy_8tracking_15streamlinespeed_5compress_streamlines, NULL, __pyx_n_s_dipy_tracking_streamlinespeed);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 540, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_compress_streamlines, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 540, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_codeobj__36 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(3, 0, 11, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__35, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_dipy_tracking_streamlinespeed_py, __pyx_n_s_compress_streamlines, 540, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__36)) __PYX_ERR(0, 540, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">541</span>:     """ Compress streamlines by linearization as in [Presseau15]_.</pre>
<pre class="cython line score-0">&#xA0;<span class="">542</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">543</span>:     The compression consists in merging consecutive segments that are</pre>
<pre class="cython line score-0">&#xA0;<span class="">544</span>:     nearly collinear. The merging is achieved by removing the point the two</pre>
<pre class="cython line score-0">&#xA0;<span class="">545</span>:     segments have in common.</pre>
<pre class="cython line score-0">&#xA0;<span class="">546</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">547</span>:     The linearization process [Presseau15]_ ensures that every point being</pre>
<pre class="cython line score-0">&#xA0;<span class="">548</span>:     removed are within a certain margin (in mm) of the resulting streamline.</pre>
<pre class="cython line score-0">&#xA0;<span class="">549</span>:     Recommendations for setting this margin can be found in [Presseau15]_</pre>
<pre class="cython line score-0">&#xA0;<span class="">550</span>:     (in which they called it tolerance error).</pre>
<pre class="cython line score-0">&#xA0;<span class="">551</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">552</span>:     The compression also ensures that two consecutive points won't be too far</pre>
<pre class="cython line score-0">&#xA0;<span class="">553</span>:     from each other (precisely less or equal than `max_segment_length`mm).</pre>
<pre class="cython line score-0">&#xA0;<span class="">554</span>:     This is a tradeoff to speed up the linearization process [Rheault15]_. A low</pre>
<pre class="cython line score-0">&#xA0;<span class="">555</span>:     value will result in a faster linearization but low compression, whereas</pre>
<pre class="cython line score-0">&#xA0;<span class="">556</span>:     a high value will result in a slower linearization but high compression.</pre>
<pre class="cython line score-0">&#xA0;<span class="">557</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">558</span>:     Parameters</pre>
<pre class="cython line score-0">&#xA0;<span class="">559</span>:     ----------</pre>
<pre class="cython line score-0">&#xA0;<span class="">560</span>:     streamlines : one or a list of array-like of shape (N,3)</pre>
<pre class="cython line score-0">&#xA0;<span class="">561</span>:         Array representing x,y,z of N points in a streamline.</pre>
<pre class="cython line score-0">&#xA0;<span class="">562</span>:     tol_error : float (optional)</pre>
<pre class="cython line score-0">&#xA0;<span class="">563</span>:         Tolerance error in mm (default: 0.01). A rule of thumb is to set it</pre>
<pre class="cython line score-0">&#xA0;<span class="">564</span>:         to 0.01mm for deterministic streamlines and 0.1mm for probabilitic</pre>
<pre class="cython line score-0">&#xA0;<span class="">565</span>:         streamlines.</pre>
<pre class="cython line score-0">&#xA0;<span class="">566</span>:     max_segment_length : float (optional)</pre>
<pre class="cython line score-0">&#xA0;<span class="">567</span>:         Maximum length in mm of any given segment produced by the compression.</pre>
<pre class="cython line score-0">&#xA0;<span class="">568</span>:         The default is 10mm. (In [Presseau15]_, they used a value of `np.inf`).</pre>
<pre class="cython line score-0">&#xA0;<span class="">569</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">570</span>:     Returns</pre>
<pre class="cython line score-0">&#xA0;<span class="">571</span>:     -------</pre>
<pre class="cython line score-0">&#xA0;<span class="">572</span>:     compressed_streamlines : one or a list of array-like</pre>
<pre class="cython line score-0">&#xA0;<span class="">573</span>:         Results of the linearization process.</pre>
<pre class="cython line score-0">&#xA0;<span class="">574</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">575</span>:     Examples</pre>
<pre class="cython line score-0">&#xA0;<span class="">576</span>:     --------</pre>
<pre class="cython line score-0">&#xA0;<span class="">577</span>:     &gt;&gt;&gt; from dipy.tracking.streamline import compress_streamlines</pre>
<pre class="cython line score-0">&#xA0;<span class="">578</span>:     &gt;&gt;&gt; import numpy as np</pre>
<pre class="cython line score-0">&#xA0;<span class="">579</span>:     &gt;&gt;&gt; # One streamline: a wiggling line</pre>
<pre class="cython line score-0">&#xA0;<span class="">580</span>:     &gt;&gt;&gt; rng = np.random.RandomState(42)</pre>
<pre class="cython line score-0">&#xA0;<span class="">581</span>:     &gt;&gt;&gt; streamline = np.linspace(0, 10, 100*3).reshape((100, 3))</pre>
<pre class="cython line score-0">&#xA0;<span class="">582</span>:     &gt;&gt;&gt; streamline += 0.2 * rng.rand(100, 3)</pre>
<pre class="cython line score-0">&#xA0;<span class="">583</span>:     &gt;&gt;&gt; c_streamline = compress_streamlines(streamline, tol_error=0.2)</pre>
<pre class="cython line score-0">&#xA0;<span class="">584</span>:     &gt;&gt;&gt; len(streamline)</pre>
<pre class="cython line score-0">&#xA0;<span class="">585</span>:     100</pre>
<pre class="cython line score-0">&#xA0;<span class="">586</span>:     &gt;&gt;&gt; len(c_streamline)</pre>
<pre class="cython line score-0">&#xA0;<span class="">587</span>:     10</pre>
<pre class="cython line score-0">&#xA0;<span class="">588</span>:     &gt;&gt;&gt; # Multiple streamlines</pre>
<pre class="cython line score-0">&#xA0;<span class="">589</span>:     &gt;&gt;&gt; streamlines = [streamline, streamline[::2]]</pre>
<pre class="cython line score-0">&#xA0;<span class="">590</span>:     &gt;&gt;&gt; c_streamlines = compress_streamlines(streamlines, tol_error=0.2)</pre>
<pre class="cython line score-0">&#xA0;<span class="">591</span>:     &gt;&gt;&gt; [len(s) for s in streamlines]</pre>
<pre class="cython line score-0">&#xA0;<span class="">592</span>:     [100, 50]</pre>
<pre class="cython line score-0">&#xA0;<span class="">593</span>:     &gt;&gt;&gt; [len(s) for s in c_streamlines]</pre>
<pre class="cython line score-0">&#xA0;<span class="">594</span>:     [10, 7]</pre>
<pre class="cython line score-0">&#xA0;<span class="">595</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">596</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">597</span>:     Notes</pre>
<pre class="cython line score-0">&#xA0;<span class="">598</span>:     -----</pre>
<pre class="cython line score-0">&#xA0;<span class="">599</span>:     Be aware that compressed streamlines have variable step sizes. One needs to</pre>
<pre class="cython line score-0">&#xA0;<span class="">600</span>:     be careful when computing streamlines-based metrics [Houde15]_.</pre>
<pre class="cython line score-0">&#xA0;<span class="">601</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">602</span>:     References</pre>
<pre class="cython line score-0">&#xA0;<span class="">603</span>:     ----------</pre>
<pre class="cython line score-0">&#xA0;<span class="">604</span>:     .. [Presseau15] Presseau C. et al., A new compression format for fiber</pre>
<pre class="cython line score-0">&#xA0;<span class="">605</span>:                     tracking datasets, NeuroImage, no 109, 73-83, 2015.</pre>
<pre class="cython line score-0">&#xA0;<span class="">606</span>:     .. [Rheault15] Rheault F. et al., Real Time Interaction with Millions of</pre>
<pre class="cython line score-0">&#xA0;<span class="">607</span>:                    Streamlines, ISMRM, 2015.</pre>
<pre class="cython line score-0">&#xA0;<span class="">608</span>:     .. [Houde15] Houde J.-C. et al. How to Avoid Biased Streamlines-Based</pre>
<pre class="cython line score-0">&#xA0;<span class="">609</span>:                  Metrics for Streamlines with Variable Step Sizes, ISMRM, 2015.</pre>
<pre class="cython line score-0">&#xA0;<span class="">610</span>:     """</pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">611</span>:     only_one_streamlines = False</pre>
<pre class='cython code score-0 '>  __pyx_v_only_one_streamlines = 0;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">612</span>:     if type(streamlines) is np.ndarray:</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = (((PyObject *)Py_TYPE(__pyx_v_streamlines)) == ((PyObject *)__pyx_ptype_5numpy_ndarray));
  __pyx_t_2 = (__pyx_t_1 != 0);
  if (__pyx_t_2) {
/* … */
  }
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">613</span>:         only_one_streamlines = True</pre>
<pre class='cython code score-0 '>    __pyx_v_only_one_streamlines = 1;
</pre><pre class="cython line score-8" onclick='toggleDiv(this)'>+<span class="">614</span>:         streamlines = [streamlines]</pre>
<pre class='cython code score-8 '>    __pyx_t_3 = <span class='py_c_api'>PyList_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 614, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_streamlines);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_streamlines);
    <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_3, 0, __pyx_v_streamlines);
    <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_streamlines, __pyx_t_3);
    __pyx_t_3 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">615</span>: </pre>
<pre class="cython line score-5" onclick='toggleDiv(this)'>+<span class="">616</span>:     if len(streamlines) == 0:</pre>
<pre class='cython code score-5 '>  __pyx_t_4 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_streamlines);<span class='error_goto'> if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 616, __pyx_L1_error)</span>
  __pyx_t_2 = ((__pyx_t_4 == 0) != 0);
  if (__pyx_t_2) {
/* … */
  }
</pre><pre class="cython line score-6" onclick='toggleDiv(this)'>+<span class="">617</span>:         return []</pre>
<pre class='cython code score-6 '>    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
    __pyx_t_3 = <span class='py_c_api'>PyList_New</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 617, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    __pyx_r = __pyx_t_3;
    __pyx_t_3 = 0;
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">618</span>: </pre>
<pre class="cython line score-5" onclick='toggleDiv(this)'>+<span class="">619</span>:     compressed_streamlines = []</pre>
<pre class='cython code score-5 '>  __pyx_t_3 = <span class='py_c_api'>PyList_New</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 619, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_v_compressed_streamlines = ((PyObject*)__pyx_t_3);
  __pyx_t_3 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">620</span>:     cdef np.npy_intp i</pre>
<pre class="cython line score-5" onclick='toggleDiv(this)'>+<span class="">621</span>:     for i in range(len(streamlines)):</pre>
<pre class='cython code score-5 '>  __pyx_t_4 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_streamlines);<span class='error_goto'> if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 621, __pyx_L1_error)</span>
  for (__pyx_t_5 = 0; __pyx_t_5 &lt; __pyx_t_4; __pyx_t_5+=1) {
    __pyx_v_i = __pyx_t_5;
</pre><pre class="cython line score-6" onclick='toggleDiv(this)'>+<span class="">622</span>:         dtype = streamlines[i].dtype</pre>
<pre class='cython code score-6 '>    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_streamlines, __pyx_v_i, npy_intp, 1, __Pyx_PyInt_From_Py_intptr_t, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 622, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_dtype);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 622, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_dtype, __pyx_t_6);
    __pyx_t_6 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">623</span>:         # HACK: To avoid memleaks we have to recast with astype(dtype).</pre>
<pre class="cython line score-43" onclick='toggleDiv(this)'>+<span class="">624</span>:         streamline = streamlines[i].astype(dtype)</pre>
<pre class='cython code score-43 '>    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_streamlines, __pyx_v_i, npy_intp, 1, __Pyx_PyInt_From_Py_intptr_t, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 624, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_astype);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 624, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = NULL;
    if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_7))) {
      __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_7);
      if (likely(__pyx_t_3)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_7);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_7, function);
      }
    }
    if (!__pyx_t_3) {
      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_7, __pyx_v_dtype);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 624, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    } else {
      #if CYTHON_FAST_PYCALL
      if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_7)) {
        PyObject *__pyx_temp[2] = {__pyx_t_3, __pyx_v_dtype};
        __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_7, __pyx_temp+1-1, 1+1);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 624, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      } else
      #endif
      #if CYTHON_FAST_PYCCALL
      if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_7)) {
        PyObject *__pyx_temp[2] = {__pyx_t_3, __pyx_v_dtype};
        __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_7, __pyx_temp+1-1, 1+1);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 624, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      } else
      #endif
      {
        __pyx_t_8 = <span class='py_c_api'>PyTuple_New</span>(1+1);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 624, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 0, __pyx_t_3); __pyx_t_3 = NULL;
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_dtype);
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_dtype);
        <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 0+1, __pyx_v_dtype);
        __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_7, __pyx_t_8, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 624, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
      }
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_streamline, __pyx_t_6);
    __pyx_t_6 = 0;
</pre><pre class="cython line score-3" onclick='toggleDiv(this)'>+<span class="">625</span>:         shape = streamline.shape</pre>
<pre class='cython code score-3 '>    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_streamline, __pyx_n_s_shape);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 625, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_shape, __pyx_t_6);
    __pyx_t_6 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">626</span>: </pre>
<pre class="cython line score-28" onclick='toggleDiv(this)'>+<span class="">627</span>:         if dtype != np.float32 and dtype != np.float64:</pre>
<pre class='cython code score-28 '>    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 627, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_6, __pyx_n_s_float32);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 627, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_v_dtype, __pyx_t_7, Py_NE); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 627, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_6); if (unlikely(__pyx_t_1 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 627, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    if (__pyx_t_1) {
    } else {
      __pyx_t_2 = __pyx_t_1;
      goto __pyx_L8_bool_binop_done;
    }
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 627, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_6, __pyx_n_s_float64);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 627, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_v_dtype, __pyx_t_7, Py_NE); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 627, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_6); if (unlikely(__pyx_t_1 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 627, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_2 = __pyx_t_1;
    __pyx_L8_bool_binop_done:;
    if (__pyx_t_2) {
/* … */
    }
</pre><pre class="cython line score-39" onclick='toggleDiv(this)'>+<span class="">628</span>:             dtype = np.float64 if dtype == np.int64 or dtype == np.uint64 else np.float32</pre>
<pre class='cython code score-39 '>      __pyx_t_7 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 628, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
      __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_7, __pyx_n_s_int64);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 628, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_t_7 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_v_dtype, __pyx_t_8, Py_EQ); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 628, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_7); if (unlikely(__pyx_t_1 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 628, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
      if (!__pyx_t_1) {
      } else {
        __pyx_t_2 = __pyx_t_1;
        goto __pyx_L10_bool_binop_done;
      }
      __pyx_t_7 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 628, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
      __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_7, __pyx_n_s_uint64);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 628, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_t_7 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_v_dtype, __pyx_t_8, Py_EQ); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 628, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_7); if (unlikely(__pyx_t_1 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 628, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_t_2 = __pyx_t_1;
      __pyx_L10_bool_binop_done:;
      if (__pyx_t_2) {
        __pyx_t_7 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 628, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
        __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_7, __pyx_n_s_float64);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 628, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
        __pyx_t_6 = __pyx_t_8;
        __pyx_t_8 = 0;
      } else {
        __pyx_t_8 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 628, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
        __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_8, __pyx_n_s_float32);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 628, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
        __pyx_t_6 = __pyx_t_7;
        __pyx_t_7 = 0;
      }
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_dtype, __pyx_t_6);
      __pyx_t_6 = 0;
</pre><pre class="cython line score-40" onclick='toggleDiv(this)'>+<span class="">629</span>:             streamline = streamline.astype(dtype)</pre>
<pre class='cython code score-40 '>      __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_streamline, __pyx_n_s_astype);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 629, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
      __pyx_t_8 = NULL;
      if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_7))) {
        __pyx_t_8 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_7);
        if (likely(__pyx_t_8)) {
          PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_7);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_8);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
          <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_7, function);
        }
      }
      if (!__pyx_t_8) {
        __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_7, __pyx_v_dtype);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 629, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      } else {
        #if CYTHON_FAST_PYCALL
        if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_7)) {
          PyObject *__pyx_temp[2] = {__pyx_t_8, __pyx_v_dtype};
          __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_7, __pyx_temp+1-1, 1+1);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 629, __pyx_L1_error)</span>
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
        } else
        #endif
        #if CYTHON_FAST_PYCCALL
        if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_7)) {
          PyObject *__pyx_temp[2] = {__pyx_t_8, __pyx_v_dtype};
          __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_7, __pyx_temp+1-1, 1+1);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 629, __pyx_L1_error)</span>
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
        } else
        #endif
        {
          __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1+1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 629, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_8); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_8); __pyx_t_8 = NULL;
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_dtype);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_dtype);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0+1, __pyx_v_dtype);
          __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_7, __pyx_t_3, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 629, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
        }
      }
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_streamline, __pyx_t_6);
      __pyx_t_6 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">630</span>: </pre>
<pre class="cython line score-11" onclick='toggleDiv(this)'>+<span class="">631</span>:         if shape[0] &lt;= 2:</pre>
<pre class='cython code score-11 '>    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_shape, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 631, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    __pyx_t_7 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_t_6, __pyx_int_2, Py_LE); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 631, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_7); if (unlikely(__pyx_t_2 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 631, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    if (__pyx_t_2) {
/* … */
    }
</pre><pre class="cython line score-21" onclick='toggleDiv(this)'>+<span class="">632</span>:             compressed_streamlines.append(streamline.copy())</pre>
<pre class='cython code score-21 '>      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_streamline, __pyx_n_s_copy);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 632, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      __pyx_t_3 = NULL;
      if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_6))) {
        __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_6);
        if (likely(__pyx_t_3)) {
          PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_6);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
          <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_6, function);
        }
      }
      if (__pyx_t_3) {
        __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_6, __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 632, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
      } else {
        __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_CallNoArg</span>(__pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 632, __pyx_L1_error)</span>
      }
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyList_Append</span>(__pyx_v_compressed_streamlines, __pyx_t_7);<span class='error_goto'> if (unlikely(__pyx_t_9 == ((int)-1))) __PYX_ERR(0, 632, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">633</span>:             continue</pre>
<pre class='cython code score-0 '>      goto __pyx_L5_continue;
</pre><pre class="cython line score-0">&#xA0;<span class="">634</span>: </pre>
<pre class="cython line score-43" onclick='toggleDiv(this)'>+<span class="">635</span>:         compressed_streamline = np.empty(shape, dtype)</pre>
<pre class='cython code score-43 '>    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 635, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_6, __pyx_n_s_empty);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 635, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = NULL;
    __pyx_t_10 = 0;
    if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
      __pyx_t_6 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
      if (likely(__pyx_t_6)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_6);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
        __pyx_t_10 = 1;
      }
    }
    #if CYTHON_FAST_PYCALL
    if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_3)) {
      PyObject *__pyx_temp[3] = {__pyx_t_6, __pyx_v_shape, __pyx_v_dtype};
      __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_3, __pyx_temp+1-__pyx_t_10, 2+__pyx_t_10);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 635, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_3)) {
      PyObject *__pyx_temp[3] = {__pyx_t_6, __pyx_v_shape, __pyx_v_dtype};
      __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_3, __pyx_temp+1-__pyx_t_10, 2+__pyx_t_10);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 635, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    } else
    #endif
    {
      __pyx_t_8 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_10);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 635, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
      if (__pyx_t_6) {
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 0, __pyx_t_6); __pyx_t_6 = NULL;
      }
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_shape);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_shape);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 0+__pyx_t_10, __pyx_v_shape);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_dtype);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_dtype);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 1+__pyx_t_10, __pyx_v_dtype);
      __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_3, __pyx_t_8, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 635, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_compressed_streamline, __pyx_t_7);
    __pyx_t_7 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">636</span>: </pre>
<pre class="cython line score-14" onclick='toggleDiv(this)'>+<span class="">637</span>:         if dtype == np.float32:</pre>
<pre class='cython code score-14 '>    __pyx_t_7 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 637, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_7, __pyx_n_s_float32);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 637, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    __pyx_t_7 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_v_dtype, __pyx_t_3, Py_EQ); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 637, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_7); if (unlikely(__pyx_t_2 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 637, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    if (__pyx_t_2) {
/* … */
      goto __pyx_L13;
    }
</pre><pre class="cython line score-7" onclick='toggleDiv(this)'>+<span class="">638</span>:             nb_points = c_compress_streamline[float2d](streamline, compressed_streamline,</pre>
<pre class='cython code score-7 '>      __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_float</span>(__pyx_v_streamline);
      if (unlikely(!__pyx_t_11.memview)) <span class='error_goto'>__PYX_ERR(0, 638, __pyx_L1_error)</span>
      __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_float</span>(__pyx_v_compressed_streamline);
      if (unlikely(!__pyx_t_12.memview)) <span class='error_goto'>__PYX_ERR(0, 638, __pyx_L1_error)</span>
/* … */
      __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyInt_From_Py_intptr_t</span>(__pyx_fuse_0__pyx_f_4dipy_8tracking_15streamlinespeed_c_compress_streamline(__pyx_t_11, __pyx_t_12, __pyx_t_13, __pyx_t_14));<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 638, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
      __PYX_XDEC_MEMVIEW(&amp;__pyx_t_11, 1);
      __pyx_t_11.memview = NULL;
      __pyx_t_11.data = NULL;
      __PYX_XDEC_MEMVIEW(&amp;__pyx_t_12, 1);
      __pyx_t_12.memview = NULL;
      __pyx_t_12.data = NULL;
      <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_nb_points, __pyx_t_7);
      __pyx_t_7 = 0;
</pre><pre class="cython line score-20" onclick='toggleDiv(this)'>+<span class="">639</span>:                                                        tol_error, max_segment_length)</pre>
<pre class='cython code score-20 '>      __pyx_t_13 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_v_tol_error); if (unlikely((__pyx_t_13 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 639, __pyx_L1_error)</span>
      __pyx_t_14 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_v_max_segment_length); if (unlikely((__pyx_t_14 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 639, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">640</span>:         else:</pre>
<pre class="cython line score-7" onclick='toggleDiv(this)'>+<span class="">641</span>:             nb_points = c_compress_streamline[double2d](streamline, compressed_streamline,</pre>
<pre class='cython code score-7 '>    /*else*/ {
      __pyx_t_15 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(__pyx_v_streamline);
      if (unlikely(!__pyx_t_15.memview)) <span class='error_goto'>__PYX_ERR(0, 641, __pyx_L1_error)</span>
      __pyx_t_16 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(__pyx_v_compressed_streamline);
      if (unlikely(!__pyx_t_16.memview)) <span class='error_goto'>__PYX_ERR(0, 641, __pyx_L1_error)</span>
/* … */
      __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyInt_From_Py_intptr_t</span>(__pyx_fuse_1__pyx_f_4dipy_8tracking_15streamlinespeed_c_compress_streamline(__pyx_t_15, __pyx_t_16, __pyx_t_14, __pyx_t_13));<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 641, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
      __PYX_XDEC_MEMVIEW(&amp;__pyx_t_15, 1);
      __pyx_t_15.memview = NULL;
      __pyx_t_15.data = NULL;
      __PYX_XDEC_MEMVIEW(&amp;__pyx_t_16, 1);
      __pyx_t_16.memview = NULL;
      __pyx_t_16.data = NULL;
      <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_nb_points, __pyx_t_7);
      __pyx_t_7 = 0;
    }
    __pyx_L13:;
</pre><pre class="cython line score-20" onclick='toggleDiv(this)'>+<span class="">642</span>:                                                         tol_error, max_segment_length)</pre>
<pre class='cython code score-20 '>      __pyx_t_14 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_v_tol_error); if (unlikely((__pyx_t_14 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 642, __pyx_L1_error)</span>
      __pyx_t_13 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_v_max_segment_length); if (unlikely((__pyx_t_13 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 642, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">643</span>: </pre>
<pre class="cython line score-55" onclick='toggleDiv(this)'>+<span class="">644</span>:         compressed_streamline.resize((nb_points, streamline.shape[1]))</pre>
<pre class='cython code score-55 '>    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_compressed_streamline, __pyx_n_s_resize);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 644, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_streamline, __pyx_n_s_shape);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 644, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_8, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 644, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    __pyx_t_8 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 644, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_nb_points);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_nb_points);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 0, __pyx_v_nb_points);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 1, __pyx_t_6);
    __pyx_t_6 = 0;
    __pyx_t_6 = NULL;
    if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
      __pyx_t_6 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
      if (likely(__pyx_t_6)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_6);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
      }
    }
    if (!__pyx_t_6) {
      __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_3, __pyx_t_8);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 644, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    } else {
      #if CYTHON_FAST_PYCALL
      if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_3)) {
        PyObject *__pyx_temp[2] = {__pyx_t_6, __pyx_t_8};
        __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_3, __pyx_temp+1-1, 1+1);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 644, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
      } else
      #endif
      #if CYTHON_FAST_PYCCALL
      if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_3)) {
        PyObject *__pyx_temp[2] = {__pyx_t_6, __pyx_t_8};
        __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_3, __pyx_temp+1-1, 1+1);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 644, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
      } else
      #endif
      {
        __pyx_t_17 = <span class='py_c_api'>PyTuple_New</span>(1+1);<span class='error_goto'> if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 644, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_17, 0, __pyx_t_6); __pyx_t_6 = NULL;
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_8);
        <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_17, 0+1, __pyx_t_8);
        __pyx_t_8 = 0;
        __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_3, __pyx_t_17, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 644, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_17); __pyx_t_17 = 0;
      }
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">645</span>:         # HACK: To avoid memleaks we have to recast with astype(dtype).</pre>
<pre class="cython line score-42" onclick='toggleDiv(this)'>+<span class="">646</span>:         compressed_streamlines.append(compressed_streamline.astype(dtype))</pre>
<pre class='cython code score-42 '>    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_compressed_streamline, __pyx_n_s_astype);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 646, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    __pyx_t_17 = NULL;
    if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
      __pyx_t_17 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
      if (likely(__pyx_t_17)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_17);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
      }
    }
    if (!__pyx_t_17) {
      __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_3, __pyx_v_dtype);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 646, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    } else {
      #if CYTHON_FAST_PYCALL
      if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_3)) {
        PyObject *__pyx_temp[2] = {__pyx_t_17, __pyx_v_dtype};
        __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_3, __pyx_temp+1-1, 1+1);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 646, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_17); __pyx_t_17 = 0;
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
      } else
      #endif
      #if CYTHON_FAST_PYCCALL
      if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_3)) {
        PyObject *__pyx_temp[2] = {__pyx_t_17, __pyx_v_dtype};
        __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_3, __pyx_temp+1-1, 1+1);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 646, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_17); __pyx_t_17 = 0;
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
      } else
      #endif
      {
        __pyx_t_8 = <span class='py_c_api'>PyTuple_New</span>(1+1);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 646, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_17); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 0, __pyx_t_17); __pyx_t_17 = NULL;
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_dtype);
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_dtype);
        <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 0+1, __pyx_v_dtype);
        __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_3, __pyx_t_8, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 646, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
      }
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyList_Append</span>(__pyx_v_compressed_streamlines, __pyx_t_7);<span class='error_goto'> if (unlikely(__pyx_t_9 == ((int)-1))) __PYX_ERR(0, 646, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    __pyx_L5_continue:;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">647</span>: </pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">648</span>:     if only_one_streamlines:</pre>
<pre class='cython code score-0 '>  __pyx_t_2 = (__pyx_v_only_one_streamlines != 0);
  if (__pyx_t_2) {
/* … */
  }
</pre><pre class="cython line score-4" onclick='toggleDiv(this)'>+<span class="">649</span>:         return compressed_streamlines[0]</pre>
<pre class='cython code score-4 '>    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(<span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_v_compressed_streamlines, 0));
    __pyx_r = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_v_compressed_streamlines, 0);
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">650</span>:     else:</pre>
<pre class="cython line score-2" onclick='toggleDiv(this)'>+<span class="">651</span>:         return compressed_streamlines</pre>
<pre class='cython code score-2 '>  /*else*/ {
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_compressed_streamlines);
    __pyx_r = __pyx_v_compressed_streamlines;
    goto __pyx_L0;
  }
</pre></div></body></html>
